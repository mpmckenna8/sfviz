!function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=42)}([function(t,e,r){"use strict";function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.d(e,"a",function(){return i})},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.d(e,"a",function(){return i})},function(t,e,r){"use strict";function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),t}r.d(e,"a",function(){return n})},function(t,e,r){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return(n="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}r.d(e,"a",function(){return n})},function(t,e,r){"use strict";function i(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r.d(e,"a",function(){return i})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n="undefined"!=typeof window&&window.addEventListener,a=new Map,o=function(){return n&&window.__SEER_INITIALIZED__},s=function(t,e){var r=a.get(t),i=Date.now();return!!(r&&i-r<e)||(a.set(t,i),!1)},u=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n&&o()){var r=new Set,a=JSON.stringify(e,function(t){return function(e,r){if(!r||"object"!==(void 0===r?"undefined":i(r))||!t.has(r))return t.add(r),Object.prototype.toString.call(r).slice(8,-1).includes("Array")?Array.prototype.slice.call(r,0,20):r}}(r));try{window.postMessage({type:t,payload:a,source:"seer-agent"},"*")}catch(t){if(s("seer-log",2e3))return;console.log(t)}}},l=new Map,c=function(t){if(t&&t.data&&"seer-core"===t.data.source){var e=t.data,r=e.type,i=e.payload,n=l.get(r);n&&n.forEach(function(t){return t(i)})}},h=function(){n&&!window.__SEER_LISTENER__&&(window.addEventListener("message",c),window.__SEER_LISTENER__=!0)};e.default={send:u,throttle:s,isReady:o,list:function(t,e){return u("LIST",{key:t,data:e})},listItem:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u("LIST_ITEM",{key:t,itemKey:e,data:r})},updateItem:function(t,e,r,i){return u("UPDATE_ITEM",{key:t,itemKey:e,path:r,data:i})},multiUpdate:function(t,e,r){return u("MULTI_UPDATE_ITEM",{key:t,itemKey:e,array:r})},deleteItem:function(t,e){return u("DELETE_ITEM",{key:t,itemKey:e})},addLog:function(t,e,r){return u("ADD_LOG",{key:t,itemKey:e,msg:r})},listeners:l,listenFor:function(t,e){if(n){if(!t||!e)throw new Error("Please provide a type and callback");l.has(t)||l.set(t,[]),window.__SEER_LISTENER__||h(),l.get(t).push(e)}},removeListener:function(t){l.forEach(function(e,r){l.set(r,e.filter(function(e){return e!==t}))})},init:h,clean:function(){n&&window.__SEER_LISTENER__&&(window.removeEventListener("message",c),delete window.__SEER_LISTENER__)}}},function(t,e,r){"use strict";(function(t){r.d(e,"b",function(){return n}),r.d(e,"a",function(){return a});var i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},n=i.window||i.self||i.global,a=i.global||i.self||i.window}).call(this,r(18))},,function(t,e,r){"use strict";r.d(e,"b",function(){return l}),r.d(e,"d",function(){return f}),r.d(e,"a",function(){return d}),r.d(e,"c",function(){return m});var i,n,a,o=r(4),s=r(0),u=r(10),l=(i={},Object(s.a)(i,3042,!1),Object(s.a)(i,32773,new Float32Array([0,0,0,0])),Object(s.a)(i,32777,32774),Object(s.a)(i,34877,32774),Object(s.a)(i,32969,1),Object(s.a)(i,32968,0),Object(s.a)(i,32971,1),Object(s.a)(i,32970,0),Object(s.a)(i,3106,new Float32Array([0,0,0,0])),Object(s.a)(i,3107,[!0,!0,!0,!0]),Object(s.a)(i,2884,!1),Object(s.a)(i,2885,1029),Object(s.a)(i,2929,!1),Object(s.a)(i,2931,1),Object(s.a)(i,2932,513),Object(s.a)(i,2928,new Float32Array([0,1])),Object(s.a)(i,2930,!0),Object(s.a)(i,3024,!0),Object(s.a)(i,36006,null),Object(s.a)(i,2886,2305),Object(s.a)(i,33170,4352),Object(s.a)(i,2849,1),Object(s.a)(i,32823,!1),Object(s.a)(i,32824,0),Object(s.a)(i,10752,0),Object(s.a)(i,32938,1),Object(s.a)(i,32939,!1),Object(s.a)(i,3089,!1),Object(s.a)(i,3088,new Int32Array([0,0,1024,1024])),Object(s.a)(i,2960,!1),Object(s.a)(i,2961,0),Object(s.a)(i,2968,4294967295),Object(s.a)(i,36005,4294967295),Object(s.a)(i,2962,519),Object(s.a)(i,2967,0),Object(s.a)(i,2963,4294967295),Object(s.a)(i,34816,519),Object(s.a)(i,36003,0),Object(s.a)(i,36004,4294967295),Object(s.a)(i,2964,7680),Object(s.a)(i,2965,7680),Object(s.a)(i,2966,7680),Object(s.a)(i,34817,7680),Object(s.a)(i,34818,7680),Object(s.a)(i,34819,7680),Object(s.a)(i,2978,new Int32Array([0,0,1024,1024])),Object(s.a)(i,3333,4),Object(s.a)(i,3317,4),Object(s.a)(i,37440,!1),Object(s.a)(i,37441,!1),Object(s.a)(i,37443,37444),Object(s.a)(i,35723,4352),Object(s.a)(i,36010,null),Object(s.a)(i,35977,!1),Object(s.a)(i,3330,0),Object(s.a)(i,3332,0),Object(s.a)(i,3331,0),Object(s.a)(i,3314,0),Object(s.a)(i,32878,0),Object(s.a)(i,3316,0),Object(s.a)(i,3315,0),Object(s.a)(i,32877,0),i),c=function(t,e,r){return e?t.enable(r):t.disable(r)},h=function(t,e,r){return t.hint(r,e)},p=function(t,e,r){return t.pixelStorei(r,e)},f=(n={},Object(s.a)(n,3042,c),Object(s.a)(n,32773,function(t,e){return t.blendColor.apply(t,Object(o.a)(e))}),Object(s.a)(n,32777,"blendEquation"),Object(s.a)(n,34877,"blendEquation"),Object(s.a)(n,32969,"blendFunc"),Object(s.a)(n,32968,"blendFunc"),Object(s.a)(n,32971,"blendFunc"),Object(s.a)(n,32970,"blendFunc"),Object(s.a)(n,3106,function(t,e){return t.clearColor.apply(t,Object(o.a)(e))}),Object(s.a)(n,3107,function(t,e){return t.colorMask.apply(t,Object(o.a)(e))}),Object(s.a)(n,2884,c),Object(s.a)(n,2885,function(t,e){return t.cullFace(e)}),Object(s.a)(n,2929,c),Object(s.a)(n,2931,function(t,e){return t.clearDepth(e)}),Object(s.a)(n,2932,function(t,e){return t.depthFunc(e)}),Object(s.a)(n,2928,function(t,e){return t.depthRange.apply(t,Object(o.a)(e))}),Object(s.a)(n,2930,function(t,e){return t.depthMask(e)}),Object(s.a)(n,3024,c),Object(s.a)(n,35723,h),Object(s.a)(n,36006,function(t,e){var r=Object(u.c)(t)?36009:36160;return t.bindFramebuffer(r,e)}),Object(s.a)(n,2886,function(t,e){return t.frontFace(e)}),Object(s.a)(n,33170,h),Object(s.a)(n,2849,function(t,e){return t.lineWidth(e)}),Object(s.a)(n,32823,c),Object(s.a)(n,32824,"polygonOffset"),Object(s.a)(n,10752,"polygonOffset"),Object(s.a)(n,35977,c),Object(s.a)(n,32938,"sampleCoverage"),Object(s.a)(n,32939,"sampleCoverage"),Object(s.a)(n,3089,c),Object(s.a)(n,3088,function(t,e){return t.scissor.apply(t,Object(o.a)(e))}),Object(s.a)(n,2960,c),Object(s.a)(n,2961,function(t,e){return t.clearStencil(e)}),Object(s.a)(n,2968,function(t,e){return t.stencilMaskSeparate(1028,e)}),Object(s.a)(n,36005,function(t,e){return t.stencilMaskSeparate(1029,e)}),Object(s.a)(n,2962,"stencilFuncFront"),Object(s.a)(n,2967,"stencilFuncFront"),Object(s.a)(n,2963,"stencilFuncFront"),Object(s.a)(n,34816,"stencilFuncBack"),Object(s.a)(n,36003,"stencilFuncBack"),Object(s.a)(n,36004,"stencilFuncBack"),Object(s.a)(n,2964,"stencilOpFront"),Object(s.a)(n,2965,"stencilOpFront"),Object(s.a)(n,2966,"stencilOpFront"),Object(s.a)(n,34817,"stencilOpBack"),Object(s.a)(n,34818,"stencilOpBack"),Object(s.a)(n,34819,"stencilOpBack"),Object(s.a)(n,2978,function(t,e){return t.viewport.apply(t,Object(o.a)(e))}),Object(s.a)(n,3333,p),Object(s.a)(n,3317,p),Object(s.a)(n,37440,p),Object(s.a)(n,37441,p),Object(s.a)(n,37443,p),Object(s.a)(n,3330,p),Object(s.a)(n,3332,p),Object(s.a)(n,3331,p),Object(s.a)(n,36010,function(t,e){return t.bindFramebuffer(36008,e)}),Object(s.a)(n,3314,p),Object(s.a)(n,32878,p),Object(s.a)(n,3316,p),Object(s.a)(n,3315,p),Object(s.a)(n,32877,p),n),d={blendEquation:function(t,e){return t.blendEquationSeparate(e[32777],e[34877])},blendFunc:function(t,e){return t.blendFuncSeparate(e[32969],e[32968],e[32971],e[32970])},polygonOffset:function(t,e){return t.polygonOffset(e[32824],e[10752])},sampleCoverage:function(t,e){return t.sampleCoverage(e[32938],e[32939])},stencilFuncFront:function(t,e){return t.stencilFuncSeparate(1028,e[2962],e[2967],e[2963])},stencilFuncBack:function(t,e){return t.stencilFuncSeparate(1029,e[34816],e[36003],e[36004])},stencilOpFront:function(t,e){return t.stencilOpSeparate(1028,e[2964],e[2965],e[2966])},stencilOpBack:function(t,e){return t.stencilOpSeparate(1029,e[34817],e[34818],e[34819])}},v=function(t,e){return t.isEnabled(e)},m=(a={},Object(s.a)(a,3042,v),Object(s.a)(a,2884,v),Object(s.a)(a,2929,v),Object(s.a)(a,3024,v),Object(s.a)(a,32823,v),Object(s.a)(a,32926,v),Object(s.a)(a,32928,v),Object(s.a)(a,3089,v),Object(s.a)(a,2960,v),Object(s.a)(a,35977,v),a)},function(t,e,r){"use strict";(function(t,i){r.d(e,"b",function(){return o}),r.d(e,"a",function(){return s});var n=r(3),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":Object(n.a)(i))&&i},o=a.window||a.self||a.global,s=a.process||{};console}).call(this,r(18),r(17))},function(t,e,r){"use strict";function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}r(25);function n(t){for(var e in t)return!1;return!0}function a(t){return Boolean(t&&2===t._version)}r.d(e,"a",function(){return i}),r.d(e,"c",function(){return a}),r.d(e,"b",function(){return n})},function(t,e,r){"use strict";r.d(e,"c",function(){return n}),r.d(e,"a",function(){return o}),r.d(e,"b",function(){return s});var i=r(8);r(25),r(10);function n(t,e){var r={};for(var n in e){var a=Number(n),o=i.d[n];o&&("string"==typeof o?r[o]=!0:o(t,e[n],a))}var s=t.state&&t.state.cache;if(s){var u=Object.assign({},s,e);for(var l in r){(0,i.a[l])(t,u)}}}function a(t,e){var r=i.c[e];return r?r(t,Number(e)):t.getParameter(Number(e))}function o(t,e){e=e||i.b;var r=Array.isArray(e)?e:Object.keys(e),n={},o=!0,s=!1,u=void 0;try{for(var l,c=r[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;n[h]=a(t,h)}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}return n}function s(t){n(t,Object.assign({},i.b,{}))}},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return f}),r.d(e,"c",function(){return d}),r.d(e,"b",function(){return v});var i=r(1),n=r(2),a=r(28),o=r(8),s=r(11),u=r(10),l=function(t,e){var r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return t===e};function c(t,e){var r=t[e].bind(t);t[e]=function(){var e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache||(t.state.cache[e]=r.apply(void 0,arguments)),t.state.enable?t.state.cache[e]:r.apply(void 0,arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function h(t,e,r){var i=t[e].bind(t);t[e]=function(){for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];var s,u=r.apply(void 0,[t.state._updateCache].concat(a)),l=u.valueChanged,c=u.oldValue;l&&((s=t.state).log.apply(s,["gl.".concat(e)].concat(a)),i.apply(void 0,a));return c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}var p=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.copyState,a=void 0!==n&&n,u=r.log,l=void 0===u?function(){}:u;Object(i.a)(this,t),this.gl=e,this.stateStack=[],this.enable=!0,this.cache=a?Object(s.a)(e):Object.assign({},o.b),this.log=l,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return Object(n.a)(t,[{key:"push",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stateStack.push({})}},{key:"pop",value:function(){Object(u.a)(this.stateStack.length>0);var t=this.stateStack[this.stateStack.length-1];Object(s.c)(this.gl,t,this.cache),this.stateStack.pop()}},{key:"_updateCache",value:function(t){var e,r=!1,i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var n in t)Object(u.a)(void 0!==n),l(t[n],this.cache[n])||(r=!0,e=this.cache[n],!i||n in i||(i[n]=this.cache[n]),this.cache[n]=t[n]);return{valueChanged:r,oldValue:e}}}]),t}();function f(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.enable,n=void 0===i||i,o=r.copyState;if(Object(u.a)(void 0!==o),!e.state){var s=void 0!==t?t:window;for(var l in s.polyfillContext&&s.polyfillContext(e),e.state=new p(e,{copyState:o,enable:n}),a.a){h(e,l,a.a[l])}c(e,"getParameter"),c(e,"isEnabled")}return e.state.enable=n,e}function d(t){t.state||f(t,{copyState:!1}),t.state.push()}function v(t){Object(u.a)(t.state),t.state.pop()}}).call(this,r(18))},function(t,e,r){"use strict";function i(t,e){if(!t)throw new Error(e||"webgl2-polyfill: assertion failed.")}r.d(e,"a",function(){return i})},function(t,e,r){"use strict";(function(t){var i=r(3),n=r(30),a=!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!t.browser)||n.a;e.a=a}).call(this,r(17))},function(t,e,r){"use strict";(function(t,i){r.d(e,"a",function(){return a});var n=r(3),a=("object"!==(void 0===t?"undefined":Object(n.a)(t))||"[object process]"!==String(t)||t.browser,"undefined"!=typeof window&&window,void 0!==i?i:window);"undefined"!=typeof document&&document}).call(this,r(17),r(18))},function(t,e,r){"use strict";(function(t){r.d(e,"b",function(){return i}),r.d(e,"c",function(){return n}),r.d(e,"a",function(){return a});var i="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",n="undefined"!=typeof window?window:t,a=(void 0!==t||window,"undefined"!=typeof document&&document,!1);try{var o={get passive(){a=!0}};n.addEventListener("test",o,o),n.removeEventListener("test",o,o)}catch(t){}}).call(this,r(18))},function(t,e){var r,i,n=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(t){i=o}}();var u,l=[],c=!1,h=-1;function p(){c&&u&&(c=!1,u.length?l=u.concat(l):h=-1,l.length&&f())}function f(){if(!c){var t=s(p);c=!0;for(var e=l.length;e;){for(u=l,l=[];++h<e;)u&&u[h].run();h=-1,e=l.length}u=null,c=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function v(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];l.push(new d(t,e)),1!==l.length||c||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=v,n.addListener=v,n.once=v,n.off=v,n.removeListener=v,n.removeAllListeners=v,n.emit=v,n.prependListener=v,n.prependOnceListener=v,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){t.exports=r(40)},function(t,e,r){"use strict";var i,n,a=r(0),o=r(13),s=function(t){return l(t)?void 0:0},u=(i={},Object(a.a)(i,3074,function(t){return l(t)?void 0:36064}),Object(a.a)(i,35723,function(t){return l(t)?void 0:4352}),Object(a.a)(i,35977,s),Object(a.a)(i,32937,s),Object(a.a)(i,36795,function(t,e){var r=l(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?e(r.GPU_DISJOINT_EXT):0}),Object(a.a)(i,37445,function(t,e){var r=t.getExtension("WEBGL_debug_renderer_info");return e(r&&r.UNMASKED_VENDOR_WEBGL||7936)}),Object(a.a)(i,37446,function(t,e){var r=t.getExtension("WEBGL_debug_renderer_info");return e(r&&r.UNMASKED_RENDERER_WEBGL||7937)}),Object(a.a)(i,34047,function(t,e){var r=t.luma.extensions.EXT_texture_filter_anisotropic;return r?e(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),Object(a.a)(i,32883,s),Object(a.a)(i,35071,s),Object(a.a)(i,37447,s),Object(a.a)(i,36063,function(t,e){if(!l(t)){var r=t.getExtension("WEBGL_draw_buffers");return r?e(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),Object(a.a)(i,35379,s),Object(a.a)(i,35374,s),Object(a.a)(i,35377,s),Object(a.a)(i,34852,function(t){if(!l(t)){var e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}}),Object(a.a)(i,36203,function(t){return t.getExtension("OES_element_index")?2147483647:65535}),Object(a.a)(i,33001,function(t){return t.getExtension("OES_element_index")?16777216:65535}),Object(a.a)(i,33e3,function(t){return 16777216}),Object(a.a)(i,37157,s),Object(a.a)(i,35373,s),Object(a.a)(i,35657,s),Object(a.a)(i,36183,s),Object(a.a)(i,37137,s),Object(a.a)(i,34045,s),Object(a.a)(i,35978,s),Object(a.a)(i,35979,s),Object(a.a)(i,35968,s),Object(a.a)(i,35376,s),Object(a.a)(i,35375,s),Object(a.a)(i,35659,s),Object(a.a)(i,37154,s),Object(a.a)(i,35371,s),Object(a.a)(i,35658,s),Object(a.a)(i,35076,s),Object(a.a)(i,35077,s),Object(a.a)(i,35380,s),i);function l(t){return Boolean(t&&2===t._version)}r.d(e,"b",function(){return h}),r.d(e,"a",function(){return p});function c(t){return Boolean(t&&2===t._version)}var h=(n={},Object(a.a)(n,"OES_vertex_array_object",{meta:{suffix:"OES"},createVertexArray:function(){Object(o.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),Object(a.a)(n,"ANGLE_instanced_arrays",{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(t,e){Object(o.a)(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),Object(a.a)(n,"WEBGL_draw_buffers",{meta:{suffix:"WEBGL"},drawBuffers:function(){Object(o.a)(!1)}}),Object(a.a)(n,"EXT_disjoint_timer_query",{meta:{suffix:"EXT"},createQuery:function(){Object(o.a)(!1)},deleteQuery:function(){Object(o.a)(!1)},beginQuery:function(){Object(o.a)(!1)},endQuery:function(){},getQuery:function(t,e){return this.getQueryObject(t,e)},getQueryParameter:function(t,e){return this.getQueryObject(t,e)},getQueryObject:function(){}}),n),p={readBuffer:function(t,e,r){c(t)&&e(r)},getVertexAttrib:function(t,e,r,i){var n,a=function(t,e){return{webgl2:c(t),ext:t.getExtension(e)}}(t,"ANGLE_instanced_arrays"),o=a.webgl2,s=a.ext;switch(i){case 35069:n=!!o&&void 0;break;case 35070:n=o||s?void 0:0}return void 0!==n?n:e(r,i)},getProgramParameter:function(t,e,r,i){if(!c(t))switch(i){case 35967:return 35981;case 35971:case 35382:return 0}return e(r,i)},getInternalformatParameter:function(t,e,r,i,n){if(!c(t))switch(n){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(r,i,n)},getTexParameter:function(t,e,r,i){switch(i){case 34046:var n=t.luma.extensions.EXT_texture_filter_anisotropic;i=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(r,i)},getParameter:function(t,e,r){var i=u[r],n="function"==typeof i?i(t,e,r):i;return void 0!==n?n:e(r)},hint:function(t,e,r,i){return e(r,i)}}},,,,function(t,e,r){"use strict";(function(t){var e=r(13),i=r(20);function n(t,r){var n=r.extension,a=r.target,o=r.target2,s=i.b[n];Object(e.a)(s);for(var u=s.meta,l=(void 0===u?{}:u).suffix,c=void 0===l?"":l,h=t.getExtension(n),p=function(){var e=d[f],r="".concat(e).concat(c),i=null;"meta"===e||"function"==typeof t[e]||(h&&"function"==typeof h[r]?i=function(){return h[r].apply(h,arguments)}:"function"==typeof s[e]&&(i=s[e].bind(a))),i&&(a[e]=i,o[e]=i)},f=0,d=Object.keys(s);f<d.length;f++)p()}(void 0!==t?t:window).polyfillContext=function(t){return t.luma=t.luma||{},function(t){t.luma.extensions={};var e=t.getSupportedExtensions()||[],r=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;t.luma[s]=t.getExtension(s)}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}}(t),t.luma.polyfilled||(function(t,e){var r=!0,i=!1,a=void 0;try{for(var o,s=Object.getOwnPropertyNames(e)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;"overrides"!==u&&n(t,{extension:u,target:t.luma,target2:t})}}catch(t){i=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}(t,i.b),function(t,e){var r=e.target,n=e.target2;Object.keys(i.a).forEach(function(e){if("function"==typeof i.a[e]){var a=t[e]?t[e].bind(t):function(){},o=i.a[e].bind(null,t,a);r[e]=o,n[e]=o}})}(t,{target:t.luma,target2:t}),t.luma.polyfilled=!0),t}}).call(this,r(18))},function(t,e,r){"use strict";function i(t,e){if(t===e)return!0;var r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}r.d(e,"a",function(){return i})},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return a});var i=r(3),n=r(27);function a(){return!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(n.a)()}}).call(this,r(17))},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return n});var i=r(3);function n(e){if("undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(i.a)(t.versions)&&Boolean(t.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=e||r;return!!(n&&n.indexOf("Electron")>=0)}}).call(this,r(17))},function(t,e,r){"use strict";var i=r(0);e.a={enable:function(t,e){return t(Object(i.a)({},e,!0))},disable:function(t,e){return t(Object(i.a)({},e,!1))},pixelStorei:function(t,e,r){return t(Object(i.a)({},e,r))},hint:function(t,e,r){return t(Object(i.a)({},e,r))},bindFramebuffer:function(t,e,r){var n;switch(e){case 36160:return t((n={},Object(i.a)(n,36006,r),Object(i.a)(n,36010,r),n));case 36009:return t(Object(i.a)({},36006,r));case 36008:return t(Object(i.a)({},36010,r));default:return null}},blendColor:function(t,e,r,n,a){return t(Object(i.a)({},32773,new Float32Array([e,r,n,a])))},blendEquation:function(t,e){var r;return t((r={},Object(i.a)(r,32777,e),Object(i.a)(r,34877,e),r))},blendEquationSeparate:function(t,e,r){var n;return t((n={},Object(i.a)(n,32777,e),Object(i.a)(n,34877,r),n))},blendFunc:function(t,e,r){var n;return t((n={},Object(i.a)(n,32969,e),Object(i.a)(n,32968,r),Object(i.a)(n,32971,e),Object(i.a)(n,32970,r),n))},blendFuncSeparate:function(t,e,r,n,a){var o;return t((o={},Object(i.a)(o,32969,e),Object(i.a)(o,32968,r),Object(i.a)(o,32971,n),Object(i.a)(o,32970,a),o))},clearColor:function(t,e,r,n,a){return t(Object(i.a)({},3106,new Float32Array([e,r,n,a])))},clearDepth:function(t,e){return t(Object(i.a)({},2931,e))},clearStencil:function(t,e){return t(Object(i.a)({},2961,e))},colorMask:function(t,e,r,n,a){return t(Object(i.a)({},3107,[e,r,n,a]))},cullFace:function(t,e){return t(Object(i.a)({},2885,e))},depthFunc:function(t,e){return t(Object(i.a)({},2932,e))},depthRange:function(t,e,r){return t(Object(i.a)({},2928,new Float32Array([e,r])))},depthMask:function(t,e){return t(Object(i.a)({},2930,e))},frontFace:function(t,e){return t(Object(i.a)({},2886,e))},lineWidth:function(t,e){return t(Object(i.a)({},2849,e))},polygonOffset:function(t,e,r){var n;return t((n={},Object(i.a)(n,32824,e),Object(i.a)(n,10752,r),n))},sampleCoverage:function(t,e,r){var n;return t((n={},Object(i.a)(n,32938,e),Object(i.a)(n,32939,r),n))},scissor:function(t,e,r,n,a){return t(Object(i.a)({},3088,new Int32Array([e,r,n,a])))},stencilMask:function(t,e){var r;return t((r={},Object(i.a)(r,2968,e),Object(i.a)(r,36005,e),r))},stencilMaskSeparate:function(t,e,r){return t(Object(i.a)({},1028===e?2968:36005,r))},stencilFunc:function(t,e,r,n){var a;return t((a={},Object(i.a)(a,2962,e),Object(i.a)(a,2967,r),Object(i.a)(a,2963,n),Object(i.a)(a,34816,e),Object(i.a)(a,36003,r),Object(i.a)(a,36004,n),a))},stencilFuncSeparate:function(t,e,r,n,a){var o;return t((o={},Object(i.a)(o,1028===e?2962:34816,r),Object(i.a)(o,1028===e?2967:36003,n),Object(i.a)(o,1028===e?2963:36004,a),o))},stencilOp:function(t,e,r,n){var a;return t((a={},Object(i.a)(a,2964,e),Object(i.a)(a,2965,r),Object(i.a)(a,2966,n),Object(i.a)(a,34817,e),Object(i.a)(a,34818,r),Object(i.a)(a,34819,n),a))},stencilOpSeparate:function(t,e,r,n,a){var o;return t((o={},Object(i.a)(o,1028===e?2964:34817,r),Object(i.a)(o,1028===e?2965:34818,n),Object(i.a)(o,1028===e?2966:34819,a),o))},viewport:function(t,e,r,n,a){return t(Object(i.a)({},2978,new Int32Array([e,r,n,a])))}}},function(t,e,r){t.exports=function(){"use strict";var t,e,r;function i(i,n){if(t)if(e){var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",o={};t(o),(r=n(o)).workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"}))}else e=n;else t=n}return i(0,function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=i;function i(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=r,this.p2y=i}i.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},i.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},i.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},i.prototype.solveCurveX=function(t,e){var r,i,n,a,o;for(void 0===e&&(e=1e-6),n=t,o=0;o<8;o++){if(a=this.sampleCurveX(n)-t,Math.abs(a)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=a/s}if((n=t)<(r=0))return r;if(n>(i=1))return i;for(;r<i;){if(a=this.sampleCurveX(n),Math.abs(a-t)<e)return n;t>a?r=n:i=n,n=.5*(i-r)+r}return n},i.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var n=a;function a(t,e){this.x=t,this.y=e}function o(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!o(t[r],e[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!o(t[i],e[i]))return!1;return!0}return t===e}function s(t,e,i,n){var a=new r(t,e,i,n);return function(t){return a.solve(t)}}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),a=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var u=s(.25,.1,.25,1);function l(t,e,r){return Math.min(r,Math.max(e,t))}function c(t,e,r){var i=r-e,n=((t-e)%i+i)%i+e;return n===e?r:n}function h(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var i=0,n=e;i<n.length;i+=1){var a=n[i];for(var o in a)t[o]=a[o]}return t}var p=1;function f(){return p++}function d(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function v(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function m(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function g(t,e){return-1!==t.indexOf(e,t.length-e.length)}function y(t,e,r){var i={};for(var n in t)i[n]=e.call(r||this,t[n],n,t);return i}function _(t,e,r){var i={};for(var n in t)e.call(r||this,t[n],n,t)&&(i[n]=t[n]);return i}function b(t){return Array.isArray(t)?t.map(b):"object"==typeof t&&t?y(t,b):t}var x={};function w(t){x[t]||("undefined"!=typeof console&&console.warn(t),x[t]=!0)}function k(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function E(t){for(var e=0,r=0,i=t.length,n=i-1,a=void 0,o=void 0;r<i;n=r++)a=t[r],e+=((o=t[n]).x-a.x)*(a.y+o.y);return e}function S(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var T,A,P,O=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),I=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,M=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,C={now:O,frame:function(t){var e=I(t);return{cancel:function(){return M(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)},resolveURL:function(t){return T||(T=self.document.createElement("a")),T.href=t,T.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio}},L={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(t){!z&&P&&(R?F(t):A=t)}},z=!1,R=!1;function F(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,P),t.isContextLost())return;j.supported=!0}catch(t){}t.deleteTexture(e),z=!0}self.document&&((P=self.document.createElement("img")).onload=function(){A&&F(A),A=null,R=!0},P.onerror=function(){z=!0,A=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var D="01",B=function(t){this._transformRequestFn=t,this._createSkuToken()};B.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",D,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},B.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},B.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},B.prototype.normalizeStyleURL=function(t,e){return Z(t,e)},B.prototype.normalizeGlyphsURL=function(t,e){return X(t,e)},B.prototype.normalizeSourceURL=function(t,e){return W(t,e)},B.prototype.normalizeSpriteURL=function(t,e,r,i){return H(t,e,r,i)},B.prototype.normalizeTileURL=function(t,e,r){return this._isSkuTokenExpired()&&this._createSkuToken(),K(t,e,r,this._skuToken)},B.prototype.canonicalizeTileURL=function(t){return Q(t)},B.prototype.canonicalizeTileset=function(t,e){return $(t,e)};var N="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes";function U(t,e){var r=et(L.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"/"!==r.path&&(t.path=""+r.path+t.path),!L.REQUIRE_ACCESS_TOKEN)return rt(t);if(!(e=e||L.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+N);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+N);return t.params.push("access_token="+e),rt(t)}function V(t){return 0===t.indexOf("mapbox:")}var G=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function q(t){return G.test(t)}var Z=function(t,e){if(!V(t))return t;var r=et(t);return r.path="/styles/v1"+r.path,U(r,e)},X=function(t,e){if(!V(t))return t;var r=et(t);return r.path="/fonts/v1"+r.path,U(r,e)},W=function(t,e){if(!V(t))return t;var r=et(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),U(r,e)},H=function(t,e,r,i){var n=et(t);return V(t)?(n.path="/styles/v1"+n.path+"/sprite"+e+r,U(n,i)):(n.path+=""+e+r,rt(n))},Y=/(\.(png|jpg)\d*)(?=$)/,K=function(t,e,r,i){if(!e||!V(e))return t;var n=et(t),a=C.devicePixelRatio>=2||512===r?"@2x":"",o=j.supported?".webp":"$1";return n.path=n.path.replace(Y,""+a+o),n.path="/v4"+n.path,L.REQUIRE_ACCESS_TOKEN&&L.ACCESS_TOKEN&&i&&n.params.push("sku="+i),U(n)},J=/\.[\w]+$/,Q=function(t){var e=et(t);if(!e.path.match(/(^\/v4\/)/)||!e.path.match(J))return t;var r="mapbox://tiles/";r+=e.path.replace("/v4/","");var i=e.params.filter(function(t){return!t.match(/^access_token=/)});return i.length&&(r+="?"+i.join("&")),r},$=function(t,e){if(!V(e))return t.tiles||[];for(var r=[],i=0,n=t.tiles;i<n.length;i+=1){var a=n[i],o=Q(a);r.push(o)}return r},tt=/^(\w+):\/\/([^\/?]*)(\/[^?]+)?\??(.+)?/;function et(t){var e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function rt(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function it(t){if(!t)return null;var e,r=t.split(".");if(!r||3!==r.length)return null;try{return JSON.parse((e=r[1],decodeURIComponent(self.atob(e).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))))}catch(t){return null}}var nt=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};nt.prototype.getStorageKey=function(t){var e,r=it(L.ACCESS_TOKEN),i="";return r&&r.u?(e=r.u,i=self.btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(Number("0x"+e))}))):i=L.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+i:"mapbox.eventData:"+i},nt.prototype.fetchEventData=function(){var t=S("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var i=self.localStorage.getItem(e);i&&(this.eventData=JSON.parse(i));var n=self.localStorage.getItem(r);n&&(this.anonId=n)}catch(t){w("Unable to read from LocalStorage")}},nt.prototype.saveEventData=function(){var t=S("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){w("Unable to write to LocalStorage")}},nt.prototype.processRequests=function(){},nt.prototype.postEvent=function(t,e,r){var i=this;if(L.EVENTS_URL){var n=et(L.EVENTS_URL);n.params.push("access_token="+(L.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.0.0",skuId:D,userId:this.anonId},o=e?h(a,e):a,s={url:rt(n),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=yt(s,function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests()})}},nt.prototype.queueRequest=function(t){this.queue.push(t),this.processRequests()};var at=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postMapLoadEvent=function(t,e,r){this.skuToken=r,L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return V(t)||q(t)})&&this.queueRequest({id:e,timestamp:Date.now()})},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var e=this.queue.shift(),r=e.id,i=e.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),v(this.anonId)||(this.anonId=d()),this.postEvent(i,{skuToken:this.skuToken},function(e){e||r&&(t.success[r]=!0)}))}},e}(nt),ot=new(function(t){function e(){t.call(this,"appUserTurnstile")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.postTurnstileEvent=function(t){L.EVENTS_URL&&L.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return V(t)||q(t)})&&this.queueRequest(Date.now())},e.prototype.processRequests=function(){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var e=it(L.ACCESS_TOKEN),r=e?e.u:L.ACCESS_TOKEN,i=r!==this.eventData.tokenU;v(this.anonId)||(this.anonId=d(),i=!0);var n=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),o=new Date(n),s=(n-this.eventData.lastSuccess)/864e5;i=i||s>=1||s<-1||a.getDate()!==o.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(n,{"enabled.telemetry":!1},function(e){e||(t.eventData.lastSuccess=n,t.eventData.tokenU=r)})}},e}(nt)),st=ot.postTurnstileEvent.bind(ot),ut=new at,lt=ut.postMapLoadEvent.bind(ut),ct={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ct);var ht=function(t){function e(e,r,i){401===r&&q(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=i,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function pt(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}var ft,dt,vt=pt()?function(){return self.worker&&self.worker.referrer}:function(){var t=self.location.origin;if(t&&"null"!==t&&"file://"!==t)return t+self.location.pathname},mt=function(t,e){if(!/^file:/.test(t.url)){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r=new self.AbortController,i=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:vt(),signal:r.signal});return"json"===t.type&&i.headers.set("Accept","application/json"),self.fetch(i).then(function(r){r.ok?r[t.type||"text"]().then(function(t){e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires"))}).catch(function(t){return e(new Error(t.message))}):e(new ht(r.statusText,r.status,t.url))}).catch(function(t){20!==t.code&&e(new Error(t.message))}),{cancel:function(){return r.abort()}}}(t,e);if(pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e)}return function(t,e){var r=new self.XMLHttpRequest;for(var i in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(i,t.headers[i]);return"json"===t.type&&r.setRequestHeader("Accept","application/json"),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var i=r.response;if("json"===t.type)try{i=JSON.parse(r.response)}catch(t){return e(t)}e(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new ht(r.statusText,r.status,t.url))},r.send(t.body),{cancel:function(){return r.abort()}}}(t,e)},gt=function(t,e){return mt(h(t,{type:"arrayBuffer"}),e)},yt=function(t,e){return mt(h(t,{method:"POST"}),e)};ft=[],dt=0;var _t=function(t,e){if(dt>=L.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return ft.push(r),r}dt++;var i=!1,n=function(){if(!i)for(i=!0,dt--;ft.length&&dt<L.MAX_PARALLEL_IMAGE_REQUESTS;){var t=ft.shift(),e=t.requestParameters,r=t.callback;t.cancelled||(t.cancel=_t(e,r).cancel)}},a=gt(t,function(t,r,i,a){if(n(),t)e(t);else if(r){var o=new self.Image,s=self.URL||self.webkitURL;o.onload=function(){e(null,o),s.revokeObjectURL(o.src)},o.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var u=new self.Blob([new Uint8Array(r)],{type:"image/png"});o.cacheControl=i,o.expires=a,o.src=r.byteLength?s.createObjectURL(u):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}});return{cancel:function(){a.cancel(),n()}}};function bt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function xt(t,e,r){if(r&&r[t]){var i=r[t].indexOf(e);-1!==i&&r[t].splice(i,1)}}var wt=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},kt=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",h({error:e},r))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(wt),Et=function(){};Et.prototype.on=function(t,e){return this._listeners=this._listeners||{},bt(t,e,this._listeners),this},Et.prototype.off=function(t,e){return xt(t,e,this._listeners),xt(t,e,this._oneTimeListeners),this},Et.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},bt(t,e,this._oneTimeListeners),this},Et.prototype.fire=function(t,e){"string"==typeof t&&(t=new wt(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var i=0,n=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];i<n.length;i+=1)n[i].call(this,t);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];a<o.length;a+=1){var s=o[a];xt(r,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof kt&&console.error(t.error);return this},Et.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Et.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var St={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:[{"!":"text-offset"}],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:[{"!":"text-anchor"},{"!":"text-offset"},{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",requires:["text-field"],values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Tt=function(t,e,r,i){this.message=(t?t+": ":"")+r,i&&(this.identifier=i),null!=e&&e.__line__&&(this.line=e.__line__)};function At(t){var e=t.key,r=t.value;return r?[new Tt(e,r,"constants have been deprecated as of v8")]:[]}function Pt(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var i=0,n=e;i<n.length;i+=1){var a=n[i];for(var o in a)t[o]=a[o]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function It(t){return Array.isArray(t)?t.map(It):Ot(t)}var Mt=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Ct=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,i=e;r<i.length;r+=1){var n=i[r],a=n[0],o=n[1];this.bindings[a]=o}};Ct.prototype.concat=function(t){return new Ct(this,t)},Ct.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Ct.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Lt={kind:"null"},jt={kind:"number"},zt={kind:"string"},Rt={kind:"boolean"},Ft={kind:"color"},Dt={kind:"object"},Bt={kind:"value"},Nt={kind:"collator"},Ut={kind:"formatted"};function Vt(t,e){return{kind:"array",itemType:t,N:e}}function Gt(t){if("array"===t.kind){var e=Gt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var qt=[Lt,jt,zt,Rt,Ft,Ut,Dt,Vt(Bt)];function Zt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Zt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,i=qt;r<i.length;r+=1)if(!Zt(i[r],e))return null}return"Expected "+Gt(t)+" but found "+Gt(e)+" instead."}var Xt=e(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function n(t){return t<0?0:t>1?1:t}function a(t){return"%"===t[t.length-1]?i(parseFloat(t)/100*255):i(parseInt(t))}function o(t){return"%"===t[t.length-1]?n(parseFloat(t)/100):n(parseFloat(t))}function s(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in r)return r[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=n.indexOf("("),l=n.indexOf(")");if(-1!==u&&l+1===n.length){var c=n.substr(0,u),h=n.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=o(h.pop());case"rgb":return 3!==h.length?null:[a(h[0]),a(h[1]),a(h[2]),p];case"hsla":if(4!==h.length)return null;p=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),v=o(h[2]),m=v<=.5?v*(d+1):v+d-v*d,g=2*v-m;return[i(255*s(g,m,f+1/3)),i(255*s(g,m,f)),i(255*s(g,m,f-1/3)),p];default:return null}}return null}}catch(t){}}).parseCSSColor,Wt=function(t,e,r,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=r,this.a=i};Wt.parse=function(t){if(t){if(t instanceof Wt)return t;if("string"==typeof t){var e=Xt(t);if(e)return new Wt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Wt.prototype.toString=function(){var t=this.toArray(),e=t[0],r=t[1],i=t[2],n=t[3];return"rgba("+Math.round(e)+","+Math.round(r)+","+Math.round(i)+","+n+")"},Wt.prototype.toArray=function(){var t=this.r,e=this.g,r=this.b,i=this.a;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*r/i,i]},Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1);var Ht=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ht.prototype.compare=function(t,e){return this.collator.compare(t,e)},Ht.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Yt=function(t,e,r){this.text=t,this.scale=e,this.fontStack=r},Kt=function(t){this.sections=t};function Jt(t,e,r,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value ["+[t,e,r,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,r,i]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Qt(t){if(null===t)return Lt;if("string"==typeof t)return zt;if("boolean"==typeof t)return Rt;if("number"==typeof t)return jt;if(t instanceof Wt)return Ft;if(t instanceof Ht)return Nt;if(t instanceof Kt)return Ut;if(Array.isArray(t)){for(var e,r=t.length,i=0,n=t;i<n.length;i+=1){var a=Qt(n[i]);if(e){if(e===a)continue;e=Bt;break}e=a}return Vt(e||Bt,r)}return Dt}function $t(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Wt||t instanceof Kt?t.toString():JSON.stringify(t)}Kt.fromString=function(t){return new Kt([new Yt(t,null,null)])},Kt.prototype.toString=function(){return this.sections.map(function(t){return t.text}).join("")},Kt.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var i=r[e];t.push(i.text);var n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),t.push(n)}return t};var te=function(t,e){this.type=t,this.value=e};te.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Wt)return!0;if(e instanceof Ht)return!0;if(e instanceof Kt)return!0;if(Array.isArray(e)){for(var r=0,i=e;r<i.length;r+=1)if(!t(i[r]))return!1;return!0}if("object"==typeof e){for(var n in e)if(!t(e[n]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var r=t[1],i=Qt(r),n=e.expectedType;return"array"!==i.kind||0!==i.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(i=n),new te(i,r)},te.prototype.evaluate=function(){return this.value},te.prototype.eachChild=function(){},te.prototype.possibleOutputs=function(){return[this.value]},te.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wt?["rgba"].concat(this.value.toArray()):this.value instanceof Kt?this.value.serialize():this.value};var ee=function(t){this.name="ExpressionEvaluationError",this.message=t};ee.prototype.toJSON=function(){return this.message};var re={string:zt,number:jt,boolean:Rt,object:Dt},ie=function(t,e){this.type=t,this.args=e};ie.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,i=1,n=t[0];if("array"===n){var a,o;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in re)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=re[s],i++}else a=Bt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],i++}r=Vt(a,o)}else r=re[n];for(var u=[];i<t.length;i++){var l=e.parse(t[i],i,Bt);if(!l)return null;u.push(l)}return new ie(r,u)},ie.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Zt(this.type,Qt(r)))return r;if(e===this.args.length-1)throw new ee("Expected value to be of type "+Gt(this.type)+", but found "+Gt(Qt(r))+" instead.")}return null},ie.prototype.eachChild=function(t){this.args.forEach(t)},ie.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},ie.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map(function(t){return t.serialize()}))};var ne=function(t){this.type=Ut,this.sections=t};ne.parse=function(t,e){if(t.length<3)return e.error("Expected at least two arguments.");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");for(var r=[],i=1;i<t.length-1;i+=2){var n=e.parse(t[i],1,Bt);if(!n)return null;var a=n.type.kind;if("string"!==a&&"value"!==a&&"null"!==a)return e.error("Formatted text type must be 'string', 'value', or 'null'.");var o=t[i+1];if("object"!=typeof o||Array.isArray(o))return e.error("Format options argument must be an object.");var s=null;if(o["font-scale"]&&!(s=e.parse(o["font-scale"],1,jt)))return null;var u=null;if(o["text-font"]&&!(u=e.parse(o["text-font"],1,Vt(zt))))return null;r.push({text:n,scale:s,font:u})}return new ne(r)},ne.prototype.evaluate=function(t){return new Kt(this.sections.map(function(e){return new Yt($t(e.text.evaluate(t)),e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null)}))},ne.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var i=r[e];t(i.text),i.scale&&t(i.scale),i.font&&t(i.font)}},ne.prototype.possibleOutputs=function(){return[void 0]},ne.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var i=r[e];t.push(i.text.serialize());var n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),t.push(n)}return t};var ae={"to-boolean":Rt,"to-color":Ft,"to-number":jt,"to-string":zt},oe=function(t,e){this.type=t,this.args=e};oe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var i=ae[r],n=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,Bt);if(!o)return null;n.push(o)}return new oe(i,n)},oe.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,i=0,n=this.args;i<n.length;i+=1){if(r=null,(e=n[i].evaluate(t))instanceof Wt)return e;if("string"==typeof e){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Jt(e[0],e[1],e[2],e[3])))return new Wt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ee(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null===(o=u[s].evaluate(t)))return 0;var l=Number(o);if(!isNaN(l))return l}throw new ee("Could not convert "+JSON.stringify(o)+" to number.")}return"formatted"===this.type.kind?Kt.fromString($t(this.args[0].evaluate(t))):$t(this.args[0].evaluate(t))},oe.prototype.eachChild=function(t){this.args.forEach(t)},oe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},oe.prototype.serialize=function(){if("formatted"===this.type.kind)return new ne([{text:this.args[0],scale:null,font:null}]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var se=["Unknown","Point","LineString","Polygon"],ue=function(){this.globals=null,this.feature=null,this.featureState=null,this._parseColorCache={}};ue.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ue.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?se[this.feature.type]:this.feature.type:null},ue.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ue.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Wt.parse(t)),e};var le=function(t,e,r,i){this.name=t,this.type=e,this._evaluate=r,this.args=i};le.prototype.evaluate=function(t){return this._evaluate(t,this.args)},le.prototype.eachChild=function(t){this.args.forEach(t)},le.prototype.possibleOutputs=function(){return[void 0]},le.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},le.parse=function(t,e){var r,i=t[0],n=le.definitions[i];if(!n)return e.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,s=o.filter(function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1}),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new ve(e.registry,e.path,null,e.scope);for(var d=[],v=!1,m=1;m<t.length;m++){var g=t[m],y=Array.isArray(p)?p[m-1]:p.type,_=u.parse(g,1+d.length,y);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var b=0;b<d.length;b++){var x=Array.isArray(p)?p[b]:p.type,w=d[b];u.concat(b+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new le(i,a,f,d)}}if(1===s.length)(r=e.errors).push.apply(r,u.errors);else{for(var k=(s.length?s:o).map(function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Gt).join(", ")+")":"("+Gt(e.type)+"...)"}).join(" | "),E=[],S=1;S<t.length;S++){var T=e.parse(t[S],1+E.length);if(!T)return null;E.push(Gt(T.type))}e.error("Expected arguments of type "+k+", but found ("+E.join(", ")+") instead.")}return null},le.register=function(t,e){for(var r in le.definitions=e,e)t[r]=le};var ce=function(t,e,r){this.type=Nt,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function he(t){if(t instanceof le){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!he(t)&&(e=!1)}),e}function pe(t){if(t instanceof le&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!pe(t)&&(e=!1)}),e}function fe(t,e){if(t instanceof le&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(t){r&&!fe(t,e)&&(r=!1)}),r}ce.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Rt);if(!i)return null;var n=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Rt);if(!n)return null;var a=null;return r.locale&&!(a=e.parse(r.locale,1,zt))?null:new ce(i,n,a)},ce.prototype.evaluate=function(t){return new Ht(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},ce.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},ce.prototype.possibleOutputs=function(){return[void 0]},ce.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var de=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};de.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new de(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},de.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},de.prototype.eachChild=function(){},de.prototype.possibleOutputs=function(){return[void 0]},de.prototype.serialize=function(){return["var",this.name]};var ve=function(t,e,r,i,n){void 0===e&&(e=[]),void 0===i&&(i=new Ct),void 0===n&&(n=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=i,this.errors=n,this.expectedType=r};function me(t,e){for(var r,i,n=0,a=t.length-1,o=0;n<=a;){if(r=t[o=Math.floor((n+a)/2)],i=t[o+1],e===r||e>r&&e<i)return o;if(r<e)n=o+1;else{if(!(r>e))throw new ee("Input is not a number.");a=o-1}}return Math.max(o-1,0)}ve.prototype.parse=function(t,e,r,i,n){return void 0===n&&(n={}),e?this.concat(e,r,i)._parse(t,n):this._parse(t,n)},ve.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new ie(e,[t]):"coerce"===r?new oe(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var i=t[0];if("string"!=typeof i)return this.error("Expression name must be a string, but found "+typeof i+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var n=this.registry[i];if(n){var a=n.parse(t,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=r(a,o,e.typeAnnotation||"coerce");else a=r(a,o,e.typeAnnotation||"assert")}if(!(a instanceof te)&&function t(e){if(e instanceof de)return t(e.boundExpression);if(e instanceof le&&"error"===e.name)return!1;if(e instanceof ce)return!1;var r=e instanceof oe||e instanceof ie,i=!0;return e.eachChild(function(e){i=r?i&&t(e):i&&e instanceof te}),!!i&&he(e)&&fe(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var u=new ue;try{a=new te(a.type,a.evaluate(u))}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+i+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},ve.prototype.concat=function(t,e,r){var i="number"==typeof t?this.path.concat(t):this.path,n=r?this.scope.concat(r):this.scope;return new ve(this.registry,i,e||null,n,this.errors)},ve.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var i=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Mt(i,t))},ve.prototype.checkSubtype=function(t,e){var r=Zt(t,e);return r&&this.error(r),r};var ge=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,n=r;i<n.length;i+=1){var a=n[i],o=a[0],s=a[1];this.labels.push(o),this.outputs.push(s)}};function ye(t,e,r){return t*(1-r)+e*r}ge.parse=function(t,e){var r=t[1],i=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,1,jt)))return null;var n=[],a=null;e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType),i.unshift(-1/0);for(var o=0;o<i.length;o+=2){var s=i[o],u=i[o+1],l=o+1,c=o+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(n.length&&n[n.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var h=e.parse(u,c,a);if(!h)return null;a=a||h.type,n.push([s,h])}return new ge(a,r,n)},ge.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);var n=e.length;return i>=e[n-1]?r[n-1].evaluate(t):r[me(e,i)].evaluate(t)},ge.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},ge.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var _e=Object.freeze({number:ye,color:function(t,e,r){return new Wt(ye(t.r,e.r,r),ye(t.g,e.g,r),ye(t.b,e.b,r),ye(t.a,e.a,r))},array:function(t,e,r){return t.map(function(t,i){return ye(t,e[i],r)})}}),be=.95047,xe=1,we=1.08883,ke=4/29,Ee=6/29,Se=3*Ee*Ee,Te=Ee*Ee*Ee,Ae=Math.PI/180,Pe=180/Math.PI;function Oe(t){return t>Te?Math.pow(t,1/3):t/Se+ke}function Ie(t){return t>Ee?t*t*t:Se*(t-ke)}function Me(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ce(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Le(t){var e=Ce(t.r),r=Ce(t.g),i=Ce(t.b),n=Oe((.4124564*e+.3575761*r+.1804375*i)/be),a=Oe((.2126729*e+.7151522*r+.072175*i)/xe);return{l:116*a-16,a:500*(n-a),b:200*(a-Oe((.0193339*e+.119192*r+.9503041*i)/we)),alpha:t.a}}function je(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=xe*Ie(e),r=be*Ie(r),i=we*Ie(i),new Wt(Me(3.2404542*r-1.5371385*e-.4985314*i),Me(-.969266*r+1.8760108*e+.041556*i),Me(.0556434*r-.2040259*e+1.0572252*i),t.alpha)}function ze(t,e,r){var i=e-t;return t+r*(i>180||i<-180?i-360*Math.round(i/360):i)}var Re={forward:Le,reverse:je,interpolate:function(t,e,r){return{l:ye(t.l,e.l,r),a:ye(t.a,e.a,r),b:ye(t.b,e.b,r),alpha:ye(t.alpha,e.alpha,r)}}},Fe={forward:function(t){var e=Le(t),r=e.l,i=e.a,n=e.b,a=Math.atan2(n,i)*Pe;return{h:a<0?a+360:a,c:Math.sqrt(i*i+n*n),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Ae,r=t.c;return je({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:ze(t.h,e.h,r),c:ye(t.c,e.c,r),l:ye(t.l,e.l,r),alpha:ye(t.alpha,e.alpha,r)}}},De=Object.freeze({lab:Re,hcl:Fe}),Be=function(t,e,r,i,n){this.type=t,this.operator=e,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];for(var a=0,o=n;a<o.length;a+=1){var s=o[a],u=s[0],l=s[1];this.labels.push(u),this.outputs.push(l)}};function Ne(t,e,r,i){var n=i-r,a=t-r;return 0===n?0:1===e?a/n:(Math.pow(e,a)-1)/(Math.pow(e,n)-1)}Be.interpolationFactor=function(t,e,i,n){var a=0;if("exponential"===t.name)a=Ne(e,t.base,i,n);else if("linear"===t.name)a=Ne(e,1,i,n);else if("cubic-bezier"===t.name){var o=t.controlPoints;a=new r(o[0],o[1],o[2],o[3]).solve(Ne(e,1,i,n))}return a},Be.parse=function(t,e){var r=t[0],i=t[1],n=t[2],a=t.slice(3);if(!Array.isArray(i)||0===i.length)return e.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){var o=i[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:o}}else{if("cubic-bezier"!==i[0])return e.error("Unknown interpolation type "+String(i[0]),1,0);var s=i.slice(1);if(4!==s.length||s.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(n=e.parse(n,2,jt)))return null;var u=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=Ft:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<a.length;c+=2){var h=a[c],p=a[c+1],f=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var v=e.parse(p,d,l);if(!v)return null;l=l||v.type,u.push([h,v])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new Be(l,r,i,n,u):e.error("Type "+Gt(l)+" is not interpolatable.")},Be.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);var n=e.length;if(i>=e[n-1])return r[n-1].evaluate(t);var a=me(e,i),o=e[a],s=e[a+1],u=Be.interpolationFactor(this.interpolation,i,o,s),l=r[a].evaluate(t),c=r[a+1].evaluate(t);return"interpolate"===this.operator?_e[this.type.kind.toLowerCase()](l,c,u):"interpolate-hcl"===this.operator?Fe.reverse(Fe.interpolate(Fe.forward(l),Fe.forward(c),u)):Re.reverse(Re.interpolate(Re.forward(l),Re.forward(c),u))},Be.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Be.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},Be.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var Ue=function(t,e){this.type=t,this.args=e};Ue.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,i=e.expectedType;i&&"value"!==i.kind&&(r=i);for(var n=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=o[a],u=e.parse(s,1+n.length,r,void 0,{typeAnnotation:"omit"});if(!u)return null;r=r||u.type,n.push(u)}var l=i&&n.some(function(t){return Zt(i,t.type)});return new Ue(l?Bt:r,n)},Ue.prototype.evaluate=function(t){for(var e=null,r=0,i=this.args;r<i.length&&null===(e=i[r].evaluate(t));r+=1);return e},Ue.prototype.eachChild=function(t){this.args.forEach(t)},Ue.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},Ue.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ve=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Ve.prototype.evaluate=function(t){return this.result.evaluate(t)},Ve.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},Ve.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],i=1;i<t.length-1;i+=2){var n=t[i];if("string"!=typeof n)return e.error("Expected string, but found "+typeof n+" instead.",i);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var a=e.parse(t[i+1],i+1);if(!a)return null;r.push([n,a])}var o=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return o?new Ve(r,o):null},Ve.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Ve.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var i=r[e],n=i[0],a=i[1];t.push(n,a.serialize())}return t.push(this.result.serialize()),t};var Ge=function(t,e,r){this.type=t,this.index=e,this.input=r};Ge.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,jt),i=e.parse(t[2],2,Vt(e.expectedType||Bt));if(!r||!i)return null;var n=i.type;return new Ge(n.itemType,r,i)},Ge.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ee("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ee("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ee("Array index must be an integer, but found "+e+" instead.");return r[e]},Ge.prototype.eachChild=function(t){t(this.index),t(this.input)},Ge.prototype.possibleOutputs=function(){return[void 0]},Ge.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var qe=function(t,e,r,i,n,a){this.inputType=t,this.type=e,this.input=r,this.cases=i,this.outputs=n,this.otherwise=a};qe.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var n={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var l=e.concat(o);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,Qt(p)))return null}else r=Qt(p);if(void 0!==n[String(p)])return l.error("Branch labels must be unique.");n[String(p)]=a.length}var f=e.parse(u,o,i);if(!f)return null;i=i||f.type,a.push(f)}var d=e.parse(t[1],1,Bt);if(!d)return null;var v=e.parse(t[t.length-1],t.length-1,i);return v?"value"!==d.type.kind&&e.concat(1).checkSubtype(r,d.type)?null:new qe(r,i,d,n,a,v):null},qe.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(Qt(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},qe.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},qe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs())},qe.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],i={},n=0,a=Object.keys(this.cases).sort();n<a.length;n+=1){var o=a[n];void 0===(h=i[this.cases[o]])?(i[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[h][1].push(o)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=r;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];1===p.length?e.push(s(p[0])):e.push(p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var Ze=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};function Xe(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function We(t,e,r,i){return 0===i.compare(e,r)}function He(t,e,r){var i="=="!==t&&"!="!==t;return function(){function n(t,e,r){this.type=Rt,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return n.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],a=e.parse(t[1],1,Bt);if(!a)return null;if(!Xe(r,a.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+Gt(a.type)+"'.");var o=e.parse(t[2],2,Bt);if(!o)return null;if(!Xe(r,o.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+Gt(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '"+Gt(a.type)+"' and '"+Gt(o.type)+"'.");i&&("value"===a.type.kind&&"value"!==o.type.kind?a=new ie(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new ie(a.type,[o])));var s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Nt)))return null}return new n(a,o,s)},n.prototype.evaluate=function(n){var a=this.lhs.evaluate(n),o=this.rhs.evaluate(n);if(i&&this.hasUntypedArgument){var s=Qt(a),u=Qt(o);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new ee('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!i&&this.hasUntypedArgument){var l=Qt(a),c=Qt(o);if("string"!==l.kind||"string"!==c.kind)return e(n,a,o)}return this.collator?r(n,a,o,this.collator.evaluate(n)):e(n,a,o)},n.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},n.prototype.possibleOutputs=function(){return[!0,!1]},n.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},n}()}Ze.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i=[],n=1;n<t.length-1;n+=2){var a=e.parse(t[n],n,Rt);if(!a)return null;var o=e.parse(t[n+1],n+1,r);if(!o)return null;i.push([a,o]),r=r||o.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new Ze(r,i,s):null},Ze.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var i=r[e],n=i[0],a=i[1];if(n.evaluate(t))return a.evaluate(t)}return this.otherwise.evaluate(t)},Ze.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var i=r[e],n=i[0],a=i[1];t(n),t(a)}t(this.otherwise)},Ze.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map(function(t){return t[0],t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs())},Ze.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Ye=He("==",function(t,e,r){return e===r},We),Ke=He("!=",function(t,e,r){return e!==r},function(t,e,r,i){return!We(0,e,r,i)}),Je=He("<",function(t,e,r){return e<r},function(t,e,r,i){return i.compare(e,r)<0}),Qe=He(">",function(t,e,r){return e>r},function(t,e,r,i){return i.compare(e,r)>0}),$e=He("<=",function(t,e,r){return e<=r},function(t,e,r,i){return i.compare(e,r)<=0}),tr=He(">=",function(t,e,r){return e>=r},function(t,e,r,i){return i.compare(e,r)>=0}),er=function(t,e,r,i,n){this.type=zt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=n};er.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,jt);if(!r)return null;var i=t[2];if("object"!=typeof i||Array.isArray(i))return e.error("NumberFormat options argument must be an object.");var n=null;if(i.locale&&!(n=e.parse(i.locale,1,zt)))return null;var a=null;if(i.currency&&!(a=e.parse(i.currency,1,zt)))return null;var o=null;if(i["min-fraction-digits"]&&!(o=e.parse(i["min-fraction-digits"],1,jt)))return null;var s=null;return i["max-fraction-digits"]&&!(s=e.parse(i["max-fraction-digits"],1,jt))?null:new er(r,n,a,o,s)},er.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},er.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},er.prototype.possibleOutputs=function(){return[void 0]},er.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var rr=function(t){this.type=jt,this.input=t};rr.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+Gt(r.type)+" instead."):new rr(r):null},rr.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ee("Expected value to be of type string or array, but found "+Gt(Qt(e))+" instead.")},rr.prototype.eachChild=function(t){t(this.input)},rr.prototype.possibleOutputs=function(){return[void 0]},rr.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var ir={"==":Ye,"!=":Ke,">":Qe,"<":Je,">=":tr,"<=":$e,array:ie,at:Ge,boolean:ie,case:Ze,coalesce:Ue,collator:ce,format:ne,interpolate:Be,"interpolate-hcl":Be,"interpolate-lab":Be,length:rr,let:Ve,literal:te,match:qe,number:ie,"number-format":er,object:ie,step:ge,string:ie,"to-boolean":oe,"to-color":oe,"to-number":oe,"to-string":oe,var:de};function nr(t,e){var r=e[0],i=e[1],n=e[2],a=e[3];r=r.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);var o=a?a.evaluate(t):1,s=Jt(r,i,n,o);if(s)throw new ee(s);return new Wt(r/255*o,i/255*o,n/255*o,o)}function ar(t,e){return t in e}function or(t,e){var r=e[t];return void 0===r?null:r}function sr(t){return{type:t}}function ur(t){return{result:"success",value:t}}function lr(t){return{result:"error",value:t}}function cr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function hr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function pr(t){return!!t.expression&&t.expression.interpolated}function fr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function dr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function vr(t){return t}function mr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function gr(t,e,r,i,n){return mr(typeof r===n?i[r]:void 0,t.default,e.default)}function yr(t,e,r){if("number"!==fr(r))return mr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var n=xr(t.stops,r);return t.stops[n][1]}function _r(t,e,r){var i=void 0!==t.base?t.base:1;if("number"!==fr(r))return mr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var a=xr(t.stops,r),o=function(t,e,r,i){var n=i-r,a=t-r;return 0===n?0:1===e?a/n:(Math.pow(e,a)-1)/(Math.pow(e,n)-1)}(r,i,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],l=_e[e.type]||vr;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=De[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),i=u.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==i)return l(r,i,o)}}:l(s,u,o)}function br(t,e,r){return"color"===e.type?r=Wt.parse(r):"formatted"===e.type?r=Kt.fromString(r.toString()):fr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),mr(r,t.default,e.default)}function xr(t,e){for(var r,i,n=0,a=t.length-1,o=0;n<=a;){if(r=t[o=Math.floor((n+a)/2)][0],i=t[o+1][0],e===r||e>r&&e<i)return o;r<e?n=o+1:r>e&&(a=o-1)}return Math.max(o-1,0)}le.register(ir,{error:[{kind:"error"},[zt],function(t,e){var r=e[0];throw new ee(r.evaluate(t))}],typeof:[zt,[Bt],function(t,e){return Gt(Qt(e[0].evaluate(t)))}],"to-rgba":[Vt(jt,4),[Ft],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Ft,[jt,jt,jt],nr],rgba:[Ft,[jt,jt,jt,jt],nr],has:{type:Rt,overloads:[[[zt],function(t,e){return ar(e[0].evaluate(t),t.properties())}],[[zt,Dt],function(t,e){var r=e[0],i=e[1];return ar(r.evaluate(t),i.evaluate(t))}]]},get:{type:Bt,overloads:[[[zt],function(t,e){return or(e[0].evaluate(t),t.properties())}],[[zt,Dt],function(t,e){var r=e[0],i=e[1];return or(r.evaluate(t),i.evaluate(t))}]]},"feature-state":[Bt,[zt],function(t,e){return or(e[0].evaluate(t),t.featureState||{})}],properties:[Dt,[],function(t){return t.properties()}],"geometry-type":[zt,[],function(t){return t.geometryType()}],id:[Bt,[],function(t){return t.id()}],zoom:[jt,[],function(t){return t.globals.zoom}],"heatmap-density":[jt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[jt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Bt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[jt,sr(jt),function(t,e){for(var r=0,i=0,n=e;i<n.length;i+=1)r+=n[i].evaluate(t);return r}],"*":[jt,sr(jt),function(t,e){for(var r=1,i=0,n=e;i<n.length;i+=1)r*=n[i].evaluate(t);return r}],"-":{type:jt,overloads:[[[jt,jt],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)-i.evaluate(t)}],[[jt],function(t,e){return-e[0].evaluate(t)}]]},"/":[jt,[jt,jt],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)/i.evaluate(t)}],"%":[jt,[jt,jt],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)%i.evaluate(t)}],ln2:[jt,[],function(){return Math.LN2}],pi:[jt,[],function(){return Math.PI}],e:[jt,[],function(){return Math.E}],"^":[jt,[jt,jt],function(t,e){var r=e[0],i=e[1];return Math.pow(r.evaluate(t),i.evaluate(t))}],sqrt:[jt,[jt],function(t,e){var r=e[0];return Math.sqrt(r.evaluate(t))}],log10:[jt,[jt],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN10}],ln:[jt,[jt],function(t,e){var r=e[0];return Math.log(r.evaluate(t))}],log2:[jt,[jt],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN2}],sin:[jt,[jt],function(t,e){var r=e[0];return Math.sin(r.evaluate(t))}],cos:[jt,[jt],function(t,e){var r=e[0];return Math.cos(r.evaluate(t))}],tan:[jt,[jt],function(t,e){var r=e[0];return Math.tan(r.evaluate(t))}],asin:[jt,[jt],function(t,e){var r=e[0];return Math.asin(r.evaluate(t))}],acos:[jt,[jt],function(t,e){var r=e[0];return Math.acos(r.evaluate(t))}],atan:[jt,[jt],function(t,e){var r=e[0];return Math.atan(r.evaluate(t))}],min:[jt,sr(jt),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[jt,sr(jt),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[jt,[jt],function(t,e){var r=e[0];return Math.abs(r.evaluate(t))}],round:[jt,[jt],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[jt,[jt],function(t,e){var r=e[0];return Math.floor(r.evaluate(t))}],ceil:[jt,[jt],function(t,e){var r=e[0];return Math.ceil(r.evaluate(t))}],"filter-==":[Rt,[zt,Bt],function(t,e){var r=e[0],i=e[1];return t.properties()[r.value]===i.value}],"filter-id-==":[Rt,[Bt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Rt,[zt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Rt,[zt,Bt],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Rt,[Bt],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i<n}],"filter->":[Rt,[zt,Bt],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n>a}],"filter-id->":[Rt,[Bt],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i>n}],"filter-<=":[Rt,[zt,Bt],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Rt,[Bt],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i<=n}],"filter->=":[Rt,[zt,Bt],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Rt,[Bt],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i>=n}],"filter-has":[Rt,[Bt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Rt,[],function(t){return null!==t.id()}],"filter-type-in":[Rt,[Vt(zt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Rt,[Vt(Bt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Rt,[zt,Vt(Bt)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[Rt,[zt,Vt(Bt)],function(t,e){var r=e[0],i=e[1];return function(t,e,r,i){for(;r<=i;){var n=r+i>>1;if(e[n]===t)return!0;e[n]>t?i=n-1:r=n+1}return!1}(t.properties()[r.value],i.value,0,i.value.length-1)}],all:{type:Rt,overloads:[[[Rt,Rt],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)&&i.evaluate(t)}],[sr(Rt),function(t,e){for(var r=0,i=e;r<i.length;r+=1)if(!i[r].evaluate(t))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)||i.evaluate(t)}],[sr(Rt),function(t,e){for(var r=0,i=e;r<i.length;r+=1)if(i[r].evaluate(t))return!0;return!1}]]},"!":[Rt,[Rt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Rt,[zt],function(t,e){var r=e[0],i=t.globals&&t.globals.isSupportedScript;return!i||i(r.evaluate(t))}],upcase:[zt,[zt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[zt,[zt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[zt,sr(Bt),function(t,e){return e.map(function(e){return $t(e.evaluate(t))}).join("")}],"resolved-locale":[zt,[Nt],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var wr=function(t,e){var r;this.expression=t,this._warningHistory={},this._evaluator=new ue,this._defaultValue=e?"color"===(r=e).type&&dr(r.default)?new Wt(0,0,0,0):"color"===r.type?Wt.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=e&&"enum"===e.type?e.values:null};function kr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ir}function Er(t,e){var r=new ve(ir,[],e?function(t){var e={color:Ft,string:zt,number:jt,enum:zt,boolean:Rt,formatted:Ut};return"array"===t.type?Vt(e[t.value]||Bt,t.length):e[t.type]}(e):void 0),i=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?ur(new wr(i,e)):lr(r.errors)}wr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this.expression.evaluate(this._evaluator)},wr.prototype.evaluate=function(t,e,r){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null;try{var i=this.expression.evaluate(this._evaluator);if(null==i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new ee("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Sr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!pe(e.expression)};Sr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r)},Sr.prototype.evaluate=function(t,e,r){return this._styleExpression.evaluate(t,e,r)};var Tr=function(t,e,r){this.kind=t,this.zoomStops=r.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!pe(e.expression),r instanceof Be&&(this._interpolationType=r.interpolation)};function Ar(t,e){if("error"===(t=Er(t,e)).result)return t;var r=t.value.expression,i=he(r);if(!i&&!cr(e))return lr([new Mt("","data expressions not supported")]);var n=fe(r,["zoom"]);if(!n&&!hr(e))return lr([new Mt("","zoom expressions not supported")]);var a=function t(e){var r=null;if(e instanceof Ve)r=t(e.result);else if(e instanceof Ue)for(var i=0,n=e.args;i<n.length;i+=1){var a=n[i];if(r=t(a))break}else(e instanceof ge||e instanceof Be)&&e.input instanceof le&&"zoom"===e.input.name&&(r=e);return r instanceof Mt?r:(e.eachChild(function(e){var i=t(e);i instanceof Mt?r=i:!r&&i?r=new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&i&&r!==i&&(r=new Mt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r)}(r);return a||n?a instanceof Mt?lr([a]):a instanceof Be&&!pr(e)?lr([new Mt("",'"interpolate" expressions cannot be used with this property')]):ur(a?new Tr(i?"camera":"composite",t.value,a):new Sr(i?"constant":"source",t.value)):lr([new Mt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Tr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r)},Tr.prototype.evaluate=function(t,e,r){return this._styleExpression.evaluate(t,e,r)},Tr.prototype.interpolationFactor=function(t,e,r){return this._interpolationType?Be.interpolationFactor(this._interpolationType,t,e,r):0};var Pr=function(t,e){this._parameters=t,this._specification=e,Pt(this,function t(e,r){var i,n,a,o="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,l=s||!u,c=e.type||(pr(r)?"exponential":"interval");if(o&&((e=Pt({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],Wt.parse(t[1])]})),e.default?e.default=Wt.parse(e.default):e.default=Wt.parse(r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!De[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===c)i=_r;else if("interval"===c)i=yr;else if("categorical"===c){i=gr,n=Object.create(null);for(var h=0,p=e.stops;h<p.length;h+=1){var f=p[h];n[f[0]]=f[1]}a=typeof e.stops[0][0]}else{if("identity"!==c)throw new Error('Unknown function type "'+c+'"');i=br}if(s){for(var d={},v=[],m=0;m<e.stops.length;m++){var g=e.stops[m],y=g[0].zoom;void 0===d[y]&&(d[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},v.push(y)),d[y].stops.push([g[0].value,g[1]])}for(var _=[],b=0,x=v;b<x.length;b+=1){var w=x[b];_.push([d[w].zoom,t(d[w],r)])}return{kind:"composite",interpolationFactor:Be.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:_.map(function(t){return t[0]}),evaluate:function(t,i){var n=t.zoom;return _r({stops:_,base:e.base},r,n).evaluate(n,i)}}}return l?{kind:"camera",interpolationFactor:"exponential"===c?Be.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){var o=t.zoom;return i(e,r,o,n,a)}}:{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?mr(e.default,r.default):i(e,r,s,n,a)}}}(this._parameters,this._specification))};function Or(t,e){if(dr(t))return new Pr(t,e);if(kr(t)){var r=Ar(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=Wt.parse(t)),{kind:"constant",evaluate:function(){return i}}}function Ir(t){var e=t.key,r=t.value,i=t.valueSpec||{},n=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],u=fr(r);if("object"!==u)return[new Tt(e,r,"object expected, "+u+" found")];for(var l in r){var c=l.split(".")[0],h=i[c]||i["*"],p=void 0;if(n[c])p=n[c];else if(i[c])p=ti;else if(n["*"])p=n["*"];else{if(!i["*"]){s.push(new Tt(e,r[l],'unknown property "'+l+'"'));continue}p=ti}s=s.concat(p({key:(e?e+".":e)+l,value:r[l],valueSpec:h,style:a,styleSpec:o,object:r,objectKey:l},r))}for(var f in i)n[f]||i[f].required&&void 0===i[f].default&&void 0===r[f]&&s.push(new Tt(e,r,'missing required property "'+f+'"'));return s}function Mr(t){var e=t.value,r=t.valueSpec,i=t.style,n=t.styleSpec,a=t.key,o=t.arrayElementValidator||ti;if("array"!==fr(e))return[new Tt(a,e,"array expected, "+fr(e)+" found")];if(r.length&&e.length!==r.length)return[new Tt(a,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new Tt(a,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};n.$version<7&&(s.function=r.function),"object"===fr(r.value)&&(s=r.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(o({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:i,styleSpec:n,key:a+"["+l+"]"}));return u}function Cr(t){var e=t.key,r=t.value,i=t.valueSpec,n=fr(r);return"number"!==n?[new Tt(e,r,"number expected, "+n+" found")]:"minimum"in i&&r<i.minimum?[new Tt(e,r,r+" is less than the minimum value "+i.minimum)]:"maximum"in i&&r>i.maximum?[new Tt(e,r,r+" is greater than the maximum value "+i.maximum)]:[]}function Lr(t){var e,r,i,n=t.valueSpec,a=Ot(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,u=!s,l="array"===fr(t.value.stops)&&"array"===fr(t.value.stops[0])&&"object"===fr(t.value.stops[0][0]),c=Ir({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return[new Tt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Mr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===fr(r)&&0===r.length&&e.push(new Tt(t.key,r,"array must have at least one stop")),e},default:function(t){return ti({key:t.key,value:t.value,valueSpec:n,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===a&&s&&c.push(new Tt(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||c.push(new Tt(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!pr(t.valueSpec)&&c.push(new Tt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!cr(t.valueSpec)?c.push(new Tt(t.key,t.value,"property functions not supported")):s&&!hr(t.valueSpec)&&c.push(new Tt(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!l||void 0!==t.value.property||c.push(new Tt(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],a=t.value,s=t.key;if("array"!==fr(a))return[new Tt(s,a,"array expected, "+fr(a)+" found")];if(2!==a.length)return[new Tt(s,a,"array length 2 expected, length "+a.length+" found")];if(l){if("object"!==fr(a[0]))return[new Tt(s,a,"object expected, "+fr(a[0])+" found")];if(void 0===a[0].zoom)return[new Tt(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new Tt(s,a,"object stop key must have value")];if(i&&i>Ot(a[0].zoom))return[new Tt(s,a[0].zoom,"stop zoom values must appear in ascending order")];Ot(a[0].zoom)!==i&&(i=Ot(a[0].zoom),r=void 0,o={}),e=e.concat(Ir({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Cr,value:p}}))}else e=e.concat(p({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return kr(It(a[1]))?e.concat([new Tt(s+"[1]",a[1],"expressions are not allowed in function stops.")]):e.concat(ti({key:s+"[1]",value:a[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function p(t,i){var s=fr(t.value),u=Ot(t.value),l=null!==t.value?t.value:i;if(e){if(s!==e)return[new Tt(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Tt(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, "+s+" found";return cr(n)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(t.key,l,c)]}return"categorical"!==a||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&void 0!==r&&u<r?[new Tt(t.key,l,"stop domain values must appear in ascending order")]:(r=u,"categorical"===a&&u in o?[new Tt(t.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new Tt(t.key,l,"integer expected, found "+u)]}}function jr(t){var e=("property"===t.expressionContext?Ar:Er)(It(t.value),t.valueSpec);if("error"===e.result)return e.value.map(function(e){return new Tt(""+t.key+e.key,t.value,e.message)});var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==r.possibleOutputs().indexOf(void 0))return[new Tt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!pe(r))return[new Tt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!pe(r))return[new Tt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!fe(r,["zoom","feature-state"]))return[new Tt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!he(r))return[new Tt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zr(t){var e=t.key,r=t.value,i=t.valueSpec,n=[];return Array.isArray(i.values)?-1===i.values.indexOf(Ot(r))&&n.push(new Tt(e,r,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(i.values).indexOf(Ot(r))&&n.push(new Tt(e,r,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(r)+" found")),n}function Rr(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var i=r[e];if(!Rr(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}Pr.deserialize=function(t){return new Pr(t._parameters,t._specification)},Pr.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Fr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Dr(t){if(null==t)return function(){return!0};Rr(t)||(t=Nr(t));var e=Er(t,Fr);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,r){return e.value.evaluate(t,r)}}function Br(t,e){return t<e?-1:t>e?1:0}function Nr(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?Ur(t[1],t[2],"=="):"!="===r?qr(Ur(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Ur(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(Nr))):"all"===r?["all"].concat(t.slice(1).map(Nr)):"none"===r?["all"].concat(t.slice(1).map(Nr).map(qr)):"in"===r?Vr(t[1],t.slice(2)):"!in"===r?qr(Vr(t[1],t.slice(2))):"has"===r?Gr(t[1]):"!has"!==r||qr(Gr(t[1]))}function Ur(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function Vr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(Br)]]:["filter-in-small",t,["literal",e]]}}function Gr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function qr(t){return["!",t]}function Zr(t){return Rr(It(t.value))?jr(Pt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,i=e.key;if("array"!==fr(r))return[new Tt(i,r,"array expected, "+fr(r)+" found")];var n,a=e.styleSpec,o=[];if(r.length<1)return[new Tt(i,r,"filter array must have at least 1 element")];switch(o=o.concat(zr({key:i+"[0]",value:r[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ot(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Ot(r[1])&&o.push(new Tt(i,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&o.push(new Tt(i,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(n=fr(r[1]))&&o.push(new Tt(i+"[1]",r[1],"string expected, "+n+" found"));for(var s=2;s<r.length;s++)n=fr(r[s]),"$type"===Ot(r[1])?o=o.concat(zr({key:i+"["+s+"]",value:r[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&o.push(new Tt(i+"["+s+"]",r[s],"string, number, or boolean expected, "+n+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)o=o.concat(t({key:i+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=fr(r[1]),2!==r.length?o.push(new Tt(i,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==n&&o.push(new Tt(i+"[1]",r[1],"string expected, "+n+" found"))}return o}(t)}function Xr(t,e){var r=t.key,i=t.style,n=t.styleSpec,a=t.value,o=t.objectKey,s=n[e+"_"+t.layerType];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return ti({key:r,value:a,valueSpec:n.transition,style:i,styleSpec:n});var l,c=t.valueSpec||s[o];if(!c)return[new Tt(r,a,'unknown property "'+o+'"')];if("string"===fr(a)&&cr(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new Tt(r,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new Tt(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&dr(It(a))&&"identity"===Ot(a.type)&&h.push(new Tt(r,a,'"text-font" does not support identity functions'))),h.concat(ti({key:t.key,value:a,valueSpec:c,style:i,styleSpec:n,expressionContext:"property",propertyType:e,propertyKey:o}))}function Wr(t){return Xr(t,"paint")}function Hr(t){return Xr(t,"layout")}function Yr(t){var e=[],r=t.value,i=t.key,n=t.style,a=t.styleSpec;r.type||r.ref||e.push(new Tt(i,r,'either "type" or "ref" is required'));var o,s=Ot(r.type),u=Ot(r.ref);if(r.id)for(var l=Ot(r.id),c=0;c<t.arrayIndex;c++){var h=n.layers[c];Ot(h.id)===l&&e.push(new Tt(i,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new Tt(i,r[t],'"'+t+'" is prohibited for ref layers'))}),n.layers.forEach(function(t){Ot(t.id)===u&&(o=t)}),o?o.ref?e.push(new Tt(i,r.ref,"ref cannot reference another ref layer")):s=Ot(o.type):e.push(new Tt(i,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(r.source){var p=n.sources&&n.sources[r.source],f=p&&Ot(p.type);p?"vector"===f&&"raster"===s?e.push(new Tt(i,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Tt(i,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==f||r["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Tt(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new Tt(i,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Tt(i,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Tt(i,r.source,'source "'+r.source+'" not found'))}else e.push(new Tt(i,r,'missing required property "source"'));return e=e.concat(Ir({key:i,value:r,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ti({key:i+".type",value:r.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:Zr,layout:function(t){return Ir({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Hr(Pt({layerType:s},t))}}})},paint:function(t){return Ir({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Wr(Pt({layerType:s},t))}}})}}}))}function Kr(t){var e=t.value,r=t.key,i=t.styleSpec,n=t.style;if(!e.type)return[new Tt(r,e,'"type" is required')];var a,o=Ot(e.type);switch(o){case"vector":case"raster":case"raster-dem":if(a=Ir({key:r,value:e,valueSpec:i["source_"+o.replace("-","_")],style:t.style,styleSpec:i}),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&a.push(new Tt(r+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return a;case"geojson":if(a=Ir({key:r,value:e,valueSpec:i.source_geojson,style:n,styleSpec:i}),e.cluster)for(var u in e.clusterProperties){var l=e.clusterProperties[u],c=l[0],h=l[1],p="string"==typeof c?[c,["accumulated"],["get",u]]:c;a.push.apply(a,jr({key:r+"."+u+".map",value:h,expressionContext:"cluster-map"})),a.push.apply(a,jr({key:r+"."+u+".reduce",value:p,expressionContext:"cluster-reduce"}))}return a;case"video":return Ir({key:r,value:e,valueSpec:i.source_video,style:n,styleSpec:i});case"image":return Ir({key:r,value:e,valueSpec:i.source_image,style:n,styleSpec:i});case"canvas":return[new Tt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zr({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:i})}}function Jr(t){var e=t.value,r=t.styleSpec,i=r.light,n=t.style,a=[],o=fr(e);if(void 0===e)return a;if("object"!==o)return a.concat([new Tt("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);a=u&&i[u[1]]&&i[u[1]].transition?a.concat(ti({key:s,value:e[s],valueSpec:r.transition,style:n,styleSpec:r})):i[s]?a.concat(ti({key:s,value:e[s],valueSpec:i[s],style:n,styleSpec:r})):a.concat([new Tt(s,e[s],'unknown property "'+s+'"')])}return a}function Qr(t){var e=t.value,r=t.key,i=fr(e);return"string"!==i?[new Tt(r,e,"string expected, "+i+" found")]:[]}var $r={"*":function(){return[]},array:Mr,boolean:function(t){var e=t.value,r=t.key,i=fr(e);return"boolean"!==i?[new Tt(r,e,"boolean expected, "+i+" found")]:[]},number:Cr,color:function(t){var e=t.key,r=t.value,i=fr(r);return"string"!==i?[new Tt(e,r,"color expected, "+i+" found")]:null===Xt(r)?[new Tt(e,r,'color expected, "'+r+'" found')]:[]},constants:At,enum:zr,filter:Zr,function:Lr,layer:Yr,object:Ir,source:Kr,light:Jr,string:Qr,formatted:function(t){return 0===Qr(t).length?[]:jr(t)}};function ti(t){var e=t.value,r=t.valueSpec,i=t.styleSpec;return r.expression&&dr(Ot(e))?Lr(t):r.expression&&kr(It(e))?jr(t):r.type&&$r[r.type]?$r[r.type](t):Ir(Pt({},t,{valueSpec:r.type?i[r.type]:r}))}function ei(t){var e=t.value,r=t.key,i=Qr(t);return i.length?i:(-1===e.indexOf("{fontstack}")&&i.push(new Tt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Tt(r,e,'"glyphs" url must include a "{range}" token')),i)}function ri(t,e){e=e||St;var r=[];return r=r.concat(ti({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ei,"*":function(){return[]}}})),t.constants&&(r=r.concat(At({key:"constants",value:t.constants,style:t,styleSpec:e}))),ii(r)}function ii(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function ni(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return ii(t.apply(this,e))}}ri.source=ni(Kr),ri.light=ni(Jr),ri.layer=ni(Yr),ri.filter=ni(Zr),ri.paintProperty=ni(Wr),ri.layoutProperty=ni(Hr);var ai=ri,oi=ri.light,si=ri.paintProperty,ui=ri.layoutProperty;function li(t,e){var r=!1;if(e&&e.length)for(var i=0,n=e;i<n.length;i+=1){var a=n[i];t.fire(new kt(new Error(a.message))),r=!0}return r}var ci=pi,hi=3;function pi(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],e=n[1],r=n[2],this.d=e+2*r;for(var a=0;a<this.d*this.d;a++){var o=n[hi+a],s=n[hi+a+1];i.push(o===s?null:n.subarray(o,s))}var u=n[hi+i.length],l=n[hi+i.length+1];this.keys=n.subarray(u,l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var c=0;c<this.d*this.d;c++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var h=r/e*t;this.min=-h,this.max=t+h}pi.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},pi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},pi.prototype._insertCell=function(t,e,r,i,n,a){this.cells[n].push(a)},pi.prototype.query=function(t,e,r,i,n){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=r&&o<=i&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,i,this._queryCell,s,{},n),s},pi.prototype._queryCell=function(t,e,r,i,n,a,o,s){var u=this.cells[n];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===o[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&r>=c[f+0]&&i>=c[f+1])?(o[p]=!0,a.push(l[p])):o[p]=!1}}},pi.prototype._forEachCell=function(t,e,r,i,n,a,o,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(i),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&n.call(this,t,e,r,i,d,a,o,s))return}},pi.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},pi.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},pi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=hi+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(e+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];n[hi+o]=a,n.set(s,a),a+=s.length}return n[hi+t.length]=a,n.set(this.keys,a),a+=this.keys.length,n[hi+t.length+1]=a,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};var fi=self.ImageData,di={};function vi(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),di[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var mi in vi("Object",Object),ci.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},ci.deserialize=function(t){return new ci(t.buffer)},vi("Grid",ci),vi("Color",Wt),vi("Error",Error),vi("StylePropertyFunction",Pr),vi("StyleExpression",wr,{omit:["_evaluator"]}),vi("ZoomDependentExpression",Tr),vi("ZoomConstantExpression",Sr),vi("CompoundExpression",le,{omit:["_evaluate"]}),ir)ir[mi]._classRegistryKey||vi("Expression_"+mi,ir[mi]);function gi(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof fi)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],n=0,a=t;n<a.length;n+=1){var o=a[n];i.push(gi(o,e))}return i}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var l=s.serialize?s.serialize(t,e):{};if(!s.serialize){for(var c in t)if(t.hasOwnProperty(c)&&!(di[u].omit.indexOf(c)>=0)){var h=t[c];l[c]=di[u].shallow.indexOf(c)>=0?h:gi(h,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(l.$name=u),l}throw new Error("can't serialize object of type "+typeof t)}function yi(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof fi)return t;if(Array.isArray(t))return t.map(yi);if("object"==typeof t){var e=t.$name||"Object",r=di[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var i=Object.create(r.prototype),n=0,a=Object.keys(t);n<a.length;n+=1){var o=a[n];if("$name"!==o){var s=t[o];i[o]=di[e].shallow.indexOf(o)>=0?s:yi(s)}}return i}throw new Error("can't deserialize object of type "+typeof t)}var _i=function(){this.first=!0};_i.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var bi={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function xi(t){for(var e=0,r=t;e<r.length;e+=1)if(Ei(r[e].charCodeAt(0)))return!0;return!1}function wi(t){for(var e=0,r=t;e<r.length;e+=1)if(!ki(r[e].charCodeAt(0)))return!1;return!0}function ki(t){return!(bi.Arabic(t)||bi["Arabic Supplement"](t)||bi["Arabic Extended-A"](t)||bi["Arabic Presentation Forms-A"](t)||bi["Arabic Presentation Forms-B"](t))}function Ei(t){return!(746!==t&&747!==t&&(t<4352||!(bi["Bopomofo Extended"](t)||bi.Bopomofo(t)||bi["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||bi["CJK Compatibility Ideographs"](t)||bi["CJK Compatibility"](t)||bi["CJK Radicals Supplement"](t)||bi["CJK Strokes"](t)||!(!bi["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||bi["CJK Unified Ideographs Extension A"](t)||bi["CJK Unified Ideographs"](t)||bi["Enclosed CJK Letters and Months"](t)||bi["Hangul Compatibility Jamo"](t)||bi["Hangul Jamo Extended-A"](t)||bi["Hangul Jamo Extended-B"](t)||bi["Hangul Jamo"](t)||bi["Hangul Syllables"](t)||bi.Hiragana(t)||bi["Ideographic Description Characters"](t)||bi.Kanbun(t)||bi["Kangxi Radicals"](t)||bi["Katakana Phonetic Extensions"](t)||bi.Katakana(t)&&12540!==t||!(!bi["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!bi["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||bi["Unified Canadian Aboriginal Syllabics"](t)||bi["Unified Canadian Aboriginal Syllabics Extended"](t)||bi["Vertical Forms"](t)||bi["Yijing Hexagram Symbols"](t)||bi["Yi Syllables"](t)||bi["Yi Radicals"](t))))}function Si(t){return!(Ei(t)||function(t){return!!(bi["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||bi["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||bi["Letterlike Symbols"](t)||bi["Number Forms"](t)||bi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||bi["Control Pictures"](t)&&9251!==t||bi["Optical Character Recognition"](t)||bi["Enclosed Alphanumerics"](t)||bi["Geometric Shapes"](t)||bi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||bi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||bi["CJK Symbols and Punctuation"](t)||bi.Katakana(t)||bi["Private Use Area"](t)||bi["CJK Compatibility Forms"](t)||bi["Small Form Variants"](t)||bi["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Ti(t,e){return!(!e&&(t>=1424&&t<=2303||bi["Arabic Presentation Forms-A"](t)||bi["Arabic Presentation Forms-B"](t))||t>=2304&&t<=3583||t>=3840&&t<=4255||bi.Khmer(t))}var Ai,Pi=!1,Oi=null,Ii=!1,Mi=new Et,Ci={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ii||null!=Ci.applyArabicShaping}},Li=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _i,this.transition={})};Li.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,i=t;r<i.length;r+=1)if(!Ti(i[r].charCodeAt(0),e))return!1;return!0}(t,Ci.isLoaded())},Li.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Li.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var ji=function(t,e){this.property=t,this.value=e,this.expression=Or(void 0===e?t.specification.default:e,t.specification)};ji.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ji.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var zi=function(t){this.property=t,this.value=new ji(t,void 0)};zi.prototype.transitioned=function(t,e){return new Fi(this.property,this.value,e,h({},t.transition,this.transition),t.now)},zi.prototype.untransitioned=function(){return new Fi(this.property,this.value,null,{},0)};var Ri=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Ri.prototype.getValue=function(t){return b(this._values[t].value.value)},Ri.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zi(this._values[t].property)),this._values[t].value=new ji(this._values[t].property,null===e?void 0:b(e))},Ri.prototype.getTransition=function(t){return b(this._values[t].transition)},Ri.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new zi(this._values[t].property)),this._values[t].transition=b(e)||void 0},Ri.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e],n=this.getValue(i);void 0!==n&&(t[i]=n);var a=this.getTransition(i);void 0!==a&&(t[i+"-transition"]=a)}return t},Ri.prototype.transitioned=function(t,e){for(var r=new Di(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var a=n[i];r._values[a]=this._values[a].transitioned(t,e._values[a])}return r},Ri.prototype.untransitioned=function(){for(var t=new Di(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e];t._values[i]=this._values[i].untransitioned()}return t};var Fi=function(t,e,r,i,n){this.property=t,this.value=e,this.begin=n+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=r)};Fi.prototype.possiblyEvaluate=function(t){var e=t.now||0,r=this.value.possiblyEvaluate(t),i=this.prior;if(i){if(e>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(e<this.begin)return i.possiblyEvaluate(t);var n=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(t),r,function(t){if(n<=0)return 0;if(n>=1)return 1;var e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}())}return r};var Di=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Di.prototype.possiblyEvaluate=function(t){for(var e=new Ui(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var n=i[r];e._values[n]=this._values[n].possiblyEvaluate(t)}return e},Di.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var r=e[t];if(this._values[r].prior)return!0}return!1};var Bi=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Bi.prototype.getValue=function(t){return b(this._values[t].value)},Bi.prototype.setValue=function(t,e){this._values[t]=new ji(this._values[t].property,null===e?void 0:b(e))},Bi.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e],n=this.getValue(i);void 0!==n&&(t[i]=n)}return t},Bi.prototype.possiblyEvaluate=function(t){for(var e=new Ui(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var n=i[r];e._values[n]=this._values[n].possiblyEvaluate(t)}return e};var Ni=function(t,e,r){this.property=t,this.value=e,this.parameters=r};Ni.prototype.isConstant=function(){return"constant"===this.value.kind},Ni.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Ni.prototype.evaluate=function(t,e){return this.property.evaluate(this.value,this.parameters,t,e)};var Ui=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Ui.prototype.get=function(t){return this._values[t]};var Vi=function(t){this.specification=t};Vi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Vi.prototype.interpolate=function(t,e,r){var i=_e[this.specification.type];return i?i(t,e,r):t};var Gi=function(t){this.specification=t};Gi.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new Ni(this,{kind:"constant",value:t.expression.evaluate(e)},e):new Ni(this,t.expression,e)},Gi.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Ni(this,{kind:"constant",value:void 0},t.parameters);var i=_e[this.specification.type];return i?new Ni(this,{kind:"constant",value:i(t.value.value,e.value.value,r)},t.parameters):t},Gi.prototype.evaluate=function(t,e,r,i){return"constant"===t.kind?t.value:t.evaluate(e,r,i)};var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(t,e){if(void 0===t.value)return new Ni(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var r=t.expression.evaluate(e),i=this._calculate(r,r,r,e);return new Ni(this,{kind:"constant",value:i},e)}if("camera"===t.expression.kind){var n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Ni(this,{kind:"constant",value:n},e)}return new Ni(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,i){if("source"===t.kind){var n=t.evaluate(e,r,i);return this._calculate(n,n,n,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,i),t.evaluate({zoom:Math.floor(e.zoom)},r,i),t.evaluate({zoom:Math.floor(e.zoom)+1},r,i),e):t.value},e.prototype._calculate=function(t,e,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(Gi),Zi=function(t){this.specification=t};Zi.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new Li(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Li(Math.floor(e.zoom),e)),t.expression.evaluate(new Li(Math.floor(e.zoom+1),e)),e)}},Zi.prototype._calculate=function(t,e,r,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},Zi.prototype.interpolate=function(t){return t};var Xi=function(t){this.specification=t};Xi.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},Xi.prototype.interpolate=function(){return!1};var Wi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var r=t[e],i=this.defaultPropertyValues[e]=new ji(r,void 0),n=this.defaultTransitionablePropertyValues[e]=new zi(r);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({})}};vi("DataDrivenProperty",Gi),vi("DataConstantProperty",Vi),vi("CrossFadedDataDrivenProperty",qi),vi("CrossFadedProperty",Zi),vi("ColorRampProperty",Xi);var Hi=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter=function(){return!0},"custom"!==e.type&&(e=e,this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Bi(r.layout)),r.paint)){for(var i in this._transitionablePaint=new Ri(r.paint),e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(var n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e){var i="layers."+this.id+".layout."+t;if(this._validate(ui,i,t,e,r))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e},e.prototype.getPaintProperty=function(t){return g(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e){var i="layers."+this.id+".paint."+t;if(this._validate(si,i,t,e,r))return!1}if(g(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],a="cross-faded-data-driven"===n.property.specification["property-type"]&&!n.value.value&&e,o=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);var s=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),s||o||a},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),_(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,r,i,n){return void 0===n&&(n={}),(!n||!1!==n.validate)&&li(this,t.call(ai,{key:e,layerType:this.type,objectKey:r,value:i,styleSpec:St,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof Ni&&cr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(Et),Yi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ki=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ji=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Qi(t,e){void 0===e&&(e=1);var r=0,i=0;return{members:t.map(function(t){var n,a=(n=t.type,Yi[n].BYTES_PER_ELEMENT),o=r=$i(r,Math.max(e,a)),s=t.components||1;return i=Math.max(i,a),r+=a*s,{name:t.name,type:t.type,components:s,offset:o}}),size:$i(r,Math.max(i,e)),alignment:e}}function $i(t,e){return Math.ceil(t/e)*e}Ji.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ji.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ji.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ji.prototype.clear=function(){this.length=0},Ji.prototype.resize=function(t){this.reserve(t),this.length=t},Ji.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ji.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var tn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var i=2*t;return this.int16[i+0]=e,this.int16[i+1]=r,t},e}(Ji);tn.prototype.bytesPerElement=4,vi("StructArrayLayout2i4",tn);var en=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)},e.prototype.emplace=function(t,e,r,i,n){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=n,t},e}(Ji);en.prototype.bytesPerElement=8,vi("StructArrayLayout4i8",en);var rn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n,a)},e.prototype.emplace=function(t,e,r,i,n,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Ji);rn.prototype.bytesPerElement=12,vi("StructArrayLayout2i4i12",rn);var nn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,i,n,a,o,s)},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u){var l=6*t,c=12*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=i,this.int16[l+3]=n,this.uint8[c+8]=a,this.uint8[c+9]=o,this.uint8[c+10]=s,this.uint8[c+11]=u,t},e}(Ji);nn.prototype.bytesPerElement=12,vi("StructArrayLayout4i4ub12",nn);var an=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,i,n,a,o,s)},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u){var l=8*t;return this.uint16[l+0]=e,this.uint16[l+1]=r,this.uint16[l+2]=i,this.uint16[l+3]=n,this.uint16[l+4]=a,this.uint16[l+5]=o,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Ji);an.prototype.bytesPerElement=16,vi("StructArrayLayout8ui16",an);var on=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,i,n,a,o,s)},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u){var l=8*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=i,this.int16[l+3]=n,this.uint16[l+4]=a,this.uint16[l+5]=o,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Ji);on.prototype.bytesPerElement=16,vi("StructArrayLayout4i4ui16",on);var sn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.float32[n+0]=e,this.float32[n+1]=r,this.float32[n+2]=i,t},e}(Ji);sn.prototype.bytesPerElement=12,vi("StructArrayLayout3f12",sn);var un=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var r=1*t;return this.uint32[r+0]=e,t},e}(Ji);un.prototype.bytesPerElement=4,vi("StructArrayLayout1ul4",un);var ln=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,r,i,n,a,o,s,u,l,c)},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,l,c,h){var p=12*t,f=6*t;return this.int16[p+0]=e,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=n,this.int16[p+4]=a,this.int16[p+5]=o,this.uint32[f+3]=s,this.uint16[p+8]=u,this.uint16[p+9]=l,this.int16[p+10]=c,this.int16[p+11]=h,t},e}(Ji);ln.prototype.bytesPerElement=24,vi("StructArrayLayout6i1ul2ui2i24",ln);var cn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,i,n,a)},e.prototype.emplace=function(t,e,r,i,n,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(Ji);cn.prototype.bytesPerElement=12,vi("StructArrayLayout2i2i2i12",cn);var hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)},e.prototype.emplace=function(t,e,r,i,n){var a=12*t,o=3*t;return this.uint8[a+0]=e,this.uint8[a+1]=r,this.float32[o+1]=i,this.float32[o+2]=n,t},e}(Ji);hn.prototype.bytesPerElement=12,vi("StructArrayLayout2ub2f12",hn);var pn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,l,c,h,p,f,d){var v=this.length;return this.resize(v+1),this.emplace(v,t,e,r,i,n,a,o,s,u,l,c,h,p,f,d)},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,l,c,h,p,f,d,v){var m=22*t,g=11*t,y=44*t;return this.int16[m+0]=e,this.int16[m+1]=r,this.uint16[m+2]=i,this.uint16[m+3]=n,this.uint32[g+2]=a,this.uint32[g+3]=o,this.uint32[g+4]=s,this.uint16[m+10]=u,this.uint16[m+11]=l,this.uint16[m+12]=c,this.float32[g+7]=h,this.float32[g+8]=p,this.uint8[y+36]=f,this.uint8[y+37]=d,this.uint32[g+10]=v,t},e}(Ji);pn.prototype.bytesPerElement=44,vi("StructArrayLayout2i2ui3ul3ui2f2ub1ul44",pn);var fn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,l,c,h,p,f,d,v,m,g){var y=this.length;return this.resize(y+1),this.emplace(y,t,e,r,i,n,a,o,s,u,l,c,h,p,f,d,v,m,g)},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,l,c,h,p,f,d,v,m,g,y){var _=22*t,b=11*t;return this.int16[_+0]=e,this.int16[_+1]=r,this.int16[_+2]=i,this.int16[_+3]=n,this.int16[_+4]=a,this.int16[_+5]=o,this.uint16[_+6]=s,this.uint16[_+7]=u,this.uint16[_+8]=l,this.uint16[_+9]=c,this.uint16[_+10]=h,this.uint16[_+11]=p,this.uint16[_+12]=f,this.uint16[_+13]=d,this.uint16[_+14]=v,this.uint32[b+8]=m,this.float32[b+9]=g,this.float32[b+10]=y,t},e}(Ji);fn.prototype.bytesPerElement=44,vi("StructArrayLayout6i9ui1ul2f44",fn);var dn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var r=1*t;return this.float32[r+0]=e,t},e}(Ji);dn.prototype.bytesPerElement=4,vi("StructArrayLayout1f4",dn);var vn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.int16[n+0]=e,this.int16[n+1]=r,this.int16[n+2]=i,t},e}(Ji);vn.prototype.bytesPerElement=6,vi("StructArrayLayout3i6",vn);var mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=2*t,a=4*t;return this.uint32[n+0]=e,this.uint16[a+2]=r,this.uint16[a+3]=i,t},e}(Ji);mn.prototype.bytesPerElement=8,vi("StructArrayLayout1ul2ui8",mn);var gn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r)},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,this.uint16[n+2]=i,t},e}(Ji);gn.prototype.bytesPerElement=6,vi("StructArrayLayout3ui6",gn);var yn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,t},e}(Ji);yn.prototype.bytesPerElement=4,vi("StructArrayLayout2ui4",yn);var _n=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){var r=1*t;return this.uint16[r+0]=e,t},e}(Ji);_n.prototype.bytesPerElement=2,vi("StructArrayLayout1ui2",_n);var bn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var i=2*t;return this.float32[i+0]=e,this.float32[i+1]=r,t},e}(Ji);bn.prototype.bytesPerElement=8,vi("StructArrayLayout2f8",bn);var xn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r,i)},e.prototype.emplace=function(t,e,r,i,n){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=i,this.float32[a+3]=n,t},e}(Ji);xn.prototype.bytesPerElement=16,vi("StructArrayLayout4f16",xn);var wn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},r.anchorPoint.get=function(){return new n(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Ki);wn.prototype.size=24;var kn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new wn(this,t)},e}(ln);vi("CollisionBoxArray",kn);var En=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},Object.defineProperties(e.prototype,r),e}(Ki);En.prototype.size=44;var Sn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new En(this,t)},e}(pn);vi("PlacedSymbolArray",Sn);var Tn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},radialTextOffset:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.rightJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+2]=t},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.centerJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+3]=t},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.leftJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+4]=t},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.verticalPlacedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+5]=t},r.key.get=function(){return this._structArray.uint16[this._pos2+6]},r.key.set=function(t){this._structArray.uint16[this._pos2+6]=t},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+7]},r.textBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+7]=t},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.iconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.iconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.featureIndex.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+12]},r.numHorizontalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+13]},r.numVerticalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+13]=t},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+14]},r.numIconVertices.set=function(t){this._structArray.uint16[this._pos2+14]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+8]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+8]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+9]},r.textBoxScale.set=function(t){this._structArray.float32[this._pos4+9]=t},r.radialTextOffset.get=function(){return this._structArray.float32[this._pos4+10]},r.radialTextOffset.set=function(t){this._structArray.float32[this._pos4+10]=t},Object.defineProperties(e.prototype,r),e}(Ki);Tn.prototype.size=44;var An=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Tn(this,t)},e}(fn);vi("SymbolInstanceArray",An);var Pn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={offsetX:{configurable:!0}};return r.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},r.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,r),e}(Ki);Pn.prototype.size=4;var On=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new Pn(this,t)},e}(dn);vi("GlyphOffsetArray",On);var In=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return r.x.get=function(){return this._structArray.int16[this._pos2+0]},r.x.set=function(t){this._structArray.int16[this._pos2+0]=t},r.y.get=function(){return this._structArray.int16[this._pos2+1]},r.y.set=function(t){this._structArray.int16[this._pos2+1]=t},r.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},r.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,r),e}(Ki);In.prototype.size=6;var Mn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new In(this,t)},e}(vn);vi("SymbolLineVertexArray",Mn);var Cn=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,r),e}(Ki);Cn.prototype.size=8;var Ln=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new Cn(this,t)},e}(mn);vi("FeatureIndexArray",Ln);var jn=Qi([{name:"a_pos",components:2,type:"Int16"}],4).members,zn=function(t){void 0===t&&(t=[]),this.segments=t};function Rn(t,e){return 256*(t=l(Math.floor(t),0,255))+l(Math.floor(e),0,255)}zn.prototype.prepareSegment=function(t,e,r,i){var n=this.segments[this.segments.length-1];return t>zn.MAX_VERTEX_ARRAY_LENGTH&&w("Max vertices per segment is "+zn.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!n||n.vertexLength+t>zn.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==i)&&(n={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==i&&(n.sortKey=i),this.segments.push(n)),n},zn.prototype.get=function(){return this.segments},zn.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var i in r.vaos)r.vaos[i].destroy()}},zn.simpleSegment=function(t,e,r,i){return new zn([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])},zn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,vi("SegmentVector",zn);var Fn=function(){this.ids=[],this.positions=[],this.indexed=!1};function Dn(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}Fn.prototype.add=function(t,e,r,i){this.ids.push(t),this.positions.push(e,r,i)},Fn.prototype.getPositions=function(t){for(var e=0,r=this.ids.length-1;e<r;){var i=e+r>>1;this.ids[i]>=t?r=i:e=i+1}for(var n=[];this.ids[e]===t;){var a=this.positions[3*e],o=this.positions[3*e+1],s=this.positions[3*e+2];n.push({index:a,start:o,end:s}),e++}return n},Fn.serialize=function(t,e){var r=new Float64Array(t.ids),i=new Uint32Array(t.positions);return function t(e,r,i,n){if(!(i>=n)){for(var a=e[i+n>>1],o=i-1,s=n+1;;){do{o++}while(e[o]<a);do{s--}while(e[s]>a);if(o>=s)break;Dn(e,o,s),Dn(r,3*o,3*s),Dn(r,3*o+1,3*s+1),Dn(r,3*o+2,3*s+2)}t(e,r,i,s),t(e,r,s+1,n)}}(r,i,0,r.length-1),e.push(r.buffer,i.buffer),{ids:r,positions:i}},Fn.deserialize=function(t){var e=new Fn;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},vi("FeaturePositionMap",Fn);var Bn=function(t,e){this.gl=t.gl,this.location=e},Nn=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(Bn),Un=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(Bn),Vn=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(Bn),Gn=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(Bn),qn=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(Bn),Zn=function(t){function e(e,r){t.call(this,e,r),this.current=Wt.transparent}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(Bn),Xn=new Float32Array(16),Wn=function(t){function e(e,r){t.call(this,e,r),this.current=Xn}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(Bn);function Hn(t){return[Rn(255*t.r,255*t.g),Rn(255*t.b,255*t.a)]}var Yn=function(t,e,r){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=r,this.maxValue=-1/0};Yn.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Yn.prototype.setConstantPatternPositions=function(){},Yn.prototype.populatePaintArray=function(){},Yn.prototype.updatePaintArray=function(){},Yn.prototype.upload=function(){},Yn.prototype.destroy=function(){},Yn.prototype.setUniforms=function(t,e,r,i){e.set(i.constantOr(this.value))},Yn.prototype.getBinding=function(t,e){return"color"===this.type?new Zn(t,e):new Un(t,e)},Yn.serialize=function(t){var e=t.value,r=t.names,i=t.type;return{value:gi(e),names:r,type:i}},Yn.deserialize=function(t){var e=t.value,r=t.names,i=t.type;return new Yn(yi(e),r,i)};var Kn=function(t,e,r){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=r,this.maxValue=-1/0,this.patternPositions={patternTo:null,patternFrom:null}};Kn.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Kn.prototype.populatePaintArray=function(){},Kn.prototype.updatePaintArray=function(){},Kn.prototype.upload=function(){},Kn.prototype.destroy=function(){},Kn.prototype.setConstantPatternPositions=function(t,e){this.patternPositions.patternTo=t.tlbr,this.patternPositions.patternFrom=e.tlbr},Kn.prototype.setUniforms=function(t,e,r,i,n){var a=this.patternPositions;"u_pattern_to"===n&&a.patternTo&&e.set(a.patternTo),"u_pattern_from"===n&&a.patternFrom&&e.set(a.patternFrom)},Kn.prototype.getBinding=function(t,e){return new qn(t,e)};var Jn=function(t,e,r,i){this.expression=t,this.names=e,this.type=r,this.uniformNames=this.names.map(function(t){return"a_"+t}),this.maxValue=-1/0,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}}),this.paintVertexArray=new i};Jn.prototype.defines=function(){return[]},Jn.prototype.setConstantPatternPositions=function(){},Jn.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,i=r.length;r.reserve(t);var n=this.expression.evaluate(new Li(0),e,{});if("color"===this.type)for(var a=Hn(n),o=i;o<t;o++)r.emplaceBack(a[0],a[1]);else{for(var s=i;s<t;s++)r.emplaceBack(n);this.maxValue=Math.max(this.maxValue,n)}},Jn.prototype.updatePaintArray=function(t,e,r,i){var n=this.paintVertexArray,a=this.expression.evaluate({zoom:0},r,i);if("color"===this.type)for(var o=Hn(a),s=t;s<e;s++)n.emplace(s,o[0],o[1]);else{for(var u=t;u<e;u++)n.emplace(u,a);this.maxValue=Math.max(this.maxValue,a)}},Jn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Jn.prototype.setUniforms=function(t,e){e.set(0)},Jn.prototype.getBinding=function(t,e){return new Un(t,e)};var Qn=function(t,e,r,i,n,a){this.expression=t,this.names=e,this.uniformNames=this.names.map(function(t){return"a_"+t+"_t"}),this.type=r,this.useIntegerZoom=i,this.zoom=n,this.maxValue=-1/0;var o=a;this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}}),this.paintVertexArray=new o};Qn.prototype.defines=function(){return[]},Qn.prototype.setConstantPatternPositions=function(){},Qn.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,i=r.length;r.reserve(t);var n=this.expression.evaluate(new Li(this.zoom),e,{}),a=this.expression.evaluate(new Li(this.zoom+1),e,{});if("color"===this.type)for(var o=Hn(n),s=Hn(a),u=i;u<t;u++)r.emplaceBack(o[0],o[1],s[0],s[1]);else{for(var l=i;l<t;l++)r.emplaceBack(n,a);this.maxValue=Math.max(this.maxValue,n,a)}},Qn.prototype.updatePaintArray=function(t,e,r,i){var n=this.paintVertexArray,a=this.expression.evaluate({zoom:this.zoom},r,i),o=this.expression.evaluate({zoom:this.zoom+1},r,i);if("color"===this.type)for(var s=Hn(a),u=Hn(o),l=t;l<e;l++)n.emplace(l,s[0],s[1],u[0],u[1]);else{for(var c=t;c<e;c++)n.emplace(c,a,o);this.maxValue=Math.max(this.maxValue,a,o)}},Qn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Qn.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},Qn.prototype.setUniforms=function(t,e,r){e.set(this.interpolationFactor(r.zoom))},Qn.prototype.getBinding=function(t,e){return new Un(t,e)};var $n=function(t,e,r,i,n,a,o){this.expression=t,this.names=e,this.type=r,this.uniformNames=this.names.map(function(t){return"a_"+t+"_t"}),this.useIntegerZoom=i,this.zoom=n,this.maxValue=-1/0,this.layerId=o,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Uint16",components:4,offset:0}}),this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a};$n.prototype.defines=function(){return[]},$n.prototype.setConstantPatternPositions=function(){},$n.prototype.populatePaintArray=function(t,e,r){var i=this.zoomInPaintVertexArray,n=this.zoomOutPaintVertexArray,a=this.layerId,o=i.length;if(i.reserve(t),n.reserve(t),r&&e.patterns&&e.patterns[a]){var s=e.patterns[a],u=s.min,l=s.mid,c=s.max,h=r[u],p=r[l],f=r[c];if(!h||!p||!f)return;for(var d=o;d<t;d++)i.emplaceBack(p.tl[0],p.tl[1],p.br[0],p.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1]),n.emplaceBack(p.tl[0],p.tl[1],p.br[0],p.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1])}},$n.prototype.updatePaintArray=function(t,e,r,i,n){var a=this.zoomInPaintVertexArray,o=this.zoomOutPaintVertexArray,s=this.layerId;if(n&&r.patterns&&r.patterns[s]){var u=r.patterns[s],l=u.min,c=u.mid,h=u.max,p=n[l],f=n[c],d=n[h];if(!p||!f||!d)return;for(var v=t;v<e;v++)a.emplace(v,f.tl[0],f.tl[1],f.br[0],f.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1]),o.emplace(v,f.tl[0],f.tl[1],f.br[0],f.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1])}},$n.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$n.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()},$n.prototype.setUniforms=function(t,e){e.set(0)},$n.prototype.getBinding=function(t,e){return new Un(t,e)};var ta=function(){this.binders={},this.cacheKey="",this._buffers=[],this._featureMap=new Fn,this._bufferOffset=0};ta.createDynamic=function(t,e,r){var i=new ta,n=[];for(var a in t.paint._values)if(r(a)){var o=t.paint.get(a);if(o instanceof Ni&&cr(o.property.specification)){var s=ra(a,t.type),u=o.property.specification.type,l=o.property.useIntegerZoom;if("cross-faded"===o.property.specification["property-type"]||"cross-faded-data-driven"===o.property.specification["property-type"])if("constant"===o.value.kind)i.binders[a]=new Kn(o.value.value,s,u),n.push("/u_"+a);else{var c=ia(a,u,"source");i.binders[a]=new $n(o.value,s,u,l,e,c,t.id),n.push("/a_"+a)}else if("constant"===o.value.kind)i.binders[a]=new Yn(o.value.value,s,u),n.push("/u_"+a);else if("source"===o.value.kind){var h=ia(a,u,"source");i.binders[a]=new Jn(o.value,s,u,h),n.push("/a_"+a)}else{var p=ia(a,u,"composite");i.binders[a]=new Qn(o.value,s,u,l,e,p),n.push("/z_"+a)}}}return i.cacheKey=n.sort().join(""),i},ta.prototype.populatePaintArrays=function(t,e,r,i){for(var n in this.binders)this.binders[n].populatePaintArray(t,e,i);void 0!==e.id&&this._featureMap.add(+e.id,r,this._bufferOffset,t),this._bufferOffset=t},ta.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders)this.binders[r].setConstantPatternPositions(t,e)},ta.prototype.updatePaintArrays=function(t,e,r,i){var n=!1;for(var a in t)for(var o=0,s=this._featureMap.getPositions(+a);o<s.length;o+=1){var u=s[o],l=e.feature(u.index);for(var c in this.binders){var h=this.binders[c];if(!(h instanceof Yn||h instanceof Kn)&&!0===h.expression.isStateDependent){var p=r.paint.get(c);h.expression=p.value,h.updatePaintArray(u.start,u.end,l,t[a],i),n=!0}}}return n},ta.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},ta.prototype.getPaintVertexBuffers=function(){return this._buffers},ta.prototype.getUniforms=function(t,e){var r=[];for(var i in this.binders)for(var n=this.binders[i],a=0,o=n.uniformNames;a<o.length;a+=1){var s=o[a];if(e[s]){var u=n.getBinding(t,e[s]);r.push({name:s,property:i,binding:u})}}return r},ta.prototype.setUniforms=function(t,e,r,i){for(var n=0,a=e;n<a.length;n+=1){var o=a[n],s=o.name,u=o.property,l=o.binding;this.binders[u].setUniforms(t,l,i,r.get(u),s)}},ta.prototype.updatePatternPaintBuffers=function(t){var e=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof $n){var n=2===t.fromScale?i.zoomInPaintVertexBuffer:i.zoomOutPaintVertexBuffer;n&&e.push(n)}else(i instanceof Jn||i instanceof Qn)&&i.paintVertexBuffer&&e.push(i.paintVertexBuffer)}this._buffers=e},ta.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var r=[];for(var i in this.binders){var n=this.binders[i];(n instanceof Jn||n instanceof Qn)&&n.paintVertexBuffer&&r.push(n.paintVertexBuffer)}this._buffers=r},ta.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var ea=function(t,e,r,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var n=0,a=e;n<a.length;n+=1){var o=a[n];this.programConfigurations[o.id]=ta.createDynamic(o,r,i),this.programConfigurations[o.id].layoutAttributes=t}this.needsUpload=!1};function ra(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function ia(t,e,r){var i={color:{source:bn,composite:xn},number:{source:dn,composite:bn}},n=function(t){return{"line-pattern":{source:an,composite:an},"fill-pattern":{source:an,composite:an},"fill-extrusion-pattern":{source:an,composite:an}}[t]}(t);return n&&n[r]||i[e][r]}ea.prototype.populatePaintArrays=function(t,e,r,i){for(var n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(t,e,r,i);this.needsUpload=!0},ea.prototype.updatePaintArrays=function(t,e,r,i){for(var n=0,a=r;n<a.length;n+=1){var o=a[n];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,e,o,i)||this.needsUpload}},ea.prototype.get=function(t){return this.programConfigurations[t]},ea.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},ea.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},vi("ConstantBinder",Yn),vi("CrossFadedConstantBinder",Kn),vi("SourceExpressionBinder",Jn),vi("CrossFadedCompositeBinder",$n),vi("CompositeExpressionBinder",Qn),vi("ProgramConfiguration",ta,{omit:["_buffers"]}),vi("ProgramConfigurationSet",ea);var na=8192,aa={min:-1*Math.pow(2,15),max:Math.pow(2,15)-1};function oa(t){for(var e=na/t.extent,r=t.loadGeometry(),i=0;i<r.length;i++)for(var n=r[i],a=0;a<n.length;a++){var o=n[a];o.x=Math.round(o.x*e),o.y=Math.round(o.y*e),(o.x<aa.min||o.x>aa.max||o.y<aa.min||o.y>aa.max)&&w("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function sa(t,e,r,i,n){t.emplaceBack(2*e+(i+1)/2,2*r+(n+1)/2)}var ua=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new tn,this.indexArray=new gn,this.segments=new zn,this.programConfigurations=new ea(jn,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function la(t,e){for(var r=0;r<t.length;r++)if(ya(e,t[r]))return!0;for(var i=0;i<e.length;i++)if(ya(t,e[i]))return!0;return!!fa(t,e)}function ca(t,e,r){return!!ya(t,e)||!!va(e,t,r)}function ha(t,e){if(1===t.length)return ga(e,t[0]);for(var r=0;r<e.length;r++)for(var i=e[r],n=0;n<i.length;n++)if(ya(t,i[n]))return!0;for(var a=0;a<t.length;a++)if(ga(e,t[a]))return!0;for(var o=0;o<e.length;o++)if(fa(t,e[o]))return!0;return!1}function pa(t,e,r){if(t.length>1){if(fa(t,e))return!0;for(var i=0;i<e.length;i++)if(va(e[i],t,r))return!0}for(var n=0;n<t.length;n++)if(va(t[n],e,r))return!0;return!1}function fa(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var i=t[r],n=t[r+1],a=0;a<e.length-1;a++)if(da(i,n,e[a],e[a+1]))return!0;return!1}function da(t,e,r,i){return k(t,r,i)!==k(e,r,i)&&k(t,e,r)!==k(t,e,i)}function va(t,e,r){var i=r*r;if(1===e.length)return t.distSqr(e[0])<i;for(var n=1;n<e.length;n++)if(ma(t,e[n-1],e[n])<i)return!0;return!1}function ma(t,e,r){var i=e.distSqr(r);if(0===i)return t.distSqr(e);var n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return n<0?t.distSqr(e):n>1?t.distSqr(r):t.distSqr(r.sub(e)._mult(n)._add(e))}function ga(t,e){for(var r,i,n,a=!1,o=0;o<t.length;o++)for(var s=0,u=(r=t[o]).length-1;s<r.length;u=s++)i=r[s],n=r[u],i.y>e.y!=n.y>e.y&&e.x<(n.x-i.x)*(e.y-i.y)/(n.y-i.y)+i.x&&(a=!a);return a}function ya(t,e){for(var r=!1,i=0,n=t.length-1;i<t.length;n=i++){var a=t[i],o=t[n];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(r=!r)}return r}function _a(t,e,r){var i=r[0],n=r[2];if(t.x<i.x&&e.x<i.x||t.x>n.x&&e.x>n.x||t.y<i.y&&e.y<i.y||t.y>n.y&&e.y>n.y)return!1;var a=k(t,e,r[0]);return a!==k(t,e,r[1])||a!==k(t,e,r[2])||a!==k(t,e,r[3])}function ba(t,e,r){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:r.programConfigurations.get(e.id).binders[t].maxValue}function xa(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function wa(t,e,r,i,a){if(!e[0]&&!e[1])return t;var o=n.convert(e)._mult(a);"viewport"===r&&o._rotate(-i);for(var s=[],u=0;u<t.length;u++){var l=t[u];s.push(l.sub(o))}return s}ua.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new Li(this.zoom),a)){var u=oa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index)}}},ua.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ua.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ua.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ua.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ua.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ua.prototype.addFeature=function(t,e,r){for(var i=0,n=e;i<n.length;i+=1)for(var a=0,o=n[i];a<o.length;a+=1){var s=o[a],u=s.x,l=s.y;if(!(u<0||u>=na||l<0||l>=na)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=c.vertexLength;sa(this.layoutVertexArray,u,l,-1,-1),sa(this.layoutVertexArray,u,l,1,-1),sa(this.layoutVertexArray,u,l,1,1),sa(this.layoutVertexArray,u,l,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{})},vi("CircleBucket",ua,{omit:["layers"]});var ka={paint:new Wi({"circle-radius":new Gi(St.paint_circle["circle-radius"]),"circle-color":new Gi(St.paint_circle["circle-color"]),"circle-blur":new Gi(St.paint_circle["circle-blur"]),"circle-opacity":new Gi(St.paint_circle["circle-opacity"]),"circle-translate":new Vi(St.paint_circle["circle-translate"]),"circle-translate-anchor":new Vi(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vi(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vi(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gi(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gi(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gi(St.paint_circle["circle-stroke-opacity"])})},Ea="undefined"!=typeof Float32Array?Float32Array:Array;function Sa(){var t=new Ea(9);return Ea!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ta(){var t=new Ea(3);return Ea!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Aa(t,e,r){var i=new Ea(3);return i[0]=t,i[1]=e,i[2]=r,i}function Pa(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,t}function Oa(){var t=new Ea(4);return Ea!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.PI,Ta(),function(){var t;t=new Ea(4),Ea!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),Ta(),Aa(1,0,0),Aa(0,1,0),Oa(),Oa(),Sa(),function(){var t;t=new Ea(2),Ea!=Float32Array&&(t[0]=0,t[1]=0)}();var Ia=function(t){function e(e){t.call(this,e,ka)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new ua(t)},e.prototype.queryRadius=function(t){var e=t;return ba("circle-radius",this,e)+ba("circle-stroke-width",this,e)+xa(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o,s){for(var u=wa(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),l=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return u.map(function(t){return Ma(t,e)})}(0,s),p=c?l*o:l,f=0,d=i;f<d.length;f+=1)for(var v=0,m=d[f];v<m.length;v+=1){var g=m[v],y=c?g:Ma(g,s),_=p,b=Pa([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=a.cameraToCenterDistance/b[3]),ca(h,y,_))return!0}return!1},e}(Hi);function Ma(t,e){var r=Pa([],[t.x,t.y,0,1],e);return new n(r[0]/r[3],r[1]/r[3])}var Ca=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ua);function La(t,e,r,i){var n=e.width,a=e.height;if(i){if(i.length!==n*a*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(n*a*r);return t.width=n,t.height=a,t.data=i,t}function ja(t,e,r){var i=e.width,n=e.height;if(i!==t.width||n!==t.height){var a=La({},{width:i,height:n},r);za(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,n)},r),t.width=i,t.height=n,t.data=a.data}}function za(t,e,r,i,n,a){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<n.height;u++)for(var l=((r.y+u)*t.width+r.x)*a,c=((i.y+u)*e.width+i.x)*a,h=0;h<n.width*a;h++)s[c+h]=o[l+h];return e}vi("HeatmapBucket",Ca,{omit:["layers"]});var Ra=function(t,e){La(this,t,1,e)};Ra.prototype.resize=function(t){ja(this,t,1)},Ra.prototype.clone=function(){return new Ra({width:this.width,height:this.height},new Uint8Array(this.data))},Ra.copy=function(t,e,r,i,n){za(t,e,r,i,n,1)};var Fa=function(t,e){La(this,t,4,e)};Fa.prototype.resize=function(t){ja(this,t,4)},Fa.prototype.replace=function(t,e){e?this.data.set(t):this.data=t},Fa.prototype.clone=function(){return new Fa({width:this.width,height:this.height},new Uint8Array(this.data))},Fa.copy=function(t,e,r,i,n){za(t,e,r,i,n,4)},vi("AlphaImage",Ra),vi("RGBAImage",Fa);var Da={paint:new Wi({"heatmap-radius":new Gi(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gi(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vi(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xi(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vi(St.paint_heatmap["heatmap-opacity"])})};function Ba(t,e){for(var r=new Uint8Array(1024),i={},n=0,a=0;n<256;n++,a+=4){i[e]=n/255;var o=t.evaluate(i);r[a+0]=Math.floor(255*o.r/o.a),r[a+1]=Math.floor(255*o.g/o.a),r[a+2]=Math.floor(255*o.b/o.a),r[a+3]=Math.floor(255*o.a)}return new Fa({width:256,height:1},r)}var Na=function(t){function e(e){t.call(this,e,Da),this._updateColorRamp()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Ca(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Ba(t,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Hi),Ua={paint:new Wi({"hillshade-illumination-direction":new Vi(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vi(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vi(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vi(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vi(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vi(St.paint_hillshade["hillshade-accent-color"])})},Va=function(t){function e(e){t.call(this,e,Ua)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Hi),Ga=Qi([{name:"a_pos",components:2,type:"Int16"}],4).members,qa=Xa,Za=Xa;function Xa(t,e,r){r=r||2;var i,n,a,o,s,u,l,c=e&&e.length,h=c?e[0]*r:t.length,p=Wa(t,0,h,r,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,r,i){var n,a,o,s=[];for(n=0,a=e.length;n<a;n++)(o=Wa(t,e[n]*i,n<a-1?e[n+1]*i:t.length,i,!1))===o.next&&(o.steiner=!0),s.push(io(o));for(s.sort(to),n=0;n<s.length;n++)eo(s[n],r),r=Ha(r,r.next);return r}(t,e,p,r)),t.length>80*r){i=a=t[0],n=o=t[1];for(var d=r;d<h;d+=r)(s=t[d])<i&&(i=s),(u=t[d+1])<n&&(n=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-i,o-n))?1/l:0}return Ya(p,f,r,i,n,l),f}function Wa(t,e,r,i,n){var a,o;if(n===vo(t,e,r,i)>0)for(a=e;a<r;a+=i)o=ho(a,t[a],t[a+1],o);else for(a=r-i;a>=e;a-=i)o=ho(a,t[a],t[a+1],o);return o&&so(o,o.next)&&(po(o),o=o.next),o}function Ha(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!so(i,i.next)&&0!==oo(i.prev,i,i.next))i=i.next;else{if(po(i),(i=e=i.prev)===i.next)break;r=!0}}while(r||i!==e);return e}function Ya(t,e,r,i,n,a,o){if(t){!o&&a&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=ro(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,a,o,s,u,l=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,i=r,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,u--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;r=i}a.nextZ=null,l*=2}while(o>1)}(n)}(t,i,n,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?Ja(t,i,n,a):Ka(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),po(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Ya(t=Qa(t,e,r),e,r,i,n,a,2):2===o&&$a(t,e,r,i,n,a):Ya(Ha(t),e,r,i,n,a,1);break}}}function Ka(t){var e=t.prev,r=t,i=t.next;if(oo(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(no(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&oo(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Ja(t,e,r,i){var n=t.prev,a=t,o=t.next;if(oo(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,u=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,l=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,c=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,h=ro(s,u,e,r,i),p=ro(l,c,e,r,i),f=t.prevZ,d=t.nextZ;f&&f.z>=h&&d&&d.z<=p;){if(f!==t.prev&&f!==t.next&&no(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&oo(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,d!==t.prev&&d!==t.next&&no(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&oo(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&no(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&oo(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&no(n.x,n.y,a.x,a.y,o.x,o.y,d.x,d.y)&&oo(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Qa(t,e,r){var i=t;do{var n=i.prev,a=i.next.next;!so(n,a)&&uo(n,i,i.next,a)&&lo(n,a)&&lo(a,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(a.i/r),po(i),po(i.next),i=t=a),i=i.next}while(i!==t);return i}function $a(t,e,r,i,n,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ao(o,s)){var u=co(o,s);return o=Ha(o,o.next),u=Ha(u,u.next),Ya(o,e,r,i,n,a),void Ya(u,e,r,i,n,a)}s=s.next}o=o.next}while(o!==t)}function to(t,e){return t.x-e.x}function eo(t,e){if(e=function(t,e){var r,i=e,n=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===o)return r.prev;var u,l=r,c=r.x,h=r.y,p=1/0;for(i=r.next;i!==l;)n>=i.x&&i.x>=c&&n!==i.x&&no(a<h?n:o,a,c,h,a<h?o:n,a,i.x,i.y)&&((u=Math.abs(a-i.y)/(n-i.x))<p||u===p&&i.x>r.x)&&lo(i,t)&&(r=i,p=u),i=i.next;return r}(t,e)){var r=co(e,t);Ha(r,r.next)}}function ro(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function io(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function no(t,e,r,i,n,a,o,s){return(n-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}function ao(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&uo(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&lo(t,e)&&lo(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)}function oo(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function so(t,e){return t.x===e.x&&t.y===e.y}function uo(t,e,r,i){return!!(so(t,e)&&so(r,i)||so(t,i)&&so(r,e))||oo(t,e,r)>0!=oo(t,e,i)>0&&oo(r,i,t)>0!=oo(r,i,e)>0}function lo(t,e){return oo(t.prev,t,t.next)<0?oo(t,e,t.next)>=0&&oo(t,t.prev,e)>=0:oo(t,e,t.prev)<0||oo(t,t.next,e)<0}function co(t,e){var r=new fo(t.i,t.x,t.y),i=new fo(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function ho(t,e,r,i){var n=new fo(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function po(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fo(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vo(t,e,r,i){for(var n=0,a=e,o=r-i;a<r;a+=i)n+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return n}function mo(t,e,r,i,n){!function t(e,r,i,n,a){for(;n>i;){if(n-i>600){var o=n-i+1,s=r-i+1,u=Math.log(o),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(o-l)/o)*(s-o/2<0?-1:1);t(e,r,Math.max(i,Math.floor(r-s*l/o+c)),Math.min(n,Math.floor(r+(o-s)*l/o+c)),a)}var h=e[r],p=i,f=n;for(go(e,i,r),a(e[n],h)>0&&go(e,i,n);p<f;){for(go(e,p,f),p++,f--;a(e[p],h)<0;)p++;for(;a(e[f],h)>0;)f--}0===a(e[i],h)?go(e,i,f):go(e,++f,n),f<=r&&(i=f+1),r<=f&&(n=f-1)}}(t,e,r||0,i||t.length-1,n||yo)}function go(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function yo(t,e){return t<e?-1:t>e?1:0}function _o(t,e){var r=t.length;if(r<=1)return[t];for(var i,n,a=[],o=0;o<r;o++){var s=E(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===n&&(n=s<0),n===s<0?(i&&a.push(i),i=[t[o]]):i.push(t[o]))}if(i&&a.push(i),e>1)for(var u=0;u<a.length;u++)a[u].length<=e||(mo(a[u],e,1,a[u].length-1,bo),a[u]=a[u].slice(0,e));return a}function bo(t,e){return e.area-t.area}function xo(t,e,r){for(var i=r.patternDependencies,n=!1,a=0,o=e;a<o.length;a+=1){var s=o[a].paint.get(t+"-pattern");s.isConstant()||(n=!0);var u=s.constantOr(null);u&&(n=!0,i[u.to]=!0,i[u.from]=!0)}return n}function wo(t,e,r,i,n){for(var a=n.patternDependencies,o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:i-1},r,{}),h=l.evaluate({zoom:i},r,{}),p=l.evaluate({zoom:i+1},r,{});a[c]=!0,a[h]=!0,a[p]=!0,r.patterns[u.id]={min:c,mid:h,max:p}}}return r}Xa.deviation=function(t,e,r,i){var n=e&&e.length,a=n?e[0]*r:t.length,o=Math.abs(vo(t,0,a,r));if(n)for(var s=0,u=e.length;s<u;s++){var l=e[s]*r,c=s<u-1?e[s+1]*r:t.length;o-=Math.abs(vo(t,l,c,r))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*r,f=i[s+1]*r,d=i[s+2]*r;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},Xa.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var a=0;a<t[n].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[n][a][o]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r},qa.default=Za;var ko=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new tn,this.indexArray=new gn,this.indexArray2=new yn,this.programConfigurations=new ea(Ga,t.layers,t.zoom),this.segments=new zn,this.segments2=new zn,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};ko.prototype.populate=function(t,e){this.features=[],this.hasPattern=xo("fill",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new Li(this.zoom),a)){var u=oa(a),l={sourceLayerIndex:s,index:o,geometry:u,properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(l.id=a.id),this.hasPattern?this.features.push(wo("fill",this.layers,l,this.zoom,e)):this.addFeature(l,u,o,{}),e.featureIndex.insert(a,u,o,s,this.index)}}},ko.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ko.prototype.addFeatures=function(t,e){for(var r=0,i=this.features;r<i.length;r+=1){var n=i[r],a=n.geometry;this.addFeature(n,a,n.index,e)}},ko.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ko.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ko.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ga),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ko.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ko.prototype.addFeature=function(t,e,r,i){for(var n=0,a=_o(e,500);n<a.length;n+=1){for(var o=a[n],s=0,u=0,l=o;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),h=c.vertexLength,p=[],f=[],d=0,v=o;d<v.length;d+=1){var m=v[d];if(0!==m.length){m!==o[0]&&f.push(p.length/2);var g=this.segments2.prepareSegment(m.length,this.layoutVertexArray,this.indexArray2),y=g.vertexLength;this.layoutVertexArray.emplaceBack(m[0].x,m[0].y),this.indexArray2.emplaceBack(y+m.length-1,y),p.push(m[0].x),p.push(m[0].y);for(var _=1;_<m.length;_++)this.layoutVertexArray.emplaceBack(m[_].x,m[_].y),this.indexArray2.emplaceBack(y+_-1,y+_),p.push(m[_].x),p.push(m[_].y);g.vertexLength+=m.length,g.primitiveLength+=m.length}}for(var b=qa(p,f),x=0;x<b.length;x+=3)this.indexArray.emplaceBack(h+b[x],h+b[x+1],h+b[x+2]);c.vertexLength+=s,c.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i)},vi("FillBucket",ko,{omit:["layers","features"]});var Eo={paint:new Wi({"fill-antialias":new Vi(St.paint_fill["fill-antialias"]),"fill-opacity":new Gi(St.paint_fill["fill-opacity"]),"fill-color":new Gi(St.paint_fill["fill-color"]),"fill-outline-color":new Gi(St.paint_fill["fill-outline-color"]),"fill-translate":new Vi(St.paint_fill["fill-translate"]),"fill-translate-anchor":new Vi(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new qi(St.paint_fill["fill-pattern"])})},So=function(t){function e(e){t.call(this,e,Eo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ko(t)},e.prototype.queryRadius=function(){return xa(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){return ha(wa(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),i)},e.prototype.isTileClipped=function(){return!0},e}(Hi),To=Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ao=Po;function Po(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(Oo,this,e)}function Oo(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function Io(t){for(var e,r,i=0,n=0,a=t.length,o=a-1;n<a;o=n++)e=t[n],i+=((r=t[o]).x-e.x)*(e.y+r.y);return i}Po.types=["Unknown","Point","LineString","Polygon"],Po.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,a=0,o=0,s=0,u=[];t.pos<r;){if(a<=0){var l=t.readVarint();i=7&l,a=l>>3}if(a--,1===i||2===i)o+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new n(o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},Po.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(i<=0){var c=t.readVarint();r=7&c,i=c>>3}if(i--,1===r||2===r)(n+=t.readSVarint())<o&&(o=n),n>s&&(s=n),(a+=t.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,s,l]},Po.prototype.toGeoJSON=function(t,e,r){var i,n,a=this.extent*Math.pow(2,r),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=Po.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+s)/a;t[e]=[360*(r.x+o)/a-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<u.length;i++)h[i]=u[i][0];c(u=h);break;case 2:for(i=0;i<u.length;i++)c(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],a=0;a<e;a++){var o=Io(t[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&n.push(r),r=[t[a]]):r.push(t[a]))}return r&&n.push(r),n}(u),i=0;i<u.length;i++)for(n=0;n<u[i].length;n++)c(u[i][n])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var Mo=Co;function Co(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Lo,this,e),this.length=this._features.length}function Lo(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(r))}function jo(t,e,r){if(3===t){var i=new Mo(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}Co.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Ao(this._pbf,e,this.extent,this._keys,this._values)};var zo={VectorTile:function(t,e){this.layers=t.readFields(jo,{},e)},VectorTileFeature:Ao,VectorTileLayer:Mo},Ro=zo.VectorTileFeature.types,Fo=Math.pow(2,13);function Do(t,e,r,i,n,a,o,s){t.emplaceBack(e,r,2*Math.floor(i*Fo)+o,n*Fo*2,a*Fo*2,Math.round(s))}var Bo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new rn,this.indexArray=new gn,this.programConfigurations=new ea(To,t.layers,t.zoom),this.segments=new zn,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function No(t,e){return t.x===e.x&&(t.x<0||t.x>na)||t.y===e.y&&(t.y<0||t.y>na)}function Uo(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>na})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>na})}Bo.prototype.populate=function(t,e){this.features=[],this.hasPattern=xo("fill-extrusion",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new Li(this.zoom),a)){var u=oa(a),l={sourceLayerIndex:s,index:o,geometry:u,properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(l.id=a.id),this.hasPattern?this.features.push(wo("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,u,o,{}),e.featureIndex.insert(a,u,o,s,this.index,!0)}}},Bo.prototype.addFeatures=function(t,e){for(var r=0,i=this.features;r<i.length;r+=1){var n=i[r],a=n.geometry;this.addFeature(n,a,n.index,e)}},Bo.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Bo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Bo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,To),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Bo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Bo.prototype.addFeature=function(t,e,r,i){for(var n=0,a=_o(e,500);n<a.length;n+=1){for(var o=a[n],s=0,u=0,l=o;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,p=o;h<p.length;h+=1){var f=p[h];if(0!==f.length&&!Uo(f))for(var d=0,v=0;v<f.length;v++){var m=f[v];if(v>=1){var g=f[v-1];if(!No(m,g)){c.vertexLength+4>zn.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var y=m.sub(g)._perp()._unit(),_=g.dist(m);d+_>32768&&(d=0),Do(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,0,d),Do(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,1,d),d+=_,Do(this.layoutVertexArray,g.x,g.y,y.x,y.y,0,0,d),Do(this.layoutVertexArray,g.x,g.y,y.x,y.y,0,1,d);var b=c.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),c.vertexLength+=4,c.primitiveLength+=2}}}}if(c.vertexLength+s>zn.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),"Polygon"===Ro[t.type]){for(var x=[],w=[],k=c.vertexLength,E=0,S=o;E<S.length;E+=1){var T=S[E];if(0!==T.length){T!==o[0]&&w.push(x.length/2);for(var A=0;A<T.length;A++){var P=T[A];Do(this.layoutVertexArray,P.x,P.y,0,0,1,1,0),x.push(P.x),x.push(P.y)}}}for(var O=qa(x,w),I=0;I<O.length;I+=3)this.indexArray.emplaceBack(k+O[I],k+O[I+2],k+O[I+1]);c.primitiveLength+=O.length/3,c.vertexLength+=s}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i)},vi("FillExtrusionBucket",Bo,{omit:["layers","features"]});var Vo={paint:new Wi({"fill-extrusion-opacity":new Vi(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gi(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vi(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vi(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qi(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gi(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gi(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vi(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Go=function(t){function e(e){t.call(this,e,Vo)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Bo(t)},e.prototype.queryRadius=function(){return xa(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,r,i,a,o,s,u){var l=wa(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),p=function(t,e,r,i){for(var a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=[u.x,u.y,0,1];Pa(l,l,e),a.push(new n(l[0]/l[3],l[1]/l[3]))}return a}(l,u),f=function(t,e,r,i){for(var a=[],o=[],s=i[8]*e,u=i[9]*e,l=i[10]*e,c=i[11]*e,h=i[8]*r,p=i[9]*r,f=i[10]*r,d=i[11]*r,v=0,m=t;v<m.length;v+=1){for(var g=[],y=[],_=0,b=m[v];_<b.length;_+=1){var x=b[_],w=x.x,k=x.y,E=i[0]*w+i[4]*k+i[12],S=i[1]*w+i[5]*k+i[13],T=i[2]*w+i[6]*k+i[14],A=i[3]*w+i[7]*k+i[15],P=T+l,O=A+c,I=E+h,M=S+p,C=T+f,L=A+d,j=new n((E+s)/O,(S+u)/O);j.z=P/O,g.push(j);var z=new n(I/L,M/L);z.z=C/L,y.push(z)}a.push(g),o.push(y)}return[a,o]}(i,h,c,u);return function(t,e,r){var i=1/0;ha(r,e)&&(i=Zo(r,e[0]));for(var n=0;n<e.length;n++)for(var a=e[n],o=t[n],s=0;s<a.length-1;s++){var u=a[s],l=a[s+1],c=o[s],h=[u,l,o[s+1],c,u];la(r,h)&&(i=Math.min(i,Zo(r,h)))}return i!==1/0&&i}(f[0],f[1],p)},e}(Hi);function qo(t,e){return t.x*e.x+t.y*e.y}function Zo(t,e){if(1===t.length){var r=e[0],i=e[1],n=e[3],a=t[0],o=i.sub(r),s=n.sub(r),u=a.sub(r),l=qo(o,o),c=qo(o,s),h=qo(s,s),p=qo(u,o),f=qo(u,s),d=l*h-c*c,v=(h*p-c*f)/d,m=(l*f-c*p)/d,g=1-v-m;return r.z*g+i.z*v+n.z*m}for(var y=1/0,_=0,b=e;_<b.length;_+=1){var x=b[_];y=Math.min(y,x.z)}return y}var Xo=Qi([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wo=zo.VectorTileFeature.types,Ho=63,Yo=Math.cos(Math.PI/180*37.5),Ko=.5,Jo=Math.pow(2,14)/Ko;function Qo(t,e,r,i,n,a,o){t.emplaceBack(e.x,e.y,i?1:0,n?1:-1,Math.round(Ho*r.x)+128,Math.round(Ho*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*Ko&63)<<2,o*Ko>>6)}var $o=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.features=[],this.hasPattern=!1,this.layoutVertexArray=new nn,this.indexArray=new gn,this.programConfigurations=new ea(Xo,t.layers,t.zoom),this.segments=new zn,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function ts(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(Jo-1)}$o.prototype.populate=function(t,e){this.features=[],this.hasPattern=xo("line",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new Li(this.zoom),a)){var u=oa(a),l={sourceLayerIndex:s,index:o,geometry:u,properties:a.properties,type:a.type,patterns:{}};void 0!==a.id&&(l.id=a.id),this.hasPattern?this.features.push(wo("line",this.layers,l,this.zoom,e)):this.addFeature(l,u,o,{}),e.featureIndex.insert(a,u,o,s,this.index)}}},$o.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},$o.prototype.addFeatures=function(t,e){for(var r=0,i=this.features;r<i.length;r+=1){var n=i[r],a=n.geometry;this.addFeature(n,a,n.index,e)}},$o.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},$o.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},$o.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},$o.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},$o.prototype.addFeature=function(t,e,r,i){for(var n=this.layers[0].layout,a=n.get("line-join").evaluate(t,{}),o=n.get("line-cap"),s=n.get("line-miter-limit"),u=n.get("line-round-limit"),l=0,c=e;l<c.length;l+=1){var h=c[l];this.addLine(h,t,a,o,s,u,r,i)}},$o.prototype.addLine=function(t,e,r,i,n,a,o,s){var u=null;e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")&&(u={start:e.properties.mapbox_clip_start,end:e.properties.mapbox_clip_end,tileTotal:void 0});for(var l="Polygon"===Wo[e.type],c=t.length;c>=2&&t[c-1].equals(t[c-2]);)c--;for(var h=0;h<c-1&&t[h].equals(t[h+1]);)h++;if(!(c<(l?3:2))){u&&(u.tileTotal=function(t,e,r){for(var i,n,a=0,o=h;o<r-1;o++)i=t[o],n=t[o+1],a+=i.dist(n);return a}(t,0,c)),"bevel"===r&&(n=1.05);var p=na/(512*this.overscaling)*15,f=t[h],d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray);this.distance=0;var v,m,g,y=i,_=l?"butt":i,b=!0,x=void 0,w=void 0,k=void 0,E=void 0;this.e1=this.e2=this.e3=-1,l&&(v=t[c-2],E=f.sub(v)._unit()._perp());for(var S=h;S<c;S++)if(!(w=l&&S===c-1?t[h+1]:t[S+1])||!t[S].equals(w)){E&&(k=E),v&&(x=v),v=t[S],E=w?w.sub(v)._unit()._perp():k;var T=(k=k||E).add(E);0===T.x&&0===T.y||T._unit();var A=T.x*E.x+T.y*E.y,P=0!==A?1/A:1/0,O=A<Yo&&x&&w;if(O&&S>h){var I=v.dist(x);if(I>2*p){var M=v.sub(v.sub(x)._mult(p/I)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,k.mult(1),0,0,!1,d,u),x=M}}var C=x&&w,L=C?r:w?y:_;if(C&&"round"===L&&(P<a?L="miter":P<=2&&(L="fakeround")),"miter"===L&&P>n&&(L="bevel"),"bevel"===L&&(P>2&&(L="flipbevel"),P<n&&(L="miter")),x&&(this.distance+=v.dist(x)),"miter"===L)T._mult(P),this.addCurrentVertex(v,this.distance,T,0,0,!1,d,u);else if("flipbevel"===L){if(P>100)T=E.clone().mult(-1);else{var j=k.x*E.y-k.y*E.x>0?-1:1,z=P*k.add(E).mag()/k.sub(E).mag();T._perp()._mult(z*j)}this.addCurrentVertex(v,this.distance,T,0,0,!1,d,u),this.addCurrentVertex(v,this.distance,T.mult(-1),0,0,!1,d,u)}else if("bevel"===L||"fakeround"===L){var R=k.x*E.y-k.y*E.x>0,F=-Math.sqrt(P*P-1);if(R?(g=0,m=F):(m=0,g=F),b||this.addCurrentVertex(v,this.distance,k,m,g,!1,d,u),"fakeround"===L){for(var D=Math.floor(8*(.5-(A-.5))),B=void 0,N=0;N<D;N++)B=E.mult((N+1)/(D+1))._add(k)._unit(),this.addPieSliceVertex(v,this.distance,B,R,d,u);this.addPieSliceVertex(v,this.distance,T,R,d,u);for(var U=D-1;U>=0;U--)B=k.mult((U+1)/(D+1))._add(E)._unit(),this.addPieSliceVertex(v,this.distance,B,R,d,u)}w&&this.addCurrentVertex(v,this.distance,E,-m,-g,!1,d,u)}else"butt"===L?(b||this.addCurrentVertex(v,this.distance,k,0,0,!1,d,u),w&&this.addCurrentVertex(v,this.distance,E,0,0,!1,d,u)):"square"===L?(b||(this.addCurrentVertex(v,this.distance,k,1,1,!1,d,u),this.e1=this.e2=-1),w&&this.addCurrentVertex(v,this.distance,E,-1,-1,!1,d,u)):"round"===L&&(b||(this.addCurrentVertex(v,this.distance,k,0,0,!1,d,u),this.addCurrentVertex(v,this.distance,k,1,1,!0,d,u),this.e1=this.e2=-1),w&&(this.addCurrentVertex(v,this.distance,E,-1,-1,!0,d,u),this.addCurrentVertex(v,this.distance,E,0,0,!1,d,u)));if(O&&S<c-1){var V=v.dist(w);if(V>2*p){var G=v.add(w.sub(v)._mult(p/V)._round());this.distance+=G.dist(v),this.addCurrentVertex(G,this.distance,E.mult(1),0,0,!1,d,u),v=G}}b=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,s)}},$o.prototype.addCurrentVertex=function(t,e,r,i,n,a,o,s){var u,l=this.layoutVertexArray,c=this.indexArray;s&&(e=ts(e,s)),u=r.clone(),i&&u._sub(r.perp()._mult(i)),Qo(l,t,u,a,!1,i,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),n&&u._sub(r.perp()._mult(n)),Qo(l,t,u,a,!0,-n,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Jo/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o))},$o.prototype.addPieSliceVertex=function(t,e,r,i,n,a){r=r.mult(i?-1:1);var o=this.layoutVertexArray,s=this.indexArray;a&&(e=ts(e,a)),Qo(o,t,r,!1,i,0,e),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},vi("LineBucket",$o,{omit:["layers","features"]});var es=new Wi({"line-cap":new Vi(St.layout_line["line-cap"]),"line-join":new Gi(St.layout_line["line-join"]),"line-miter-limit":new Vi(St.layout_line["line-miter-limit"]),"line-round-limit":new Vi(St.layout_line["line-round-limit"])}),rs={paint:new Wi({"line-opacity":new Gi(St.paint_line["line-opacity"]),"line-color":new Gi(St.paint_line["line-color"]),"line-translate":new Vi(St.paint_line["line-translate"]),"line-translate-anchor":new Vi(St.paint_line["line-translate-anchor"]),"line-width":new Gi(St.paint_line["line-width"]),"line-gap-width":new Gi(St.paint_line["line-gap-width"]),"line-offset":new Gi(St.paint_line["line-offset"]),"line-blur":new Gi(St.paint_line["line-blur"]),"line-dasharray":new Zi(St.paint_line["line-dasharray"]),"line-pattern":new qi(St.paint_line["line-pattern"]),"line-gradient":new Xi(St.paint_line["line-gradient"])}),layout:es},is=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new Li(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=h({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(Gi))(rs.paint.properties["line-width"].specification);is.useIntegerZoom=!0;var ns=function(t){function e(e){t.call(this,e,rs)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Ba(t,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=is.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new $o(t)},e.prototype.queryRadius=function(t){var e=t,r=as(ba("line-width",this,e),ba("line-gap-width",this,e)),i=ba("line-offset",this,e);return r/2+Math.abs(i)+xa(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,a,o,s){var u=wa(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),l=s/2*as(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),c=this.paint.get("line-offset").evaluate(e,r);return c&&(i=function(t,e){for(var r=[],i=new n(0,0),a=0;a<t.length;a++){for(var o=t[a],s=[],u=0;u<o.length;u++){var l=o[u-1],c=o[u],h=o[u+1],p=0===u?i:c.sub(l)._unit()._perp(),f=u===o.length-1?i:h.sub(c)._unit()._perp(),d=p._add(f)._unit(),v=d.x*f.x+d.y*f.y;d._mult(1/v),s.push(d._mult(e)._add(c))}r.push(s)}return r}(i,c*s)),function(t,e,r){for(var i=0;i<e.length;i++){var n=e[i];if(t.length>=3)for(var a=0;a<n.length;a++)if(ya(t,n[a]))return!0;if(pa(t,n,r))return!0}return!1}(u,i,l)},e.prototype.isTileClipped=function(){return!0},e}(Hi);function as(t,e){return e>0?e+2*t:t}var os=Qi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),ss=Qi([{name:"a_projected_pos",components:3,type:"Float32"}],4),us=(Qi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Qi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ls=(Qi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),cs=Qi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function hs(t,e,r){return t.sections.forEach(function(t){t.text=function(t,e,r){var i=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Ci.applyArabicShaping&&(t=Ci.applyArabicShaping(t)),t}(t.text,e,r)}),t}Qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"}]),Qi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"radialTextOffset"}]),Qi([{type:"Float32",name:"offsetX"}]),Qi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ps={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},fs=function(t){function e(e,r,i,n){t.call(this,e,r),this.angle=i,void 0!==n&&(this.segment=n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(n);vi("Anchor",fs);var ds=256;function vs(t,e){var r=e.expression;if("constant"===r.kind)return{functionType:"constant",layoutSize:r.evaluate(new Li(t+1))};if("source"===r.kind)return{functionType:"source"};for(var i=r.zoomStops,n=0;n<i.length&&i[n]<=t;)n++;for(var a=n=Math.max(0,n-1);a<i.length&&i[a]<t+1;)a++;a=Math.min(i.length-1,a);var o={min:i[n],max:i[a]};return"composite"===r.kind?{functionType:"composite",zoomRange:o,propertyValue:e.value}:{functionType:"camera",layoutSize:r.evaluate(new Li(t+1)),zoomRange:o,sizeRange:{min:r.evaluate(new Li(o.min)),max:r.evaluate(new Li(o.max))},propertyValue:e.value}}function ms(t,e,r){var i=e;return"source"===t.functionType?r.lowerSize/ds:"composite"===t.functionType?ye(r.lowerSize/ds,r.upperSize/ds,i.uSizeT):i.uSize}function gs(t,e,r){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var i=t.propertyValue,n=t.zoomRange,a=t.sizeRange,o=l(Or(i,r.specification).interpolationFactor(e,n.min,n.max),0,1);return{uSizeT:0,uSize:a.min+o*(a.max-a.min)}}var s=t.propertyValue,u=t.zoomRange;return{uSizeT:l(Or(s,r.specification).interpolationFactor(e,u.min,u.max),0,1),uSize:0}}var ys=Object.freeze({getSizeData:vs,evaluateSizeForFeature:ms,evaluateSizeForZoom:gs,SIZE_PACK_FACTOR:ds}),_s=zo.VectorTileFeature.types,bs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xs(t,e,r,i,n,a,o,s){t.emplaceBack(e,r,Math.round(32*i),Math.round(32*n),a,o,s?s[0]:0,s?s[1]:0)}function ws(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}var ks=function(t){this.layoutVertexArray=new on,this.indexArray=new gn,this.programConfigurations=t,this.segments=new zn,this.dynamicLayoutVertexArray=new sn,this.opacityVertexArray=new un,this.placedSymbolArray=new Sn};ks.prototype.upload=function(t,e,r,i){r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,os.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ss.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,bs,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t)},ks.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},vi("SymbolBuffers",ks);var Es=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new zn,this.collisionVertexArray=new hn};Es.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,us.members,!0)},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},vi("CollisionBuffers",Es);var Ss=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vs(this.zoom,e["text-size"]),this.iconSizeData=vs(this.zoom,e["icon-size"]);var r=this.layers[0].layout,i=r.get("symbol-sort-key"),n=r.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==n&&void 0!==i.constantOr(1);var a="viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey;this.sortFeaturesByY=a&&(r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement")),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id}),this.sourceID=t.sourceID};Ss.prototype.createArrays=function(){this.text=new ks(new ea(os.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new ks(new ea(os.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new Es(cn,ls.members,yn),this.collisionCircle=new Es(cn,cs.members,gn),this.glyphOffsetArray=new On,this.lineVertexArray=new Mn,this.symbolInstances=new An},Ss.prototype.calculateGlyphDependencies=function(t,e,r,i){for(var n=0;n<t.length;n++)if(e[t.charCodeAt(n)]=!0,r&&i){var a=ps[t.charAt(n)];a&&(e[a.charCodeAt(0)]=!0)}},Ss.prototype.populate=function(t,e){var r=this.layers[0],i=r.layout,n=i.get("text-font"),a=i.get("text-field"),o=i.get("icon-image"),s=("constant"!==a.value.kind||a.value.value.toString().length>0)&&("constant"!==n.value.kind||n.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0,l=i.get("symbol-sort-key");if(this.features=[],s||u){for(var c=e.iconDependencies,h=e.glyphDependencies,p=new Li(this.zoom),f=0,d=t;f<d.length;f+=1){var v=d[f],m=v.feature,g=v.index,y=v.sourceLayerIndex;if(r._featureFilter(p,m)){var _=void 0;if(s){var b=r.getValueAndResolveTokens("text-field",m);_=hs(b instanceof Kt?b:Kt.fromString(b),r,m)}var x=void 0;if(u&&(x=r.getValueAndResolveTokens("icon-image",m)),_||x){var w=this.sortFeaturesByKey?l.evaluate(m,{}):void 0,k={text:_,icon:x,index:g,sourceLayerIndex:y,geometry:oa(m),properties:m.properties,type:_s[m.type],sortKey:w};if(void 0!==m.id&&(k.id=m.id),this.features.push(k),x&&(c[x]=!0),_)for(var E=n.evaluate(m,{}).join(","),S="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),T=0,A=_.sections;T<A.length;T+=1){var P=A[T],O=xi(_.toString()),I=P.fontStack||E,M=h[I]=h[I]||{};this.calculateGlyphDependencies(P.text,M,S,O)}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},r={},i=[],n=0;function a(e){i.push(t[e]),n++}function o(t,e,n){var a=r[t];return delete r[t],r[e]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(n[0]),a}function s(t,r,n){var a=e[r];return delete e[r],e[t]=a,i[a].geometry[0].shift(),i[a].geometry[0]=n[0].concat(i[a].geometry[0]),a}function u(t,e,r){var i=r?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in r&&d in e&&r[f]!==e[d]){var v=s(f,d,h),m=o(f,d,i[v].geometry);delete e[f],delete r[d],r[u(p,i[m].geometry,!0)]=m,i[v].geometry=null}else f in r?o(f,d,h):d in e?s(f,d,h):(a(l),e[f]=n-1,r[d]=n-1)}else a(l)}return i.filter(function(t){return t.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(t,e){return t.sortKey-e.sortKey})}},Ss.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},Ss.prototype.isEmpty=function(){return 0===this.symbolInstances.length},Ss.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ss.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ss.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},Ss.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o<e.length-1&&(i+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=a[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Ss.prototype.addSymbols=function(t,e,r,i,n,a,o,s,u,l){for(var c=t.indexArray,h=t.layoutVertexArray,p=t.dynamicLayoutVertexArray,f=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray,a.sortKey),d=this.glyphOffsetArray.length,v=f.vertexLength,m=0,g=e;m<g.length;m+=1){var y=g[m],_=y.tl,b=y.tr,x=y.bl,w=y.br,k=y.tex,E=f.vertexLength,S=y.glyphOffset[1];xs(h,s.x,s.y,_.x,S+_.y,k.x,k.y,r),xs(h,s.x,s.y,b.x,S+b.y,k.x+k.w,k.y,r),xs(h,s.x,s.y,x.x,S+x.y,k.x,k.y+k.h,r),xs(h,s.x,s.y,w.x,S+w.y,k.x+k.w,k.y+k.h,r),ws(p,s,0),c.emplaceBack(E,E+1,E+2),c.emplaceBack(E+1,E+2,E+3),f.vertexLength+=4,f.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(y.glyphOffset[0])}t.placedSymbolArray.emplaceBack(s.x,s.y,d,this.glyphOffsetArray.length-d,v,u,l,s.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],o,!1,0),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,a,a.index,{})},Ss.prototype._addCollisionDebugVertex=function(t,e,r,i,n,a){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,i,n,Math.round(a.x),Math.round(a.y))},Ss.prototype.addCollisionDebugVertices=function(t,e,r,i,a,o,s,u){var l=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),c=l.vertexLength,h=a.layoutVertexArray,p=a.collisionVertexArray,f=s.anchorX,d=s.anchorY;if(this._addCollisionDebugVertex(h,p,o,f,d,new n(t,e)),this._addCollisionDebugVertex(h,p,o,f,d,new n(r,e)),this._addCollisionDebugVertex(h,p,o,f,d,new n(r,i)),this._addCollisionDebugVertex(h,p,o,f,d,new n(t,i)),l.vertexLength+=4,u){var v=a.indexArray;v.emplaceBack(c,c+1,c+2),v.emplaceBack(c,c+2,c+3),l.primitiveLength+=2}else{var m=a.indexArray;m.emplaceBack(c,c+1),m.emplaceBack(c+1,c+2),m.emplaceBack(c+2,c+3),m.emplaceBack(c+3,c),l.primitiveLength+=4}},Ss.prototype.addDebugCollisionBoxes=function(t,e,r){for(var i=t;i<e;i++){var n=this.collisionBoxArray.get(i),a=n.x1,o=n.y1,s=n.x2,u=n.y2,l=n.radius>0;this.addCollisionDebugVertices(a,o,s,u,l?this.collisionCircle:this.collisionBox,n.anchorPoint,r,l)}},Ss.prototype.generateCollisionDebugBuffers=function(){for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e)}},Ss.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,i,n){for(var a={},o=e;o<r;o++){var s=t.get(o);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},a.textFeatureIndex=s.featureIndex;break}a.textCircles||(a.textCircles=[],a.textFeatureIndex=s.featureIndex),a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var u=i;u<n;u++){var l=t.get(u);if(0===l.radius){a.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},a.iconFeatureIndex=l.featureIndex;break}}return a},Ss.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex))}},Ss.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ss.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ss.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},Ss.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},Ss.prototype.addIndicesForPlacedTextSymbol=function(t){for(var e=this.text.placedSymbolArray.get(t),r=e.vertexStartIndex+4*e.numGlyphs,i=e.vertexStartIndex;i<r;i+=4)this.text.indexArray.emplaceBack(i,i+1,i+2),this.text.indexArray.emplaceBack(i+1,i+2,i+3)},Ss.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],i=0;i<this.symbolInstances.length;i++)r.push(i);for(var n=Math.sin(t),a=Math.cos(t),o=[],s=[],u=0;u<this.symbolInstances.length;u++){var l=this.symbolInstances.get(u);o.push(0|Math.round(n*l.anchorX+a*l.anchorY)),s.push(l.featureIndex)}r.sort(function(t,e){return o[t]-o[e]||s[e]-s[t]}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,h=r;c<h.length;c+=1){var p=h[c],f=this.symbolInstances.get(p);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach(function(t,r,i){t>=0&&i.indexOf(t)===r&&e.addIndicesForPlacedTextSymbol(t)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedTextSymbol(f.verticalPlacedTextSymbolIndex);var d=this.icon.placedSymbolArray.get(p);if(d.numGlyphs){var v=d.vertexStartIndex;this.icon.indexArray.emplaceBack(v,v+1,v+2),this.icon.indexArray.emplaceBack(v+1,v+2,v+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},vi("SymbolBucket",Ss,{omit:["layers","collisionBoxArray","features","compareText"]}),Ss.MAX_GLYPHS=65535,Ss.addDynamicAttributes=ws;var Ts=new Wi({"symbol-placement":new Vi(St.layout_symbol["symbol-placement"]),"symbol-spacing":new Vi(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vi(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gi(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vi(St.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vi(St.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Vi(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vi(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vi(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gi(St.layout_symbol["icon-size"]),"icon-text-fit":new Vi(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vi(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gi(St.layout_symbol["icon-image"]),"icon-rotate":new Gi(St.layout_symbol["icon-rotate"]),"icon-padding":new Vi(St.layout_symbol["icon-padding"]),"icon-keep-upright":new Vi(St.layout_symbol["icon-keep-upright"]),"icon-offset":new Gi(St.layout_symbol["icon-offset"]),"icon-anchor":new Gi(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vi(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vi(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vi(St.layout_symbol["text-rotation-alignment"]),"text-field":new Gi(St.layout_symbol["text-field"]),"text-font":new Gi(St.layout_symbol["text-font"]),"text-size":new Gi(St.layout_symbol["text-size"]),"text-max-width":new Gi(St.layout_symbol["text-max-width"]),"text-line-height":new Vi(St.layout_symbol["text-line-height"]),"text-letter-spacing":new Gi(St.layout_symbol["text-letter-spacing"]),"text-justify":new Gi(St.layout_symbol["text-justify"]),"text-radial-offset":new Gi(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vi(St.layout_symbol["text-variable-anchor"]),"text-anchor":new Gi(St.layout_symbol["text-anchor"]),"text-max-angle":new Vi(St.layout_symbol["text-max-angle"]),"text-rotate":new Gi(St.layout_symbol["text-rotate"]),"text-padding":new Vi(St.layout_symbol["text-padding"]),"text-keep-upright":new Vi(St.layout_symbol["text-keep-upright"]),"text-transform":new Gi(St.layout_symbol["text-transform"]),"text-offset":new Gi(St.layout_symbol["text-offset"]),"text-allow-overlap":new Vi(St.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Vi(St.layout_symbol["text-ignore-placement"]),"text-optional":new Vi(St.layout_symbol["text-optional"])}),As={paint:new Wi({"icon-opacity":new Gi(St.paint_symbol["icon-opacity"]),"icon-color":new Gi(St.paint_symbol["icon-color"]),"icon-halo-color":new Gi(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gi(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gi(St.paint_symbol["icon-halo-blur"]),"icon-translate":new Vi(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vi(St.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gi(St.paint_symbol["text-opacity"]),"text-color":new Gi(St.paint_symbol["text-color"]),"text-halo-color":new Gi(St.paint_symbol["text-halo-color"]),"text-halo-width":new Gi(St.paint_symbol["text-halo-width"]),"text-halo-blur":new Gi(St.paint_symbol["text-halo-blur"]),"text-translate":new Vi(St.paint_symbol["text-translate"]),"text-translate-anchor":new Vi(St.paint_symbol["text-translate-anchor"])}),layout:Ts},Ps=function(t){function e(e){t.call(this,e,As)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var r,i=this.layout.get(t).evaluate(e,{}),n=this._unevaluatedLayout._values[t];return n.isDataDriven()||kr(n.value)?i:(r=e.properties,i.replace(/{([^{}]+)}/g,function(t,e){return e in r?String(r[e]):""}))},e.prototype.createBucket=function(t){return new Ss(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(Hi),Os={paint:new Wi({"background-color":new Vi(St.paint_background["background-color"]),"background-pattern":new Zi(St.paint_background["background-pattern"]),"background-opacity":new Vi(St.paint_background["background-opacity"])})},Is=function(t){function e(e){t.call(this,e,Os)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Hi),Ms={paint:new Wi({"raster-opacity":new Vi(St.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vi(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vi(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vi(St.paint_raster["raster-brightness-max"]),"raster-saturation":new Vi(St.paint_raster["raster-saturation"]),"raster-contrast":new Vi(St.paint_raster["raster-contrast"]),"raster-resampling":new Vi(St.paint_raster["raster-resampling"]),"raster-fade-duration":new Vi(St.paint_raster["raster-fade-duration"])})},Cs=function(t){function e(e){t.call(this,e,Ms)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Hi),Ls=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t)},e}(Hi),js={circle:Ia,heatmap:Na,hillshade:Va,fill:So,"fill-extrusion":Go,line:ns,symbol:Ps,background:Is,raster:Cs};function zs(t){for(var e=0,r=0,i=0,n=t;i<n.length;i+=1){var a=n[i];e+=a.w*a.h,r=Math.max(r,a.w)}t.sort(function(t,e){return e.h-t.h});for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],p=o.length-1;p>=0;p--){var f=o[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=o.pop();p<o.length&&(o[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(o.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}var Rs=function(t,e){var r=e.pixelRatio,i=e.version;this.paddedRect=t,this.pixelRatio=r,this.version=i},Fs={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Fs.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Fs.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Fs.tlbr.get=function(){return this.tl.concat(this.br)},Fs.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Rs.prototype,Fs);var Ds=function(t,e){var r={},i={};this.haveRenderCallbacks=[];var n=[];this.addImages(t,r,n),this.addImages(e,i,n);var a=zs(n),o=a.w,s=a.h,u=new Fa({width:o||1,height:s||1});for(var l in t){var c=t[l],h=r[l].paddedRect;Fa.copy(c.data,u,{x:0,y:0},{x:h.x+1,y:h.y+1},c.data)}for(var p in e){var f=e[p],d=i[p].paddedRect,v=d.x+1,m=d.y+1,g=f.data.width,y=f.data.height;Fa.copy(f.data,u,{x:0,y:0},{x:v,y:m},f.data),Fa.copy(f.data,u,{x:0,y:y-1},{x:v,y:m-1},{width:g,height:1}),Fa.copy(f.data,u,{x:0,y:0},{x:v,y:m+y},{width:g,height:1}),Fa.copy(f.data,u,{x:g-1,y:0},{x:v-1,y:m},{width:1,height:y}),Fa.copy(f.data,u,{x:0,y:0},{x:v+g,y:m},{width:1,height:y})}this.image=u,this.iconPositions=r,this.patternPositions=i};Ds.prototype.addImages=function(t,e,r){for(var i in t){var n=t[i],a={x:0,y:0,w:n.data.width+2,h:n.data.height+2};r.push(a),e[i]=new Rs(a,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(i)}},Ds.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},Ds.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var i=t.tl,n=i[0],a=i[1];r.update(e.data,void 0,{x:n,y:a})}},vi("ImagePosition",Rs),vi("ImageAtlas",Ds);var Bs=self.HTMLImageElement,Ns=self.HTMLCanvasElement,Us=self.HTMLVideoElement,Vs=self.ImageData,Gs=function(t,e,r,i){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,i)};Gs.prototype.update=function(t,e,r){var i=t.width,n=t.height,a=!(this.size&&this.size[0]===i&&this.size[1]===n||r),o=this.context,s=o.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[i,n],t instanceof Bs||t instanceof Ns||t instanceof Us||t instanceof Vs?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,i,n,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=r||{x:0,y:0},l=u.x,c=u.y;t instanceof Bs||t instanceof Ns||t instanceof Us||t instanceof Vs?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,i,n,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Gs.prototype.bind=function(t,e,r){var i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),r!==i.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=i.LINEAR),t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e)},Gs.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Gs.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var qs=function(t,e,r,i,n){var a,o,s=8*n-i-1,u=(1<<s)-1,l=u>>1,c=-7,h=r?n-1:0,p=r?-1:1,f=t[e+h];for(h+=p,a=f&(1<<-c)-1,f>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=p,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=i;c>0;o=256*o+t[e+h],h+=p,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),a-=l}return(f?-1:1)*o*Math.pow(2,a-i)},Zs=function(t,e,r,i,n,a){var o,s,u,l=8*a-n-1,c=(1<<l)-1,h=c>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:a-1,d=i?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,n),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),o=0));n>=8;t[r+f]=255&s,f+=d,s/=256,n-=8);for(o=o<<n|s,l+=n;l>0;t[r+f]=255&o,f+=d,o/=256,l-=8);t[r+f-d]|=128*v},Xs=Ws;function Ws(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function Hs(t){return t.type===Ws.Bytes?t.readVarint()+t.pos:t.pos+1}function Ys(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ks(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function Js(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Qs(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function $s(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function tu(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function eu(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function ru(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function iu(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function nu(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function au(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function ou(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function su(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function uu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ws.Varint=0,Ws.Fixed64=1,Ws.Bytes=2,Ws.Fixed32=5,Ws.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=7&i,t(n,e,this),this.pos===a&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ou(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=uu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ou(this.buf,this.pos)+4294967296*ou(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=ou(this.buf,this.pos)+4294967296*uu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=qs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=qs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,n,a=r.buf;if(i=(112&(n=a[r.pos++]))>>4,n<128)return Ys(t,i,e);if(i|=(127&(n=a[r.pos++]))<<3,n<128)return Ys(t,i,e);if(i|=(127&(n=a[r.pos++]))<<10,n<128)return Ys(t,i,e);if(i|=(127&(n=a[r.pos++]))<<17,n<128)return Ys(t,i,e);if(i|=(127&(n=a[r.pos++]))<<24,n<128)return Ys(t,i,e);if(i|=(1&(n=a[r.pos++]))<<31,n<128)return Ys(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){for(var i="",n=e;n<r;){var a,o,s,u=t[n],l=null,c=u>239?4:u>223?3:u>191?2:1;if(n+c>r)break;1===c?u<128&&(l=u):2===c?128==(192&(a=t[n+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(a=t[n+1],o=t[n+2],128==(192&a)&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[n+1],o=t[n+2],s=t[n+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),i+=String.fromCharCode(l),n+=c}return i}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=Hs(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Hs(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ws.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ws.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ws.Fixed32)this.pos+=4;else{if(e!==Ws.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),su(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),su(this.buf,-1&t,this.pos),su(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,n,a=0;a<e.length;a++){if((i=e.charCodeAt(a))>55295&&i<57344){if(!n){i>56319||a+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Ks(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Zs(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Zs(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&Ks(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,Ws.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,Js,e)},writePackedSVarint:function(t,e){this.writeMessage(t,Qs,e)},writePackedBoolean:function(t,e){this.writeMessage(t,eu,e)},writePackedFloat:function(t,e){this.writeMessage(t,$s,e)},writePackedDouble:function(t,e){this.writeMessage(t,tu,e)},writePackedFixed32:function(t,e){this.writeMessage(t,ru,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,iu,e)},writePackedFixed64:function(t,e){this.writeMessage(t,nu,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,au,e)},writeBytesField:function(t,e){this.writeTag(t,Ws.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ws.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ws.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ws.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ws.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ws.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ws.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ws.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ws.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ws.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var lu=3;function cu(t,e,r){1===t&&r.readMessage(hu,e)}function hu(t,e,r){if(3===t){var i=r.readMessage(pu,{}),n=i.id,a=i.bitmap,o=i.width,s=i.height,u=i.left,l=i.top,c=i.advance;e.push({id:n,bitmap:new Ra({width:o+2*lu,height:s+2*lu},a),metrics:{width:o,height:s,left:u,top:l,advance:c}})}}function pu(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}var fu=lu,du=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.callbackID=0,m(["receive"],this),this.target.addEventListener("message",this.receive,!1)};function vu(t,e,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}du.prototype.send=function(t,e,r,i){var n=this,a=r?this.mapId+":"+this.callbackID++:null;r&&(this.callbacks[a]=r);var o=[];if(this.target.postMessage({targetMapId:i,sourceMapId:this.mapId,type:t,id:String(a),data:gi(e,o)},o),r)return{cancel:function(){return n.target.postMessage({targetMapId:i,sourceMapId:n.mapId,type:"<cancel>",id:String(a)})}}},du.prototype.receive=function(t){var e,r=this,i=t.data,n=i.id;if(!i.targetMapId||this.mapId===i.targetMapId){var a=function(t,e){delete r.callbacks[n];var i=[];r.target.postMessage({sourceMapId:r.mapId,type:"<response>",id:String(n),error:t?gi(t):null,data:gi(e,i)},i)};if("<response>"===i.type||"<cancel>"===i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e&&i.error?e(yi(i.error)):e&&e(null,yi(i.data));else if(void 0!==i.id&&this.parent[i.type]){this.callbacks[i.id]=null;var o=this.parent[i.type](i.sourceMapId,yi(i.data),a);o&&null===this.callbacks[i.id]&&(this.callbacks[i.id]=o.cancel)}else if(void 0!==i.id&&this.parent.getWorkerSource){var s=i.type.split("."),u=yi(i.data);this.parent.getWorkerSource(i.sourceMapId,s[0],u.source)[s[1]](u,a)}else this.parent[i.type](yi(i.data))}},du.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var mu=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};mu.prototype.setNorthEast=function(t){return this._ne=t instanceof gu?new gu(t.lng,t.lat):gu.convert(t),this},mu.prototype.setSouthWest=function(t){return this._sw=t instanceof gu?new gu(t.lng,t.lat):gu.convert(t),this},mu.prototype.extend=function(t){var e,r,i=this._sw,n=this._ne;if(t instanceof gu)e=t,r=t;else{if(!(t instanceof mu))return Array.isArray(t)?t.every(Array.isArray)?this.extend(mu.convert(t)):this.extend(gu.convert(t)):this;if(e=t._sw,r=t._ne,!e||!r)return this}return i||n?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new gu(e.lng,e.lat),this._ne=new gu(r.lng,r.lat)),this},mu.prototype.getCenter=function(){return new gu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},mu.prototype.getSouthWest=function(){return this._sw},mu.prototype.getNorthEast=function(){return this._ne},mu.prototype.getNorthWest=function(){return new gu(this.getWest(),this.getNorth())},mu.prototype.getSouthEast=function(){return new gu(this.getEast(),this.getSouth())},mu.prototype.getWest=function(){return this._sw.lng},mu.prototype.getSouth=function(){return this._sw.lat},mu.prototype.getEast=function(){return this._ne.lng},mu.prototype.getNorth=function(){return this._ne.lat},mu.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},mu.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},mu.prototype.isEmpty=function(){return!(this._sw&&this._ne)},mu.convert=function(t){return!t||t instanceof mu?t:new mu(t)};var gu=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};function yu(t){return 2*Math.PI*6378137*Math.cos(t*Math.PI/180)}function _u(t){return(180+t)/360}function bu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function xu(t,e){return t/yu(e)}function wu(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}gu.prototype.wrap=function(){return new gu(c(this.lng,-180,180),this.lat)},gu.prototype.toArray=function(){return[this.lng,this.lat]},gu.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},gu.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new mu(new gu(this.lng-r,this.lat-e),new gu(this.lng+r,this.lat+e))},gu.convert=function(t){if(t instanceof gu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new gu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new gu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ku=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};ku.fromLngLat=function(t,e){void 0===e&&(e=0);var r=gu.convert(t);return new ku(_u(r.lng),bu(r.lat),xu(e,r.lat))},ku.prototype.toLngLat=function(){return new gu(360*this.x-180,wu(this.y))},ku.prototype.toAltitude=function(){return this.z*yu(wu(this.y))};var Eu=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Au(0,t,e,r)};Eu.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Eu.prototype.url=function(t,e){var r,i,n,a,o,s=(r=this.x,i=this.y,n=this.z,a=vu(256*r,256*(i=Math.pow(2,n)-i-1),n),o=vu(256*(r+1),256*(i+1),n),a[0]+","+a[1]+","+o[0]+","+o[1]),u=function(t,e,r){for(var i,n="",a=t;a>0;a--)n+=(e&(i=1<<a-1)?1:0)+(r&i?2:0);return n}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Eu.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new n((t.x*e-this.x)*na,(t.y*e-this.y)*na)};var Su=function(t,e){this.wrap=t,this.canonical=e,this.key=Au(t,e.z,e.x,e.y)},Tu=function(t,e,r,i,n){this.overscaledZ=t,this.wrap=e,this.canonical=new Eu(r,+i,+n),this.key=Au(e,t,i,n)};function Au(t,e,r,i){(t*=2)<0&&(t=-1*t-1);var n=1<<e;return 32*(n*n*t+n*i+r)+e}Tu.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Tu.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Tu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Tu.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Tu.prototype.children=function(t){if(this.overscaledZ>=t)return[new Tu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new Tu(e,this.wrap,e,r,i),new Tu(e,this.wrap,e,r+1,i),new Tu(e,this.wrap,e,r,i+1),new Tu(e,this.wrap,e,r+1,i+1)]},Tu.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Tu.prototype.wrapped=function(){return new Tu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Tu.prototype.unwrapTo=function(t){return new Tu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Tu.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Tu.prototype.toUnwrapped=function(){return new Su(this.wrap,this.canonical)},Tu.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Tu.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new ku(t.x-this.wrap,t.y))},vi("CanonicalTileID",Eu),vi("OverscaledTileID",Tu,{omit:["posMatrix"]});var Pu=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return w('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');var i=this.dim=e.height;this.stride=this.dim+2,this.data=new Int32Array(this.stride*this.stride);for(var n=e.data,a="terrarium"===r?this._unpackTerrarium:this._unpackMapbox,o=0;o<i;o++)for(var s=0;s<i;s++){var u=4*(o*i+s);this.set(s,o,a(n[u],n[u+1],n[u+2]))}for(var l=0;l<i;l++)this.set(-1,l,this.get(0,l)),this.set(i,l,this.get(i-1,l)),this.set(l,-1,this.get(l,0)),this.set(l,i,this.get(l,i-1));this.set(-1,-1,this.get(0,0)),this.set(i,-1,this.get(i-1,0)),this.set(-1,i,this.get(0,i-1)),this.set(i,i,this.get(i-1,i-1))};Pu.prototype.set=function(t,e,r){this.data[this._idx(t,e)]=r+65536},Pu.prototype.get=function(t,e){return this.data[this._idx(t,e)]-65536},Pu.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Pu.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Pu.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Pu.prototype.getPixels=function(){return new Fa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Pu.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var i=e*this.dim,n=e*this.dim+this.dim,a=r*this.dim,o=r*this.dim+this.dim;switch(e){case-1:i=n-1;break;case 1:n=i+1}switch(r){case-1:a=o-1;break;case 1:o=a+1}for(var s=-e*this.dim,u=-r*this.dim,l=a;l<o;l++)for(var c=i;c<n;c++)this.set(c,l,t.get(c+s,l+u))},vi("DEMData",Pu);var Ou=Qi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Iu=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Iu.prototype.encode=function(t){return this._stringToNumber[t]},Iu.prototype.decode=function(t){return this._numberToString[t]};var Mu=function(t,e,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=i,this.properties=t.properties,null!=t.id&&(this.id=t.id)},Cu={geometry:{configurable:!0}};Cu.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Cu.geometry.set=function(t){this._geometry=t},Mu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Mu.prototype,Cu);var Lu=function(){this.state={},this.stateChanges={},this.deletedStates={}};Lu.prototype.updateState=function(t,e,r){var i=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][i]=this.stateChanges[t][i]||{},h(this.stateChanges[t][i],r),null===this.deletedStates[t])for(var n in this.deletedStates[t]={},this.state[t])n!==i&&(this.deletedStates[t][n]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][i])for(var a in this.deletedStates[t][i]={},this.state[t][i])r[a]||(this.deletedStates[t][i][a]=null);else for(var o in r)this.deletedStates[t]&&this.deletedStates[t][i]&&null===this.deletedStates[t][i][o]&&delete this.deletedStates[t][i][o]},Lu.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var i=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&e)null!==this.deletedStates[t][i]&&(this.deletedStates[t][i]=this.deletedStates[t][i]||{},this.deletedStates[t][i][r]=null);else if(e)if(this.stateChanges[t]&&this.stateChanges[t][i])for(r in this.deletedStates[t][i]={},this.stateChanges[t][i])this.deletedStates[t][i][r]=null;else this.deletedStates[t][i]=null;else this.deletedStates[t]=null}},Lu.prototype.getState=function(t,e){var r=String(e),i=this.state[t]||{},n=this.stateChanges[t]||{},a=h({},i[r],n[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var o=this.deletedStates[t][e];if(null===o)return{};for(var s in o)delete a[s]}return a},Lu.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Lu.prototype.coalesceChanges=function(t,e){var r={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var n={};for(var a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),h(this.state[i][a],this.stateChanges[i][a]),n[a]=this.state[i][a];r[i]=n}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var u in this.state[o])s[u]={},this.state[o][u]={};else for(var l in this.deletedStates[o]){if(null===this.deletedStates[o][l])this.state[o][l]={};else for(var c=0,p=Object.keys(this.deletedStates[o][l]);c<p.length;c+=1){var f=p[c];delete this.state[o][l][f]}s[l]=this.state[o][l]}r[o]=r[o]||{},h(r[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var d in t)t[d].setFeatureState(r,e)};var ju=function(t,e,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new ci(na,16,0),this.grid3D=new ci(na,16,0),this.featureIndexArray=r||new Ln};function zu(t){for(var e=1/0,r=1/0,i=-1/0,n=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),r=Math.min(r,s.y),i=Math.max(i,s.x),n=Math.max(n,s.y)}return{minX:e,minY:r,maxX:i,maxY:n}}function Ru(t,e){return e-t}ju.prototype.insert=function(t,e,r,i,n,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n);for(var s=a?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<na&&c[1]<na&&c[2]>=0&&c[3]>=0&&s.insert(o,c[0],c[1],c[2],c[3])}},ju.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new zo.VectorTile(new Xs(this.rawTileData)).layers,this.sourceLayerCoder=new Iu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ju.prototype.query=function(t,e,r){var i=this;this.loadVTLayers();for(var a=t.params||{},o=na/t.tileSize/t.scale,s=Dr(a.filter),u=t.queryGeometry,l=t.queryPadding*o,c=zu(u),h=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),p=zu(t.cameraQueryGeometry),f=0,d=this.grid3D.query(p.minX-l,p.minY-l,p.maxX+l,p.maxY+l,function(e,r,i,a){return function(t,e,r,i,a){for(var o=0,s=t;o<s.length;o+=1){var u=s[o];if(e<=u.x&&r<=u.y&&i>=u.x&&a>=u.y)return!0}var l=[new n(e,r),new n(e,a),new n(i,a),new n(i,r)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if(ya(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(_a(t[p],t[p+1],l))return!0;return!1}(t.cameraQueryGeometry,e-l,r-l,i+l,a+l)});f<d.length;f+=1){var v=d[f];h.push(v)}h.sort(Ru);for(var m,g={},y=function(n){var l=h[n];if(l!==m){m=l;var c=i.featureIndexArray.get(l),p=null;i.loadMatchingFeature(g,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,s,a.layers,e,function(e,n){p||(p=oa(e));var a={};return e.id&&(a=r.getState(n.sourceLayer||"_geojsonTileLayer",e.id)),n.queryIntersectsFeature(u,e,a,p,i.z,t.transform,o,t.pixelPosMatrix)})}},_=0;_<h.length;_++)y(_);return g},ju.prototype.loadMatchingFeature=function(t,e,r,i,n,a,o,s){var u=this.bucketLayerIDs[e];if(!a||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(a,u)){var l=this.sourceLayerCoder.decode(r),c=this.vtLayers[l].feature(i);if(n(new Li(this.tileID.overscaledZ),c))for(var h=0;h<u.length;h++){var p=u[h];if(!(a&&a.indexOf(p)<0)){var f=o[p];if(f){var d=!s||s(c,f);if(d){var v=new Mu(c,this.z,this.x,this.y);v.layer=f.serialize();var m=t[p];void 0===m&&(m=t[p]=[]),m.push({featureIndex:i,feature:v,intersectionZ:d})}}}}}},ju.prototype.lookupSymbolFeatures=function(t,e,r,i,n,a){var o={};this.loadVTLayers();for(var s=Dr(i),u=0,l=t;u<l.length;u+=1){var c=l[u];this.loadMatchingFeature(o,e,r,c,s,n,a)}return o},ju.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var i=0,n=r[e];i<n.length;i+=1)if(t===n[i])return!0;return!1},vi("FeatureIndex",ju,{omit:["rawTileData","sourceLayerCoder"]});var Fu=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.expiredRequestCount=0,this.state="loading"};Fu.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<C.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Fu.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Fu.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var i in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var i=function(){var t=a[n],i=t.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==i.length){t.layers=i,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map(function(t){return i.filter(function(e){return e.id===t})[0]}));for(var o=0,s=i;o<s.length;o+=1){var u=s[o];r[u.id]=t}}},n=0,a=t;n<a.length;n+=1)i();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var n=this.buckets[i];if(n instanceof Ss){if(this.hasSymbolBuckets=!0,!r)break;n.justReloaded=!0}}for(var a in this.queryPadding=0,this.buckets){var o=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(a).queryRadius(o))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new kn},Fu.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Fu.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},Fu.prototype.getBucket=function(t){return this.buckets[t.id]},Fu.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gs(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gs(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null)},Fu.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Fu.prototype.queryRenderedFeatures=function(t,e,r,i,n,a,o,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:n,tileSize:this.tileSize,pixelPosMatrix:u,transform:o,params:a,queryPadding:this.queryPadding*s},t,e):{}},Fu.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var r=this.latestFeatureIndex.loadVTLayers(),i=e?e.sourceLayer:"",n=r._geojsonTileLayer||r[i];if(n)for(var a=Dr(e&&e.filter),o=this.tileID.canonical,s=o.z,u=o.x,l=o.y,c={z:s,x:u,y:l},h=0;h<n.length;h++){var p=n.feature(h);if(a(new Li(this.tileID.overscaledZ),p)){var f=new Mu(p,s,u,l);f.tile=c,t.push(f)}}}},Fu.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},Fu.prototype.setMask=function(t,e){if(!o(this.mask,t)&&(this.mask=t,this.clearMask(),!o(t,{0:!0}))){var r=new en,i=new gn;this.segments=new zn,this.segments.prepareSegment(0,r,i);for(var a=Object.keys(t),s=0;s<a.length;s++){var u=t[a[s]],l=na>>u.z,c=new n(u.x*l,u.y*l),h=new n(c.x+l,c.y+l),p=this.segments.prepareSegment(4,r,i);r.emplaceBack(c.x,c.y,c.x,c.y),r.emplaceBack(h.x,c.y,h.x,c.y),r.emplaceBack(c.x,h.y,c.x,h.y),r.emplaceBack(h.x,h.y,h.x,h.y);var f=p.vertexLength;i.emplaceBack(f,f+1,f+2),i.emplaceBack(f+1,f+2,f+3),p.vertexLength+=4,p.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(r,Ou.members),this.maskedIndexBuffer=e.createIndexBuffer(i)}},Fu.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Fu.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Fu.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=function(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,r,i,n){var a=i||n;return e[r]=!a||a.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),n=!1;if(this.expirationTime>i)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{var a=this.expirationTime-e;a?this.expirationTime=i+Math.max(a,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Fu.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Fu.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var i in this.buckets){var n=this.buckets[i],a=n.layers[0].sourceLayer||"_geojsonTileLayer",o=r[a],s=t[a];o&&s&&0!==Object.keys(s).length&&(n.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(i).queryRadius(n))))}}},Fu.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Fu.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<C.now()},Fu.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Fu.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=C.now()+t};var Du=24,Bu={horizontal:1,vertical:2,horizontalOnly:3},Nu=function(){this.text="",this.sectionIndex=[],this.sections=[]};function Uu(t,e,r,i,n,a,o,s,u,l){var c,h=Nu.fromFeature(t,r);l===Bu.vertical&&h.verticalizePunctuation();var p=Ci.processBidirectionalText,f=Ci.processStyledBidirectionalText;if(p&&1===h.sections.length){c=[];for(var d=0,v=p(h.toString(),Wu(h,s,i,e));d<v.length;d+=1){var m=v[d],g=new Nu;g.text=m,g.sections=h.sections;for(var y=0;y<m.length;y++)g.sectionIndex.push(0);c.push(g)}}else if(f){c=[];for(var _=0,b=f(h.text,h.sectionIndex,Wu(h,s,i,e));_<b.length;_+=1){var x=b[_],w=new Nu;w.text=x[0],w.sectionIndex=x[1],w.sections=h.sections,c.push(w)}}else c=function(t,e){for(var r=[],i=t.text,n=0,a=0,o=e;a<o.length;a+=1){var s=o[a];r.push(t.substring(n,s)),n=s}return n<i.length&&r.push(t.substring(n,i.length)),r}(h,Wu(h,s,i,e));var k=[],E={positionedGlyphs:k,text:h.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:l,lineCount:c.length};return function(t,e,r,i,n,a,o,s){for(var u=0,l=-17,c=0,h=t.positionedGlyphs,p="right"===a?1:"left"===a?0:.5,f=0,d=r;f<d.length;f+=1){var v=d[f];v.trim();var m=v.getMaxScale();if(v.length()){for(var g=h.length,y=0;y<v.length();y++){var _=v.getSection(y),b=v.getCharCode(y),x=24*(m-_.scale),w=e[_.fontStack],k=w&&w[b];k&&(Ei(b)&&o!==Bu.horizontal?(h.push({glyph:b,x:u,y:x,vertical:!0,scale:_.scale,fontStack:_.fontStack}),u+=Du*_.scale+s):(h.push({glyph:b,x:u,y:l+x,vertical:!1,scale:_.scale,fontStack:_.fontStack}),u+=k.metrics.advance*_.scale+s))}if(h.length!==g){var E=u-s;c=Math.max(E,c),Yu(h,e,g,h.length-1,p)}u=0,l+=i*m}else l+=i}var S=Hu(n),T=S.horizontalAlign,A=S.verticalAlign;!function(t,e,r,i,n,a,o){for(var s=(e-r)*n,u=(-i*o+.5)*a,l=0;l<t.length;l++)t[l].x+=s,t[l].y+=u}(h,p,T,A,c,i,r.length);var P=l- -17;t.top+=-A*P,t.bottom=t.top+P,t.left+=-T*c,t.right=t.left+c}(E,e,c,n,a,o,l,s),!!k.length&&E}Nu.fromFeature=function(t,e){for(var r=new Nu,i=0;i<t.sections.length;i++){var n=t.sections[i];r.sections.push({scale:n.scale||1,fontStack:n.fontStack||e}),r.text+=n.text;for(var a=0;a<n.text.length;a++)r.sectionIndex.push(i)}return r},Nu.prototype.length=function(){return this.text.length},Nu.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Nu.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Nu.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var i=t.charCodeAt(r+1)||null,n=t.charCodeAt(r-1)||null;i&&Si(i)&&!ps[t[r+1]]||n&&Si(n)&&!ps[t[r-1]]||!ps[t[r]]?e+=t[r]:e+=ps[t[r]]}return e}(this.text)},Nu.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Vu[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,i=this.text.length-1;i>=0&&i>=t&&Vu[this.text.charCodeAt(i)];i--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},Nu.prototype.substring=function(t,e){var r=new Nu;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},Nu.prototype.toString=function(){return this.text},Nu.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(e,r){return Math.max(e,t.sections[r].scale)},0)};var Vu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gu={};function qu(t,e,r,i){var n=Math.pow(t-e,2);return i?t<e?n/2:2*n:n+Math.abs(r)*r}function Zu(t,e){var r=0;return 10===t&&(r-=1e4),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Xu(t,e,r,i,n,a){for(var o=null,s=qu(e,r,n,a),u=0,l=i;u<l.length;u+=1){var c=l[u],h=qu(e-c.x,r,n,a)+c.badness;h<=s&&(o=c,s=h)}return{index:t,x:e,priorBreak:o,badness:s}}function Wu(t,e,r,i){if(!r)return[];if(!t)return[];for(var n,a=[],o=function(t,e,r,i){for(var n=0,a=0;a<t.length();a++){var o=t.getSection(a),s=i[o.fontStack],u=s&&s[t.getCharCode(a)];u&&(n+=u.metrics.advance*o.scale+e)}return n/Math.max(1,Math.ceil(n/r))}(t,e,r,i),s=0,u=0;u<t.length();u++){var l=t.getSection(u),c=t.getCharCode(u),h=i[l.fontStack],p=h&&h[c];p&&!Vu[c]&&(s+=p.metrics.advance*l.scale+e),u<t.length()-1&&(Gu[c]||!((n=c)<11904)&&(bi["Bopomofo Extended"](n)||bi.Bopomofo(n)||bi["CJK Compatibility Forms"](n)||bi["CJK Compatibility Ideographs"](n)||bi["CJK Compatibility"](n)||bi["CJK Radicals Supplement"](n)||bi["CJK Strokes"](n)||bi["CJK Symbols and Punctuation"](n)||bi["CJK Unified Ideographs Extension A"](n)||bi["CJK Unified Ideographs"](n)||bi["Enclosed CJK Letters and Months"](n)||bi["Halfwidth and Fullwidth Forms"](n)||bi.Hiragana(n)||bi["Ideographic Description Characters"](n)||bi["Kangxi Radicals"](n)||bi["Katakana Phonetic Extensions"](n)||bi.Katakana(n)||bi["Vertical Forms"](n)||bi["Yi Radicals"](n)||bi["Yi Syllables"](n)))&&a.push(Xu(u+1,s,o,a,Zu(c,t.getCharCode(u+1)),!1))}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Xu(t.length(),s,o,a,0,!0))}function Hu(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Yu(t,e,r,i,n){if(n){var a=t[i],o=e[a.fontStack],s=o&&o[a.glyph];if(s)for(var u=s.metrics.advance*a.scale,l=(t[i].x+u)*n,c=r;c<=i;c++)t[c].x-=l}}function Ku(t,e,r){var i=Hu(r),n=i.horizontalAlign,a=i.verticalAlign,o=e[0],s=e[1],u=o-t.displaySize[0]*n,l=u+t.displaySize[0],c=s-t.displaySize[1]*a;return{image:t,top:c,bottom:c+t.displaySize[1],left:u,right:l}}function Ju(t,e,r,i,n){if(void 0===e.segment)return!0;for(var a=e,o=e.segment+1,s=0;s>-r/2;){if(--o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;for(var u=[],l=0;s<r/2;){var c=t[o-1],h=t[o],p=t[o+1];if(!p)return!1;var f=c.angleTo(h)-h.angleTo(p);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),l+=f;s-u[0].distance>i;)l-=u.shift().angleDelta;if(l>n)return!1;o++,s+=h.dist(p)}return!0}function Qu(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function $u(t,e,r){return t?.6*e*r:0}function tl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function el(t,e,r,i,n,a){for(var o=$u(r,n,a),s=tl(r,i)*a,u=0,l=Qu(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,v=ye(h.x,p.x,d),m=ye(h.y,p.y,d),g=new fs(v,m,p.angleTo(h),c);return g._round(),!o||Ju(t,g,s,o,e)?g:void 0}u+=f}}function rl(t,e,r,i,n,a,o,s,u){var l=$u(i,a,o),c=tl(i,n),h=c*o,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,r,i,n,a,o,s,u,l){for(var c=o/2,h=Qu(e),p=0,f=r-i,d=[],v=0;v<e.length-1;v++){for(var m=e[v],g=e[v+1],y=m.dist(g),_=g.angleTo(m);f+i<p+y;){var b=((f+=i)-p)/y,x=ye(m.x,g.x,b),w=ye(m.y,g.y,b);if(x>=0&&x<l&&w>=0&&w<l&&f-c>=0&&f+c<=h){var k=new fs(x,w,_,v);k._round(),n&&!Ju(e,k,o,n,a)||d.push(k)}}p+=y}return u||d.length||s||(d=t(e,p/2,i,n,a,o,s,!0,l)),d}(t,p?e/2*s%e:(c/2+2*a)*o*s%e,e,l,r,h,p,!1,u)}Gu[10]=!0,Gu[32]=!0,Gu[38]=!0,Gu[40]=!0,Gu[41]=!0,Gu[43]=!0,Gu[45]=!0,Gu[47]=!0,Gu[173]=!0,Gu[183]=!0,Gu[8203]=!0,Gu[8208]=!0,Gu[8211]=!0,Gu[8231]=!0;var il=function(t,e,r,i,a,o,s,u,l,c,h,p){var f=s.top*u-l,d=s.bottom*u+l,v=s.left*u-l,m=s.right*u+l;if(this.boxStartIndex=t.length,c){var g=d-f,y=m-v;g>0&&(g=Math.max(10*u,g),this._addLineCollisionCircles(t,e,r,r.segment,y,g,i,a,o,h))}else{if(p){var _=new n(v,f),b=new n(m,f),x=new n(v,d),w=new n(m,d),k=p*Math.PI/180;_._rotate(k),b._rotate(k),x._rotate(k),w._rotate(k),v=Math.min(_.x,b.x,x.x,w.x),m=Math.max(_.x,b.x,x.x,w.x),f=Math.min(_.y,b.y,x.y,w.y),d=Math.max(_.y,b.y,x.y,w.y)}t.emplaceBack(r.x,r.y,v,f,m,d,i,a,o,0,0)}this.boxEndIndex=t.length};il.prototype._addLineCollisionCircles=function(t,e,r,i,n,a,o,s,u,l){var c=a/2,h=Math.floor(n/c)||1,p=1+.4*Math.log(l)/Math.LN2,f=Math.floor(h*p/2),d=-a/2,v=r,m=i+1,g=d,y=-n/2,_=y-n/4;do{if(--m<0){if(g>y)return;m=0;break}g-=e[m].dist(v),v=e[m]}while(g>_);for(var b=e[m].dist(e[m+1]),x=-f;x<h+f;x++){var w=x*c,k=y+w;if(w<0&&(k+=w),w>n&&(k+=w-n),!(k<g)){for(;g+b<k;){if(g+=b,++m+1>=e.length)return;b=e[m].dist(e[m+1])}var E=k-g,S=e[m],T=e[m+1].sub(S)._unit()._mult(E)._add(S)._round(),A=Math.abs(k-d)<c?0:.8*(k-d);t.emplaceBack(T.x,T.y,-a/2,-a/2,a/2,a/2,o,s,u,a/2,A)}}};var nl=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=al),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function al(t,e){return t<e?-1:t>e?1:0}function ol(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var i=1/0,a=1/0,o=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<i)&&(i=c.x),(!l||c.y<a)&&(a=c.y),(!l||c.x>o)&&(o=c.x),(!l||c.y>s)&&(s=c.y)}var h=o-i,p=s-a,f=Math.min(h,p),d=f/2,v=new nl([],sl);if(0===f)return new n(i,a);for(var m=i;m<o;m+=f)for(var g=a;g<s;g+=f)v.push(new ul(m+d,g+d,d,t));for(var y=function(t){for(var e=0,r=0,i=0,n=t[0],a=0,o=n.length,s=o-1;a<o;s=a++){var u=n[a],l=n[s],c=u.x*l.y-l.x*u.y;r+=(u.x+l.x)*c,i+=(u.y+l.y)*c,e+=3*c}return new ul(r/e,i/e,0,t)}(t),_=v.length;v.length;){var b=v.pop();(b.d>y.d||!y.d)&&(y=b,r&&console.log("found best %d after %d probes",Math.round(1e4*b.d)/1e4,_)),b.max-y.d<=e||(d=b.h/2,v.push(new ul(b.p.x-d,b.p.y-d,d,t)),v.push(new ul(b.p.x+d,b.p.y-d,d,t)),v.push(new ul(b.p.x-d,b.p.y+d,d,t)),v.push(new ul(b.p.x+d,b.p.y+d,d,t)),_+=4)}return r&&(console.log("num probes: "+_),console.log("best distance: "+y.d)),y.p}function sl(t,e){return e.max-t.max}function ul(t,e,r,i){this.p=new n(t,e),this.h=r,this.d=function(t,e){for(var r=!1,i=1/0,n=0;n<e.length;n++)for(var a=e[n],o=0,s=a.length,u=s-1;o<s;u=o++){var l=a[o],c=a[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(r=!r),i=Math.min(i,ma(t,l,c))}return(r?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}nl.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},nl.prototype.pop=function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},nl.prototype.peek=function(){return this.data[0]},nl.prototype._up=function(t){for(var e=this.data,r=this.compare,i=e[t];t>0;){var n=t-1>>1,a=e[n];if(r(i,a)>=0)break;e[t]=a,t=n}e[t]=i},nl.prototype._down=function(t){for(var e=this.data,r=this.compare,i=this.length>>1,n=e[t];t<i;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&r(e[s],o)<0&&(a=s,o=e[s]),r(o,n)>=0)break;e[t]=o,t=a}e[t]=n};var ll=e(function(t){t.exports=function(t,e){var r,i,n,a,o,s,u,l;for(r=3&t.length,i=t.length-r,n=e,o=3432918353,s=461845907,l=0;l<i;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,n=27492+(65535&(a=5*(65535&(n=(n^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:n^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return n^=t.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0}}),cl=e(function(t){t.exports=function(t,e){for(var r,i=t.length,n=e^i,a=0;i>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),i-=4,++a;switch(i){case 3:n^=(255&t.charCodeAt(a+2))<<16;case 2:n^=(255&t.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0}}),hl=ll,pl=ll,fl=cl;hl.murmur3=pl,hl.murmur2=fl;var dl=7;function vl(t,e){var r=0,i=0,n=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":i=n-dl;break;case"bottom-right":case"bottom-left":i=-n+dl;break;case"bottom":i=-e+dl;break;case"top":i=e-dl}switch(t){case"top-right":case"bottom-right":r=-n;break;case"top-left":case"bottom-left":r=n;break;case"left":r=e;break;case"right":r=-e}return[r,i]}function ml(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gl(t,e,r,i,a,o,s){var u=o.layoutTextSize.evaluate(e,{}),l=o.layoutIconSize.evaluate(e,{}),c=o.textMaxSize.evaluate(e,{});void 0===c&&(c=u);var h=t.layers[0].layout,p=h.get("icon-offset").evaluate(e,{}),f=bl(r.horizontal),d=u/24,v=t.tilePixelRatio*d,m=t.tilePixelRatio*c/24,g=t.tilePixelRatio*l,y=t.tilePixelRatio*h.get("symbol-spacing"),_=h.get("text-padding")*t.tilePixelRatio,b=h.get("icon-padding")*t.tilePixelRatio,x=h.get("text-max-angle")/180*Math.PI,k="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),E="map"===h.get("icon-rotation-alignment")&&"point"!==h.get("symbol-placement"),S=h.get("symbol-placement"),T=y/2,A=function(u,l){l.x<0||l.x>=na||l.y<0||l.y>=na||function(t,e,r,i,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x){var k,E,S=t.addToLineVertexArray(e,r),T=0,A=0,P=0,O={},I=hl(""),M=(o.layout.get("text-radial-offset").evaluate(_,{})||0)*Du;for(var C in i.horizontal){var L=i.horizontal[C];if(!k){I=hl(L.text);var j=o.layout.get("text-rotate").evaluate(_,{});k=new il(s,r,e,u,l,c,L,h,p,f,t.overscaling,j)}var z=1===L.lineCount;if(A+=_l(t,e,L,o,f,_,d,S,i.vertical?Bu.horizontal:Bu.horizontalOnly,z?Object.keys(i.horizontal):[C],O,b,x),z)break}i.vertical&&(P+=_l(t,e,i.vertical,o,f,_,d,S,Bu.vertical,["vertical"],O,b,x));var R=k?k.boxStartIndex:t.collisionBoxArray.length,F=k?k.boxEndIndex:t.collisionBoxArray.length;if(a){var D=function(t,e,r,i,a,o){var s,u,l,c,h=e.image,p=r.layout,f=e.top-1/h.pixelRatio,d=e.left-1/h.pixelRatio,v=e.bottom+1/h.pixelRatio,m=e.right+1/h.pixelRatio;if("none"!==p.get("icon-text-fit")&&a){var g=m-d,y=v-f,_=p.get("text-size").evaluate(o,{})/24,b=a.left*_,x=a.right*_,w=a.top*_,k=x-b,E=a.bottom*_-w,S=p.get("icon-text-fit-padding")[0],T=p.get("icon-text-fit-padding")[1],A=p.get("icon-text-fit-padding")[2],P=p.get("icon-text-fit-padding")[3],O="width"===p.get("icon-text-fit")?.5*(E-y):0,I="height"===p.get("icon-text-fit")?.5*(k-g):0,M="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?k:g,C="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?E:y;s=new n(b+I-P,w+O-S),u=new n(b+I+T+M,w+O-S),l=new n(b+I+T+M,w+O+A+C),c=new n(b+I-P,w+O+A+C)}else s=new n(d,f),u=new n(m,f),l=new n(m,v),c=new n(d,v);var L=r.layout.get("icon-rotate").evaluate(o,{})*Math.PI/180;if(L){var j=Math.sin(L),z=Math.cos(L),R=[z,-j,j,z];s._matMult(R),u._matMult(R),c._matMult(R),l._matMult(R)}return[{tl:s,tr:u,bl:c,br:l,tex:h.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,a,o,0,bl(i.horizontal),_),B=o.layout.get("icon-rotate").evaluate(_,{});E=new il(s,r,e,u,l,c,a,v,m,!1,t.overscaling,B),T=4*D.length;var N=t.iconSizeData,U=null;"source"===N.functionType?(U=[ds*o.layout.get("icon-size").evaluate(_,{})])[0]>yl&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'):"composite"===N.functionType&&((U=[ds*x.compositeIconSizes[0].evaluate(_,{}),ds*x.compositeIconSizes[1].evaluate(_,{})])[0]>yl||U[1]>yl)&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'),t.addSymbols(t.icon,D,U,y,g,_,!1,e,S.lineStartIndex,S.lineLength)}var V=E?E.boxStartIndex:t.collisionBoxArray.length,G=E?E.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=Ss.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),t.symbolInstances.emplaceBack(e.x,e.y,O.right>=0?O.right:-1,O.center>=0?O.center:-1,O.left>=0?O.left:-1,O.vertical||-1,I,R,F,V,G,u,A,P,T,0,h,M)}(t,l,u,r,i,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,v,_,k,s,g,b,E,p,e,a,o)};if("line"===S)for(var P=0,O=function(t,e,r,i,a){for(var o=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<0&&p.x<0||(h.x<0?h=new n(0,h.y+(p.y-h.y)*((0-h.x)/(p.x-h.x)))._round():p.x<0&&(p=new n(0,h.y+(p.y-h.y)*((0-h.x)/(p.x-h.x)))._round()),h.y<0&&p.y<0||(h.y<0?h=new n(h.x+(p.x-h.x)*((0-h.y)/(p.y-h.y)),0)._round():p.y<0&&(p=new n(h.x+(p.x-h.x)*((0-h.y)/(p.y-h.y)),0)._round()),h.x>=i&&p.x>=i||(h.x>=i?h=new n(i,h.y+(p.y-h.y)*((i-h.x)/(p.x-h.x)))._round():p.x>=i&&(p=new n(i,h.y+(p.y-h.y)*((i-h.x)/(p.x-h.x)))._round()),h.y>=a&&p.y>=a||(h.y>=a?h=new n(h.x+(p.x-h.x)*((a-h.y)/(p.y-h.y)),a)._round():p.y>=a&&(p=new n(h.x+(p.x-h.x)*((a-h.y)/(p.y-h.y)),a)._round()),l&&h.equals(l[l.length-1])||(l=[h],o.push(l)),l.push(p)))))}return o}(e.geometry,0,0,na,na);P<O.length;P+=1)for(var I=O[P],M=0,C=rl(I,y,x,r.vertical||f,i,24,m,t.overscaling,na);M<C.length;M+=1){var L=C[M];f&&xl(t,f.text,T,L)||A(I,L)}else if("line-center"===S)for(var j=0,z=e.geometry;j<z.length;j+=1){var R=z[j];if(R.length>1){var F=el(R,x,r.vertical||f,i,24,m);F&&A(R,F)}}else if("Polygon"===e.type)for(var D=0,B=_o(e.geometry,0);D<B.length;D+=1){var N=B[D],U=ol(N,16);A(N[0],new fs(U.x,U.y,0))}else if("LineString"===e.type)for(var V=0,G=e.geometry;V<G.length;V+=1){var q=G[V];A(q,new fs(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var Z=0,X=e.geometry;Z<X.length;Z+=1)for(var W=0,H=X[Z];W<H.length;W+=1){var Y=H[W];A([Y],new fs(Y.x,Y.y,0))}}var yl=65535;function _l(t,e,r,i,a,o,s,u,l,c,h,p,f){var d=function(t,e,r,i,a,o,s){for(var u=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,l=e.positionedGlyphs,c=[],h=0;h<l.length;h++){var p=l[h],f=s[p.fontStack],d=f&&f[p.glyph];if(d){var v=d.rect;if(v){var m=fu+1,g=d.metrics.advance*p.scale/2,y=a?[p.x+g,p.y]:[0,0],_=a?[0,0]:[p.x+g+r[0],p.y+r[1]],b=(d.metrics.left-m)*p.scale-g+_[0],x=(-d.metrics.top-m)*p.scale+_[1],w=b+v.w*p.scale,k=x+v.h*p.scale,E=new n(b,x),S=new n(w,x),T=new n(b,k),A=new n(w,k);if(a&&p.vertical){var P=new n(-g,g),O=-Math.PI/2,I=new n(5,0);E._rotateAround(O,P)._add(I),S._rotateAround(O,P)._add(I),T._rotateAround(O,P)._add(I),A._rotateAround(O,P)._add(I)}if(u){var M=Math.sin(u),C=Math.cos(u),L=[C,-M,M,C];E._matMult(L),S._matMult(L),T._matMult(L),A._matMult(L)}c.push({tl:E,tr:S,bl:T,br:A,tex:v,writingMode:e.writingMode,glyphOffset:y})}}}return c}(0,r,s,i,a,o,p),v=t.textSizeData,m=null;"source"===v.functionType?(m=[ds*i.layout.get("text-size").evaluate(o,{})])[0]>yl&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'):"composite"===v.functionType&&((m=[ds*f.compositeTextSizes[0].evaluate(o,{}),ds*f.compositeTextSizes[1].evaluate(o,{})])[0]>yl||m[1]>yl)&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'),t.addSymbols(t.text,d,m,s,a,o,l,e,u.lineStartIndex,u.lineLength);for(var g=0,y=c;g<y.length;g+=1)h[y[g]]=t.text.placedSymbolArray.length-1;return 4*d.length}function bl(t){for(var e in t)return t[e];return null}function xl(t,e,r,i){var n=t.compareText;if(e in n){for(var a=n[e],o=a.length-1;o>=0;o--)if(i.dist(a[o])<r)return!0}else n[e]=[];return n[e].push(i),!1}t.Actor=du,t.AlphaImage=Ra,t.CanonicalTileID=Eu,t.CollisionBoxArray=kn,t.Color=Wt,t.DEMData=Pu,t.DataConstantProperty=Vi,t.DictionaryCoder=Iu,t.EXTENT=na,t.ErrorEvent=kt,t.EvaluationParameters=Li,t.Event=wt,t.Evented=Et,t.FeatureIndex=ju,t.FillBucket=ko,t.FillExtrusionBucket=Bo,t.ImageAtlas=Ds,t.ImagePosition=Rs,t.LineBucket=$o,t.LngLat=gu,t.LngLatBounds=mu,t.MercatorCoordinate=ku,t.ONE_EM=Du,t.OverscaledTileID=Tu,t.Point=n,t.Point$1=n,t.ProgramConfiguration=ta,t.Properties=Wi,t.Protobuf=Xs,t.RGBAImage=Fa,t.RequestManager=B,t.ResourceType=ct,t.SegmentVector=zn,t.SourceFeatureState=Lu,t.StructArrayLayout1ui2=_n,t.StructArrayLayout2i4=tn,t.StructArrayLayout2ui4=yn,t.StructArrayLayout3ui6=gn,t.StructArrayLayout4i8=en,t.SymbolBucket=Ss,t.Texture=Gs,t.Tile=Fu,t.Transitionable=Ri,t.Uniform1f=Un,t.Uniform1i=Nn,t.Uniform2f=Vn,t.Uniform3f=Gn,t.Uniform4f=qn,t.UniformColor=Zn,t.UniformMatrix4f=Wn,t.UnwrappedTileID=Su,t.ValidationError=Tt,t.WritingMode=Bu,t.ZoomHistory=_i,t.addDynamicAttributes=ws,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var i=t.length,n=new Array(t.length),a=null;t.forEach(function(t,o){e(t,function(t,e){t&&(a=t),n[o]=e,0==--i&&r(a,n)})})},t.bezier=s,t.bindAll=m,t.browser=C,t.clamp=l,t.clone=function(t){var e=new Ea(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=b,t.config=L,t.create=function(){var t=new Ea(16);return Ea!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=Sa,t.create$2=function(){var t=new Ea(4);return Ea!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Er,t.createLayout=Qi,t.createStyleLayer=function(t){return"custom"===t.type?new Ls(t):new js[t.type](t)},t.deepEqual=o,t.ease=u,t.emitValidationErrors=li,t.endsWith=g,t.evaluateRadialOffset=vl,t.evaluateSizeForFeature=ms,t.evaluateSizeForZoom=gs,t.evented=Mi,t.extend=h,t.featureFilter=Dr,t.filterObject=_,t.fromRotation=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Hu,t.getAnchorJustification=ml,t.getArrayBuffer=gt,t.getImage=_t,t.getJSON=function(t,e){return mt(h(t,{type:"json"}),e)},t.getReferrer=vt,t.getVideo=function(t,e){var r,i,n=self.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(var a=0;a<t.length;a++){var o=self.document.createElement("source");r=t[a],i=void 0,(i=self.document.createElement("a")).href=r,(i.protocol!==self.document.location.protocol||i.host!==self.document.location.host)&&(n.crossOrigin="Anonymous"),o.src=t[a],n.appendChild(o)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=r*s-i*o,_=r*u-n*o,b=r*l-a*o,x=i*u-n*s,w=i*l-a*s,k=n*l-a*u,E=c*v-h*d,S=c*m-p*d,T=c*g-f*d,A=h*m-p*v,P=h*g-f*v,O=p*g-f*m,I=y*O-_*P+b*A+x*T-w*S+k*E;return I?(I=1/I,t[0]=(s*O-u*P+l*A)*I,t[1]=(n*P-i*O-a*A)*I,t[2]=(v*k-m*w+g*x)*I,t[3]=(p*w-h*k-f*x)*I,t[4]=(u*T-o*O-l*S)*I,t[5]=(r*O-n*T+a*S)*I,t[6]=(m*b-d*k-g*_)*I,t[7]=(c*k-p*b+f*_)*I,t[8]=(o*P-s*T+l*E)*I,t[9]=(i*T-r*P-a*E)*I,t[10]=(d*w-v*b+g*y)*I,t[11]=(h*b-c*w-f*y)*I,t[12]=(s*S-o*A-u*E)*I,t[13]=(r*A-i*S+n*E)*I,t[14]=(v*_-d*x-m*y)*I,t[15]=(c*x-h*_+p*y)*I,t):null},t.isChar=bi,t.isMapboxURL=V,t.keysDifference=function(t,e){var r=[];for(var i in t)i in e||r.push(i);return r},t.makeRequest=mt,t.mapObject=y,t.mercatorXfromLng=_u,t.mercatorYfromLat=bu,t.mercatorZfromAltitude=xu,t.multiply=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*i+b*s+x*h+w*v,t[1]=_*n+b*u+x*p+w*m,t[2]=_*a+b*l+x*f+w*g,t[3]=_*o+b*c+x*d+w*y,_=r[4],b=r[5],x=r[6],w=r[7],t[4]=_*i+b*s+x*h+w*v,t[5]=_*n+b*u+x*p+w*m,t[6]=_*a+b*l+x*f+w*g,t[7]=_*o+b*c+x*d+w*y,_=r[8],b=r[9],x=r[10],w=r[11],t[8]=_*i+b*s+x*h+w*v,t[9]=_*n+b*u+x*p+w*m,t[10]=_*a+b*l+x*f+w*g,t[11]=_*o+b*c+x*d+w*y,_=r[12],b=r[13],x=r[14],w=r[15],t[12]=_*i+b*s+x*h+w*v,t[13]=_*n+b*u+x*p+w*m,t[14]=_*a+b*l+x*f+w*g,t[15]=_*o+b*c+x*d+w*y,t},t.mvt=zo,t.number=ye,t.ortho=function(t,e,r,i,n,a,o){var s=1/(e-r),u=1/(i-n),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*u,t[14]=(o+a)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Xs(t).readFields(cu,[])},t.pbf=Xs,t.performSymbolLayout=function(t,e,r,i,n,a){t.createArrays();var o=512*t.overscaling;t.tilePixelRatio=na/o,t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.functionType){var c=t.textSizeData.zoomRange,h=c.min,p=c.max;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Li(h)),u["text-size"].possiblyEvaluate(new Li(p))]}if("composite"===t.iconSizeData.functionType){var f=t.iconSizeData.zoomRange,d=f.min,v=f.max;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Li(d)),u["icon-size"].possiblyEvaluate(new Li(v))]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new Li(t.zoom+1)),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new Li(t.zoom+1)),l.textMaxSize=u["text-size"].possiblyEvaluate(new Li(18));for(var m=s.get("text-line-height")*Du,g="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),y=s.get("text-keep-upright"),_=0,b=t.features;_<b.length;_+=1){var x=b[_],k=s.get("text-font").evaluate(x,{}).join(","),E=r,S={horizontal:{},vertical:void 0},T=x.text,A=[0,0];if(T){var P=T.toString(),O=s.get("text-letter-spacing").evaluate(x,{})*Du,I=wi(P)?O:0,M=s.get("text-anchor").evaluate(x,{}),C=s.get("text-variable-anchor"),L=s.get("text-radial-offset").evaluate(x,{});C||(A=L?vl(M,L*Du):s.get("text-offset").evaluate(x,{}).map(function(t){return t*Du}));var j=g?"center":s.get("text-justify").evaluate(x,{}),z="point"===s.get("symbol-placement")?s.get("text-max-width").evaluate(x,{})*Du:0;if(!g&&C)for(var R="auto"===j?C.map(function(t){return ml(t)}):[j],F=!1,D=0;D<R.length;D++){var B=R[D];if(!S.horizontal[B])if(F)S.horizontal[B]=S.horizontal[0];else{var N=Uu(T,e,k,z,m,"center",B,I,A,Bu.horizontal);N&&(S.horizontal[B]=N,F=1===N.lineCount)}}else{"auto"===j&&(j=ml(M));var U=Uu(T,e,k,z,m,M,j,I,A,Bu.horizontal);U&&(S.horizontal[j]=U),xi(P)&&g&&y&&(S.vertical=Uu(T,e,k,z,m,M,j,I,A,Bu.vertical))}}var V=void 0;if(x.icon){var G=i[x.icon];G&&(V=Ku(n[x.icon],s.get("icon-offset").evaluate(x,{}),s.get("icon-anchor").evaluate(x,{})),void 0===t.sdfIcons?t.sdfIcons=G.sdf:t.sdfIcons!==G.sdf&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),G.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(Object.keys(S.horizontal).length||V)&&gl(t,x,S,V,E,l,A)}a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,i,n){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(a=1/(i-n),t[10]=(n+i)*a,t[14]=2*n*i*a):(t[10]=-1,t[14]=-2*i),t},t.pick=function(t,e){for(var r={},i=0;i<e.length;i++){var n=e[i];n in t&&(r[n]=t[n])}return r},t.plugin=Ci,t.polygonIntersectsPolygon=la,t.postMapLoadEvent=lt,t.postTurnstileEvent=st,t.potpack=zs,t.properties=As,t.rasterBoundsAttributes=Ou,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=vi,t.registerForPluginAvailability=function(t){return Oi?t({pluginURL:Oi,completionCallback:Ai}):Mi.once("pluginAvailable",t),t},t.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u+a*s,t[1]=n*u+o*s,t[2]=i*-s+a*u,t[3]=n*-s+o*u,t},t.rotateX=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+l*i,t[5]=o*n+c*i,t[6]=s*n+h*i,t[7]=u*n+p*i,t[8]=l*n-a*i,t[9]=c*n-o*i,t[10]=h*n-s*i,t[11]=p*n-u*i,t},t.rotateZ=function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+l*i,t[1]=o*n+c*i,t[2]=s*n+h*i,t[3]=u*n+p*i,t[4]=l*n-a*i,t[5]=c*n-o*i,t[6]=h*n-s*i,t[7]=p*n-u*i,t},t.scale=function(t,e,r){var i=r[0],n=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.setRTLTextPlugin=function(t,e){if(Pi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Pi=!0,Oi=C.resolveURL(t),Ai=function(t){t?(Pi=!1,Oi=null,e&&e(t)):Ii=!0},Mi.fire(new wt("pluginAvailable",{pluginURL:Oi,completionCallback:Ai}))},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],i=t[2];return r+=90,r*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(i),y:e*Math.sin(r)*Math.sin(i),z:e*Math.cos(i)}},t.styleSpec=St,t.symbolSize=ys,t.transformMat3=function(t,e,r){var i=e[0],n=e[1],a=e[2];return t[0]=i*r[0]+n*r[3]+a*r[6],t[1]=i*r[1]+n*r[4]+a*r[7],t[2]=i*r[2]+n*r[5]+a*r[8],t},t.transformMat4=Pa,t.translate=function(t,e,r){var i,n,a,o,s,u,l,c,h,p,f,d,v=r[0],m=r[1],g=r[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*v+s*m+h*g+e[12],t[13]=n*v+u*m+p*g+e[13],t[14]=a*v+l*m+f*g+e[14],t[15]=o*v+c*m+d*g+e[15]),t},t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=oi,t.validateStyle=ai,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=zo,t.version="1.0.0",t.warnOnce=w,t.webpSupported=j,t.window=self,t.wrap=c}),i(0,function(t){function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",n=0,a=t;n<a.length;n+=1)i+=e(a[n])+",";return i+"]"}for(var o=Object.keys(t).sort(),s="{",u=0;u<o.length;u++)s+=JSON.stringify(o[u])+":"+e(t[o[u]])+",";return s+"}"}function r(r){for(var i="",n=0,a=t.refProperties;n<a.length;n+=1)i+="/"+e(r[a[n]]);return i}var i=function(t){t&&this.replace(t)};i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},i.prototype.update=function(e,i){for(var n=this,a=0,o=e;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter)}for(var l=0,c=i;l<c.length;l+=1){var h=c[l];delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t){for(var e={},i=0;i<t.length;i++){var n=r(t[i]),a=e[n];a||(a=e[n]=[]),a.push(t[i])}var o=[];for(var s in e)o.push(e[s]);return o}(t.values(this._layerConfigs));p<f.length;p+=1){var d=f[p].map(function(t){return n._layers[t.id]}),v=d[0];if("none"!==v.visibility){var m=v.source||"",g=this.familiesBySource[m];g||(g=this.familiesBySource[m]={});var y=v.sourceLayer||"_geojsonTileLayer",_=g[y];_||(_=g[y]=[]),_.push(d)}}};var n=function(e){var r={},i=[];for(var n in e){var a=e[n],o=r[n]={};for(var s in a){var u=a[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};i.push(l),o[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(i),h=c.w,p=c.h,f=new t.AlphaImage({width:h||1,height:p||1});for(var d in e){var v=e[d];for(var m in v){var g=v[+m];if(g&&0!==g.bitmap.width&&0!==g.bitmap.height){var y=r[d][m].rect;t.AlphaImage.copy(g.bitmap,f,{x:0,y:0},{x:y.x+1,y:y.y+1},g.bitmap)}}}this.image=f,this.positions=r};t.register("GlyphAtlas",n);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies};function o(e,r){for(var i=new t.EvaluationParameters(r),n=0,a=e;n<a.length;n+=1)a[n].recalculate(i)}a.prototype.parse=function(e,r,i,a){var s=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var u=new t.DictionaryCoder(Object.keys(e.layers).sort()),l=new t.FeatureIndex(this.tileID);l.bucketLayerIDs=[];var c,h,p,f,d={},v={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{}},m=r.familiesBySource[this.source];for(var g in m){var y=e.layers[g];if(y){1===y.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+g+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var _=u.encode(g),b=[],x=0;x<y.length;x++){var w=y.feature(x);b.push({feature:w,index:x,sourceLayerIndex:_})}for(var k=0,E=m[g];k<E.length;k+=1){var S=E[k],T=S[0];T.minzoom&&this.zoom<Math.floor(T.minzoom)||T.maxzoom&&this.zoom>=T.maxzoom||"none"!==T.visibility&&(o(S,this.zoom),(d[T.id]=T.createBucket({index:l.bucketLayerIDs.length,layers:S,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_,sourceID:this.source})).populate(b,v),l.bucketLayerIDs.push(S.map(function(t){return t.id})))}}}var A=t.mapObject(v.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(A).length?i.send("getGlyphs",{uid:this.uid,stacks:A},function(t,e){c||(c=t,h=e,I.call(s))}):h={};var P=Object.keys(v.iconDependencies);P.length?i.send("getImages",{icons:P},function(t,e){c||(c=t,p=e,I.call(s))}):p={};var O=Object.keys(v.patternDependencies);function I(){if(c)return a(c);if(h&&p&&f){var e=new n(h),r=new t.ImageAtlas(p,f);for(var i in d){var s=d[i];s instanceof t.SymbolBucket?(o(s.layers,this.zoom),t.performSymbolLayout(s,h,e.positions,p,r.iconPositions,this.showCollisionBoxes)):s.hasPattern&&(s instanceof t.LineBucket||s instanceof t.FillBucket||s instanceof t.FillExtrusionBucket)&&(o(s.layers,this.zoom),s.addFeatures(v,r.patternPositions))}this.status="done",a(null,{buckets:t.values(d).filter(function(t){return!t.isEmpty()}),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?h:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}O.length?i.send("getImages",{icons:O},function(t,e){c||(c=t,f=e,I.call(s))}):f={},I.call(this)};var s="undefined"!=typeof performance,u={getEntriesByName:function(t){return!!(s&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(s&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,r){return!!(s&&performance&&performance.measure)&&performance.measure(t,e,r)},clearMarks:function(t){return!!(s&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(s&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},l=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},u.mark(this._marks.start)};function c(e,r){var i=t.getArrayBuffer(e.request,function(e,i,n,a){e?r(e):i&&r(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(i)),rawData:i,cacheControl:n,expires:a})});return function(){i.cancel(),r()}}l.prototype.finish=function(){u.mark(this._marks.end);var t=u.getEntriesByName(this._marks.measure);return 0===t.length&&(u.measure(this._marks.measure,this._marks.start,this._marks.end),t=u.getEntriesByName(this._marks.measure),u.clearMarks(this._marks.start),u.clearMarks(this._marks.end),u.clearMeasures(this._marks.measure)),t},u.Performance=l;var h=function(t,e,r){this.actor=t,this.layerIndex=e,this.loadVectorData=r||c,this.loading={},this.loaded={}};h.prototype.loadTile=function(e,r){var i=this,n=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new u.Performance(e.request),s=this.loading[n]=new a(e);s.abort=this.loadVectorData(e,function(e,a){if(delete i.loading[n],e||!a)return s.status="done",i.loaded[n]=s,r(e);var u=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var c={};if(o){var h=o.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,i.layerIndex,i.actor,function(e,i){if(e||!i)return r(e);r(null,t.extend({rawTileData:u.slice(0)},i,l,c))}),i.loaded=i.loaded||{},i.loaded[n]=s})},h.prototype.reloadTile=function(t,e){var r=this.loaded,i=t.uid,n=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=t.showCollisionBoxes;var o=function(t,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,n.layerIndex,n.actor,i)),e(t,r)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.actor,o):o())}},h.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),e()},h.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e()};var p=function(){this.loaded={}};p.prototype.loadTile=function(e,r){var i=e.uid,n=e.encoding,a=e.rawImageData,o=new t.DEMData(i,a,n);this.loaded=this.loaded||{},this.loaded[i]=o,r(null,o)},p.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var f={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function d(t){var e=0;if(t&&t.length>0){e+=Math.abs(v(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(v(t[r]))}return e}function v(t){var e,r,i,n,a,o,s=0,u=t.length;if(u>2){for(o=0;o<u;o++)o===u-2?(i=u-2,n=u-1,a=0):o===u-1?(i=u-1,n=0,a=1):(i=o,n=o+1,a=o+2),e=t[i],r=t[n],s+=(m(t[a][0])-m(e[0]))*Math.sin(m(r[1]));s=s*f.RADIUS*f.RADIUS/2}return s}function m(t){return t*Math.PI/180}var g={geometry:function t(e){var r,i=0;switch(e.type){case"Polygon":return d(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)i+=d(e.coordinates[r]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)i+=t(e.geometries[r]);return i}},ring:v};function y(t,e){return function(r){return t(r,e)}}function _(t,e){e=!!e,t[0]=b(t[0],e);for(var r=1;r<t.length;r++)t[r]=b(t[r],!e);return t}function b(t,e){return function(t){return g.ring(t)>=0}(t)===e?t:t.reverse()}var x=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,w=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};w.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,i=this._feature.geometry;r<i.length;r+=1){var n=i[r];e.push([new t.Point$1(n[0],n[1])])}return e}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var u=[],l=0,c=s[o];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}a.push(u)}return a},w.prototype.toGeoJSON=function(t,e,r){return x.call(this,t,e,r)};var k=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};k.prototype.feature=function(t){return new w(this._features[t])};var E=t.vectorTile.VectorTileFeature,S=T;function T(t,e){this.options=e||{},this.features=t,this.length=t.length}function A(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}T.prototype.feature=function(t){return new A(this.features[t],this.options.extent)},A.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var i=e[r],n=[],a=0;a<i.length;a++)n.push(new t.Point$1(i[a][0],i[a][1]));this.geometry.push(n)}return this.geometry},A.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,i=1/0,n=-1/0,a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var u=o[s];e=Math.min(e,u.x),r=Math.max(r,u.x),i=Math.min(i,u.y),n=Math.max(n,u.y)}return[e,i,r,n]},A.prototype.toGeoJSON=E.prototype.toGeoJSON;var P=M,O=M,I=S;function M(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,C,t.layers[r])}(e,r),r.finish()}function C(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)i.feature=t.feature(r),e.writeMessage(2,L,i);var n=i.keys;for(r=0;r<n.length;r++)e.writeStringField(3,n[r]);var a=i.values;for(r=0;r<a.length;r++)e.writeMessage(4,D,a[r])}function L(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,j,t),e.writeVarintField(3,r.type),e.writeMessage(4,F,r)}function j(t,e){var r=t.feature,i=t.keys,n=t.values,a=t.keycache,o=t.valuecache;for(var s in r.properties){var u=a[s];void 0===u&&(i.push(s),u=i.length-1,a[s]=u),e.writeVarint(u);var l=r.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=o[h];void 0===p&&(n.push(l),p=n.length-1,o[h]=p),e.writeVarint(p)}}function z(t,e){return(e<<3)+(7&t)}function R(t){return t<<1^t>>31}function F(t,e){for(var r=t.loadGeometry(),i=t.type,n=0,a=0,o=r.length,s=0;s<o;s++){var u=r[s],l=1;1===i&&(l=u.length),e.writeVarint(z(1,l));for(var c=3===i?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==i&&e.writeVarint(z(2,c-1));var p=u[h].x-n,f=u[h].y-a;e.writeVarint(R(p)),e.writeVarint(R(f)),n+=p,a+=f}3===i&&e.writeVarint(z(7,1))}}function D(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function B(t,e,r,i){N(t,r,i),N(e,2*r,2*i),N(e,2*r+1,2*i+1)}function N(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function U(t,e,r,i){var n=t-r,a=e-i;return n*n+a*a}P.fromVectorTileJs=O,P.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var i in t)r[i]=new S(t[i].features,e),r[i].name=i,r[i].version=e.version,r[i].extent=e.extent;return M({layers:r})},P.GeoJSONWrapper=I;var V=function(t){return t[0]},G=function(t){return t[1]},q=function(t,e,r,i,n){void 0===e&&(e=V),void 0===r&&(r=G),void 0===i&&(i=64),void 0===n&&(n=Float64Array),this.nodeSize=i,this.points=t;for(var a=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(t.length),s=this.coords=new n(2*t.length),u=0;u<t.length;u++)o[u]=u,s[2*u]=e(t[u]),s[2*u+1]=r(t[u]);!function t(e,r,i,n,a,o){if(!(a-n<=i)){var s=n+a>>1;!function t(e,r,i,n,a,o){for(;a>n;){if(a-n>600){var s=a-n+1,u=i-n+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,r,i,Math.max(n,Math.floor(i-u*c/s+h)),Math.min(a,Math.floor(i+(s-u)*c/s+h)),o)}var p=r[2*i+o],f=n,d=a;for(B(e,r,n,i),r[2*a+o]>p&&B(e,r,n,a);f<d;){for(B(e,r,f,d),f++,d--;r[2*f+o]<p;)f++;for(;r[2*d+o]>p;)d--}r[2*n+o]===p?B(e,r,n,d):B(e,r,++d,a),d<=i&&(n=d+1),i<=d&&(a=d-1)}}(e,r,s,n,a,o%2),t(e,r,i,n,s-1,o+1),t(e,r,i,s+1,a,o+1)}}(o,s,i,0,o.length-1,0)};q.prototype.range=function(t,e,r,i){return function(t,e,r,i,n,a,o){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=o)for(var d=f;d<=p;d++)s=e[2*d],u=e[2*d+1],s>=r&&s<=n&&u>=i&&u<=a&&c.push(t[d]);else{var v=Math.floor((f+p)/2);s=e[2*v],u=e[2*v+1],s>=r&&s<=n&&u>=i&&u<=a&&c.push(t[v]);var m=(h+1)%2;(0===h?r<=s:i<=u)&&(l.push(f),l.push(v-1),l.push(m)),(0===h?n>=s:a>=u)&&(l.push(v+1),l.push(p),l.push(m))}}return c}(this.ids,this.coords,t,e,r,i,this.nodeSize)},q.prototype.within=function(t,e,r){return function(t,e,r,i,n,a){for(var o=[0,t.length-1,0],s=[],u=n*n;o.length;){var l=o.pop(),c=o.pop(),h=o.pop();if(c-h<=a)for(var p=h;p<=c;p++)U(e[2*p],e[2*p+1],r,i)<=u&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],v=e[2*f+1];U(d,v,r,i)<=u&&s.push(t[f]);var m=(l+1)%2;(0===l?r-n<=d:i-n<=v)&&(o.push(h),o.push(f-1),o.push(m)),(0===l?r+n>=d:i+n>=v)&&(o.push(f+1),o.push(c),o.push(m))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var Z={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},X=function(t){this.options=$(Object.create(Z),t),this.trees=new Array(this.options.maxZoom+1)};function W(t,e,r,i,n){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:i,properties:n}}function H(t,e){var r=t.geometry.coordinates,i=r[0],n=r[1];return{x:J(i),y:Q(n),zoom:1/0,index:e,parentId:-1}}function Y(t){return{type:"Feature",id:t.id,properties:K(t),geometry:{type:"Point",coordinates:[(i=t.x,360*(i-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,i}function K(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return $($({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function J(t){return t/360+.5}function Q(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function $(t,e){for(var r in e)t[r]=e[r];return t}function tt(t){return t.x}function et(t){return t.y}function rt(t,e,r,i,n,a){var o=n-r,s=a-i;if(0!==o||0!==s){var u=((t-r)*o+(e-i)*s)/(o*o+s*s);u>1?(r=n,i=a):u>0&&(r+=o*u,i+=s*u)}return(o=t-r)*o+(s=e-i)*s}function it(t,e,r,i){var n={id:void 0===t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)nt(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<e.length;i++)nt(t,e[i]);else if("MultiPolygon"===r)for(i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)nt(t,e[i][n])}(n),n}function nt(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function at(t,e,r,i){if(e.geometry){var n=e.geometry.coordinates,a=e.geometry.type,o=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],u=e.id;if(r.promoteId?u=e.properties[r.promoteId]:r.generateId&&(u=i||0),"Point"===a)ot(n,s);else if("MultiPoint"===a)for(var l=0;l<n.length;l++)ot(n[l],s);else if("LineString"===a)st(n,s,o,!1);else if("MultiLineString"===a){if(r.lineMetrics){for(l=0;l<n.length;l++)s=[],st(n[l],s,o,!1),t.push(it(u,"LineString",s,e.properties));return}ut(n,s,o,!1)}else if("Polygon"===a)ut(n,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(l=0;l<e.geometry.geometries.length;l++)at(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<n.length;l++){var c=[];ut(n[l],c,o,!0),s.push(c)}}t.push(it(u,a,s,e.properties))}}function ot(t,e){e.push(lt(t[0])),e.push(ct(t[1])),e.push(0)}function st(t,e,r,i){for(var n,a,o=0,s=0;s<t.length;s++){var u=lt(t[s][0]),l=ct(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(o+=i?(n*l-u*a)/2:Math.sqrt(Math.pow(u-n,2)+Math.pow(l-a,2))),n=u,a=l}var c=e.length-3;e[2]=1,function t(e,r,i,n){for(var a,o=n,s=i-r>>1,u=i-r,l=e[r],c=e[r+1],h=e[i],p=e[i+1],f=r+3;f<i;f+=3){var d=rt(e[f],e[f+1],l,c,h,p);if(d>o)a=f,o=d;else if(d===o){var v=Math.abs(f-s);v<u&&(a=f,u=v)}}o>n&&(a-r>3&&t(e,r,a,n),e[a+2]=o,i-a>3&&t(e,a,i,n))}(e,0,c,r),e[c+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function ut(t,e,r,i){for(var n=0;n<t.length;n++){var a=[];st(t[n],a,r,i),e.push(a)}}function lt(t){return t/360+.5}function ct(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function ht(t,e,r,i,n,a,o,s){if(i/=e,a>=(r/=e)&&o<i)return t;if(o<r||a>=i)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===n?c.minX:c.minY,d=0===n?c.maxX:c.maxY;if(f>=r&&d<i)u.push(c);else if(!(d<r||f>=i)){var v=[];if("Point"===p||"MultiPoint"===p)pt(h,v,r,i,n);else if("LineString"===p)ft(h,v,r,i,n,!1,s.lineMetrics);else if("MultiLineString"===p)vt(h,v,r,i,n,!1);else if("Polygon"===p)vt(h,v,r,i,n,!0);else if("MultiPolygon"===p)for(var m=0;m<h.length;m++){var g=[];vt(h[m],g,r,i,n,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===p){for(m=0;m<v.length;m++)u.push(it(c.id,p,v[m],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===v.length?(p="LineString",v=v[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===v.length?"Point":"MultiPoint"),u.push(it(c.id,p,v,c.tags))}}}return u.length?u:null}function pt(t,e,r,i,n){for(var a=0;a<t.length;a+=3){var o=t[a+n];o>=r&&o<=i&&(e.push(t[a]),e.push(t[a+1]),e.push(t[a+2]))}}function ft(t,e,r,i,n,a,o){for(var s,u,l=dt(t),c=0===n?gt:yt,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],v=t[p+2],m=t[p+3],g=t[p+4],y=0===n?f:d,_=0===n?m:g,b=!1;o&&(s=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-g,2))),y<r?_>r&&(u=c(l,f,d,m,g,r),o&&(l.start=h+s*u)):y>i?_<i&&(u=c(l,f,d,m,g,i),o&&(l.start=h+s*u)):mt(l,f,d,v),_<r&&y>=r&&(u=c(l,f,d,m,g,r),b=!0),_>i&&y<=i&&(u=c(l,f,d,m,g,i),b=!0),!a&&b&&(o&&(l.end=h+s*u),e.push(l),l=dt(t)),o&&(h+=s)}var x=t.length-3;f=t[x],d=t[x+1],v=t[x+2],(y=0===n?f:d)>=r&&y<=i&&mt(l,f,d,v),x=l.length-3,a&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&mt(l,l[0],l[1],l[2]),l.length&&e.push(l)}function dt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function vt(t,e,r,i,n,a){for(var o=0;o<t.length;o++)ft(t[o],e,r,i,n,a,!1)}function mt(t,e,r,i){t.push(e),t.push(r),t.push(i)}function gt(t,e,r,i,n,a){var o=(a-e)/(i-e);return t.push(a),t.push(r+(n-r)*o),t.push(1),o}function yt(t,e,r,i,n,a){var o=(a-r)/(n-r);return t.push(e+(i-e)*o),t.push(a),t.push(1),o}function _t(t,e){for(var r=[],i=0;i<t.length;i++){var n,a=t[i],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)n=bt(a.geometry,e);else if("MultiLineString"===o||"Polygon"===o){n=[];for(var s=0;s<a.geometry.length;s++)n.push(bt(a.geometry[s],e))}else if("MultiPolygon"===o)for(n=[],s=0;s<a.geometry.length;s++){for(var u=[],l=0;l<a.geometry[s].length;l++)u.push(bt(a.geometry[s][l],e));n.push(u)}r.push(it(a.id,o,n,a.tags))}return r}function bt(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function xt(t,e){if(t.transformed)return t;var r,i,n,a=1<<t.z,o=t.x,s=t.y;for(r=0;r<t.features.length;r++){var u=t.features[r],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(i=0;i<l.length;i+=2)u.geometry.push(wt(l[i],l[i+1],e,a,o,s));else for(i=0;i<l.length;i++){var h=[];for(n=0;n<l[i].length;n+=2)h.push(wt(l[i][n],l[i][n+1],e,a,o,s));u.geometry.push(h)}}return t.transformed=!0,t}function wt(t,e,r,i,n,a){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-a))]}function kt(t,e,r,i,n){for(var a=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){o.numFeatures++,Et(o,t[s],a,n);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function Et(t,e,r,i){var n=e.geometry,a=e.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<n.length;s+=3)o.push(n[s]),o.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)St(o,n,t,r,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<n.length;s++)St(o,n[s],t,r,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var u=0;u<n.length;u++){var l=n[u];for(s=0;s<l.length;s++)St(o,l[s],t,r,!0,0===s)}if(o.length){var c=e.tags||null;if("LineString"===a&&i.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var p={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function St(t,e,r,i,n,a){var o=i*i;if(i>0&&e.size<(n?o:i))r.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===i||e[u+2]>o)&&(r.numSimplified++,s.push(e[u]),s.push(e[u+1])),r.numPoints++;n&&function(t,e){for(var r=0,i=0,n=t.length,a=n-2;i<n;a=i,i+=2)r+=(t[i]-t[a])*(t[i+1]+t[a+1]);if(r>0===e)for(i=0,n=t.length;i<n/2;i+=2){var o=t[i],s=t[i+1];t[i]=t[n-2-i],t[i+1]=t[n-1-i],t[n-2-i]=o,t[n-1-i]=s}}(s,a),t.push(s)}}function Tt(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)at(r,t.features[i],e,i);else"Feature"===t.type?at(r,t,e):at(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var r=e.buffer/e.extent,i=t,n=ht(t,1,-1-r,r,0,-1,2,e),a=ht(t,1,1-r,2+r,0,-1,2,e);return(n||a)&&(i=ht(t,1,-r,1+r,0,-1,2,e)||[],n&&(i=_t(n,1).concat(i)),a&&(i=i.concat(_t(a,-1)))),i}(i,e)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function At(t,e,r){return 32*((1<<t)*r+e)+t}function Pt(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var i=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!i)return e(null,null);var n=new k(i.features),a=P(n);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:n,rawData:a.buffer})}X.prototype.load=function(t){var e=this.options,r=e.log,i=e.minZoom,n=e.maxZoom,a=e.nodeSize;r&&console.time("total time");var o="prepare "+t.length+" points";r&&console.time(o),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(H(t[u],u));this.trees[n+1]=new q(s,tt,et,a,Float32Array),r&&console.timeEnd(o);for(var l=n;l>=i;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new q(s,tt,et,a,Float32Array),r&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return r&&console.timeEnd("total time"),this},X.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),n=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,n=180;else if(r>n){var o=this.getClusters([r,i,180,a],e),s=this.getClusters([-180,i,n,a],e);return o.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(J(r),Q(a),J(n),Q(i));c<h.length;c+=1){var p=h[c],f=u.points[p];l.push(f.numPoints?Y(f):this.points[f.index])}return l},X.prototype.getChildren=function(t){var e=t>>5,r=t%32,i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);var a=n.points[e];if(!a)throw new Error(i);for(var o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],u=0,l=n.within(a.x,a.y,o);u<l.length;u+=1){var c=l[u],h=n.points[c];h.parentId===t&&s.push(h.numPoints?Y(h):this.points[h.index])}if(0===s.length)throw new Error(i);return s},X.prototype.getLeaves=function(t,e,r){e=e||10,r=r||0;var i=[];return this._appendLeaves(i,t,e,r,0),i},X.prototype.getTile=function(t,e,r){var i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),a=this.options,o=a.extent,s=a.radius/o,u=(r-s)/n,l=(r+1+s)/n,c={features:[]};return this._addTileFeatures(i.range((e-s)/n,u,(e+1+s)/n,l),i.points,e,r,n,c),0===e&&this._addTileFeatures(i.range(1-s/n,u,1,l),i.points,n,r,n,c),e===n-1&&this._addTileFeatures(i.range(0,u,s/n,l),i.points,-1,r,n,c),c.features.length?c:null},X.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},X.prototype._appendLeaves=function(t,e,r,i,n){for(var a=0,o=this.getChildren(e);a<o.length;a+=1){var s=o[a],u=s.properties;if(u&&u.cluster?n+u.point_count<=i?n+=u.point_count:n=this._appendLeaves(t,u.cluster_id,r,i,n):n<i?n++:t.push(s),t.length===r)break}return n},X.prototype._addTileFeatures=function(t,e,r,i,n,a){for(var o=0,s=t;o<s.length;o+=1){var u=e[s[o]],l={type:1,geometry:[[Math.round(this.options.extent*(u.x*n-r)),Math.round(this.options.extent*(u.y*n-i))]],tags:u.numPoints?K(u):this.points[u.index].properties},c=u.numPoints?u.id:this.points[u.index].id;void 0!==c&&(l.id=c),a.features.push(l)}},X.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},X.prototype._cluster=function(t,e){for(var r=[],i=this.options,n=i.radius,a=i.extent,o=i.reduce,s=n/(a*Math.pow(2,e)),u=0;u<t.length;u++){var l=t[u];if(!(l.zoom<=e)){l.zoom=e;for(var c=this.trees[e+1],h=c.within(l.x,l.y,s),p=l.numPoints||1,f=l.x*p,d=l.y*p,v=o?this._map(l,!0):null,m=(u<<5)+(e+1),g=0,y=h;g<y.length;g+=1){var _=y[g],b=c.points[_];if(!(b.zoom<=e)){b.zoom=e;var x=b.numPoints||1;f+=b.x*x,d+=b.y*x,p+=x,b.parentId=m,o&&o(v,this._map(b))}}1===p?r.push(l):(l.parentId=m,r.push(W(f/p,d/p,m,p,v)))}}return r},X.prototype._map=function(t,e){if(t.numPoints)return e?$({},t.properties):t.properties;var r=this.points[t.index].properties,i=this.options.map(r);return e&&i===r?$({},i):i},Tt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Tt.prototype.splitTile=function(t,e,r,i,n,a,o){for(var s=[t,e,r,i],u=this.options,l=u.debug;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=At(e,r,i),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=kt(t,e,r,i,u),this.tileCoords.push({z:e,x:r,y:i}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,n){if(e===u.maxZoom||e===n)continue;var d=1<<n-e;if(r!==Math.floor(a/d)||i!==Math.floor(o/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var v,m,g,y,_,b,x=.5*u.buffer/u.extent,w=.5-x,k=.5+x,E=1+x;v=m=g=y=null,_=ht(t,c,r-x,r+k,0,p.minX,p.maxX,u),b=ht(t,c,r+w,r+E,0,p.minX,p.maxX,u),t=null,_&&(v=ht(_,c,i-x,i+k,1,p.minY,p.maxY,u),m=ht(_,c,i+w,i+E,1,p.minY,p.maxY,u),_=null),b&&(g=ht(b,c,i-x,i+k,1,p.minY,p.maxY,u),y=ht(b,c,i+w,i+E,1,p.minY,p.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(v||[],e+1,2*r,2*i),s.push(m||[],e+1,2*r,2*i+1),s.push(g||[],e+1,2*r+1,2*i),s.push(y||[],e+1,2*r+1,2*i+1)}}},Tt.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,a=i.debug;if(t<0||t>24)return null;var o=1<<t,s=At(t,e=(e%o+o)%o,r);if(this.tiles[s])return xt(this.tiles[s],n);a>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var u,l=t,c=e,h=r;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[At(l,c,h)];return u&&u.source?(a>1&&console.log("found parent tile z%d-%d-%d",l,c,h),a>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,r),a>1&&console.timeEnd("drilling down"),this.tiles[s]?xt(this.tiles[s],n):null):null};var Ot=function(e){function r(t,r,i){e.call(this,t,r,Pt),i&&(this.loadGeoJSON=i)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var n=!!(i&&i.request&&i.request.collectResourceTiming)&&new u.Performance(i.request);this.loadGeoJSON(i,function(a,o){if(a||!o)return r(a);if("object"!=typeof o)return r(new Error("Input data is not a valid GeoJSON object."));!function t(e,r){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(y(t,r)),e;case"GeometryCollection":return e.geometries=e.geometries.map(y(t,r)),e;case"Feature":return e.geometry=t(e.geometry,r),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=_(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(y(_,e))),t}(e,r);default:return e}}(o,!0);try{e._geoJSONIndex=i.cluster?new X(function(e){var r=e.superclusterOptions,i=e.clusterProperties;if(!i||!r)return r;for(var n={},a={},o={accumulated:null,zoom:0},s={properties:null},u=Object.keys(i),l=0,c=u;l<c.length;l+=1){var h=c[l],p=i[h],f=p[0],d=p[1],v=t.createExpression(d),m=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);n[h]=v.value,a[h]=m.value}return r.map=function(t){s.properties=t;for(var e={},r=0,i=u;r<i.length;r+=1){var a=i[r];e[a]=n[a].evaluate(o,s)}return e},r.reduce=function(t,e){s.properties=e;for(var r=0,i=u;r<i.length;r+=1){var n=i[r];o.accumulated=t[n],t[n]=a[n].evaluate(o,s)}},r}(i)).load(o.features):new Tt(o,i.geojsonVtOptions)}catch(a){return r(a)}e.loaded={};var s={};if(n){var u=n.finish();u&&(s.resourceTiming={},s.resourceTiming[i.source]=JSON.parse(JSON.stringify(u)))}r(null,s)})}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(t,r){var i=this.loaded,n=t.uid;return i&&i[n]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},r.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))},r.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId))},r.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))},r}(h),It=function(e){var r=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:h,geojson:Ot},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return It.prototype.setReferrer=function(t,e){this.referrer=e},It.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},It.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},It.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},It.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},It.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},It.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},It.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},It.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},It.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,r):r()}},It.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},It.prototype.loadRTLTextPlugin=function(e,r,i){try{t.plugin.isLoaded()||(this.self.importScripts(r),i(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+r)))}catch(t){i(t.toString())}},It.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},It.prototype.getWorkerSource=function(t,e,r){var i=this;if(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),!this.workerSources[t][e][r]){var n={send:function(e,r,n){i.actor.send(e,r,n,t)}};this.workerSources[t][e][r]=new this.workerSourceTypes[e](n,this.getLayerIndex(t))}return this.workerSources[t][e][r]},It.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new p),this.demWorkerSources[t][e]},"undefined"!=typeof WorkerGlobalScope&&void 0!==t.window&&t.window instanceof WorkerGlobalScope&&(t.window.worker=new It(t.window)),It}),i(0,function(t){var e=t.createCommonjsModule(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),i=URL.createObjectURL(r);try{e=new Worker(i),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(i),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){return void 0===r[t]&&(r[t]=function(t){var r=document.createElement("canvas"),i=Object.create(e.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,r.probablySupportsContext?r.probablySupportsContext("webgl",i)||r.probablySupportsContext("experimental-webgl",i):r.supportsContext?r.supportsContext("webgl",i)||r.supportsContext("experimental-webgl",i):r.getContext("webgl",i)||r.getContext("experimental-webgl",i)}(t)),r[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),r={create:function(e,r,i){var n=t.window.document.createElement(e);return r&&(n.className=r),i&&i.appendChild(n),n},createNS:function(e,r){return t.window.document.createElementNS(e,r)}},i=t.window.document?t.window.document.documentElement.style:null;function n(t){if(!i)return null;for(var e=0;e<t.length;e++)if(t[e]in i)return t[e];return t[0]}var a,o=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);r.disableDrag=function(){i&&o&&(a=i[o],i[o]="none")},r.enableDrag=function(){i&&o&&(i[o]=a)};var s=n(["transform","WebkitTransform"]);r.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}r.addEventListener=function(t,e,r,i){void 0===i&&(i={}),"passive"in i&&u?t.addEventListener(e,r,i):t.addEventListener(e,r,i.capture)},r.removeEventListener=function(t,e,r,i){void 0===i&&(i={}),"passive"in i&&u?t.removeEventListener(e,r,i):t.removeEventListener(e,r,i.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}r.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout(function(){t.window.removeEventListener("click",c,!0)},0)},r.mousePos=function(e,r){var i=e.getBoundingClientRect();return r=r.touches?r.touches[0]:r,new t.Point(r.clientX-i.left-e.clientLeft,r.clientY-i.top-e.clientTop)},r.touchPos=function(e,r){for(var i=e.getBoundingClientRect(),n=[],a="touchend"===r.type?r.changedTouches:r.touches,o=0;o<a.length;o++)n.push(new t.Point(a[o].clientX-i.left-e.clientLeft,a[o].clientY-i.top-e.clientTop));return n},r.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},r.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function r(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.isLoaded=function(){return this.loaded},r.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var i=r[e],n=i.ids,a=i.callback;this._notify(n,a)}this.requestors=[]}},r.prototype.getImage=function(t){return this.images[t]},r.prototype.addImage=function(t,e){this.images[t]=e},r.prototype.updateImage=function(t,e){var r=this.images[t];e.version=r.version+1,this.images[t]=e,this.updatedImages[t]=!0},r.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},r.prototype.listImages=function(){return Object.keys(this.images)},r.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var i=0,n=t;i<n.length;i+=1){var a=n[i];this.images[a]||(r=!1)}this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},r.prototype._notify=function(e,r){for(var i={},n=0,a=e;n<a.length;n+=1){var o=a[n];this.images[o]||this.fire(new t.Event("styleimagemissing",{id:o}));var s=this.images[o];s?i[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}r(null,i)},r.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},r.prototype.getPattern=function(e){var r=this.patterns[e],i=this.getImage(e);if(!i)return null;if(r&&r.position.version===i.version)return r.position;if(r)r.position.version=i.version;else{var n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},a=new t.ImagePosition(n,i);this.patterns[e]={bin:n,position:a}}return this._updatePatternAtlas(),this.patterns[e].position},r.prototype.bind=function(e){var r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)},r.prototype._updatePatternAtlas=function(){var e=[];for(var r in this.patterns)e.push(this.patterns[r].bin);var i=t.potpack(e),n=i.w,a=i.h,o=this.atlasImage;for(var s in o.resize({width:n||1,height:a||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c},{width:p,height:f}),t.RGBAImage.copy(h,o,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),t.RGBAImage.copy(h,o,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},r.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},r.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var i=r[e];if(!this.callbackDispatchedThisFrame[i]){this.callbackDispatchedThisFrame[i]=!0;var n=this.images[i];h(n)&&this.updateImage(i,n)}}},r}(t.Evented),f=v,d=1e20;function v(t,e,r,i,n,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=n||"sans-serif",this.fontWeight=a||"normal",this.radius=r||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function m(t,e,r,i,n,a,o){for(var s=0;s<e;s++){for(var u=0;u<r;u++)i[u]=t[u*e+s];for(g(i,n,a,o,r),u=0;u<r;u++)t[u*e+s]=n[u]}for(u=0;u<r;u++){for(s=0;s<e;s++)i[s]=t[u*e+s];for(g(i,n,a,o,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(n[s])}}function g(t,e,r,i,n){r[0]=0,i[0]=-d,i[1]=+d;for(var a=1,o=0;a<n;a++){for(var s=(t[a]+a*a-(t[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=i[o];)o--,s=(t[a]+a*a-(t[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);r[++o]=a,i[o]=s,i[o+1]=+d}for(a=0,o=0;a<n;a++){for(;i[o+1]<a;)o++;e[a]=(a-r[o])*(a-r[o])+t[r[o]]}}v.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),i=0;i<this.size*this.size;i++){var n=e.data[4*i+3]/255;this.gridOuter[i]=1===n?0:0===n?d:Math.pow(Math.max(0,.5-n),2),this.gridInner[i]=1===n?d:0===n?0:Math.pow(Math.max(0,n-.5),2)}for(m(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),m(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),i=0;i<this.size*this.size;i++){var a=this.gridOuter[i]-this.gridInner[i];r[i]=Math.max(0,Math.min(255,Math.round(255-255*(a/this.radius+this.cutoff))))}return r};var y=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};y.prototype.setURL=function(t){this.url=t},y.prototype.getGlyphs=function(e,r){var i=this,n=[];for(var a in e)for(var o=0,s=e[a];o<s.length;o+=1){var u=s[o];n.push({stack:a,id:u})}t.asyncAll(n,function(t,e){var r=t.stack,n=t.id,a=i.entries[r];a||(a=i.entries[r]={glyphs:{},requests:{}});var o=a.glyphs[n];if(void 0===o)if(o=i._tinySDF(a,r,n))e(null,{stack:r,id:n,glyph:o});else{var s=Math.floor(n/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var u=a.requests[s];u||(u=a.requests[s]=[],y.loadGlyphRange(r,s,i.url,i.requestManager,function(t,e){if(e)for(var r in e)a.glyphs[+r]=e[+r];for(var i=0,n=u;i<n.length;i+=1)(0,n[i])(t,e);delete a.requests[s]})),u.push(function(t,i){t?e(t):i&&e(null,{stack:r,id:n,glyph:i[n]||null})})}}else e(null,{stack:r,id:n,glyph:o})},function(t,e){if(t)r(t);else if(e){for(var i={},n=0,a=e;n<a.length;n+=1){var o=a[n],s=o.stack,u=o.id,l=o.glyph;(i[s]||(i[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}r(null,i)}})},y.prototype._tinySDF=function(e,r,i){var n=this.localIdeographFontFamily;if(n&&(t.isChar["CJK Unified Ideographs"](i)||t.isChar["Hangul Syllables"](i))){var a=e.tinySDF;if(!a){var o="400";/bold/i.test(r)?o="900":/medium/i.test(r)?o="500":/light/i.test(r)&&(o="200"),a=e.tinySDF=new y.TinySDF(24,3,8,.25,n,o)}return{id:i,bitmap:new t.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},y.loadGlyphRange=function(e,r,i,n,a){var o=256*r,s=o+255,u=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",o+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,function(e,r){if(e)a(e);else if(r){for(var i={},n=0,o=t.parseGlyphPBF(r);n<o.length;n+=1){var s=o[n];i[s.id]=s}a(null,i)}})},y.TinySDF=f;var _=function(){this.specification=t.styleSpec.light.position};_.prototype.possiblyEvaluate=function(e,r){return t.sphericalToCartesian(e.expression.evaluate(r))},_.prototype.interpolate=function(e,r,i){return{x:t.number(e.x,r.x,i),y:t.number(e.y,r.y,i),z:t.number(e.z,r.z,i)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new _,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),x=function(e){function r(r){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.getLight=function(){return this._transitionable.serialize()},r.prototype.setLight=function(e,r){if(void 0===r&&(r={}),!this._validate(t.validateLight,e,r))for(var i in e){var n=e[i];t.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),n):this._transitionable.setValue(i,n)}},r.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},r.prototype.hasTransition=function(){return this._transitioning.hasTransition()},r.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},r.prototype._validate=function(e,r,i){return(!i||!1!==i.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},r}(t.Evented),w=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};w.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.positions[r]||(this.positions[r]=this.addDash(t,e)),this.positions[r]},w.prototype.addDash=function(e,r){var i=r?7:0,n=2*i+1;if(this.nextRow+n>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var a=0,o=0;o<e.length;o++)a+=e[o];for(var s=this.width/a,u=s/2,l=e.length%2==1,c=-i;c<=i;c++)for(var h=this.nextRow+i+c,p=this.width*h,f=l?-e[e.length-1]:0,d=e[0],v=1,m=0;m<this.width;m++){for(;d<m/s;)f=d,d+=e[v],l&&v===e.length-1&&(d+=e[0]),v++;var g=Math.abs(m-f*s),y=Math.abs(m-d*s),_=Math.min(g,y),b=v%2==1,x=void 0;if(r){var w=i?c/i*(u+1):0;if(b){var k=u-Math.abs(w);x=Math.sqrt(_*_+k*k)}else x=u-Math.sqrt(_*_+w*w)}else x=(b?1:-1)*_;this.data[3+4*(p+m)]=Math.max(0,Math.min(255,x+128))}var E={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:a};return this.nextRow+=n,this.dirty=!0,E},w.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var k=function e(r,i){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var n=this.workerPool.acquire(this.id),a=0;a<n.length;a++){var o=n[a],s=new e.Actor(o,i,this.id);s.name="Worker "+a,this.actors.push(s)}};function E(e,r,i){var n=function(n,a){if(n)return i(n);if(a){var o=t.pick(a,["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map(function(t){return t.id})),e.url&&(o.tiles=r.canonicalizeTileset(o,e.url)),i(null,o)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),n):t.browser.frame(function(){return n(null,e)})}k.prototype.broadcast=function(e,r,i){i=i||function(){},t.asyncAll(this.actors,function(t,i){t.send(e,r,i)},i)},k.prototype.send=function(t,e,r,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,e,r),i},k.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},k.Actor=t.Actor;var S=function(e,r,i){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=i||24};S.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},S.prototype.contains=function(e){var r=Math.pow(2,e.z),i=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),n=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),a=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=i&&e.x<a&&e.y>=n&&e.y<o};var T=function(e){function r(r,i,n,a){if(e.call(this),this.id=r,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,t.extend(this,t.pick(i,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=E(this._options,this.map._requestManager,function(r,i){e._tileJSONRequest=null,r?e.fire(new t.ErrorEvent(r)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new S(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.loadTile=function(e,r){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,null),n={request:this.map._requestManager.transformRequest(i,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function a(t,i){return e.aborted?r(null):t&&404!==t.status?r(t):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}n.request.collectResourceTiming=this._collectResourceTiming,void 0===e.workerID||"expired"===e.state?e.workerID=this.dispatcher.send("loadTile",n,a.bind(this)):"loading"===e.state?e.reloadCallback=r:this.dispatcher.send("reloadTile",n,a.bind(this),e.workerID)},r.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0,t.workerID)},r.prototype.hasTransition=function(){return!1},r}(t.Evented),A=function(e){function r(r,i,n,a){e.call(this),this.id=r,this.dispatcher=n,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({},i),t.extend(this,t.pick(i,["url","scheme","tileSize"]))}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=E(this._options,this.map._requestManager,function(r,i){e._tileJSONRequest=null,r?e.fire(new t.ErrorEvent(r)):i&&(t.extend(e,i),i.bounds&&(e.tileBounds=new S(i.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(i.tiles),t.postMapLoadEvent(i.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,r){var i=this,n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,a){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(a){i.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=i.map.painter.context,s=o.gl;e.texture=i.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.Texture(o,a,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),e.state="loaded",r(null)}})},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(t.Evented),P=function(e){function r(r,i,n,a){e.call(this,r,i,n,a),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({},i),this.encoding=i.encoding||"mapbox"}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},r.prototype.loadTile=function(e,r){var i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,n){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(n){this.map._refreshExpiredTiles&&e.setExpiryData(n),delete n.cacheControl,delete n.expires;var a=t.browser.getImageData(n),o={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.workerID&&"expired"!==e.state||(e.workerID=this.dispatcher.send("loadDEMTile",o,function(t,i){t&&(e.state="errored",r(t)),i&&(e.dem=i,e.needsHillshadePrepare=!0,e.state="loaded",r(null))}.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},r.prototype._getNeighboringTiles=function(e){var r=e.canonical,i=Math.pow(2,r.z),n=(r.x-1+i)%i,a=0===r.x?e.wrap-1:e.wrap,o=(r.x+1+i)%i,s=r.x+1===i?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,a,r.z,n,r.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,o,r.y).key]={backfilled:!1},r.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,a,r.z,n,r.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,o,r.y-1).key]={backfilled:!1}),r.y+1<i&&(u[new t.OverscaledTileID(e.overscaledZ,a,r.z,n,r.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,o,r.y+1).key]={backfilled:!1}),u},r.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:t.uid,source:this.id},void 0,t.workerID)},r}(A),O=function(e){function r(r,i,n,a){e.call(this),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=n,this.setEventedParent(a),this._data=i.data,this._options=t.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution);var o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(i.clusterRadius||50)*o,log:!1},clusterProperties:i.clusterProperties},i.workerOptions)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(r){if(r)e.fire(new t.ErrorEvent(r));else{var i={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",i))}})},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setData=function(e){var r=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)r.fire(new t.ErrorEvent(e));else{var i={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&r._resourceTiming.length>0&&(i.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new t.Event("data",i))}}),this},r.prototype.getClusterExpansionZoom=function(t,e){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e,this.workerID),this},r.prototype.getClusterChildren=function(t,e){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e,this.workerID),this},r.prototype.getClusterLeaves=function(t,e,r,i){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},i,this.workerID),this},r.prototype._updateWorkerData=function(e){var r=this,i=t.extend({},this.workerOptions),n=this._data;"string"==typeof n?(i.request=this.map._requestManager.transformRequest(t.browser.resolveURL(n),t.ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(n),this.workerID=this.dispatcher.send(this.type+".loadData",i,function(t,n){r._removed||n&&n.abandoned||(r._loaded=!0,n&&n.resourceTiming&&n.resourceTiming[r.id]&&(r._resourceTiming=n.resourceTiming[r.id].slice(0)),r.dispatcher.send(r.type+".coalesce",{source:i.source},null,r.workerID),e(t))},this.workerID)},r.prototype.loadTile=function(e,r){var i=this,n=void 0===e.workerID?"loadTile":"reloadTile",a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};e.workerID=this.dispatcher.send(n,a,function(t,a){return e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(a,i.map.painter,"reloadTile"===n),r(null))},this.workerID)},r.prototype.abortTile=function(t){t.aborted=!0},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},r.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},r.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},r.prototype.hasTransition=function(){return!1},r}(t.Evented),I=function(e){function r(t,r,i,n){e.call(this),this.id=t,this.dispatcher=i,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(n),this.options=r}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(e,r){var i=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),function(n,a){n?i.fire(new t.ErrorEvent(n)):a&&(i.image=a,e&&(i.coordinates=e),r&&r(),i._finishLoading())})},r.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,function(){e.texture=null}),this):this},r.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setCoordinates=function(e){var r=this;this.coordinates=e;var i=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var r=1/0,i=1/0,n=-1/0,a=-1/0,o=0,s=e;o<s.length;o+=1){var u=s[o];r=Math.min(r,u.x),i=Math.min(i,u.y),n=Math.max(n,u.x),a=Math.max(a,u.y)}var l=n-r,c=a-i,h=Math.max(l,c),p=Math.max(0,Math.floor(-Math.log(h)/Math.LN2)),f=Math.pow(2,p);return new t.CanonicalTileID(p,Math.floor((r+n)/2*f),Math.floor((i+a)/2*f))}(i),this.minzoom=this.maxzoom=this.tileID.z;var n=i.map(function(t){return r.tileID.getTilePoint(t)._round()});return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(n[0].x,n[0].y,0,0),this._boundsArray.emplaceBack(n[1].x,n[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(n[3].x,n[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(n[2].x,n[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},r.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},r.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},r.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return!1},r}(t.Evented),M=function(e){function r(t,r,i,n){e.call(this,t,r,i,n),this.roundZoom=!0,this.type="video",this.options=r}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(){var e=this,r=this.options;this.urls=[];for(var i=0,n=r.urls;i<n.length;i+=1){var a=n[i];this.urls.push(this.map._requestManager.transformRequest(a,t.ResourceType.Source).url)}t.getVideo(this.urls,function(r,i){r?e.fire(new t.ErrorEvent(r)):i&&(e.video=i,e.video.loop=!0,e.video.addEventListener("playing",function(){e.map.triggerRepaint()}),e.map&&e.video.play(),e._finishLoading())})},r.prototype.getVideo=function(){return this.video},r.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},r.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,r=e.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var n=this.tiles[i];"loaded"!==n.state&&(n.state="loaded",n.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this.video&&!this.video.paused},r}(I),C=function(e){function r(r,i,n,a){e.call(this,r,i,n,a),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},r.prototype.getCanvas=function(){return this.canvas},r.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},r.prototype.onRemove=function(){this.pause()},r.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var r=this.map.painter.context,i=r.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,i.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[n];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this._playing},r.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},r}(I),L={vector:T,raster:A,"raster-dem":P,geojson:O,video:M,image:I,canvas:C},j=function(e,r,i,n){var a=new L[r.type](e,r,i,n);if(a.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+a.id);return t.bindAll(["load","abort","unload","serialize","prepare"],a),a};function z(e,r){var i=t.identity([]);return t.translate(i,i,[1,1,0]),t.scale(i,i,[.5*e.width,.5*e.height,1]),t.multiply(i,i,e.calculatePosMatrix(r.toUnwrapped()))}function R(t,e,r,i,n){var a=function(t,e,r){if(t)for(var i=0,n=t;i<n.length;i+=1){var a=e[n[i]];if(a&&a.source===r&&"fill-extrusion"===a.type)return!0}else for(var o in e){var s=e[o];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),o=n.maxPitchScaleFactor(),s=t.tilesIn(r,o,a);s.sort(F);for(var u=[],l=0,c=s;l<c.length;l+=1){var h=c[l];u.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,i,n,o,z(t.transform,h.tileID))})}var p=function(t){for(var e={},r={},i=0,n=t;i<n.length;i+=1){var a=n[i],o=a.queryResults,s=a.wrappedTileID,u=r[s]=r[s]||{};for(var l in o)for(var c=o[l],h=u[l]=u[l]||{},p=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var v=d[f];h[v.featureIndex]||(h[v.featureIndex]=!0,p.push(v))}}return e}(u);for(var f in p)p[f].forEach(function(e){var r=e.feature,i=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=i});return p}function F(t,e){var r=t.tileID,i=e.tileID;return r.overscaledZ-i.overscaledZ||r.canonical.y-i.canonical.y||r.wrap-i.wrap||r.canonical.x-i.canonical.x}var D=function(t,e){this.max=t,this.onRemove=e,this.reset()};D.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var i=r[e];i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value)}return this.data={},this.order=[],this},D.prototype.add=function(t,e,r){var i=this,n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);var a={value:e,timeout:void 0};if(void 0!==r&&(a.timeout=setTimeout(function(){i.remove(t,a)},r)),this.data[n].push(a),this.order.push(n),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},D.prototype.has=function(t){return t.wrapped().key in this.data},D.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},D.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},D.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},D.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,i=void 0===e?0:this.data[r].indexOf(e),n=this.data[r][i];return this.data[r].splice(i,1),n.timeout&&clearTimeout(n.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(n.value),this.order.splice(this.order.indexOf(r),1),this},D.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this};var B=function(t,e,r){this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};B.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},B.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},B.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var N={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},U=function(t,e,r,i){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],n=e.attributes[i.name];void 0!==n&&t.enableVertexAttribArray(n)}},U.prototype.setVertexAttribPointers=function(t,e,r){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],a=e.attributes[n.name];void 0!==a&&t.vertexAttribPointer(a,n.components,t[N[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0))}},U.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)};var V=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};V.prototype.get=function(){return this.current},V.prototype.set=function(t){},V.prototype.getDefault=function(){return this.default},V.prototype.setDefault=function(){this.set(this.default)};var G=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(V),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(V),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(V),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(V),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(V),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(V),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(V),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(V),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(V),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(V),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(V),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(V),it=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(V),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(V),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(V),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(V),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(V),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(V),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(V),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(V),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(V),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(V),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(V),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(V),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(V),mt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(V),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(V),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(V),bt=function(t){function e(e,r){t.call(this,e),this.context=e,this.parent=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDefault=function(){return null},e}(V),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),kt=function(t,e,r){this.context=t,this.width=e,this.height=r;var i=t.gl,n=this.framebuffer=i.createFramebuffer();this.colorAttachment=new xt(t,n),this.depthAttachment=new wt(t,n)};kt.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r),t.deleteFramebuffer(this.framebuffer)};var Et=function(t,e,r){this.func=t,this.mask=e,this.range=r};Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);var St=function(t,e,r,i,n,a){this.test=t,this.ref=e,this.mask=r,this.fail=i,this.depthFail=n,this.pass=a};St.disabled=new St({func:519,mask:0},0,0,7680,7680,7680);var Tt=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};Tt.disabled=new Tt(Tt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,t.Color.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var At=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};At.disabled=new At(!1,1029,2305),At.backCCW=new At(!0,1029,2305);var Pt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new G(this),this.clearDepth=new q(this),this.clearStencil=new Z(this),this.colorMask=new X(this),this.depthMask=new W(this),this.stencilMask=new H(this),this.stencilFunc=new Y(this),this.stencilOp=new K(this),this.stencilTest=new J(this),this.depthRange=new Q(this),this.depthTest=new $(this),this.depthFunc=new tt(this),this.blend=new et(this),this.blendFunc=new rt(this),this.blendColor=new it(this),this.blendEquation=new nt(this),this.cullFace=new at(this),this.cullFaceSide=new ot(this),this.frontFace=new st(this),this.program=new ut(this),this.activeTexture=new lt(this),this.viewport=new ct(this),this.bindFramebuffer=new ht(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new ft(this),this.bindVertexBuffer=new dt(this),this.bindElementBuffer=new vt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mt(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new _t(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};Pt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Pt.prototype.createIndexBuffer=function(t,e){return new B(this,t,e)},Pt.prototype.createVertexBuffer=function(t,e,r){return new U(this,t,e,r)},Pt.prototype.createRenderbuffer=function(t,e,r){var i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),n},Pt.prototype.createFramebuffer=function(t,e){return new kt(this,t,e)},Pt.prototype.clear=function(t){var e=t.color,r=t.depth,i=this.gl,n=0;e&&(n|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(n|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),i.clear(n)},Pt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Pt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Pt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Pt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Pt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ot=function(e){function r(r,i,n){var a=this;e.call(this),this.id=r,this.dispatcher=n,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform))}),this.on("error",function(){a._sourceErrored=!0}),this._source=j(r,i,n,this),this._tiles={},this._cache=new D(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},r.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},r.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},r.prototype.getSource=function(){return this._source},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},r.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},r.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},r.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},r.prototype.serialize=function(){return this._source.serialize()},r.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},r.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(It)},r.prototype.getRenderableIds=function(e){var r=this,i=[];for(var n in this._tiles)this._isIdRenderable(+n,e)&&i.push(+n);return e?i.sort(function(e,i){var n=r._tiles[e].tileID,a=r._tiles[i].tileID,o=new t.Point(n.canonical.x,n.canonical.y)._rotate(r.transform.angle),s=new t.Point(a.canonical.x,a.canonical.y)._rotate(r.transform.angle);return n.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x}):i.sort(It)},r.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},r.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},r.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},r.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},r.prototype._tileLoaded=function(e,r,i,n){if(n)return e.state="errored",void(404!==n.status?this._source.fire(new t.ErrorEvent(n,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},r.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var i=e[r];if(t.neighboringTiles&&t.neighboringTiles[i]){var n=this.getTileByID(i);a(t,n),a(n,t)}}function a(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,i=e.tileID.canonical.y-t.tileID.canonical.y,n=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===r&&0===i||Math.abs(i)>1||(Math.abs(r)>1&&(1===Math.abs(r+n)?r+=n:1===Math.abs(r-n)&&(r-=n)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,i),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}},r.prototype.getTile=function(t){return this.getTileByID(t.key)},r.prototype.getTileByID=function(t){return this._tiles[t]},r.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},r.prototype._retainLoadedChildren=function(t,e,r,i){for(var n in this._tiles){var a=this._tiles[n];if(!(i[n]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>r)){for(var o=a.tileID;a&&a.tileID.overscaledZ>e+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var u=o;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){i[o.key]=o;break}}}},r.prototype.findLoadedParent=function(t,e){for(var r=t.overscaledZ-1;r>=e;r--){var i=t.scaledTo(r);if(!i)return;var n=String(i.key),a=this._tiles[n];if(a&&a.hasData())return a;if(this._cache.has(i))return this._cache.get(i)}},r.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),r=Math.floor(5*e),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},r.prototype.handleWrapJump=function(t){var e=(t-(void 0===this._prevLng?t:this._prevLng))/360,r=Math.round(e);if(this._prevLng=t,r){var i={};for(var n in this._tiles){var a=this._tiles[n];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+r),i[a.tileID.key]=a}for(var o in this._tiles=i,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var s in this._tiles){var u=this._tiles[s];this._setTileReloadTimer(s,u)}}},r.prototype.update=function(e){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var n;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)}):(n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(n=n.filter(function(t){return i._source.hasTile(t)}))):n=[];var a=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),o=Math.max(a-r.maxOverzooming,this._source.minzoom),s=Math.max(a+r.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(n,a);if(Mt(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],v=this._tiles[f];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(d,o);m&&(this._addTile(m.tileID),l[m.tileID.key]=m.tileID),c[f]=d}}for(var g in this._retainLoadedChildren(c,a,s,u),l)u[g]||(this._coveredTiles[g]=!0,u[g]=l[g])}for(var y in u)this._tiles[y].clearFadeHold();for(var _=0,b=t.keysDifference(this._tiles,u);_<b.length;_+=1){var x=b[_],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}}},r.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},r.prototype._updateRetainedTiles=function(t,e){for(var i={},n={},a=Math.max(e-r.maxOverzooming,this._source.minzoom),o=Math.max(e+r.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);i[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,o,i);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],v=this._tiles[d.key];if(!v.hasData()){if(e+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){i[m.key]=m;continue}}else{var y=d.children(this._source.maxzoom);if(i[y[0].key]&&i[y[1].key]&&i[y[2].key]&&i[y[3].key])continue}for(var _=v.wasRequested(),b=d.overscaledZ-1;b>=a;--b){var x=d.scaledTo(b);if(n[x.key])break;if(n[x.key]=!0,!(v=this.getTile(x))&&_&&(v=this._addTile(x)),v&&(i[x.key]=x,_=v.wasRequested(),v.hasData()))break}}}return i},r.prototype._addTile=function(e){var r=this._tiles[e.key];if(r)return r;(r=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));var i=Boolean(r);return i||(r=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,i||this._source.fire(new t.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null},r.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout(function(){r._reloadTile(t,"expired"),delete r._timers[t]},i))},r.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},r.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},r.prototype.tilesIn=function(e,r,i){var n=this,a=[],o=this.transform;if(!o)return a;for(var s=i?o.getCameraQueryGeometry(e):e,u=e.map(function(t){return o.pointCoordinate(t)}),l=s.map(function(t){return o.pointCoordinate(t)}),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,v=0,m=l;v<m.length;v+=1){var g=m[v];h=Math.min(h,g.x),p=Math.min(p,g.y),f=Math.max(f,g.x),d=Math.max(d,g.y)}for(var y=function(e){var i=n._tiles[c[e]];if(!i.holdingForFade()){var s=i.tileID,v=Math.pow(2,o.zoom-i.tileID.overscaledZ),m=r*i.queryPadding*t.EXTENT/i.tileSize/v,g=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(g[0].x-m<t.EXTENT&&g[0].y-m<t.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){var y=u.map(function(t){return s.getTilePoint(t)}),_=l.map(function(t){return s.getTilePoint(t)});a.push({tile:i,tileID:s,queryGeometry:y,cameraQueryGeometry:_,scale:v})}}},_=0;_<c.length;_++)y(_);return a},r.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map(function(t){return e._tiles[t].tileID}),i=0,n=r;i<n.length;i+=1){var a=n[i];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return r},r.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Mt(this._source.type))for(var e in this._tiles){var r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=t.browser.now())return!0}return!1},r.prototype.setFeatureState=function(t,e,r){t=t||"_geojsonTileLayer",this._state.updateState(t,e,r)},r.prototype.removeFeatureState=function(t,e,r){t=t||"_geojsonTileLayer",this._state.removeFeatureState(t,e,r)},r.prototype.getFeatureState=function(t,e){return t=t||"_geojsonTileLayer",this._state.getState(t,e)},r}(t.Evented);function It(t,e){return t%32-e%32||e-t}function Mt(t){return"raster"===t||"image"===t||"video"===t}function Ct(){return new t.window.Worker(Qi.workerUrl)}Ot.maxOverzooming=10,Ot.maxUnderzooming=3;var Lt=function(){this.active={}};Lt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Lt.workerCount;)this.workers.push(new Ct);return this.active[t]=!0,this.workers.slice()},Lt.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var jt,zt=Math.floor(t.browser.hardwareConcurrency/2);function Rt(e,r){var i={};for(var n in e)"ref"!==n&&(i[n]=e[n]);return t.refProperties.forEach(function(t){t in r&&(i[t]=r[t])}),i}function Ft(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Rt(t[i],e[t[i].ref]));return t}Lt.workerCount=Math.max(Math.min(zt,6),1);var Dt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Bt(t,e,r){r.push({command:Dt.addSource,args:[t,e[t]]})}function Nt(t,e,r){e.push({command:Dt.removeSource,args:[t]}),r[t]=!0}function Ut(t,e,r,i){Nt(t,r,i),Bt(t,e,r)}function Vt(e,r,i){var n;for(n in e[i])if(e[i].hasOwnProperty(n)&&"data"!==n&&!t.deepEqual(e[i][n],r[i][n]))return!1;for(n in r[i])if(r[i].hasOwnProperty(n)&&"data"!==n&&!t.deepEqual(e[i][n],r[i][n]))return!1;return!0}function Gt(e,r,i,n,a,o){var s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||i.push({command:o,args:[n,s,r[s],a]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||i.push({command:o,args:[n,s,r[s],a]}))}function qt(t){return t.id}function Zt(t,e){return t[e.id]=e,t}var Xt=function(t,e,r){var i=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};Xt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xt.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)},Xt.prototype.insertCircle=function(t,e,r,i){this._forEachCell(e-i,r-i,e+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(i)},Xt.prototype._insertBoxCell=function(t,e,r,i,n,a){this.boxCells[n].push(a)},Xt.prototype._insertCircleCell=function(t,e,r,i,n,a){this.circleCells[n].push(a)},Xt.prototype._query=function(t,e,r,i,n,a){if(r<0||t>this.width||i<0||e>this.height)return!n&&[];var o=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];o.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return a?o.filter(a):o}var p={hitTest:n,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,r,i,this._queryCell,o,p,a),n?o.length>0:o},Xt.prototype._queryCircle=function(t,e,r,i,n){var a=t-r,o=t+r,s=e-r,u=e+r;if(o<0||a>this.width||u<0||s>this.height)return!i&&[];var l=[],c={hitTest:i,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}};return this._forEachCell(a,s,o,u,this._queryCellCircle,l,c,n),i?l.length>0:l},Xt.prototype.query=function(t,e,r,i,n){return this._query(t,e,r,i,!1,n)},Xt.prototype.hitTest=function(t,e,r,i,n){return this._query(t,e,r,i,!0,n)},Xt.prototype.hitTestCircle=function(t,e,r,i){return this._queryCircle(t,e,r,!0,i)},Xt.prototype._queryCell=function(t,e,r,i,n,a,o,s){var u=o.seenUids,l=this.boxCells[n];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&r>=c[d+0]&&i>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var v=this.circleCells[n];if(null!==v)for(var m=this.circles,g=0,y=v;g<y.length;g+=1){var _=y[g];if(!u.circle[_]){u.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(m[b],m[b+1],m[b+2],t,e,r,i)&&(!s||s(this.circleKeys[_]))){if(o.hitTest)return a.push(!0),!0;var x=m[b],w=m[b+1],k=m[b+2];a.push({key:this.circleKeys[_],x1:x-k,y1:w-k,x2:x+k,y2:w+k})}}}},Xt.prototype._queryCellCircle=function(t,e,r,i,n,a,o,s){var u=o.circle,l=o.seenUids,c=this.boxCells[n];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[v+0],h[v+1],h[v+2],h[v+3])&&(!s||s(this.boxKeys[d])))return a.push(!0),!0}}var m=this.circleCells[n];if(null!==m)for(var g=this.circles,y=0,_=m;y<_.length;y+=1){var b=_[y];if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circlesCollide(g[x],g[x+1],g[x+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[b])))return a.push(!0),!0}}},Xt.prototype._forEachCell=function(t,e,r,i,n,a,o,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.xCellCount*f+p;if(n.call(this,t,e,r,i,d,a,o,s))return}},Xt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Xt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Xt.prototype._circlesCollide=function(t,e,r,i,n,a){var o=i-t,s=n-e,u=r+a;return u*u>o*o+s*s},Xt.prototype._circleAndRectCollide=function(t,e,r,i,n,a,o){var s=(a-i)/2,u=Math.abs(t-(i+s));if(u>s+r)return!1;var l=(o-n)/2,c=Math.abs(e-(n+l));if(c>l+r)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=r*r};var Wt=t.properties.layout;function Ht(e,r,i,n,a){var o=t.create();return r?(t.scale(o,o,[1/a,1/a,1]),i||t.rotateZ(o,o,n.angle)):t.multiply(o,n.labelPlaneMatrix,e),o}function Yt(e,r,i,n,a){if(r){var o=t.clone(e);return t.scale(o,o,[a,a,1]),i||t.rotateZ(o,o,-n.angle),o}return n.glCoordMatrix}function Kt(e,r){var i=[e.x,e.y,0,1];oe(i,i,r);var n=i[3];return{point:new t.Point(i[0]/n,i[1]/n),signedDistanceFromCamera:n}}function Jt(t,e){var r=t[0]/t[3],i=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&i>=-e[1]&&i<=e[1]}function Qt(e,r,i,n,a,o,s,u){var l=n?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,i.transform.zoom,Wt.properties[n?"text-size":"icon-size"]),h=[256/i.width*2+1,256/i.height*2+1],p=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=i.transform.width/i.transform.height,m=!1,g=0;g<d.length;g++){var y=d.get(g);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!m)ae(y.numGlyphs,p);else{m=!1;var _=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(_,_,r),Jt(_,h)){var b=.5+_[3]/i.transform.cameraToCenterDistance*.5,x=t.evaluateSizeForFeature(l,c,y),w=s?x*b:x/b,k=new t.Point(y.anchorX,y.anchorY),E=Kt(k,a).point,S={},T=ee(y,w,!1,u,r,a,o,e.glyphOffsetArray,f,p,E,k,S,v);m=T.useVertical,(T.notEnoughRoom||m||T.needsFlipping&&ee(y,w,!0,u,r,a,o,e.glyphOffsetArray,f,p,E,k,S,v).notEnoughRoom)&&ae(y.numGlyphs,p)}else ae(y.numGlyphs,p)}}n?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function $t(t,e,r,i,n,a,o,s,u,l,c,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,v=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(p-1),g=ie(t*v,r,i,n,a,o,s.segment,f,d,u,l,c,h);if(!g)return null;var y=ie(t*m,r,i,n,a,o,s.segment,f,d,u,l,c,h);return y?{first:g,last:y}:null}function te(e,r,i,n){return e===t.WritingMode.horizontal&&Math.abs(i.y-r.y)>Math.abs(i.x-r.x)*n?{useVertical:!0}:(e===t.WritingMode.vertical?r.y<i.y:r.x>i.x)?{needsFlipping:!0}:null}function ee(e,r,i,n,a,o,s,u,l,c,h,p,f,d){var v,m=r/24,g=e.lineOffsetX*m,y=e.lineOffsetY*m;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=$t(m,u,g,y,i,h,p,e,l,o,f,!1);if(!w)return{notEnoughRoom:!0};var k=Kt(w.first.point,s).point,E=Kt(w.last.point,s).point;if(n&&!i){var S=te(e.writingMode,k,E,d);if(S)return S}v=[w.first];for(var T=e.glyphStartIndex+1;T<_-1;T++)v.push(ie(m*u.getoffsetX(T),g,y,i,h,p,e.segment,b,x,l,o,f,!1));v.push(w.last)}else{if(n&&!i){var A=Kt(p,a).point,P=e.lineStartIndex+e.segment+1,O=new t.Point(l.getx(P),l.gety(P)),I=Kt(O,a),M=I.signedDistanceFromCamera>0?I.point:re(p,O,A,1,a),C=te(e.writingMode,A,M,d);if(C)return C}var L=ie(m*u.getoffsetX(e.glyphStartIndex),g,y,i,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,o,f,!1);if(!L)return{notEnoughRoom:!0};v=[L]}for(var j=0,z=v;j<z.length;j+=1){var R=z[j];t.addDynamicAttributes(c,R.point,R.angle)}return{}}function re(t,e,r,i,n){var a=Kt(t.add(t.sub(e)._unit()),n).point,o=r.sub(a);return r.add(o._mult(i/o.mag()))}function ie(e,r,i,n,a,o,s,u,l,c,h,p,f){var d=n?e-r:e+r,v=d>0?1:-1,m=0;n&&(v*=-1,m=Math.PI),v<0&&(m+=Math.PI);for(var g=v>0?u+s:u+s+1,y=g,_=a,b=a,x=0,w=0,k=Math.abs(d);x+w<=k;){if((g+=v)<u||g>=l)return null;if(b=_,void 0===(_=p[g])){var E=new t.Point(c.getx(g),c.gety(g)),S=Kt(E,h);if(S.signedDistanceFromCamera>0)_=p[g]=S.point;else{var T=g-v;_=re(0===x?o:new t.Point(c.getx(T),c.gety(T)),E,b,k-x+1,h)}}x+=w,w=b.dist(_)}var A=(k-x)/w,P=_.sub(b),O=P.mult(A)._add(b);return O._add(P._unit()._perp()._mult(i*v)),{point:O,angle:m+Math.atan2(_.y-b.y,_.x-b.x),tileDistance:f?{prevTileDistance:g-v===y?0:c.gettileUnitDistanceFromAnchor(g-v),lastSegmentViewportDistance:k-x}:null}}var ne=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ae(t,e){for(var r=0;r<t;r++){var i=e.length;e.resize(i+4),e.float32.set(ne,3*i)}}function oe(t,e,r){var i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t[3]=r[3]*i+r[7]*n+r[15],t}var se=function(t,e,r){void 0===e&&(e=new Xt(t.width+200,t.height+200,25)),void 0===r&&(r=new Xt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function ue(t,e,r){t[e+4]=r?1:0}function le(e,r,i){return r*(t.EXTENT/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}se.prototype.placeCollisionBox=function(t,e,r,i,n){var a=this.projectAndGetPerspectiveRatio(i,t.anchorPointX,t.anchorPointY),o=r*a.perspectiveRatio,s=t.x1*o+a.point.x,u=t.y1*o+a.point.y,l=t.x2*o+a.point.x,c=t.y2*o+a.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,n)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},se.prototype.approximateTileDistance=function(t,e,r,i,n){var a=n?1:i/this.pitchfactor,o=t.lastSegmentViewportDistance*r;return t.prevTileDistance+o+(a-1)*o*Math.abs(Math.sin(e))},se.prototype.placeCollisionCircles=function(e,r,i,n,a,o,s,u,l,c,h,p,f){var d=[],v=this.projectAnchor(l,a.anchorX,a.anchorY),m=u/24,g=a.lineOffsetX*u,y=a.lineOffsetY*u,_=new t.Point(a.anchorX,a.anchorY),b=$t(m,s,g,y,!1,Kt(_,c).point,_,a,o,c,{},!0),x=!1,w=!1,k=!0,E=v.perspectiveRatio*n,S=1/(n*i),T=0,A=0;b&&(T=this.approximateTileDistance(b.first.tileDistance,b.first.angle,S,v.cameraDistance,p),A=this.approximateTileDistance(b.last.tileDistance,b.last.angle,S,v.cameraDistance,p));for(var P=0;P<e.length;P+=5){var O=e[P],I=e[P+1],M=e[P+2],C=e[P+3];if(!b||C<-T||C>A)ue(e,P,!1);else{var L=this.projectPoint(l,O,I),j=M*E;if(d.length>0){var z=L.x-d[d.length-4],R=L.y-d[d.length-3];if(j*j*2>z*z+R*R&&P+8<e.length){var F=e[P+8];if(F>-T&&F<A){ue(e,P,!1);continue}}}var D=P/5;d.push(L.x,L.y,j,D),ue(e,P,!0);var B=L.x-j,N=L.y-j,U=L.x+j,V=L.y+j;if(k=k&&this.isOffscreen(B,N,U,V),w=w||this.isInsideGrid(B,N,U,V),!r&&this.grid.hitTestCircle(L.x,L.y,j,f)){if(!h)return{circles:[],offscreen:!1};x=!0}}}return{circles:x||!w?[]:d,offscreen:k}},se.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var r=[],i=1/0,n=1/0,a=-1/0,o=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);i=Math.min(i,c.x),n=Math.min(n,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y),r.push(c)}for(var h={},p={},f=0,d=this.grid.query(i,n,a,o).concat(this.ignoredGrid.query(i,n,a,o));f<d.length;f+=1){var v=d[f],m=v.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var g=[new t.Point(v.x1,v.y1),new t.Point(v.x2,v.y1),new t.Point(v.x2,v.y2),new t.Point(v.x1,v.y2)];t.polygonIntersectsPolygon(r,g)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===p[m.bucketInstanceId]&&(p[m.bucketInstanceId]=[]),p[m.bucketInstanceId].push(m.featureIndex))}}return p},se.prototype.insertCollisionBox=function(t,e,r,i,n){var a={bucketInstanceId:r,featureIndex:i,collisionGroupID:n};(e?this.ignoredGrid:this.grid).insert(a,t[0],t[1],t[2],t[3])},se.prototype.insertCollisionCircles=function(t,e,r,i,n){for(var a=e?this.ignoredGrid:this.grid,o={bucketInstanceId:r,featureIndex:i,collisionGroupID:n},s=0;s<t.length;s+=4)a.insertCircle(o,t[s],t[s+1],t[s+2])},se.prototype.projectAnchor=function(t,e,r){var i=[e,r,0,1];return oe(i,i,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5,cameraDistance:i[3]}},se.prototype.projectPoint=function(e,r,i){var n=[r,i,0,1];return oe(n,n,e),new t.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100)},se.prototype.projectAndGetPerspectiveRatio=function(e,r,i){var n=[r,i,0,1];return oe(n,n,e),{point:new t.Point((n[0]/n[3]+1)/2*this.transform.width+100,(-n[1]/n[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},se.prototype.isOffscreen=function(t,e,r,i){return r<100||t>=this.screenRightBoundary||i<100||e>this.screenBottomBoundary},se.prototype.isInsideGrid=function(t,e,r,i){return r>=0&&t<this.gridRightBoundary&&i>=0&&e<this.gridBottomBoundary};var ce=function(t,e,r,i){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):i&&r?1:0,this.placed=r};ce.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var he=function(t,e,r,i,n){this.text=new ce(t?t.text:null,e,r,n),this.icon=new ce(t?t.icon:null,e,i,n)};he.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var pe=function(t,e,r){this.text=t,this.icon=e,this.skipFade=r},fe=function(t,e,r,i,n){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=n},de=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function ve(e,r,i,n,a){var o=t.getAnchorAlignment(e),s=-(o.horizontalAlign-.5)*r,u=-(o.verticalAlign-.5)*i,l=t.evaluateRadialOffset(e,n);return new t.Point(s+l[0]*a,u+l[1]*a)}de.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var me=function(t,e,r,i){this.transform=t.clone(),this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new de(r),this.prevPlacement=i,i&&(i.prevPlacement=void 0)};function ge(t,e,r,i,n){t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0),t.emplaceBack(e?1:0,r?1:0,i||0,n||0)}me.prototype.placeLayerTile=function(e,r,i,n){var a=r.getBucket(e),o=r.latestFeatureIndex;if(a&&o&&e.id===a.layerIds[0]){var s=r.collisionBoxArray,u=a.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p=Ht(h,"map"===u.get("text-pitch-alignment"),"map"===u.get("text-rotation-alignment"),this.transform,le(r,1,this.transform.zoom)),f=Ht(h,"map"===u.get("icon-pitch-alignment"),"map"===u.get("icon-rotation-alignment"),this.transform,le(r,1,this.transform.zoom));this.retainedQueryData[a.bucketInstanceId]=new fe(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID),this.placeLayerBucket(a,h,p,f,l,c,i,r.holdingForFade(),n,s)}},me.prototype.attemptAnchorPlacement=function(e,r,i,n,a,o,s,u,l,c,h,p,f,d){var v,m=ve(e,i,n,a,o),g=this.collisionIndex.placeCollisionBox(function(e,r,i,n,a,o){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(r,i);return n&&f._rotate(a?o:-o),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}(r,m.x,m.y,s,u,this.transform.angle),p,l,c,h.predicate);if(g.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID]&&this.prevPlacement.placements[f.crossTileID].text&&(v=this.prevPlacement.variableOffsets[f.crossTileID].anchor),this.variableOffsets[f.crossTileID]={radialOffset:a,width:i,height:n,anchor:e,textBoxScale:o,prevAnchor:v},this.markUsedJustification(d,e,f),g},me.prototype.placeLayerBucket=function(e,r,i,n,a,o,s,u,l,c){var h=e.layers[0].layout,p=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom,t.properties.layout.properties["text-size"]),f=h.get("text-optional"),d=h.get("icon-optional"),v=h.get("text-allow-overlap"),m=h.get("icon-allow-overlap"),g=v&&(m||!e.hasIconData()||d),y=m&&(v||!e.hasTextData()||f),_=this.collisionGroups.get(e.sourceID),b="map"===h.get("text-rotation-alignment"),x="map"===h.get("text-pitch-alignment");!e.collisionArrays&&c&&e.deserializeCollisionBoxes(c);for(var w=0;w<e.symbolInstances.length;w++){var k=e.symbolInstances.get(w);if(!l[k.crossTileID]){if(u){this.placements[k.crossTileID]=new pe(!1,!1,!1);continue}var E=!1,S=!1,T=!0,A=null,P=null,O=null,I=0,M=0,C=e.collisionArrays[w];C.textFeatureIndex&&(I=C.textFeatureIndex);var L=C.textBox;if(L)if(h.get("text-variable-anchor")){var j=L.x2-L.x1,z=L.y2-L.y1,R=k.textBoxScale,F=h.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[k.crossTileID]){var D=this.prevPlacement.variableOffsets[k.crossTileID];F[0]!==D.anchor&&(F=F.filter(function(t){return t!==D.anchor})).unshift(D.anchor)}for(var B=0,N=F;B<N.length;B+=1){var U=N[B];if(A=this.attemptAnchorPlacement(U,L,j,z,k.radialTextOffset,R,b,x,o,r,_,v,k,e)){E=!0;break}}if(!this.variableOffsets[k.crossTileID]&&this.prevPlacement){var V=this.prevPlacement.variableOffsets[k.crossTileID];V&&(this.variableOffsets[k.crossTileID]=V,this.markUsedJustification(e,V.anchor,k))}}else E=(A=this.collisionIndex.placeCollisionBox(L,h.get("text-allow-overlap"),o,r,_.predicate)).box.length>0;T=A&&A.offscreen;var G=C.textCircles;if(G){var q=e.text.placedSymbolArray.get(k.centerJustifiedTextSymbolIndex),Z=t.evaluateSizeForFeature(e.textSizeData,p,q);P=this.collisionIndex.placeCollisionCircles(G,h.get("text-allow-overlap"),a,o,q,e.lineVertexArray,e.glyphOffsetArray,Z,r,i,s,x,_.predicate),E=h.get("text-allow-overlap")||P.circles.length>0,T=T&&P.offscreen}C.iconFeatureIndex&&(M=C.iconFeatureIndex),C.iconBox&&(S=(O=this.collisionIndex.placeCollisionBox(C.iconBox,h.get("icon-allow-overlap"),o,r,_.predicate)).box.length>0,T=T&&O.offscreen);var X=f||0===k.numHorizontalGlyphVertices&&0===k.numVerticalGlyphVertices,W=d||0===k.numIconVertices;X||W?W?X||(S=S&&E):E=S&&E:S=E=S&&E,E&&A&&this.collisionIndex.insertCollisionBox(A.box,h.get("text-ignore-placement"),e.bucketInstanceId,I,_.ID),S&&O&&this.collisionIndex.insertCollisionBox(O.box,h.get("icon-ignore-placement"),e.bucketInstanceId,M,_.ID),E&&P&&this.collisionIndex.insertCollisionCircles(P.circles,h.get("text-ignore-placement"),e.bucketInstanceId,I,_.ID),this.placements[k.crossTileID]=new pe(E||g,S||y,T||e.justReloaded),l[k.crossTileID]=!0}}e.justReloaded=!1},me.prototype.markUsedJustification=function(e,r,i){var n={left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex},a=n[t.getAnchorJustification(r)];for(var o in n){var s=n[o];s>=0&&(e.text.placedSymbolArray.get(s).crossTileID=a>=0&&s!==a?0:i.crossTileID)}},me.prototype.commit=function(t){this.commitTime=t;var e=this.prevPlacement,r=!1,i=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,n=e?e.opacities:{},a=e?e.variableOffsets:{};for(var o in this.placements){var s=this.placements[o],u=n[o];u?(this.opacities[o]=new he(u,i,s.text,s.icon),r=r||s.text!==u.text.placed||s.icon!==u.icon.placed):(this.opacities[o]=new he(null,i,s.text,s.icon,s.skipFade),r=r||s.text||s.icon)}for(var l in n){var c=n[l];if(!this.opacities[l]){var h=new he(c,i,!1,!1);h.isHidden()||(this.opacities[l]=h,r=r||c.text.placed||c.icon.placed)}}for(var p in a)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=a[p]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},me.prototype.updateLayerOpacities=function(t,e){for(var r={},i=0,n=e;i<n.length;i+=1){var a=n[i],o=a.getBucket(t);o&&a.latestFeatureIndex&&t.id===o.layerIds[0]&&this.updateBucketOpacities(o,r,a.collisionBoxArray)}},me.prototype.updateBucketOpacities=function(e,r,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexArray.clear(),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexArray.clear();var n=e.layers[0].layout,a=new he(null,0,!1,!1,!0),o=n.get("text-allow-overlap"),s=n.get("icon-allow-overlap"),u=n.get("text-variable-anchor"),l="map"===n.get("text-rotation-alignment"),c="map"===n.get("text-pitch-alignment"),h=new he(null,0,o&&(s||!e.hasIconData()||n.get("icon-optional")),s&&(o||!e.hasTextData()||n.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasCollisionBoxData()||e.hasCollisionCircleData())&&e.deserializeCollisionBoxes(i);for(var p=0;p<e.symbolInstances.length;p++){var f=e.symbolInstances.get(p),d=f.numHorizontalGlyphVertices,v=f.numVerticalGlyphVertices,m=f.crossTileID,g=r[m],y=this.opacities[m];g?y=a:y||(y=h,this.opacities[m]=y),r[m]=!0;var _=d>0||v>0,b=f.numIconVertices>0;if(_){for(var x=Se(y.text),w=(d+v)/4,k=0;k<w;k++)e.text.opacityVertexArray.emplaceBack(x);var E=y.text.isHidden()?1:0;[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex].forEach(function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=E)});var S=this.variableOffsets[f.crossTileID];S&&this.markUsedJustification(e,S.anchor,f)}if(b){for(var T=Se(y.icon),A=0;A<f.numIconVertices/4;A++)e.icon.opacityVertexArray.emplaceBack(T);e.icon.placedSymbolArray.get(p).hidden=y.icon.isHidden()}if(e.hasCollisionBoxData()||e.hasCollisionCircleData()){var P=e.collisionArrays[p];if(P){if(P.textBox){var O=new t.Point(0,0),I=!0;if(u){var M=this.variableOffsets[m];M?(O=ve(M.anchor,M.width,M.height,M.radialOffset,M.textBoxScale),l&&O._rotate(c?this.transform.angle:-this.transform.angle)):I=!1}ge(e.collisionBox.collisionVertexArray,y.text.placed,!I,O.x,O.y)}P.iconBox&&ge(e.collisionBox.collisionVertexArray,y.icon.placed,!1);var C=P.textCircles;if(C&&e.hasCollisionCircleData())for(var L=0;L<C.length;L+=5){var j=g||0===C[L+4];ge(e.collisionCircle.collisionVertexArray,y.text.placed,j)}}}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexBuffer&&e.collisionBox.collisionVertexBuffer.updateData(e.collisionBox.collisionVertexArray),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexBuffer&&e.collisionCircle.collisionVertexBuffer.updateData(e.collisionCircle.collisionVertexArray)},me.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},me.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},me.prototype.stillRecent=function(t){return this.commitTime+this.fadeDuration>t},me.prototype.setStale=function(){this.stale=!0};var ye=Math.pow(2,25),_e=Math.pow(2,24),be=Math.pow(2,17),xe=Math.pow(2,16),we=Math.pow(2,9),ke=Math.pow(2,8),Ee=Math.pow(2,1);function Se(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*ye+e*_e+r*be+e*xe+r*we+e*ke+r*Ee+e}var Te=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};Te.prototype.continuePlacement=function(t,e,r,i,n){for(;this._currentTileIndex<t.length;){var a=t[this._currentTileIndex];if(e.placeLayerTile(i,a,r,this._seenCrossTileIDs),this._currentTileIndex++,n())return!0}};var Ae=function(t,e,r,i,n,a,o){this.placement=new me(t,n,a,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1};Ae.prototype.isDone=function(){return this._done},Ae.prototype.continuePlacement=function(e,r,i){for(var n=this,a=t.browser.now(),o=function(){var e=t.browser.now()-a;return!n._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=r[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Te),this._inProgressLayer.continuePlacement(i[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ae.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Pe=512/t.EXTENT/2,Oe=function(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var i=0;i<e.length;i++){var n=e.get(i),a=n.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}};Oe.prototype.getScaledCoordinates=function(e,r){var i=r.canonical.z-this.tileID.canonical.z,n=Pe/Math.pow(2,i);return{x:Math.floor((r.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((r.canonical.y*t.EXTENT+e.anchorY)*n)}},Oe.prototype.findMatches=function(t,e,r){for(var i=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),n=0;n<t.length;n++){var a=t.get(n);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,e),u=0,l=o;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=i&&Math.abs(c.coord.y-s.y)<=i&&!r[c.crossTileID]){r[c.crossTileID]=!0,a.crossTileID=c.crossTileID;break}}}}};var Ie=function(){this.maxCrossTileID=0};Ie.prototype.generate=function(){return++this.maxCrossTileID};var Me=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Me.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var i=this.indexes[r],n={};for(var a in i){var o=i[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),n[o.tileID.key]=o}this.indexes[r]=n}this.lng=t},Me.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var n=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>t.overscaledZ)for(var s in o){var u=o[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,n)}else{var l=o[t.scaledTo(Number(a)).key];l&&l.findMatches(e.symbolInstances,t,n)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=r.generate(),n[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Oe(t,e.symbolInstances,e.bucketInstanceId),!0},Me.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var i=0,n=e.indexedSymbolInstances[r];i<n.length;i+=1){var a=n[i];delete this.usedCrossTileIDs[t][a.crossTileID]}},Me.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var i=this.indexes[r];for(var n in i)t[i[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,i[n]),delete i[n],e=!0)}return e};var Ce=function(){this.layerIndexes={},this.crossTileIDs=new Ie,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ce.prototype.addLayer=function(t,e,r){var i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Me);var n=!1,a={};i.handleWrapJump(r);for(var o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(u.tileID,l,this.crossTileIDs)&&(n=!0),a[l.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(n=!0),n},Ce.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[r]||delete this.layerIndexes[r]};var Le=function(e,r){return t.emitValidationErrors(e,r&&r.filter(function(t){return"source.canvas"!==t.identifier}))},je=t.pick(Dt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ze=t.pick(Dt,["setCenter","setZoom","setBearing","setPitch"]),Re=function(e){function r(i,n){var a=this;void 0===n&&(n={}),e.call(this),this.map=i,this.dispatcher=new k((jt||(jt=new Lt),jt),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new y(i._requestManager,n.localIdeographFontFamily),this.lineAtlas=new w(256,512),this.crossTileSymbolIndex=new Ce,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var o=this;this._rtlTextPluginCallback=r.registerForPluginAvailability(function(t){for(var e in o.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),o.sourceCaches)o.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var i in a._layers){var n=a._layers[i];n.source===r.id&&a._validateLayer(n)}}}})}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.loadURL=function(e,r){var i=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var n="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);var a=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(a,function(e,r){i._request=null,e?i.fire(new t.ErrorEvent(e)):r&&i._load(r,n)})},r.prototype.loadJSON=function(e,r){var i=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame(function(){i._request=null,i._load(e,!1!==r.validate)})},r.prototype._load=function(e,r){var i=this;if(!r||!Le(this,t.validateStyle(e))){for(var n in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(n,e.sources[n],{validate:!1});e.sprite?this._spriteRequest=function(e,r,i){var n,a,o,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),function(t,e){u=null,o||(o=t,n=e,c())}),l=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),function(t,e){l=null,o||(o=t,a=e,c())});function c(){if(o)i(o);else if(n&&a){var e=t.browser.getImageData(a),r={};for(var s in n){var u=n[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,v=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,v,{x:h,y:p},{x:0,y:0},{width:l,height:c}),r[s]={data:v,pixelRatio:d,sdf:f}}i(null,r)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e.sprite,this.map._requestManager,function(e,r){if(i._spriteRequest=null,e)i.fire(new t.ErrorEvent(e));else if(r)for(var n in r)i.imageManager.addImage(n,r[n]);i.imageManager.setLoaded(!0),i.fire(new t.Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var a=Ft(this.stylesheet.layers);this._order=a.map(function(t){return t.id}),this._layers={};for(var o=0,s=a;o<s.length;o+=1){var u=s[o];(u=t.createStyleLayer(u)).setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new x(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},r.prototype._validateLayer=function(e){var r=this.sourceCaches[e.source];if(r){var i=e.sourceLayer;if(i){var n=r.getSource();("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(i))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+i+'" does not exist on source "'+n.id+'" as specified by style layer "'+e.id+'"')))}}},r.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},r.prototype._serializeLayers=function(t){for(var e=[],r=0,i=t;r<i.length;r+=1){var n=i[r],a=this._layers[n];"custom"!==a.type&&e.push(a.serialize())}return e},r.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},r.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},r.prototype.update=function(e){if(this._loaded){var r=this._changed;if(this._changed){var i=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);for(var a in(i.length||n.length)&&this._updateWorkerLayers(i,n),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var u in this.sourceCaches)this.sourceCaches[u].used=!1;for(var l=0,c=this._order;l<c.length;l+=1){var h=c[l],p=this._layers[h];p.recalculate(e),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,r&&this.fire(new t.Event("data",{dataType:"style"}))}},r.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},r.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},r.prototype.setState=function(e){var r=this;if(this._checkLoaded(),Le(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Ft(e.layers);var i=function(e,r){if(!e)return[{command:Dt.setStyle,args:[r]}];var i=[];try{if(!t.deepEqual(e.version,r.version))return[{command:Dt.setStyle,args:[r]}];t.deepEqual(e.center,r.center)||i.push({command:Dt.setCenter,args:[r.center]}),t.deepEqual(e.zoom,r.zoom)||i.push({command:Dt.setZoom,args:[r.zoom]}),t.deepEqual(e.bearing,r.bearing)||i.push({command:Dt.setBearing,args:[r.bearing]}),t.deepEqual(e.pitch,r.pitch)||i.push({command:Dt.setPitch,args:[r.pitch]}),t.deepEqual(e.sprite,r.sprite)||i.push({command:Dt.setSprite,args:[r.sprite]}),t.deepEqual(e.glyphs,r.glyphs)||i.push({command:Dt.setGlyphs,args:[r.glyphs]}),t.deepEqual(e.transition,r.transition)||i.push({command:Dt.setTransition,args:[r.transition]}),t.deepEqual(e.light,r.light)||i.push({command:Dt.setLight,args:[r.light]});var n={},a=[];!function(e,r,i,n){var a;for(a in r=r||{},e=e||{})e.hasOwnProperty(a)&&(r.hasOwnProperty(a)||Nt(a,i,n));for(a in r)r.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.deepEqual(e[a],r[a])||("geojson"===e[a].type&&"geojson"===r[a].type&&Vt(e,r,a)?i.push({command:Dt.setGeoJSONSourceData,args:[a,r[a].data]}):Ut(a,r,i,n)):Bt(a,r,i))}(e.sources,r.sources,a,n);var o=[];e.layers&&e.layers.forEach(function(t){n[t.source]?i.push({command:Dt.removeLayer,args:[t.id]}):o.push(t)}),i=i.concat(a),function(e,r,i){r=r||[];var n,a,o,s,u,l,c,h=(e=e||[]).map(qt),p=r.map(qt),f=e.reduce(Zt,{}),d=r.reduce(Zt,{}),v=h.slice(),m=Object.create(null);for(n=0,a=0;n<h.length;n++)o=h[n],d.hasOwnProperty(o)?a++:(i.push({command:Dt.removeLayer,args:[o]}),v.splice(v.indexOf(o,a),1));for(n=0,a=0;n<p.length;n++)o=p[p.length-1-n],v[v.length-1-n]!==o&&(f.hasOwnProperty(o)?(i.push({command:Dt.removeLayer,args:[o]}),v.splice(v.lastIndexOf(o,v.length-a),1)):a++,l=v[v.length-n],i.push({command:Dt.addLayer,args:[d[o],l]}),v.splice(v.length-n,0,o),m[o]=!0);for(n=0;n<p.length;n++)if(s=f[o=p[n]],u=d[o],!m[o]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in Gt(s.layout,u.layout,i,o,null,Dt.setLayoutProperty),Gt(s.paint,u.paint,i,o,null,Dt.setPaintProperty),t.deepEqual(s.filter,u.filter)||i.push({command:Dt.setFilter,args:[o,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||i.push({command:Dt.setLayerZoomRange,args:[o,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Gt(s[c],u[c],i,o,c.slice(6),Dt.setPaintProperty):t.deepEqual(s[c],u[c])||i.push({command:Dt.setLayerProperty,args:[o,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?Gt(s[c],u[c],i,o,c.slice(6),Dt.setPaintProperty):t.deepEqual(s[c],u[c])||i.push({command:Dt.setLayerProperty,args:[o,c,u[c]]}))}else i.push({command:Dt.removeLayer,args:[o]}),l=v[v.lastIndexOf(o)+1],i.push({command:Dt.addLayer,args:[u,l]})}(o,r.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:Dt.setStyle,args:[r]}]}return i}(this.serialize(),e).filter(function(t){return!(t.command in ze)});if(0===i.length)return!1;var n=i.filter(function(t){return!(t.command in je)});if(n.length>0)throw new Error("Unimplemented: "+n.map(function(t){return t.command}).join(", ")+".");return i.forEach(function(t){"setTransition"!==t.command&&r[t.command].apply(r,t.args)}),this.stylesheet=e,!0},r.prototype.addImage=function(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},r.prototype.getImage=function(t){return this.imageManager.getImage(t)},r.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},r.prototype.addSource=function(e,r,i){var n=this;if(void 0===i&&(i={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!r.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(r).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,r,null,i))){this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);var a=this.sourceCaches[e]=new Ot(e,r,this.dispatcher);a.style=this,a.setEventedParent(this,function(){return{isSourceLoaded:n.loaded(),source:a.serialize(),sourceId:e}}),a.onAdd(this.map),this._changed=!0}},r.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+r+'" is using it.')));var i=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),i.setEventedParent(null),i.clearTiles(),i.onRemove&&i.onRemove(this.map),this._changed=!0},r.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},r.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},r.prototype.addLayer=function(e,r,i){void 0===i&&(i={}),this._checkLoaded();var n=e.id;if(this.getLayer(n))this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" already exists on this map')));else{var a;if("custom"===e.type){if(Le(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(n,e.source),e=t.clone$1(e),e=t.extend(e,{source:n})),this._validate(t.validateStyle.layer,"layers."+n,e,{arrayIndex:-1},i))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}})}var o=r?this._order.indexOf(r):this._order.length;if(r&&-1===o)this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.')));else{if(this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=a,this._removedLayers[n]&&a.source&&"custom"!==a.type){var s=this._removedLayers[n];delete this._removedLayers[n],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},r.prototype.moveLayer=function(e,r){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==r){var i=this._order.indexOf(e);this._order.splice(i,1);var n=r?this._order.indexOf(r):this._order.length;r&&-1===n?this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.'))):(this._order.splice(n,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},r.prototype.removeLayer=function(e){this._checkLoaded();var r=this._layers[e];if(r){r.setEventedParent(null);var i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},r.prototype.getLayer=function(t){return this._layers[t]},r.prototype.setLayerZoomRange=function(e,r,i){this._checkLoaded();var n=this.getLayer(e);n?n.minzoom===r&&n.maxzoom===i||(null!=r&&(n.minzoom=r),null!=i&&(n.maxzoom=i),this._updateLayer(n)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},r.prototype.setFilter=function(e,r,i){void 0===i&&(i={}),this._checkLoaded();var n=this.getLayer(e);if(n){if(!t.deepEqual(n.filter,r))return null==r?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(t.validateStyle.filter,"layers."+n.id+".filter",r,null,i)||(n.filter=t.clone$1(r),this._updateLayer(n)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},r.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},r.prototype.setLayoutProperty=function(e,r,i,n){void 0===n&&(n={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getLayoutProperty(r),i)||(a.setLayoutProperty(r,i,n),this._updateLayer(a)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getLayoutProperty=function(e,r){var i=this.getLayer(e);if(i)return i.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},r.prototype.setPaintProperty=function(e,r,i,n){void 0===n&&(n={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getPaintProperty(r),i)||(a.setPaintProperty(r,i,n)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},r.prototype.setFeatureState=function(e,r){this._checkLoaded();var i=e.source,n=e.sourceLayer,a=this.sourceCaches[i],o=parseInt(e.id,10);if(void 0!==a){var s=a.getSource().type;"geojson"===s&&n?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||n?isNaN(o)||o<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative."))):a.setFeatureState(n,o,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},r.prototype.removeFeatureState=function(e,r){this._checkLoaded();var i=e.source,n=this.sourceCaches[i];if(void 0!==n){var a=n.getSource().type,o="vector"===a?e.sourceLayer:void 0,s=parseInt(e.id,10);"vector"!==a||o?void 0!==e.id&&isNaN(s)||s<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be non-negative."))):r&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):n.removeFeatureState(o,s,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")))},r.prototype.getFeatureState=function(e){this._checkLoaded();var r=e.source,i=e.sourceLayer,n=this.sourceCaches[r],a=parseInt(e.id,10);if(void 0!==n)if("vector"!==n.getSource().type||i){if(!(isNaN(a)||a<0))return n.getFeatureState(i,a);this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative.")))}else this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},r.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},r.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},r.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},r.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},i={},n=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(r(o)){i[o]=a;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][o];if(l)for(var c=0,h=l;c<h.length;c+=1){var p=h[c];n.push(p)}}}}n.sort(function(t,e){return e.intersectionZ-t.intersectionZ});for(var f=[],d=this._order.length-1;d>=0;d--){var v=this._order[d];if(r(v))for(var m=n.length-1;m>=0;m--){var g=n[m].feature;if(i[g.layer.id]<d)break;f.push(g),n.pop()}else for(var y=0,_=t;y<_.length;y+=1){var b=_[y][v];if(b)for(var x=0,w=b;x<w.length;x+=1){var k=w[x];f.push(k.feature)}}}return f},r.prototype.queryRenderedFeatures=function(e,r,i){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter);var n={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,o=r.layers;a<o.length;a+=1){var s=o[a],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];n[u.source]=!0}}var l=[];for(var c in this.sourceCaches)r.layers&&!n[c]||l.push(R(this.sourceCaches[c],this._layers,e,r,i));return this.placement&&l.push(function(t,e,r,i,n,a){for(var o={},s=n.queryRenderedSymbols(r),u=[],l=0,c=Object.keys(s).map(Number);l<c.length;l+=1){var h=c[l];u.push(a[h])}u.sort(F);for(var p=function(){var e=d[f],r=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,i.filter,i.layers,t);for(var n in r){var a=o[n]=o[n]||[],u=r[n];u.sort(function(t,r){var i=e.featureSortOrder;if(i){var n=i.indexOf(t.featureIndex);return i.indexOf(r.featureIndex)-n}return r.featureIndex-t.featureIndex});for(var l=0,c=u;l<c.length;l+=1){var h=c[l];a.push(h)}}},f=0,d=u;f<d.length;f+=1)p();var v=function(r){o[r].forEach(function(i){var n=i.feature,a=t[r],o=e[a.source].getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=o})};for(var m in o)v(m);return o}(this._layers,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},r.prototype.querySourceFeatures=function(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter);var i=this.sourceCaches[e];return i?function(t,e){for(var r=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),i=[],n={},a=0;a<r.length;a++){var o=r[a],s=o.tileID.canonical.key;n[s]||(n[s]=!0,o.querySourceFeatures(i,e))}return i}(i,r):[]},r.prototype.addSourceType=function(t,e,i){return r.getSourceType(t)?i(new Error('A source type called "'+t+'" already exists.')):(r.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},r.prototype.getLight=function(){return this.light.getLight()},r.prototype.setLight=function(e,r){void 0===r&&(r={}),this._checkLoaded();var i=this.light.getLight(),n=!1;for(var a in e)if(!t.deepEqual(e[a],i[a])){n=!0;break}if(n){var o={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(o)}},r.prototype._validate=function(e,r,i,n,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Le(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:i,styleSpec:t.styleSpec},n)))},r.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove()},r.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},r.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},r.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},r.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},r.prototype._updatePlacement=function(e,r,i,n){for(var a=!1,o=!1,s={},u=0,l=this._order;u<l.length;u+=1){var c=l[u],h=this._layers[c];if("symbol"===h.type){if(!s[h.source]){var p=this.sourceCaches[h.source];s[h.source]=p.getRenderableIds(!0).map(function(t){return p.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var f=this.crossTileSymbolIndex.addLayer(h,s[h.source],e.center.lng);a=a||f}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var d=this._layerOrderChanged||0===i;if((d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now()))&&(this.pauseablePlacement=new Ae(e,this._order,d,r,i,n,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),o=!0),a&&this.pauseablePlacement.placement.setStale()),o||a)for(var v=0,m=this._order;v<m.length;v+=1){var g=m[v],y=this._layers[g];"symbol"===y.type&&this.placement.updateLayerOpacities(y,s[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},r.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},r.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r)},r.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},r.prototype.getResource=function(e,r,i){return t.makeRequest(r,i)},r}(t.Evented);Re.getSourceType=function(t){return L[t]},Re.setSourceType=function(t,e){L[t]=e},Re.registerForPluginAvailability=t.registerForPluginAvailability;var Fe=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),De=lr("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Be=lr("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ne=lr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ue=lr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvarying vec3 v_data;void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ve=lr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ge=lr("#pragma mapbox: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),qe=lr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ze=lr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Xe=lr("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),We=lr("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),He=lr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Ye=lr("#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_pos;void main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Ke=lr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Je=lr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Qe=lr("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),$e=lr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),tr=lr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;return (data.r+data.g*256.0+data.b*256.0*256.0)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),er=lr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),rr=lr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),ir=lr("#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),nr=lr("uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_gl_units_to_pixels;uniform mediump float u_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}"),ar=lr("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0/DEVICE_PIXEL_RATIO/2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),or=lr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),sr=lr("uniform sampler2D u_texture;\n#pragma mapbox: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;\n#pragma mapbox: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;void main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),ur=lr("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}");function lr(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i={};return{fragmentSource:t=t.replace(r,function(t,e,r,n,a){return i[a]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nvarying "+r+" "+n+" "+a+";\n#else\nuniform "+r+" "+n+" u_"+a+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+a+"\n    "+r+" "+n+" "+a+" = u_"+a+";\n#endif\n"}),vertexSource:e=e.replace(r,function(t,e,r,n,a){var o="float"===n?"vec2":"vec4",s=a.match(/color/)?"color":o;return i[a]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nuniform lowp float a_"+a+"_t;\nattribute "+r+" "+o+" a_"+a+";\nvarying "+r+" "+n+" "+a+";\n#else\nuniform "+r+" "+n+" u_"+a+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+a+" = a_"+a+";\n#else\n    "+r+" "+n+" "+a+" = u_"+a+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+a+" = unpack_mix_"+s+"(a_"+a+", a_"+a+"_t);\n#else\n    "+r+" "+n+" "+a+" = u_"+a+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+a+"\nuniform lowp float a_"+a+"_t;\nattribute "+r+" "+o+" a_"+a+";\n#else\nuniform "+r+" "+n+" u_"+a+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+r+" "+n+" "+a+" = a_"+a+";\n#else\n    "+r+" "+n+" "+a+" = u_"+a+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+a+"\n    "+r+" "+n+" "+a+" = unpack_mix_"+s+"(a_"+a+", a_"+a+"_t);\n#else\n    "+r+" "+n+" "+a+" = u_"+a+";\n#endif\n"})}}var cr=Object.freeze({prelude:De,background:Be,backgroundPattern:Ne,circle:Ue,clippingMask:Ve,heatmap:Ge,heatmapTexture:qe,collisionBox:Ze,collisionCircle:Xe,debug:We,fill:He,fillOutline:Ye,fillOutlinePattern:Ke,fillPattern:Je,fillExtrusion:Qe,fillExtrusionPattern:$e,hillshadePrepare:tr,hillshade:er,line:rr,lineGradient:ir,linePattern:nr,lineSDF:ar,raster:or,symbolIcon:sr,symbolSDF:ur}),hr=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};hr.prototype.bind=function(t,e,r,i,n,a,o,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==i.length,l=0;!u&&l<i.length;l++)this.boundPaintVertexBuffers[l]!==i[l]&&(u=!0);var c=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==r||u||this.boundIndexBuffer!==n||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||c?this.freshBind(e,r,i,n,a,o,s):(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind())},hr.prototype.freshBind=function(t,e,r,i,n,a,o){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=r;p<f.length;p+=1)f[p].enableAttributes(c,t);a&&a.enableAttributes(c,t),o&&o.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,n);for(var d=0,v=r;d<v.length;d+=1){var m=v[d];m.bind(),m.setVertexAttribPointers(c,t,n)}a&&(a.bind(),a.setVertexAttribPointers(c,t,n)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(c,t,n)),l.currentNumAttributes=u},hr.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var pr=function(e,r,i,n,a){var o=e.gl;this.program=o.createProgram();var s=i.defines().concat("#define DEVICE_PIXEL_RATIO "+t.browser.devicePixelRatio.toFixed(1));a&&s.push("#define OVERDRAW_INSPECTOR;");var u=s.concat(De.fragmentSource,r.fragmentSource).join("\n"),l=s.concat(De.vertexSource,r.vertexSource).join("\n"),c=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(c,u),o.compileShader(c),o.attachShader(this.program,c);var h=o.createShader(o.VERTEX_SHADER);o.shaderSource(h,l),o.compileShader(h),o.attachShader(this.program,h);for(var p=i.layoutAttributes||[],f=0;f<p.length;f++)o.bindAttribLocation(this.program,f,p[f].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={};for(var d={},v=0;v<this.numAttributes;v++){var m=o.getActiveAttrib(this.program,v);m&&(this.attributes[m.name]=o.getAttribLocation(this.program,m.name))}for(var g=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),y=0;y<g;y++){var _=o.getActiveUniform(this.program,y);_&&(d[_.name]=o.getUniformLocation(this.program,_.name))}this.fixedUniforms=n(e,d),this.binderUniforms=i.getUniforms(e,d)};function fr(e,r,i){var n=1/le(i,1,r.transform.tileZoom),a=Math.pow(2,i.tileID.overscaledZ),o=i.tileSize*Math.pow(2,r.transform.tileZoom)/a,s=o*(i.tileID.canonical.x+i.tileID.wrap*a),u=o*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_scale:[t.browser.devicePixelRatio,n,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,u>>16],u_pixel_coord_lower:[65535&s,65535&u]}}pr.prototype.draw=function(t,e,r,i,n,a,o,s,u,l,c,h,p,f,d,v){var m,g=t.gl;for(var y in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(i),t.setColorMode(n),t.setCullFace(a),this.fixedUniforms)this.fixedUniforms[y].set(o[y]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var _=(m={},m[g.LINES]=2,m[g.TRIANGLES]=3,m[g.LINE_STRIP]=1,m)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],k=w.vaos||(w.vaos={});(k[s]||(k[s]=new hr)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,v),g.drawElements(e,w.primitiveLength*_,g.UNSIGNED_SHORT,w.primitiveOffset*_*2)}};var dr=function(e,r,i,n){var a=r.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],u=t.create$1();"viewport"===a.properties.get("anchor")&&t.fromRotation(u,-r.transform.angle),t.transformMat3(s,s,u);var l=a.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+i,u_opacity:n}},vr=function(e,r,i,n,a,o,s){return t.extend(dr(e,r,i,n),fr(o,r,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},mr=function(t){return{u_matrix:t}},gr=function(e,r,i,n){return t.extend(mr(e),fr(i,r,n))},yr=function(t,e){return{u_matrix:t,u_world:e}},_r=function(e,r,i,n,a){return t.extend(gr(e,r,i,n),{u_world:a})},br=function(t,e,r,i){var n,a,o=t.transform;if("map"===i.paint.get("circle-pitch-alignment")){var s=le(r,1,o.zoom);n=!0,a=[s,s]}else n=!1,a=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:t.translatePosMatrix(e.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+n,u_extrude_scale:a}},xr=function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,r.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,r.u_overscale_factor)}},wr=function(t,e,r){var i=le(r,1,e.zoom),n=Math.pow(2,e.zoom-r.tileID.overscaledZ),a=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:i,u_extrude_scale:[e.pixelsToGLUnits[0]/(i*n),e.pixelsToGLUnits[1]/(i*n)],u_overscale_factor:a}},kr=function(t,e){return{u_matrix:t,u_color:e}},Er=function(t){return{u_matrix:t}},Sr=function(t,e,r,i){return{u_matrix:t,u_extrude_scale:le(e,1,r),u_intensity:i}},Tr=function(t,e,r){var i=r.paint.get("hillshade-shadow-color"),n=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),o=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(o-=t.transform.angle);var s=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),s),u_image:0,u_latrange:Pr(0,e.tileID),u_light:[r.paint.get("hillshade-exaggeration"),o],u_shadow:i,u_highlight:n,u_accent:a}},Ar=function(e,r){var i=e.dem.stride,n=t.create();return t.ortho(n,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(n,n,[0,-t.EXTENT,0]),{u_matrix:n,u_image:1,u_dimension:[i,i],u_zoom:e.tileID.overscaledZ,u_maxzoom:r}};function Pr(e,r){var i=Math.pow(2,r.canonical.z),n=r.canonical.y;return[new t.MercatorCoordinate(0,n/i).toLngLat().lat,new t.MercatorCoordinate(0,(n+1)/i).toLngLat().lat]}var Or=function(t,e,r){var i=t.transform;return{u_matrix:jr(t,e,r),u_ratio:1/le(e,1,i.zoom),u_gl_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Ir=function(e,r,i){return t.extend(Or(e,r,i),{u_image:0})},Mr=function(e,r,i,n){var a=e.transform,o=Lr(r,a);return{u_matrix:jr(e,r,i),u_texsize:r.imageAtlasTexture.size,u_ratio:1/le(r,1,a.zoom),u_image:0,u_scale:[t.browser.devicePixelRatio,o,n.fromScale,n.toScale],u_fade:n.t,u_gl_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Cr=function(e,r,i,n,a){var o=e.transform,s=e.lineAtlas,u=Lr(r,o),l="round"===i.layout.get("line-cap"),c=s.getDash(n.from,l),h=s.getDash(n.to,l),p=c.width*a.fromScale,f=h.width*a.toScale;return t.extend(Or(e,r,i),{u_patternscale_a:[u/p,-c.height/2],u_patternscale_b:[u/f,-h.height/2],u_sdfgamma:s.width/(256*Math.min(p,f)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:h.y,u_mix:a.t})};function Lr(t,e){return 1/le(t,1,e.tileZoom)}function jr(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}var zr=function(t,e,r,i,n){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(o=n.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=n.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Rr(n.paint.get("raster-hue-rotate"))};var a,o};function Rr(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}var Fr=function(t,e,r,i,n,a,o,s,u,l){var c=n.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:c.width/c.height,u_fade_change:n.options.fadeDuration?n.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_gl_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+i,u_texsize:l,u_texture:0}},Dr=function(e,r,i,n,a,o,s,u,l,c,h){var p=a.transform;return t.extend(Fr(e,r,i,n,a,o,s,u,l,c),{u_gamma_scale:n?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_is_halo:+h})},Br=function(t,e,r){return{u_matrix:t,u_opacity:e,u_color:r}},Nr=function(e,r,i,n,a,o){return t.extend(function(t,e,r,i){var n=r.imageManager.getPattern(t.from),a=r.imageManager.getPattern(t.to),o=r.imageManager.getPixelSize(),s=o.width,u=o.height,l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,r.transform.tileZoom)/l,h=c*(i.tileID.canonical.x+i.tileID.wrap*l),p=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:n.tl,u_pattern_br_a:n.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:n.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/le(i,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(n,o,i,a),{u_matrix:e,u_opacity:r})},Ur={fillExtrusion:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fillExtrusionPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fill:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},fillPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},fillOutline:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}},fillOutlinePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},circle:function(e,r){return{u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,r.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},collisionBox:xr,collisionCircle:xr,debug:function(e,r){return{u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},clippingMask:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmap:function(e,r){return{u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmapTexture:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}},hillshade:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}},hillshadePrepare:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_maxzoom:new t.Uniform1f(e,r.u_maxzoom)}},line:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels)}},lineGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels),u_image:new t.Uniform1i(e,r.u_image)}},linePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_ratio:new t.Uniform1f(e,r.u_ratio),u_image:new t.Uniform1i(e,r.u_image),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},lineSDF:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_gl_units_to_pixels:new t.Uniform2f(e,r.u_gl_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,r.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,r.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,r.u_sdfgamma),u_image:new t.Uniform1i(e,r.u_image),u_tex_y_a:new t.Uniform1f(e,r.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,r.u_tex_y_b),u_mix:new t.Uniform1f(e,r.u_mix)}},raster:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,r.u_buffer_scale),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights)}},symbolIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,r.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture)}},symbolSDF:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_gl_coord_matrix:new t.UniformMatrix4f(e,r.u_gl_coord_matrix),u_is_text:new t.Uniform1f(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_is_halo:new t.Uniform1f(e,r.u_is_halo)}},background:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}},backgroundPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}}};function Vr(e,r){for(var i=e.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),n=0;n<i.length;n++){var a={},o=i[n],s=i.slice(n+1);Gr(o.tileID.wrapped(),o.tileID,s,new t.OverscaledTileID(0,o.tileID.wrap+1,0,0,0),a),o.setMask(a,r)}}function Gr(e,r,i,n,a){for(var o=0;o<i.length;o++){var s=i[o];if(n.isLessThan(s.tileID))break;if(r.key===s.tileID.key)return;if(s.tileID.isChildOf(r)){for(var u=r.children(1/0),l=0;l<u.length;l++)Gr(e,u[l],i.slice(o),n,a);return}}var c=r.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(c,r.canonical.x-(e.canonical.x<<c),r.canonical.y-(e.canonical.y<<c));a[h.key]=a[h.key]||h}function qr(t,e,r,i,n){for(var a=t.context,o=a.gl,s=n?t.useProgram("collisionCircle"):t.useProgram("collisionBox"),u=0;u<i.length;u++){var l=i[u],c=e.getTile(l),h=c.getBucket(r);if(h){var p=n?h.collisionCircle:h.collisionBox;p&&s.draw(a,n?o.TRIANGLES:o.LINES,Et.disabled,St.disabled,t.colorModeForRenderPass(),At.disabled,wr(l.posMatrix,t.transform,c),r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,null,t.transform.zoom,null,null,p.collisionVertexBuffer)}}}var Zr=t.identity(new Float32Array(16)),Xr=t.properties.layout;function Wr(e,r,i,n,a,o){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*r,l=-(s.verticalAlign-.5)*i,c=t.evaluateRadialOffset(e,n);return new t.Point((u/a+c[0])*o,(l/a+c[1])*o)}function Hr(e,r,i,n,a,o,s,u,l,c){var h=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray;p.clear();for(var f=0;f<h.length;f++){var d=h.get(f),v=!d.hidden&&d.crossTileID?n[d.crossTileID]:null;if(v){var m=new t.Point(d.anchorX,d.anchorY),g=Kt(m,i?u:s),y=.5+o.cameraToCenterDistance/g.signedDistanceFromCamera*.5,_=a.evaluateSizeForFeature(e.textSizeData,c,d)*y/t.ONE_EM;i&&(_*=e.tilePixelRatio/l);for(var b=v.width,x=v.height,w=v.radialOffset,k=v.textBoxScale,E=Wr(v.anchor,b,x,w,k,_),S=i?Kt(m.add(E),s).point:g.point.add(r?E.rotate(-o.angle):E),T=0;T<d.numGlyphs;T++)t.addDynamicAttributes(p,S,0)}else ae(d.numGlyphs,p)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function Yr(e,r,i,n,a,o,s,u,l,c,h,p,f){for(var d,v,m=e.context,g=m.gl,y=e.transform,_="map"===u,b="map"===l,x=_&&"point"!==i.layout.get("symbol-placement"),w=_&&!b&&!x,k=void 0!==i.layout.get("symbol-sort-key").constantOr(1),E=e.depthModeForSublayer(0,Et.ReadOnly),S=i.layout.get("text-variable-anchor"),T=[],A=0,P=n;A<P.length;A+=1){var O=P[A],I=r.getTile(O),M=I.getBucket(i);if(M){var C=a?M.text:M.icon;if(C&&C.segments.get().length){var L=C.programConfigurations.get(i.id),j=a||M.sdfIcons,z=a?M.textSizeData:M.iconSizeData;d||(d=e.useProgram(j?"symbolSDF":"symbolIcon",L),v=t.evaluateSizeForZoom(z,y.zoom,Xr.properties[a?"text-size":"icon-size"])),m.activeTexture.set(g.TEXTURE0);var R=void 0,F=void 0,D=void 0;if(a)F=I.glyphAtlasTexture,D=g.LINEAR,R=I.glyphAtlasTexture.size;else{var B=1!==i.layout.get("icon-size").constantOr(0)||M.iconsNeedLinear,N=b||0!==y.pitch;F=I.imageAtlasTexture,D=j||e.options.rotating||e.options.zooming||B||N?g.LINEAR:g.NEAREST,R=I.imageAtlasTexture.size}var U=le(I,1,e.transform.zoom),V=Ht(O.posMatrix,b,_,e.transform,U),G=Yt(O.posMatrix,b,_,e.transform,U);if(x)Qt(M,O.posMatrix,e,a,V,G,b,c);else if(a&&v&&S){var q=Math.pow(2,y.zoom-I.tileID.overscaledZ);Hr(M,_,b,f,t.symbolSize,y,V,O.posMatrix,q,v)}var Z=e.translatePosMatrix(O.posMatrix,I,o,s),X=x||a&&S?Zr:V,W=e.translatePosMatrix(G,I,o,s,!0),H=j&&0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Y={program:d,buffers:C,uniformValues:j?Dr(z.functionType,v,w,b,e,Z,X,W,a,R,!0):Fr(z.functionType,v,w,b,e,Z,X,W,a,R),atlasTexture:F,atlasInterpolation:D,isSDF:j,hasHalo:H};if(k)for(var K=0,J=C.segments.get();K<J.length;K+=1){var Q=J[K];T.push({segments:new t.SegmentVector([Q]),sortKey:Q.sortKey,state:Y})}else T.push({segments:C.segments,sortKey:0,state:Y})}}}k&&T.sort(function(t,e){return t.sortKey-e.sortKey});for(var $=0,tt=T;$<tt.length;$+=1){var et=tt[$],rt=et.state;if(rt.atlasTexture.bind(rt.atlasInterpolation,g.CLAMP_TO_EDGE),rt.isSDF){var it=rt.uniformValues;rt.hasHalo&&(it.u_is_halo=1,Kr(rt.buffers,et.segments,i,e,rt.program,E,h,p,it)),it.u_is_halo=0}Kr(rt.buffers,et.segments,i,e,rt.program,E,h,p,rt.uniformValues)}}function Kr(t,e,r,i,n,a,o,s,u){var l=i.context,c=l.gl;n.draw(l,c.TRIANGLES,a,o,s,At.disabled,u,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,i.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Jr(t,e,r,i,n,a,o){var s,u,l,c,h,p=t.context.gl,f=r.paint.get("fill-pattern"),d=f&&f.constantOr(1),v=r.getCrossfadeParameters();o?(u=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var m=0,g=i;m<g.length;m+=1){var y=g[m],_=e.getTile(y);if(!d||_.patternsLoaded()){var b=_.getBucket(r);if(b){var x=b.programConfigurations.get(r.id),w=t.useProgram(u,x);d&&(t.context.activeTexture.set(p.TEXTURE0),_.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),x.updatePatternPaintBuffers(v));var k=f.constantOr(null);if(k&&_.imageAtlas){var E=_.imageAtlas.patternPositions[k.to],S=_.imageAtlas.patternPositions[k.from];E&&S&&x.setConstantPatternPositions(E,S)}var T=t.translatePosMatrix(y.posMatrix,_,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(o){c=b.indexBuffer2,h=b.segments2;var A=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?_r(T,t,v,_,A):yr(T,A)}else c=b.indexBuffer,h=b.segments,l=d?gr(T,t,v,_):mr(T);w.draw(t.context,s,n,t.stencilModeForClipping(y),a,At.disabled,l,r.id,b.layoutVertexBuffer,c,h,r.paint,t.transform.zoom,x)}}}}function Qr(t,e,r,i,n,a,o){for(var s=t.context,u=s.gl,l=r.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity"),f=0,d=i;f<d.length;f+=1){var v=d[f],m=e.getTile(v),g=m.getBucket(r);if(g){var y=g.programConfigurations.get(r.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",y);c&&(t.context.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePatternPaintBuffers(h));var b=l.constantOr(null);if(b&&m.imageAtlas){var x=m.imageAtlas.patternPositions[b.to],w=m.imageAtlas.patternPositions[b.from];x&&w&&y.setConstantPatternPositions(x,w)}var k=t.translatePosMatrix(v.posMatrix,m,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),E=r.paint.get("fill-extrusion-vertical-gradient"),S=c?vr(k,t,E,p,v,h,m):dr(k,t,E,p);_.draw(s,s.gl.TRIANGLES,n,a,o,At.backCCW,S,r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,y)}}}function $r(t,e,r,i,n,a){var o=t.context,s=o.gl,u=e.fbo;if(u){var l=t.useProgram("hillshade");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get());var c=Tr(t,e,r);e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments?l.draw(o,s.TRIANGLES,i,n,a,At.disabled,c,r.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments):l.draw(o,s.TRIANGLES,i,n,a,At.disabled,c,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function ti(e,r,i,n,a,o,s){var u=e.context,l=u.gl;if(r.dem&&r.dem.data){var c=r.dem.dim,h=r.dem.stride,p=r.dem.getPixels();if(u.activeTexture.set(l.TEXTURE1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(h),r.demTexture){var f=r.demTexture;f.update(p,{premultiply:!1}),f.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else r.demTexture=new t.Texture(u,p,l.RGBA,{premultiply:!1}),r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);u.activeTexture.set(l.TEXTURE0);var d=r.fbo;if(!d){var v=new t.Texture(u,{width:c,height:c,data:null},l.RGBA);v.bind(l.LINEAR,l.CLAMP_TO_EDGE),(d=r.fbo=u.createFramebuffer(c,c)).colorAttachment.set(v.texture)}u.bindFramebuffer.set(d.framebuffer),u.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(u,l.TRIANGLES,a,o,s,At.disabled,Ar(r,n),i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function ei(e,r,i,n,a){var o=n.paint.get("raster-fade-duration");if(o>0){var s=t.browser.now(),u=(s-e.timeAdded)/o,l=r?(s-r.timeAdded)/o:-1,c=i.getSource(),h=a.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function ri(e,r,i){var n=e.context,a=n.gl,o=i.posMatrix,s=e.useProgram("debug"),u=Et.disabled,l=St.disabled,c=e.colorModeForRenderPass(),h="$debug";s.draw(n,a.LINE_STRIP,u,l,c,At.disabled,kr(o,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);for(var p=r.getTileByID(i.key).latestRawTileData,f=p&&p.byteLength||0,d=Math.floor(f/1024),v=function(t,e,r,i){i=i||1;var n,a,o,s,u,l,c,h,p=[];for(n=0,a=t.length;n<a;n++)if(u=ii[t[n]]){for(h=null,o=0,s=u[1].length;o<s;o+=2)-1===u[1][o]&&-1===u[1][o+1]?h=null:(l=e+u[1][o]*i,c=200-u[1][o+1]*i,h&&p.push(h.x,h.y,l,c),h={x:l,y:c});e+=u[0]*i}return p}(i.toString()+" "+d+"kb",50,0,5),m=new t.StructArrayLayout2i4,g=new t.StructArrayLayout2ui4,y=0;y<v.length;y+=2)m.emplaceBack(v[y],v[y+1]),g.emplaceBack(y,y+1);for(var _=n.createVertexBuffer(m,Fe.members),b=n.createIndexBuffer(g),x=t.SegmentVector.simpleSegment(0,0,m.length/2,m.length/2),w=r.getTile(i).tileSize,k=t.EXTENT/(Math.pow(2,e.transform.zoom-i.overscaledZ)*w),E=[[-1,-1],[-1,1],[1,-1],[1,1]],S=0;S<E.length;S++){var T=E[S];s.draw(n,a.LINES,u,l,c,At.disabled,kr(t.translate([],o,[k*T[0],k*T[1],0]),t.Color.white),h,_,b,x)}s.draw(n,a.LINES,u,l,c,At.disabled,kr(o,t.Color.black),h,_,b,x)}var ii={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},ni={symbol:function(t,e,r,i,n){if("translucent"===t.renderPass){var a=St.disabled,o=t.colorModeForRenderPass();0!==r.paint.get("icon-opacity").constantOr(1)&&Yr(t,e,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,o,n),0!==r.paint.get("text-opacity").constantOr(1)&&Yr(t,e,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,o,n),e.map.showCollisionBoxes&&function(t,e,r,i){qr(t,e,r,i,!1),qr(t,e,r,i,!0)}(t,e,r,i)}},circle:function(t,e,r,i){if("translucent"===t.renderPass){var n=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),o=r.paint.get("circle-stroke-opacity");if(0!==n.constantOr(1)||0!==a.constantOr(1)&&0!==o.constantOr(1))for(var s=t.context,u=s.gl,l=t.depthModeForSublayer(0,Et.ReadOnly),c=St.disabled,h=t.colorModeForRenderPass(),p=0;p<i.length;p++){var f=i[p],d=e.getTile(f),v=d.getBucket(r);if(v){var m=v.programConfigurations.get(r.id);t.useProgram("circle",m).draw(s,u.TRIANGLES,l,c,h,At.disabled,br(t,f,d,r),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,r.paint,t.transform.zoom,m)}}}},heatmap:function(e,r,i,n){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var a=e.context,o=a.gl,s=e.depthModeForSublayer(0,Et.ReadOnly),u=St.disabled,l=new Tt([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var i=t.gl;t.activeTexture.set(i.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var n=r.heatmapFbo;if(n)i.bindTexture(i.TEXTURE_2D,n.colorAttachment.get()),t.bindFramebuffer.set(n.framebuffer);else{var a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),n=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,r,i,n){var a=e.gl;a.texImage2D(a.TEXTURE_2D,0,a.RGBA,r.width/4,r.height/4,0,a.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:a.UNSIGNED_BYTE,null),n.colorAttachment.set(i),e.extTextureHalfFloat&&a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,n.colorAttachment.setDirty(),t(e,r,i,n))}(t,e,a,n)}}(a,e,i),a.clear({color:t.Color.transparent});for(var c=0;c<n.length;c++){var h=n[c];if(!r.hasRenderableParent(h)){var p=r.getTile(h),f=p.getBucket(i);if(f){var d=f.programConfigurations.get(i.id),v=e.useProgram("heatmap",d),m=e.transform.zoom;v.draw(a,o.TRIANGLES,s,u,l,At.disabled,Sr(h.posMatrix,p,m,i.paint.get("heatmap-intensity")),i.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,i.paint,e.transform.zoom,d)}}}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){var i=e.context,n=i.gl,a=r.heatmapFbo;if(a){i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),i.activeTexture.set(n.TEXTURE1);var o=r.colorRampTexture;o||(o=r.colorRampTexture=new t.Texture(i,r.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,n.TRIANGLES,Et.disabled,St.disabled,e.colorModeForRenderPass(),At.disabled,function(e,r,i,n){var a=t.create();t.ortho(a,0,e.width,e.height,0,0,1);var o=e.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:i,u_color_ramp:n,u_opacity:r.paint.get("heatmap-opacity")}}(e,r,0,1),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}}(e,i))},line:function(e,r,i,n){if("translucent"===e.renderPass){var a=i.paint.get("line-opacity"),o=i.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1)){var s=e.depthModeForSublayer(0,Et.ReadOnly),u=e.colorModeForRenderPass(),l=i.paint.get("line-dasharray"),c=i.paint.get("line-pattern"),h=c.constantOr(1),p=i.paint.get("line-gradient"),f=i.getCrossfadeParameters(),d=l?"lineSDF":h?"linePattern":p?"lineGradient":"line",v=e.context,m=v.gl,g=!0;if(p){v.activeTexture.set(m.TEXTURE0);var y=i.gradientTexture;if(!i.gradient)return;y||(y=i.gradientTexture=new t.Texture(v,i.gradient,m.RGBA)),y.bind(m.LINEAR,m.CLAMP_TO_EDGE)}for(var _=0,b=n;_<b.length;_+=1){var x=b[_],w=r.getTile(x);if(!h||w.patternsLoaded()){var k=w.getBucket(i);if(k){var E=k.programConfigurations.get(i.id),S=e.context.program.get(),T=e.useProgram(d,E),A=g||T.program!==S,P=c.constantOr(null);if(P&&w.imageAtlas){var O=w.imageAtlas.patternPositions[P.to],I=w.imageAtlas.patternPositions[P.from];O&&I&&E.setConstantPatternPositions(O,I)}var M=l?Cr(e,w,i,l,f):h?Mr(e,w,i,f):p?Ir(e,w,i):Or(e,w,i);l&&(A||e.lineAtlas.dirty)?(v.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(v)):h&&(v.activeTexture.set(m.TEXTURE0),w.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),E.updatePatternPaintBuffers(f)),T.draw(v,m.TRIANGLES,s,e.stencilModeForClipping(x),u,At.disabled,M,i.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,i.paint,e.transform.zoom,E),g=!1}}}}}},fill:function(e,r,i,n){var a=i.paint.get("fill-color"),o=i.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=e.colorModeForRenderPass(),u=i.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===a.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Et.ReadWrite:Et.ReadOnly);Jr(e,r,i,n,c,s,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){var h=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);Jr(e,r,i,n,h,s,!0)}}},"fill-extrusion":function(t,e,r,i){var n=r.paint.get("fill-extrusion-opacity");if(0!==n&&"translucent"===t.renderPass){var a=new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D);if(1!==n||r.paint.get("fill-extrusion-pattern").constantOr(1))Qr(t,e,r,i,a,St.disabled,Tt.disabled),Qr(t,e,r,i,a,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var o=t.colorModeForRenderPass();Qr(t,e,r,i,a,St.disabled,o)}}},hillshade:function(t,e,r,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var n=t.context,a=e.getSource().maxzoom,o=t.depthModeForSublayer(0,Et.ReadOnly),s=St.disabled,u=t.colorModeForRenderPass(),l=0,c=i;l<c.length;l+=1){var h=c[l],p=e.getTile(h);p.needsHillshadePrepare&&"offscreen"===t.renderPass?ti(t,p,r,a,o,s,u):"translucent"===t.renderPass&&$r(t,p,r,o,s,u)}n.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,i){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity"))for(var n=t.context,a=n.gl,o=e.getSource(),s=t.useProgram("raster"),u=St.disabled,l=t.colorModeForRenderPass(),c=i.length&&i[0].overscaledZ,h=!t.options.moving,p=0,f=i;p<f.length;p+=1){var d=f[p],v=t.depthModeForSublayer(d.overscaledZ-c,1===r.paint.get("raster-opacity")?Et.ReadWrite:Et.ReadOnly,a.LESS),m=e.getTile(d),g=t.transform.calculatePosMatrix(d.toUnwrapped(),h);m.registerFadeDuration(r.paint.get("raster-fade-duration"));var y=e.findLoadedParent(d,0),_=ei(m,y,e,r,t.transform),b=void 0,x=void 0,w="nearest"===r.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;n.activeTexture.set(a.TEXTURE0),m.texture.bind(w,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),n.activeTexture.set(a.TEXTURE1),y?(y.texture.bind(w,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),b=Math.pow(2,y.tileID.overscaledZ-m.tileID.overscaledZ),x=[m.tileID.canonical.x*b%1,m.tileID.canonical.y*b%1]):m.texture.bind(w,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var k=zr(g,x||[0,0],b||1,_,r);o instanceof I?s.draw(n,a.TRIANGLES,v,u,l,At.disabled,k,r.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):m.maskedBoundsBuffer&&m.maskedIndexBuffer&&m.segments?s.draw(n,a.TRIANGLES,v,u,l,At.disabled,k,r.id,m.maskedBoundsBuffer,m.maskedIndexBuffer,m.segments,r.paint,t.transform.zoom):s.draw(n,a.TRIANGLES,v,u,l,At.disabled,k,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var i=r.paint.get("background-color"),n=r.paint.get("background-opacity");if(0!==n){var a=t.context,o=a.gl,s=t.transform,u=s.tileSize,l=r.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=l||1!==i.a||1!==n?"translucent":"opaque";if(t.renderPass===c){var h=St.disabled,p=t.depthModeForSublayer(0,"opaque"===c?Et.ReadWrite:Et.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});l&&(a.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context));for(var m=r.getCrossfadeParameters(),g=0,y=v;g<y.length;g+=1){var _=y[g],b=t.transform.calculatePosMatrix(_.toUnwrapped()),x=l?Nr(b,n,t,l,{tileID:_,tileSize:u},m):Br(b,n,i);d.draw(a,o.TRIANGLES,p,h,f,At.disabled,x,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,r){for(var i=0;i<r.length;i++)ri(t,e,r[i])},custom:function(t,e,r){var i=t.context,n=r.implementation;if("offscreen"===t.renderPass){var a=n.prerender;a&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),a.call(n,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(St.disabled);var o="3d"===n.renderingMode?new Et(t.context.gl.LEQUAL,Et.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Et.ReadOnly);i.setDepthMode(o),n.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}},ai=function(e,r){this.context=new Pt(e),this.transform=r,this._tileTextures={},this.setup(),this.numSublayers=Ot.maxUnderzooming+Ot.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.ProgramConfiguration,this.crossTileSymbolIndex=new Ce};function oi(t,e){if(t.y>e.y){var r=t;t=e,e=r}return{x0:t.x,y0:t.y,x1:e.x,y1:e.y,dx:e.x-t.x,dy:e.y-t.y}}function si(t,e,r,i,n){var a=Math.max(r,Math.floor(e.y0)),o=Math.min(i,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,l=e.dx/e.dy,c=t.dx>0,h=e.dx<0,p=a;p<o;p++){var f=u*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=l*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;n(Math.floor(d),Math.ceil(f),p)}}function ui(t,e,r,i,n,a){var o,s=oi(t,e),u=oi(e,r),l=oi(r,t);s.dy>u.dy&&(o=s,s=u,u=o),s.dy>l.dy&&(o=s,s=l,l=o),u.dy>l.dy&&(o=u,u=l,l=o),s.dy&&si(l,s,i,n,a),u.dy&&si(l,u,i,n,a)}ai.prototype.resize=function(e,r){var i=this.context.gl;if(this.width=e*t.browser.devicePixelRatio,this.height=r*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,a=this.style._order;n<a.length;n+=1){var o=a[n];this.style._layers[o].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},ai.prototype.setup=function(){var e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,Fe.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var i=new t.StructArrayLayout2i4;i.emplaceBack(0,0),i.emplaceBack(t.EXTENT,0),i.emplaceBack(0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(i,Fe.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var n=new t.StructArrayLayout4i8;n.emplaceBack(0,0,0,0),n.emplaceBack(t.EXTENT,0,t.EXTENT,0),n.emplaceBack(0,t.EXTENT,0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(n,t.rasterBoundsAttributes.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,Fe.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);var u=this.context.gl;this.stencilClearMode=new St({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},ai.prototype.clearStencil=function(){var e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var i=t.create();t.ortho(i,0,this.width,this.height,0,0,1),t.scale(i,i,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,Et.disabled,this.stencilClearMode,Tt.disabled,At.disabled,Er(i),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ai.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,i=r.gl;this.nextStencilID+e.length>256&&this.clearStencil(),r.setColorMode(Tt.disabled),r.setDepthMode(Et.disabled);var n=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,o=e;a<o.length;a+=1){var s=o[a],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;n.draw(r,i.TRIANGLES,Et.disabled,new St({func:i.ALWAYS,mask:0},u,255,i.KEEP,i.KEEP,i.REPLACE),Tt.disabled,At.disabled,Er(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ai.prototype.stencilModeFor3D=function(){this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new St({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},ai.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new St({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},ai.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Tt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Tt.unblended:Tt.alphaBlended},ai.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return Et.disabled;var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Et(r||this.context.gl.LEQUAL,e,[i,i])},ai.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ai.prototype.render=function(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,n=this.style.sourceCaches;for(var a in n){var o=n[a];o.used&&o.prepare(this.context)}var s={},u={},l={};for(var c in n){var h=n[c];s[c]=h.getVisibleCoordinates(),u[c]=s[c].slice().reverse(),l[c]=h.getVisibleCoordinates(!0).reverse()}for(var p in n){var f=n[p],d=f.getSource();if("raster"===d.type||"raster-dem"===d.type){for(var v=[],m=0,g=s[p];m<g.length;m+=1){var y=g[m];v.push(f.getTile(y))}Vr(v,this.context)}}this.opaquePassCutoff=1/0;for(var _=0;_<i.length;_++){var b=i[_];if(this.style._layers[b].is3D()){this.opaquePassCutoff=_;break}}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var x=0,w=i;x<w.length;x+=1){var k=w[x],E=this.style._layers[k];if(E.hasOffscreenPass()&&!E.isHidden(this.transform.zoom)){var S=u[E.source];("custom"===E.type||S.length)&&this.renderLayer(this,n[E.source],E,S)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var T=this.style._layers[i[this.currentLayer]],A=n[T.source],P=s[T.source];this._renderTileClippingMasks(T,P),this.renderLayer(this,A,T,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var O=this.style._layers[i[this.currentLayer]],I=n[O.source],M=("symbol"===O.type?l:u)[O.source];this._renderTileClippingMasks(O,s[O.source]),this.renderLayer(this,I,O,M)}if(this.options.showTileBoundaries)for(var C in n){ni.debug(this,n[C],s[C]);break}this.setCustomLayerDefaults()},ai.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},ai.prototype.renderLayer=function(t,e,r,i){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||i.length)&&(this.id=r.id,ni[r.type](t,e,r,i,this.style.placement.variableOffsets))},ai.prototype.translatePosMatrix=function(e,r,i,n,a){if(!i[0]&&!i[1])return e;var o=a?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){var s=Math.sin(o),u=Math.cos(o);i=[i[0]*u-i[1]*s,i[0]*s+i[1]*u]}var l=[a?i[0]:le(r,i[0],this.transform.zoom),a?i[1]:le(r,i[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},ai.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},ai.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},ai.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from),r=this.imageManager.getPattern(t.to);return!e||!r},ai.prototype.useProgram=function(t,e){void 0===e&&(e=this.emptyProgramConfiguration),this.cache=this.cache||{};var r=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new pr(this.context,cr[t],e,Ur[t],this._showOverdrawInspector)),this.cache[r]},ai.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ai.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)};var li=function(e,r,i){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===i||i,this._minZoom=e||0,this._maxZoom=r||22,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},ci={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};li.prototype.clone=function(){var t=new li(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},ci.minZoom.get=function(){return this._minZoom},ci.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},ci.maxZoom.get=function(){return this._maxZoom},ci.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},ci.renderWorldCopies.get=function(){return this._renderWorldCopies},ci.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},ci.worldSize.get=function(){return this.tileSize*this.scale},ci.centerPoint.get=function(){return this.size._div(2)},ci.size.get=function(){return new t.Point(this.width,this.height)},ci.bearing.get=function(){return-this.angle/Math.PI*180},ci.bearing.set=function(e){var r=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ci.pitch.get=function(){return this._pitch/Math.PI*180},ci.pitch.set=function(e){var r=t.clamp(e,0,60)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())},ci.fov.get=function(){return this._fov/Math.PI*180},ci.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},ci.zoom.get=function(){return this._zoom},ci.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},ci.center.get=function(){return this._center},ci.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},li.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},li.prototype.getVisibleUnwrappedCoordinates=function(e){var r=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var i=this.pointCoordinate(new t.Point(0,0)),n=this.pointCoordinate(new t.Point(this.width,0)),a=this.pointCoordinate(new t.Point(this.width,this.height)),o=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(i.x,n.x,a.x,o.x)),u=Math.floor(Math.max(i.x,n.x,a.x,o.x)),l=s-1;l<=u+1;l++)0!==l&&r.push(new t.UnwrappedTileID(l,e));return r},li.prototype.coveringTiles=function(e){var r=this.coveringZoomLevel(e),i=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);var n=t.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,r),o=new t.Point(a*n.x-.5,a*n.y-.5);return function(e,r,i,n){void 0===n&&(n=!0);var a=1<<e,o={};function s(r,s,u){var l,c,h,p;if(u>=0&&u<=a)for(l=r;l<s;l++)c=Math.floor(l/a),h=(l%a+a)%a,0!==c&&!0!==n||(p=new t.OverscaledTileID(i,c,e,h,u),o[p.key]=p)}var u=r.map(function(e){return new t.Point(e.x,e.y)._mult(a)});return ui(u[0],u[1],u[2],0,a,s),ui(u[2],u[3],u[0],0,a,s),Object.keys(o).map(function(t){return o[t]})}(r,[this.pointCoordinate(new t.Point(0,0)),this.pointCoordinate(new t.Point(this.width,0)),this.pointCoordinate(new t.Point(this.width,this.height)),this.pointCoordinate(new t.Point(0,this.height))],e.reparseOverscaled?i:r,this._renderWorldCopies).sort(function(t,e){return o.dist(t.canonical)-o.dist(e.canonical)})},li.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},ci.unmodified.get=function(){return this._unmodified},li.prototype.zoomScale=function(t){return Math.pow(2,t)},li.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},li.prototype.project=function(e){var r=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(r)*this.worldSize)},li.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},ci.point.get=function(){return this.project(this.center)},li.prototype.setLocationAtPoint=function(e,r){var i=this.pointCoordinate(r),n=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(e),o=new t.MercatorCoordinate(a.x-(i.x-n.x),a.y-(i.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},li.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},li.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},li.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},li.prototype.coordinateLocation=function(t){return t.toLngLat()},li.prototype.pointCoordinate=function(e){var r=[e.x,e.y,0,1],i=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(i,i,this.pixelMatrixInverse);var n=r[3],a=i[3],o=r[0]/n,s=i[0]/a,u=r[1]/n,l=i[1]/a,c=r[2]/n,h=i[2]/a,p=c===h?0:(0-c)/(h-c);return new t.MercatorCoordinate(t.number(o,s,p)/this.worldSize,t.number(u,l,p)/this.worldSize)},li.prototype.coordinatePoint=function(e){var r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix),new t.Point(r[0]/r[3],r[1]/r[3])},li.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},li.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},li.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},li.prototype.calculatePosMatrix=function(e,r){void 0===r&&(r=!1);var i=e.key,n=r?this._alignedPosMatrixCache:this._posMatrixCache;if(n[i])return n[i];var a=e.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*o,a.y*o,0]),t.scale(u,u,[o/t.EXTENT,o/t.EXTENT,1]),t.multiply(u,r?this.alignedProjMatrix:this.projMatrix,u),n[i]=new Float32Array(u),n[i]},li.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},li.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,r,i,n,a=-90,o=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;a=t.mercatorYfromLat(h[1])*this.worldSize,e=(o=t.mercatorYfromLat(h[0])*this.worldSize)-a<l.y?l.y/(o-a):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,r=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(r||0,e||0);if(d)return this.center=this.unproject(new t.Point(r?(u+s)/2:f.x,e?(o+a)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var v=f.y,m=l.y/2;v-m<a&&(n=a+m),v+m>o&&(n=o-m)}if(this.lngRange){var g=f.x,y=l.x/2;g-y<s&&(i=s+y),g+y>u&&(i=u-y)}void 0===i&&void 0===n||(this.center=this.unproject(new t.Point(void 0!==i?i:f.x,void 0!==n?n:f.y))),this._unmodified=c,this._constraining=!1}},li.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this._fov/2,r=Math.PI/2+this._pitch,i=Math.sin(e)*this.cameraToCenterDistance/Math.sin(Math.PI-r-e),n=this.point,a=n.x,o=n.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),u=new Float64Array(16);t.perspective(u,this._fov,this.width/this.height,1,s),t.scale(u,u,[1,-1,1]),t.translate(u,u,[0,0,-this.cameraToCenterDistance]),t.rotateX(u,u,this._pitch),t.rotateZ(u,u,this.angle),t.translate(u,u,[-a,-o,0]),this.mercatorMatrix=t.scale([],u,[this.worldSize,this.worldSize,this.worldSize]),t.scale(u,u,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=u;var l=this.width%2/2,c=this.height%2/2,h=Math.cos(this.angle),p=Math.sin(this.angle),f=a-Math.round(a)+h*l+p*c,d=o-Math.round(o)+h*c+p*l,v=new Float64Array(u);if(t.translate(v,v,[f>.5?f-1:f,d>.5?d-1:d,0]),this.alignedProjMatrix=v,u=t.create(),t.scale(u,u,[this.width/2,-this.height/2,1]),t.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.create(),t.scale(u,u,[1,-1,1]),t.translate(u,u,[-1,-1,0]),t.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(u=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={}}},li.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance},li.prototype.getCameraPoint=function(){var e=this._pitch,r=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,r))},li.prototype.getCameraQueryGeometry=function(e){var r=this.getCameraPoint();if(1===e.length)return[e[0],r];for(var i=r.x,n=r.y,a=r.x,o=r.y,s=0,u=e;s<u.length;s+=1){var l=u[s];i=Math.min(i,l.x),n=Math.min(n,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}return[new t.Point(i,n),new t.Point(a,n),new t.Point(a,o),new t.Point(i,o),new t.Point(i,n)]},Object.defineProperties(li.prototype,ci);var hi=function(){var e,r,i,n;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),r=!1,i=0,n=function(){i=0,r&&(e(),i=setTimeout(n,300),r=!1)},function(){return r=!0,i||n(),i})};hi.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},hi.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},hi.prototype.getHashString=function(t){var e=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),n=Math.pow(10,i),a=Math.round(e.lng*n)/n,o=Math.round(e.lat*n)/n,s=this._map.getBearing(),u=this._map.getPitch(),l="";return l+=t?"#/"+a+"/"+o+"/"+r:"#"+r+"/"+o+"/"+a,(s||u)&&(l+="/"+Math.round(10*s)/10),u&&(l+="/"+Math.round(u)),l},hi.prototype._onHashChange=function(){var e=t.window.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},hi.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var pi=function(e){function i(i,n,a,o){void 0===o&&(o={});var s=r.mousePos(n.getCanvasContainer(),a),u=n.unproject(s);e.call(this,i,t.extend({point:s,lngLat:u,originalEvent:a},o)),this._defaultPrevented=!1,this.target=n}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var n={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,n),i}(t.Event),fi=function(e){function i(i,n,a){var o=r.touchPos(n.getCanvasContainer(),a),s=o.map(function(t){return n.unproject(t)}),u=o.reduce(function(t,e,r,i){return t.add(e.div(i.length))},new t.Point(0,0)),l=n.unproject(u);e.call(this,i,{points:o,point:u,lngLats:s,lngLat:l,originalEvent:a}),this._defaultPrevented=!1}e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i;var n={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,n),i}(t.Event),di=function(t){function e(e,r,i){t.call(this,e,{originalEvent:i}),this._defaultPrevented=!1}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,r),e}(t.Event),vi=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};vi.prototype.isEnabled=function(){return!!this._enabled},vi.prototype.isActive=function(){return!!this._active},vi.prototype.isZooming=function(){return!!this._zooming},vi.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},vi.prototype.onWheel=function(e){if(this.isEnabled()){var r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,i=t.browser.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(n*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this.isActive()||this._start(e)),e.preventDefault()}},vi.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},vi.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e})),this._finishTimeout&&clearTimeout(this._finishTimeout);var i=r.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},vi.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var r=this._map.transform;if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?1/450:.01,n=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==n&&(n=1/n);var a="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(a*n))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o="number"==typeof this._targetZoom?this._targetZoom:r.zoom,s=this._startZoom,u=this._easing,l=!1;if("wheel"===this._type&&s&&u){var c=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=u(c);r.zoom=t.number(s,o,h),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):l=!0}else r.zoom=o,l=!0;r.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),l&&(this._active=!1,this._finishTimeout=setTimeout(function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom},200))}},vi.prototype._smoothOutEasing=function(e){var r=t.ease;if(this._prevEase){var i=this._prevEase,n=(t.browser.now()-i.start)/i.duration,a=i.easing(n+.01)-i.easing(n),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);r=t.bezier(o,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:r},r};var mi=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};mi.prototype.isEnabled=function(){return!!this._enabled},mi.prototype.isActive=function(){return!!this._active},mi.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},mi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},mi.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),r.disableDrag(),this._startPos=this._lastPos=r.mousePos(this._el,e),this._active=!0)},mi.prototype._onMouseMove=function(t){var e=r.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=e,this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var n=Math.min(i.x,e.x),a=Math.max(i.x,e.x),o=Math.min(i.y,e.y),s=Math.max(i.y,e.y);r.setTransform(this._box,"translate("+n+"px,"+o+"px)"),this._box.style.width=a-n+"px",this._box.style.height=s-o+"px"}},mi.prototype._onMouseUp=function(e){if(0===e.button){var i=this._startPos,n=r.mousePos(this._el,e);this._finish(),r.suppressClick(),i.x===n.x&&i.y===n.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(i,n,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}))}},mi.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},mi.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos},mi.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))};var gi=t.bezier(0,0,.25,1),yi=function(e,r){this._map=e,this._el=r.element||e.getCanvasContainer(),this._state="disabled",this._button=r.button||"right",this._bearingSnap=r.bearingSnap||0,this._pitchWithRotate=!1!==r.pitchWithRotate,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};yi.prototype.isEnabled=function(){return"disabled"!==this._state},yi.prototype.isActive=function(){return"active"===this._state},yi.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},yi.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},yi.prototype.onMouseDown=function(e){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=r.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==r.mouseButton(e))return;this._eventButton=0}r.disableDrag(),t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._lastPos=r.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},yi.prototype._onMouseMove=function(t){var e=r.mousePos(this._el,t);this._lastPos.equals(e)||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},yi.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var r=this._map.transform,i=this._startPos,n=this._lastPos,a=.8*(i.x-n.x),o=-.5*(i.y-n.y),s=r.bearing-a,u=r.pitch-o,l=this._inertia,c=l[l.length-1];this._drainInertiaBuffer(),l.push([t.browser.now(),this._map._normalizeBearing(s,c[1])]),r.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",e),r.pitch=u),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._startPos=this._lastPos}},yi.prototype._onMouseUp=function(t){if(r.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",r.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},yi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},yi.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),r.enableDrag()},yi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._lastPos},yi.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var r=this._map,i=r.getBearing(),n=this._inertia,a=function(){Math.abs(i)<e._bearingSnap?r.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(n.length<2)a();else{var o=n[0],s=n[n.length-1],u=n[n.length-2],l=r._normalizeBearing(i,u[1]),c=s[1]-o[1],h=c<0?-1:1,p=(s[0]-o[0])/1e3;if(0!==c&&0!==p){var f=Math.abs(c*(.25/p));f>180&&(f=180);var d=f/180;l+=h*f*(d/2),Math.abs(r._normalizeBearing(l,0))<this._bearingSnap&&(l=r._normalizeBearing(0,l)),r.rotateTo(l,{duration:1e3*d,easing:gi,noMoveStart:!0},{originalEvent:t})}else a()}},yi.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},yi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>0&&r-e[0][0]>160;)e.shift()};var _i=t.bezier(0,0,.3,1),bi=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=r.clickTolerance||1,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};bi.prototype.isEnabled=function(){return"disabled"!==this._state},bi.prototype.isActive=function(){return"active"===this._state},bi.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled")},bi.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},bi.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==r.mouseButton(e)||(r.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),r.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)))},bi.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(r.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),r.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)))},bi.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._lastPos=r.mousePos(this._el,e),this._inertia=[[t.browser.now(),this._startPos]]},bi.prototype._onMove=function(e){e.preventDefault();var i=r.mousePos(this._el,e);this._lastPos.equals(i)||"pending"===this._state&&i.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=i,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",e),this._fireEvent("movestart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},bi.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._startPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._startPos=this._lastPos,delete this._lastMoveEvent}},bi.prototype._onMouseUp=function(t){if(0===r.mouseButton(t))switch(this._state){case"active":this._state="enabled",r.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._onTouchEnd=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},bi.prototype._unbind=function(){r.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),r.removeEventListener(t.window.document,"touchend",this._onTouchEnd),r.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),r.removeEventListener(t.window.document,"mouseup",this._onMouseUp),r.removeEventListener(t.window,"blur",this._onBlur)},bi.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._mouseDownPos,delete this._lastPos},bi.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var r=e[e.length-1],i=e[0],n=r[1].sub(i[1]),a=(r[0]-i[0])/1e3;if(0===a||r[1].equals(i[1]))this._fireEvent("moveend",t);else{var o=n.mult(.3/a),s=o.mag();s>1400&&(s=1400,o._unit()._mult(s));var u=s/750,l=o.mult(-u/2);this._map.panBy(l,{duration:1e3*u,easing:_i,noMoveStart:!0},{originalEvent:t})}}},bi.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},bi.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>0&&r-e[0][0]>160;)e.shift()};var xi=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function wi(t){return t*(2-t)}xi.prototype.isEnabled=function(){return!!this._enabled},xi.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},xi.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},xi.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,r=0,i=0,n=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),n=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),n=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(a=1,t.preventDefault());break;default:return}var o=this._map,s=o.getZoom(),u={duration:300,delayEndEvents:500,easing:wi,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:o.getBearing()+15*r,pitch:o.getPitch()+10*i,offset:[100*-n,100*-a],center:o.getCenter()};o.easeTo(u,{originalEvent:t})}};var ki=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};ki.prototype.isEnabled=function(){return!!this._enabled},ki.prototype.isActive=function(){return!!this._active},ki.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ki.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ki.prototype.onTouchStart=function(t){var e=this;this.isEnabled()&&(t.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(t)):this._tapped=setTimeout(function(){e._tapped=null},300)))},ki.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},ki.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},ki.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Ei=t.bezier(0,0,.15,1),Si=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Si.prototype.isEnabled=function(){return!!this._enabled},Si.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Si.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Si.prototype.disableRotation=function(){this._rotationDisabled=!0},Si.prototype.enableRotation=function(){this._rotationDisabled=!1},Si.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var i=r.mousePos(this._el,e.touches[0]),n=r.mousePos(this._el,e.touches[1]),a=i.add(n).div(2);this._startVec=i.sub(n),this._startAround=this._map.transform.pointLocation(a),this._gestureIntent=void 0,this._inertia=[],r.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),r.addEventListener(t.window.document,"touchend",this._onEnd)}},Si.prototype._getTouchEventData=function(t){var e=r.mousePos(this._el,t.touches[0]),i=r.mousePos(this._el,t.touches[1]),n=e.sub(i);return{vec:n,center:e.add(i).div(2),scale:n.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*n.angleWith(this._startVec)/Math.PI}},Si.prototype._onMove=function(e){if(2===e.touches.length){var r=this._getTouchEventData(e),i=r.vec,n=r.scale,a=r.bearing;if(!this._gestureIntent){var o=this._rotationDisabled&&1!==n||Math.abs(1-n)>.15;Math.abs(a)>10?this._gestureIntent="rotate":o&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=i)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},Si.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var r=this._map.transform;this._startScale||(this._startScale=r.scale,this._startBearing=r.bearing);var i=this._getTouchEventData(this._lastTouchEvent),n=i.center,a=i.bearing,o=i.scale,s=r.pointLocation(n),u=r.locationPoint(s);"rotate"===e&&(r.bearing=this._startBearing+a),r.zoom=r.scaleZoom(this._startScale*o),r.setLocationAtPoint(this._startAround,u),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),o,n])}},Si.prototype._onEnd=function(e){r.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),r.removeEventListener(t.window.document,"touchend",this._onEnd);var i=this._gestureIntent,n=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,i){this._map.fire(new t.Event(i+"end",{originalEvent:e})),this._drainInertiaBuffer();var a=this._inertia,o=this._map;if(a.length<2)o.snapToNorth({},{originalEvent:e});else{var s=a[a.length-1],u=a[0],l=o.transform.scaleZoom(n*s[1]),c=o.transform.scaleZoom(n*u[1]),h=l-c,p=(s[0]-u[0])/1e3,f=s[2];if(0!==p&&l!==c){var d=.15*h/p;Math.abs(d)>2.5&&(d=d>0?2.5:-2.5);var v=1e3*Math.abs(d/(12*.15)),m=l+d*v/2e3;m<0&&(m=0),o.easeTo({zoom:m,duration:v,easing:Ei,around:this._aroundCenter?o.getCenter():o.unproject(f),noMoveStart:!0},{originalEvent:e})}else o.snapToNorth({},{originalEvent:e})}}},Si.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>2&&r-e[0][0]>160;)e.shift()};var Ti={scrollZoom:vi,boxZoom:mi,dragRotate:yi,dragPan:bi,keyboard:xi,doubleClickZoom:ki,touchZoomRotate:Si},Ai=function(e){function r(r,i){e.call(this),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=i.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},r.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},r.prototype.panBy=function(e,r,i){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),i)},r.prototype.panTo=function(e,r,i){return this.easeTo(t.extend({center:e},r),i)},r.prototype.getZoom=function(){return this.transform.zoom},r.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},r.prototype.zoomTo=function(e,r,i){return this.easeTo(t.extend({zoom:e},r),i)},r.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},r.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},r.prototype.getBearing=function(){return this.transform.bearing},r.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},r.prototype.rotateTo=function(e,r,i){return this.easeTo(t.extend({bearing:e},r),i)},r.prototype.resetNorth=function(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this},r.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},r.prototype.getPitch=function(){return this.transform.pitch},r.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},r.prototype.cameraForBounds=function(e,r){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,r)},r.prototype._cameraForBoxAndBearing=function(e,r,i,n){if("number"==typeof(n=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){var a=n.padding;n.padding={top:a,bottom:a,right:a,left:a}}if(t.deepEqual(Object.keys(n.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){var o=this.transform,s=o.project(t.LngLat.convert(e)),u=o.project(t.LngLat.convert(r)),l=s.rotate(-i*Math.PI/180),c=u.rotate(-i*Math.PI/180),h=new t.Point(Math.max(l.x,c.x),Math.max(l.y,c.y)),p=new t.Point(Math.min(l.x,c.x),Math.min(l.y,c.y)),f=h.sub(p),d=(o.width-n.padding.left-n.padding.right)/f.x,v=(o.height-n.padding.top-n.padding.bottom)/f.y;if(!(v<0||d<0)){var m=Math.min(o.scaleZoom(o.scale*Math.min(d,v)),n.maxZoom),g=t.Point.convert(n.offset),y=(n.padding.left-n.padding.right)/2,_=(n.padding.top-n.padding.bottom)/2,b=new t.Point(g.x+y,g.y+_).mult(o.scale/o.zoomScale(m));return{center:o.unproject(s.add(u).div(2).sub(b)),zoom:m,bearing:i}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},r.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},r.prototype.fitScreenCoordinates=function(e,r,i,n,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(r)),i,n),n,a)},r.prototype._fitInternal=function(e,r,i){return e?(r=t.extend(e,r)).linear?this.easeTo(r,i):this.flyTo(r,i):this},r.prototype.jumpTo=function(e,r){this.stop();var i=this.transform,n=!1,a=!1,o=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(n=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.LngLat.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(a=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(o=!0,i.pitch=+e.pitch),this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),n&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),a&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),o&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))},r.prototype.easeTo=function(e,r){var i=this;this.stop(),!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate&&(e.duration=0);var n=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u="zoom"in e?+e.zoom:a,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,h=n.centerPoint.add(t.Point.convert(e.offset)),p=n.pointLocation(h),f=t.LngLat.convert(e.center||p);this._normalizeCenter(f);var d,v,m=n.project(p),g=n.project(f).sub(m),y=n.zoomScale(u-a);return e.around&&(d=t.LngLat.convert(e.around),v=n.locationPoint(d)),this._zooming=u!==a,this._rotating=o!==l,this._pitching=c!==s,this._prepareEase(r,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(e){if(i._zooming&&(n.zoom=t.number(a,u,e)),i._rotating&&(n.bearing=t.number(o,l,e)),i._pitching&&(n.pitch=t.number(s,c,e)),d)n.setLocationAtPoint(d,v);else{var p=n.zoomScale(n.zoom-a),f=u>a?Math.min(2,y):Math.max(.5,y),_=Math.pow(f,1-e),b=n.unproject(m.add(g.mult(e*_)).mult(p));n.setLocationAtPoint(n.renderWorldCopies?b.wrap():b,h)}i._fireMoveEvents(r)},function(){e.delayEndEvents?i._easeEndTimeoutID=setTimeout(function(){return i._afterEase(r)},e.delayEndEvents):i._afterEase(r)},e),this},r.prototype._prepareEase=function(e,r){this._moving=!0,r||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},r.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},r.prototype._afterEase=function(e){var r=this._zooming,i=this._rotating,n=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),n&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},r.prototype.flyTo=function(e,r){var i=this;this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var n=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u="zoom"in e?t.clamp(+e.zoom,n.minZoom,n.maxZoom):a,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,c="pitch"in e?+e.pitch:s,h=n.zoomScale(u-a),p=n.centerPoint.add(t.Point.convert(e.offset)),f=n.pointLocation(p),d=t.LngLat.convert(e.center||f);this._normalizeCenter(d);var v=n.project(f),m=n.project(d).sub(v),g=e.curve,y=Math.max(n.width,n.height),_=y/h,b=m.mag();if("minZoom"in e){var x=t.clamp(Math.min(e.minZoom,a,u),n.minZoom,n.maxZoom),w=y/n.zoomScale(x-a);g=Math.sqrt(w/b*2)}var k=g*g;function E(t){var e=(_*_-y*y+(t?-1:1)*k*k*b*b)/(2*(t?_:y)*k*b);return Math.log(Math.sqrt(e*e+1)-e)}function S(t){return(Math.exp(t)-Math.exp(-t))/2}function T(t){return(Math.exp(t)+Math.exp(-t))/2}var A=E(0),P=function(t){return T(A)/T(A+g*t)},O=function(t){return y*((T(A)*(S(e=A+g*t)/T(e))-S(A))/k)/b;var e},I=(E(1)-A)/g;if(Math.abs(b)<1e-6||!isFinite(I)){if(Math.abs(y-_)<1e-6)return this.easeTo(e,r);var M=_<y?-1:1;I=Math.abs(Math.log(_/y))/g,O=function(){return 0},P=function(t){return Math.exp(M*g*t)}}if("duration"in e)e.duration=+e.duration;else{var C="screenSpeed"in e?+e.screenSpeed/g:+e.speed;e.duration=1e3*I/C}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=o!==l,this._pitching=c!==s,this._prepareEase(r,!1),this._ease(function(e){var h=e*I,f=1/P(h);n.zoom=1===e?u:a+n.scaleZoom(f),i._rotating&&(n.bearing=t.number(o,l,e)),i._pitching&&(n.pitch=t.number(s,c,e));var g=1===e?d:n.unproject(v.add(m.mult(O(h))).mult(f));n.setLocationAtPoint(n.renderWorldCopies?g.wrap():g,p),i._fireMoveEvents(r)},function(){return i._afterEase(r)},e),this},r.prototype.isEasing=function(){return!!this._easeFrameId},r.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},r.prototype._ease=function(e,r,i){!1===i.animate||0===i.duration?(e(1),r()):(this._easeStart=t.browser.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},r.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},r.prototype._normalizeBearing=function(e,r){e=t.wrap(e,-180,180);var i=Math.abs(e-r);return Math.abs(e-360-r)<i&&(e-=360),Math.abs(e+360-r)<i&&(e+=360),e},r.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}},r}(t.Evented),Pi=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};Pi.prototype.getDefaultPosition=function(){return"bottom-right"},Pi.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=r.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Pi.prototype.onRemove=function(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},Pi.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:t.config.ACCESS_TOKEN}];if(e){var i=r.reduce(function(t,e,i){return e.value&&(t+=e.key+"="+e.value+(i<r.length-1?"&":"")),t},"?");e.href=t.config.FEEDBACK_URL+"/"+i+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener"}},Pi.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},Pi.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(function(t){return"string"!=typeof t?"":t})):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var r=this._map.style.sourceCaches;for(var i in r){var n=r[i];if(n.used){var a=n.getSource();a.attribution&&t.indexOf(a.attribution)<0&&t.push(a.attribution)}}t.sort(function(t,e){return t.length-e.length}),(t=t.filter(function(e,r){for(var i=r+1;i<t.length;i++)if(t[i].indexOf(e)>=0)return!1;return!0})).length?(this._innerContainer.innerHTML=t.join(" | "),this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null}},Pi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Oi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Oi.prototype.onAdd=function(t){this._map=t,this._container=r.create("div","mapboxgl-ctrl");var e=r.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),e.setAttribute("rel","noopener"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Oi.prototype.onRemove=function(){r.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Oi.prototype.getDefaultPosition=function(){return"bottom-left"},Oi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Oi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Oi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var Ii=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ii.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},Ii.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,i=e?this._queue.concat(e):this._queue;r<i.length;r+=1){var n=i[r];if(n.id===t)return void(n.cancelled=!0)}},Ii.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,r=t;e<r.length;e+=1){var i=r[e];if(!i.cancelled&&(i.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ii.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Mi=t.window.HTMLImageElement,Ci=t.window.HTMLElement,Li={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},ji=function(i){function n(e){var n=this;if(null!=(e=t.extend({},Li,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var a=new li(e.minZoom,e.maxZoom,e.renderWorldCopies);if(i.call(this,a,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new Ii,this._controls=[],this._mapId=t.uniqueId(),this._requestManager=new t.RequestManager(e.transformRequest),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Ci))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return n._update(!1)}),this.on("moveend",function(){return n._update(!1)}),this.on("zoom",function(){return n._update(!0)}),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var i=t.getCanvasContainer(),n=null,a=!1,o=null;for(var s in Ti)t[s]=new Ti[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);r.addEventListener(i,"mouseout",function(e){t.fire(new pi("mouseout",t,e))}),r.addEventListener(i,"mousedown",function(n){a=!0,o=r.mousePos(i,n);var s=new pi("mousedown",t,n);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(n),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(n),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(n))}),r.addEventListener(i,"mouseup",function(e){var r=t.dragRotate.isActive();n&&!r&&t.fire(new pi("contextmenu",t,n)),n=null,a=!1,t.fire(new pi("mouseup",t,e))}),r.addEventListener(i,"mousemove",function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var r=e.target;r&&r!==i;)r=r.parentNode;r===i&&t.fire(new pi("mousemove",t,e))}}),r.addEventListener(i,"mouseover",function(e){for(var r=e.target;r&&r!==i;)r=r.parentNode;r===i&&t.fire(new pi("mouseover",t,e))}),r.addEventListener(i,"touchstart",function(r){var i=new fi("touchstart",t,r);t.fire(i),i.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(r),t.touchZoomRotate.onStart(r),t.doubleClickZoom.onTouchStart(i))},{passive:!1}),r.addEventListener(i,"touchmove",function(e){t.fire(new fi("touchmove",t,e))},{passive:!1}),r.addEventListener(i,"touchend",function(e){t.fire(new fi("touchend",t,e))}),r.addEventListener(i,"touchcancel",function(e){t.fire(new fi("touchcancel",t,e))}),r.addEventListener(i,"click",function(n){var a=r.mousePos(i,n);(a.equals(o)||a.dist(o)<e.clickTolerance)&&t.fire(new pi("click",t,n))}),r.addEventListener(i,"dblclick",function(e){var r=new pi("dblclick",t,e);t.fire(r),r.defaultPrevented||t.doubleClickZoom.onDblClick(r)}),r.addEventListener(i,"contextmenu",function(e){var r=t.dragRotate.isActive();a||r?a&&(n=e):t.fire(new pi("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault()}),r.addEventListener(i,"wheel",function(r){e.interactive&&t.stop();var i=new di("wheel",t,r);t.fire(i),i.defaultPrevented||t.scrollZoom.onWheel(r)},{passive:!1})}(this,e),this._hash=e.hash&&(new hi).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Pi({customAttribution:e.customAttribution})),this.addControl(new Oi,e.logoPosition),this.on("style.load",function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)}),this.on("data",function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))}),this.on("dataloading",function(e){n.fire(new t.Event(e.dataType+"dataloading",e))})}i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n;var a={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0}};return n.prototype._getMapId=function(){return this._mapId},n.prototype.addControl=function(e,r){if(void 0===r&&e.getDefaultPosition&&(r=e.getDefaultPosition()),void 0===r&&(r="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var i=e.onAdd(this);this._controls.push(e);var n=this._controlPositions[r];return-1!==r.indexOf("bottom")?n.insertBefore(i,n.firstChild):n.appendChild(i),this},n.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this},n.prototype.resize=function(e){var r=this._containerDimensions(),i=r[0],n=r[1];return this._resizeCanvas(i,n),this.transform.resize(i,n),this.painter.resize(i,n),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},n.prototype.getBounds=function(){return this.transform.getBounds()},n.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},n.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},n.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},n.prototype.getMinZoom=function(){return this.transform.minZoom},n.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},n.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},n.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},n.prototype.getMaxZoom=function(){return this.transform.maxZoom},n.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},n.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},n.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},n.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},n.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},n.prototype.on=function(t,e,r){var n=this;if(void 0===r)return i.prototype.on.call(this,t,e);var a=function(){var i;if("mouseenter"===t||"mouseover"===t){var a=!1;return{layer:e,listener:r,delegates:{mousemove:function(i){var o=n.getLayer(e)?n.queryRenderedFeatures(i.point,{layers:[e]}):[];o.length?a||(a=!0,r.call(n,new pi(t,n,i.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"===t||"mouseout"===t){var o=!1;return{layer:e,listener:r,delegates:{mousemove:function(i){(n.getLayer(e)?n.queryRenderedFeatures(i.point,{layers:[e]}):[]).length?o=!0:o&&(o=!1,r.call(n,new pi(t,n,i.originalEvent)))},mouseout:function(e){o&&(o=!1,r.call(n,new pi(t,n,e.originalEvent)))}}}}return{layer:e,listener:r,delegates:(i={},i[t]=function(t){var i=n.getLayer(e)?n.queryRenderedFeatures(t.point,{layers:[e]}):[];i.length&&(t.features=i,r.call(n,t),delete t.features)},i)}}();for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(a),a.delegates)this.on(o,a.delegates[o]);return this},n.prototype.off=function(t,e,r){if(void 0===r)return i.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var n=this._delegatedListeners[t],a=0;a<n.length;a++){var o=n[a];if(o.layer===e&&o.listener===r){for(var s in o.delegates)this.off(s,o.delegates[s]);return n.splice(a,1),this}}return this},n.prototype.queryRenderedFeatures=function(e,r){if(!this.style)return[];var i;if(void 0!==r||void 0===e||e instanceof t.Point||Array.isArray(e)||(r=e,e=void 0),r=r||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])i=[t.Point.convert(e)];else{var n=t.Point.convert(e[0]),a=t.Point.convert(e[1]);i=[n,new t.Point(a.x,n.y),a,new t.Point(n.x,a.y),n]}return this.style.queryRenderedFeatures(i,r,this.transform)},n.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},n.prototype.setStyle=function(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:Li.localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(e,r))},n.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Re(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},n.prototype._diffStyle=function(e,r){var i=this;if("string"==typeof e){var n=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(n,t.ResourceType.Style);t.getJSON(a,function(e,n){e?i.fire(new t.ErrorEvent(e)):n&&i._updateDiff(n,r)})}else"object"==typeof e&&this._updateDiff(e,r)},n.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(i){t.warnOnce("Unable to perform style diff: "+(i.message||i.error||i)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},n.prototype.getStyle=function(){if(this.style)return this.style.serialize()},n.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},n.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0)},n.prototype.isSourceLoaded=function(e){var r=this.style&&this.style.sourceCaches[e];if(void 0!==r)return r.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},n.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var i in r){var n=r[i];if("loaded"!==n.state&&"errored"!==n.state)return!1}}return!0},n.prototype.addSourceType=function(t,e,r){return this.style.addSourceType(t,e,r)},n.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},n.prototype.getSource=function(t){return this.style.getSource(t)},n.prototype.addImage=function(e,r,i){void 0===i&&(i={});var n=i.pixelRatio;void 0===n&&(n=1);var a=i.sdf;if(void 0===a&&(a=!1),r instanceof Mi){var o=t.browser.getImageData(r),s=o.width,u=o.height,l=o.data;this.style.addImage(e,{data:new t.RGBAImage({width:s,height:u},l),pixelRatio:n,sdf:a,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=r.width,h=r.height,p=r.data,f=r;this.style.addImage(e,{data:new t.RGBAImage({width:c,height:h},new Uint8Array(p)),pixelRatio:n,sdf:a,version:0,userImage:f}),f.onAdd&&f.onAdd(this,e)}},n.prototype.updateImage=function(e,r){var i=this.style.getImage(e);if(!i)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var n=r instanceof Mi?t.browser.getImageData(r):r,a=n.width,o=n.height,s=n.data;if(void 0===a||void 0===o)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==i.data.width||o!==i.data.height)return this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));var u=!(r instanceof Mi);i.data.replace(s,u),this.style.updateImage(e,i)},n.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},n.prototype.removeImage=function(t){this.style.removeImage(t)},n.prototype.loadImage=function(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),r)},n.prototype.listImages=function(){return this.style.listImages()},n.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0)},n.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},n.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},n.prototype.getLayer=function(t){return this.style.getLayer(t)},n.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},n.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},n.prototype.getFilter=function(t){return this.style.getFilter(t)},n.prototype.setPaintProperty=function(t,e,r,i){return void 0===i&&(i={}),this.style.setPaintProperty(t,e,r,i),this._update(!0)},n.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},n.prototype.setLayoutProperty=function(t,e,r,i){return void 0===i&&(i={}),this.style.setLayoutProperty(t,e,r,i),this._update(!0)},n.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},n.prototype.setLight=function(t,e){return void 0===e&&(e={}),this.style.setLight(t,e),this._update(!0)},n.prototype.getLight=function(){return this.style.getLight()},n.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},n.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},n.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},n.prototype.getContainer=function(){return this._container},n.prototype.getCanvasContainer=function(){return this._canvasContainer},n.prototype.getCanvas=function(){return this._canvas},n.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},n.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},n.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=r.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=r.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=r.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=r.create("div","mapboxgl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){a[t]=r.create("div","mapboxgl-ctrl-"+t,n)})},n.prototype._resizeCanvas=function(e,r){var i=t.window.devicePixelRatio||1;this._canvas.width=i*e,this._canvas.height=i*r,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px"},n.prototype._setupPainter=function(){var r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);i?(this.painter=new ai(i,this.transform),t.webpSupported.testSupport(i)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},n.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},n.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},n.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},n.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},n.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},n.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},n.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var r=this.transform.zoom,i=t.browser.now();this.style.zoomHistory.update(r,i);var n=new t.EvaluationParameters(r,{now:i,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=n.crossFadingFactor();1===a&&a===this._crossFadingFactor||(e=!0,this._crossFadingFactor=a),this.style.update(n)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),this},n.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,r=this._controls;e<r.length;e+=1)r[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),zi(this._canvasContainer),zi(this._controlContainer),zi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},n.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame(function(){e._frame=null,e._render()}))},n.prototype._onWindowOnline=function(){this._update()},n.prototype._onWindowResize=function(){this._trackResize&&this.resize()._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update()},Object.defineProperties(n.prototype,a),n}(Ai);function zi(t){t.parentNode&&t.parentNode.removeChild(t)}var Ri={showCompass:!0,showZoom:!0},Fi=function(e){var i=this;this.options=t.extend({},Ri,e),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(t.bindAll(["_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom in",function(){return i._map.zoomIn()}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom out",function(){return i._map.zoomOut()})),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset bearing to north",function(){return i._map.resetNorth()}),this._compassArrow=r.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function Di(e,r,i){if(e=new t.LngLat(e.lng,e.lat),r){var n=new t.LngLat(e.lng-360,e.lat),a=new t.LngLat(e.lng+360,e.lat),o=i.locationPoint(e).distSqr(r);i.locationPoint(n).distSqr(r)<o?e=n:i.locationPoint(a).distSqr(r)<o&&(e=a)}for(;Math.abs(e.lng-i.center.lng)>180;){var s=i.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=i.width&&s.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e}Fi.prototype._updateZoomButtons=function(){var t=this._map.getZoom();this._zoomInButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMaxZoom()),this._zoomOutButton.classList.toggle("mapboxgl-ctrl-icon-disabled",t===this._map.getMinZoom())},Fi.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Fi.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yi(t,{button:"left",element:this._compass}),r.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.enable()),this._container},Fi.prototype.onRemove=function(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),r.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.disable(),delete this._handler),delete this._map},Fi.prototype._createButton=function(t,e,i){var n=r.create("button",t,this._container);return n.type="button",n.title=e,n.setAttribute("aria-label",e),n.addEventListener("click",i),n};var Bi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ni(t,e,r){var i=t.classList;for(var n in Bi)i.remove("mapboxgl-"+r+"-anchor-"+n);i.add("mapboxgl-"+r+"-anchor-"+e)}var Ui,Vi=function(e){function i(i,n){if(e.call(this),(i instanceof t.window.HTMLElement||n)&&(i=t.extend({element:i},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._draggable=i&&i.draggable||!1,this._state="inactive",i&&i.element)this._element=i.element,this._offset=t.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div");var a=r.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=r.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var s=r.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=r.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=r.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=r.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=r.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var v=r.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var m=r.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(m);var g=r.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var y=r.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=r.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var b=r.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),y.appendChild(_),y.appendChild(b),s.appendChild(u),s.appendChild(f),s.appendChild(v),s.appendChild(g),s.appendChild(y),a.appendChild(s),this._element.appendChild(a),this._offset=t.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(t){t.preventDefault()}),Ni(this._element,this._anchor,"marker"),this._popup=null}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},i.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},i.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Di(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),r.setTransform(this._element,Bi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"))},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},i.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},i.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},i.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.isDraggable=function(){return this._draggable},i}(t.Evented),Gi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},qi=function(e){function i(r){e.call(this),this.options=t.extend({},Gi,r),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(e){var i;return this._map=e,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==Ui?i(Ui):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(function(t){Ui="denied"!==t.state,i(Ui)}):(Ui=!!t.window.navigator.geolocation,i(Ui)),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),r.remove(this._container),this._map=void 0},i.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},i.prototype._updateCamera=function(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,n=this._map.getBearing(),a=t.extend({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(i),a,{geolocateSource:!0})},i.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},i.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},i.prototype._setupUI=function(e){var i=this;!1!==e?(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=r.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Vi(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(e){e.geolocateSource||"ACTIVE_LOCK"!==i._watchState||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),i._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),i.fire(new t.Event("trackuserlocationend")))})):t.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.")},i.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},i}(t.Evented),Zi={maxWidth:100,unit:"metric"},Xi=function(e){this.options=t.extend({},Zi,e),t.bindAll(["_onMove","setUnit"],this)};function Wi(t,e,r){var i,n,a,o,s,u,l=r&&r.maxWidth||100,c=t._container.clientHeight/2,h=(i=t.unproject([0,c]),n=t.unproject([l,c]),a=Math.PI/180,o=i.lat*a,s=n.lat*a,u=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((n.lng-i.lng)*a),6371e3*Math.acos(Math.min(u,1)));if(r&&"imperial"===r.unit){var p=3.2808*h;p>5280?Hi(e,l,p/5280,"mi"):Hi(e,l,p,"ft")}else r&&"nautical"===r.unit?Hi(e,l,h/1852,"nm"):Hi(e,l,h,"m")}function Hi(t,e,r,i){var n,a,o,s=(n=r,(a=Math.pow(10,(""+Math.floor(n)).length-1))*(o=(o=n/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(o))),u=s/r;"m"===i&&s>=1e3&&(s/=1e3,i="km"),t.style.width=e*u+"px",t.innerHTML=s+i}Xi.prototype.getDefaultPosition=function(){return"bottom-left"},Xi.prototype._onMove=function(){Wi(this._map,this._container,this.options)},Xi.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Xi.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Xi.prototype.setUnit=function(t){this.options.unit=t,Wi(this._map,this._container,this.options)};var Yi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};Yi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Yi.prototype.onRemove=function(){r.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Yi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Yi.prototype._setupUI=function(){(this._fullscreenButton=r.create("button",this._className+"-icon "+this._className+"-fullscreen",this._controlContainer)).type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Yi.prototype._updateTitle=function(){var t=this._isFullscreen()?"Exit fullscreen":"Enter fullscreen";this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Yi.prototype._isFullscreen=function(){return this._fullscreen},Yi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"),this._updateTitle())},Yi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ki={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Ji=function(e){function i(r){e.call(this),this.options=t.extend(Object.create(Ki),r),t.bindAll(["_update","_onClickClose","remove"],this)}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.addTo=function(e){return this._map=e,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._map.on("remove",this.remove),this._update(),this.fire(new t.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("remove",this.remove),delete this._map),this.fire(new t.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._update(),this},i.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},i.prototype.setHTML=function(e){var r,i=t.window.document.createDocumentFragment(),n=t.window.document.createElement("body");for(n.innerHTML=e;r=n.firstChild;)i.appendChild(r);return this.setDOMContent(i)},i.prototype.getMaxWidth=function(){return this._container.style.maxWidth},i.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},i.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},i.prototype._createContent=function(){this._content&&r.remove(this._content),this._content=r.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=r.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},i.prototype._update=function(){var e=this;if(this._map&&this._lngLat&&this._content){this._container||(this._container=r.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(t){return e._container.classList.add(t)})),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&(this._lngLat=Di(this._lngLat,this._pos,this._map.transform));var i=this._pos=this._map.project(this._lngLat),n=this.options.anchor,a=function e(r){if(r){if("number"==typeof r){var i=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new t.Point(0,0),top:new t.Point(0,r),"top-left":new t.Point(i,i),"top-right":new t.Point(-i,i),bottom:new t.Point(0,-r),"bottom-left":new t.Point(i,-i),"bottom-right":new t.Point(-i,-i),left:new t.Point(r,0),right:new t.Point(-r,0)}}if(r instanceof t.Point||Array.isArray(r)){var n=t.Point.convert(r);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.Point.convert(r.center||[0,0]),top:t.Point.convert(r.top||[0,0]),"top-left":t.Point.convert(r["top-left"]||[0,0]),"top-right":t.Point.convert(r["top-right"]||[0,0]),bottom:t.Point.convert(r.bottom||[0,0]),"bottom-left":t.Point.convert(r["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(r["bottom-right"]||[0,0]),left:t.Point.convert(r.left||[0,0]),right:t.Point.convert(r.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!n){var o,s=this._container.offsetWidth,u=this._container.offsetHeight;o=i.y+a.bottom.y<u?["top"]:i.y>this._map.transform.height-u?["bottom"]:[],i.x<s/2?o.push("left"):i.x>this._map.transform.width-s/2&&o.push("right"),n=0===o.length?"bottom":o.join("-")}var l=i.add(a[n]).round();r.setTransform(this._container,Bi[n]+" translate("+l.x+"px,"+l.y+"px)"),Ni(this._container,n,"popup")}},i.prototype._onClickClose=function(){this.remove()},i}(t.Evented),Qi={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,Map:ji,NavigationControl:Fi,GeolocateControl:qi,AttributionControl:Pi,ScaleControl:Xi,FullscreenControl:Yi,Popup:Ji,Marker:Vi,Style:Re,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Lt.workerCount},set workerCount(t){Lt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},workerUrl:""};return Qi}),r}()},function(t,e,r){"use strict";(function(t){var i=r(3);e.a="undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type||!(void 0===t||"object"!==Object(i.a)(t.versions)||!Boolean(t.versions.electron))||"object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,r(17))},function(t,e){var r={type:"FeatureCollection",features:[]};let n={geojson:r,nongeo:[]};function a(t){return[t.latitude,t.longitude]}function o(){this.type="Feature",this.properties={},this.geometry={type:"Point",coordinates:[]}}t.exports=function(t){var e;for(i in(t=JSON.parse(t)).length,t){var s=t[i],u={datetime:(e=t[i]).incident_datetime,report_type_description:e.report_type_description,category:e.incident_category,incident_subcategory:e.incident_subcategory,pddistrict:e.police_district,dayofweek:e.dayofweek,resolution:e.resolution,incident_number:e.incident_number,desc:e.incident_description},l=new o;if(l.properties=u,s.latitude){var c=a(s);l.geometry.coordinates=c,r.features.push(l)}else console.log("this has no lat, ",s),n.nongeo.push(s)}return n.geojson=r,n}},,,,,,function(t,e){},function(t,e){},function(t,e){},function(t,e,r){var i=function(t){"use strict";var e,r=Object.prototype,i=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function u(t,e,r,i){var n=e&&e.prototype instanceof v?e:v,a=Object.create(n.prototype),o=new A(i||[]);return a._invoke=function(t,e,r){var i=c;return function(n,a){if(i===p)throw new Error("Generator is already running");if(i===f){if("throw"===n)throw a;return O()}for(r.method=n,r.arg=a;;){var o=r.delegate;if(o){var s=E(o,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===c)throw i=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=l(t,e,r);if("normal"===u.type){if(i=r.done?f:h,u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=f,r.method="throw",r.arg=u.arg)}}}(t,r,o),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var c="suspendedStart",h="suspendedYield",p="executing",f="completed",d={};function v(){}function m(){}function g(){}var y={};y[a]=function(){return this};var _=Object.getPrototypeOf,b=_&&_(_(P([])));b&&b!==r&&i.call(b,a)&&(y=b);var x=g.prototype=v.prototype=Object.create(y);function w(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function k(t){var e;this._invoke=function(r,n){function a(){return new Promise(function(e,a){!function e(r,n,a,o){var s=l(t[r],t,n);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,a,o)},function(t){e("throw",t,a,o)}):Promise.resolve(c).then(function(t){u.value=t,a(u)},function(t){return e("throw",t,a,o)})}o(s.arg)}(r,n,e,a)})}return e=e?e.then(a,a):a()}}function E(t,r){var i=t.iterator[r.method];if(i===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,E(t,r),"throw"===r.method))return d;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var n=l(i,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,d;var a=n.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function P(t){if(t){var r=t[a];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function r(){for(;++n<t.length;)if(i.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}return{next:O}}function O(){return{value:e,done:!0}}return m.prototype=x.constructor=g,g.constructor=m,g[s]=m.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s in t||(t[s]="GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},w(k.prototype),k.prototype[o]=function(){return this},t.AsyncIterator=k,t.async=function(e,r,i,n){var a=new k(u(e,r,i,n));return t.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},w(x),x[s]="Generator",x[a]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var i=e.pop();if(i in t)return r.value=i,r.done=!1,r}return r.done=!0,r}},t.values=P,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(i,n){return s.type="throw",s.arg=t,r.next=i,n&&(r.method="next",r.arg=e),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,i){return this.delegate={iterator:P(t),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=e),d}},t}(t.exports);try{regeneratorRuntime=i}catch(t){Function("r","regeneratorRuntime = r")(i)}},function(t,e,r){var i;
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */
!function(n,a,o,s){"use strict";var u,l=["","webkit","Moz","MS","ms","o"],c=a.createElement("div"),h="function",p=Math.round,f=Math.abs,d=Date.now;function v(t,e,r){return setTimeout(w(t,r),e)}function m(t,e,r){return!!Array.isArray(t)&&(g(t,r[e],r),!0)}function g(t,e,r){var i;if(t)if(t.forEach)t.forEach(e,r);else if(t.length!==s)for(i=0;i<t.length;)e.call(r,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i,t)}function y(t,e,r){var i="DEPRECATED METHOD: "+e+"\n"+r+" AT \n";return function(){var e=new Error("get-stack-trace"),r=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=n.console&&(n.console.warn||n.console.log);return a&&a.call(n.console,i,r),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(i!==s&&null!==i)for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}return e}:Object.assign;var _=y(function(t,e,r){for(var i=Object.keys(e),n=0;n<i.length;)(!r||r&&t[i[n]]===s)&&(t[i[n]]=e[i[n]]),n++;return t},"extend","Use `assign`."),b=y(function(t,e){return _(t,e,!0)},"merge","Use `assign`.");function x(t,e,r){var i,n=e.prototype;(i=t.prototype=Object.create(n)).constructor=t,i._super=n,r&&u(i,r)}function w(t,e){return function(){return t.apply(e,arguments)}}function k(t,e){return typeof t==h?t.apply(e&&e[0]||s,e):t}function E(t,e){return t===s?e:t}function S(t,e,r){g(O(e),function(e){t.addEventListener(e,r,!1)})}function T(t,e,r){g(O(e),function(e){t.removeEventListener(e,r,!1)})}function A(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function P(t,e){return t.indexOf(e)>-1}function O(t){return t.trim().split(/\s+/g)}function I(t,e,r){if(t.indexOf&&!r)return t.indexOf(e);for(var i=0;i<t.length;){if(r&&t[i][r]==e||!r&&t[i]===e)return i;i++}return-1}function M(t){return Array.prototype.slice.call(t,0)}function C(t,e,r){for(var i=[],n=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];I(n,o)<0&&i.push(t[a]),n[a]=o,a++}return r&&(i=e?i.sort(function(t,r){return t[e]>r[e]}):i.sort()),i}function L(t,e){for(var r,i,n=e[0].toUpperCase()+e.slice(1),a=0;a<l.length;){if((i=(r=l[a])?r+n:e)in t)return i;a++}return s}var j=1;function z(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||n}var R="ontouchstart"in n,F=L(n,"PointerEvent")!==s,D=R&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=25,N=1,U=2,V=4,G=8,q=1,Z=2,X=4,W=8,H=16,Y=Z|X,K=W|H,J=Y|K,Q=["x","y"],$=["clientX","clientY"];function tt(t,e){var r=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){k(t.options.enable,[t])&&r.handler(e)},this.init()}function et(t,e,r){var i=r.pointers.length,n=r.changedPointers.length,a=e&N&&i-n==0,o=e&(V|G)&&i-n==0;r.isFirst=!!a,r.isFinal=!!o,a&&(t.session={}),r.eventType=e,function(t,e){var r=t.session,i=e.pointers,n=i.length;r.firstInput||(r.firstInput=rt(e));n>1&&!r.firstMultiple?r.firstMultiple=rt(e):1===n&&(r.firstMultiple=!1);var a=r.firstInput,o=r.firstMultiple,u=o?o.center:a.center,l=e.center=it(i);e.timeStamp=d(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=st(u,l),e.distance=ot(u,l),function(t,e){var r=e.center,i=t.offsetDelta||{},n=t.prevDelta||{},a=t.prevInput||{};e.eventType!==N&&a.eventType!==V||(n=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},i=t.offsetDelta={x:r.x,y:r.y});e.deltaX=n.x+(r.x-i.x),e.deltaY=n.y+(r.y-i.y)}(r,e),e.offsetDirection=at(e.deltaX,e.deltaY);var c=nt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=f(c.x)>f(c.y)?c.x:c.y,e.scale=o?(h=o.pointers,p=i,ot(p[0],p[1],$)/ot(h[0],h[1],$)):1,e.rotation=o?function(t,e){return st(e[1],e[0],$)+st(t[1],t[0],$)}(o.pointers,i):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length,function(t,e){var r,i,n,a,o=t.lastInterval||e,u=e.timeStamp-o.timeStamp;if(e.eventType!=G&&(u>B||o.velocity===s)){var l=e.deltaX-o.deltaX,c=e.deltaY-o.deltaY,h=nt(u,l,c);i=h.x,n=h.y,r=f(h.x)>f(h.y)?h.x:h.y,a=at(l,c),t.lastInterval=e}else r=o.velocity,i=o.velocityX,n=o.velocityY,a=o.direction;e.velocity=r,e.velocityX=i,e.velocityY=n,e.direction=a}(r,e);var h,p;var v=t.element;A(e.srcEvent.target,v)&&(v=e.srcEvent.target);e.target=v}(t,r),t.emit("hammer.input",r),t.recognize(r),t.session.prevInput=r}function rt(t){for(var e=[],r=0;r<t.pointers.length;)e[r]={clientX:p(t.pointers[r].clientX),clientY:p(t.pointers[r].clientY)},r++;return{timeStamp:d(),pointers:e,center:it(e),deltaX:t.deltaX,deltaY:t.deltaY}}function it(t){var e=t.length;if(1===e)return{x:p(t[0].clientX),y:p(t[0].clientY)};for(var r=0,i=0,n=0;n<e;)r+=t[n].clientX,i+=t[n].clientY,n++;return{x:p(r/e),y:p(i/e)}}function nt(t,e,r){return{x:e/t||0,y:r/t||0}}function at(t,e){return t===e?q:f(t)>=f(e)?t<0?Z:X:e<0?W:H}function ot(t,e,r){r||(r=Q);var i=e[r[0]]-t[r[0]],n=e[r[1]]-t[r[1]];return Math.sqrt(i*i+n*n)}function st(t,e,r){r||(r=Q);var i=e[r[0]]-t[r[0]],n=e[r[1]]-t[r[1]];return 180*Math.atan2(n,i)/Math.PI}tt.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(z(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(z(this.element),this.evWin,this.domHandler)}};var ut={mousedown:N,mousemove:U,mouseup:V},lt="mousedown",ct="mousemove mouseup";function ht(){this.evEl=lt,this.evWin=ct,this.pressed=!1,tt.apply(this,arguments)}x(ht,tt,{handler:function(t){var e=ut[t.type];e&N&&0===t.button&&(this.pressed=!0),e&U&&1!==t.which&&(e=V),this.pressed&&(e&V&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var pt={pointerdown:N,pointermove:U,pointerup:V,pointercancel:G,pointerout:G},ft={2:"touch",3:"pen",4:"mouse",5:"kinect"},dt="pointerdown",vt="pointermove pointerup pointercancel";function mt(){this.evEl=dt,this.evWin=vt,tt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}n.MSPointerEvent&&!n.PointerEvent&&(dt="MSPointerDown",vt="MSPointerMove MSPointerUp MSPointerCancel"),x(mt,tt,{handler:function(t){var e=this.store,r=!1,i=t.type.toLowerCase().replace("ms",""),n=pt[i],a=ft[t.pointerType]||t.pointerType,o="touch"==a,s=I(e,t.pointerId,"pointerId");n&N&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):n&(V|G)&&(r=!0),s<0||(e[s]=t,this.callback(this.manager,n,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),r&&e.splice(s,1))}});var gt={touchstart:N,touchmove:U,touchend:V,touchcancel:G},yt="touchstart",_t="touchstart touchmove touchend touchcancel";function bt(){this.evTarget=yt,this.evWin=_t,this.started=!1,tt.apply(this,arguments)}x(bt,tt,{handler:function(t){var e=gt[t.type];if(e===N&&(this.started=!0),this.started){var r=function(t,e){var r=M(t.touches),i=M(t.changedTouches);e&(V|G)&&(r=C(r.concat(i),"identifier",!0));return[r,i]}.call(this,t,e);e&(V|G)&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:t})}}});var xt={touchstart:N,touchmove:U,touchend:V,touchcancel:G},wt="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=wt,this.targetIds={},tt.apply(this,arguments)}x(kt,tt,{handler:function(t){var e=xt[t.type],r=function(t,e){var r=M(t.touches),i=this.targetIds;if(e&(N|U)&&1===r.length)return i[r[0].identifier]=!0,[r,r];var n,a,o=M(t.changedTouches),s=[],u=this.target;if(a=r.filter(function(t){return A(t.target,u)}),e===N)for(n=0;n<a.length;)i[a[n].identifier]=!0,n++;n=0;for(;n<o.length;)i[o[n].identifier]&&s.push(o[n]),e&(V|G)&&delete i[o[n].identifier],n++;if(!s.length)return;return[C(a.concat(s),"identifier",!0),s]}.call(this,t,e);r&&this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:t})}});var Et=2500,St=25;function Tt(){tt.apply(this,arguments);var t=w(this.handler,this);this.touch=new kt(this.manager,t),this.mouse=new ht(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function At(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var r={x:e.clientX,y:e.clientY};this.lastTouches.push(r);var i=this.lastTouches;setTimeout(function(){var t=i.indexOf(r);t>-1&&i.splice(t,1)},Et)}}x(Tt,tt,{handler:function(t,e,r){var i="touch"==r.pointerType,n="mouse"==r.pointerType;if(!(n&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if(i)(function(t,e){t&N?(this.primaryTouch=e.changedPointers[0].identifier,At.call(this,e)):t&(V|G)&&At.call(this,e)}).call(this,e,r);else if(n&&function(t){for(var e=t.srcEvent.clientX,r=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var n=this.lastTouches[i],a=Math.abs(e-n.x),o=Math.abs(r-n.y);if(a<=St&&o<=St)return!0}return!1}.call(this,r))return;this.callback(t,e,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Pt=L(c.style,"touchAction"),Ot=Pt!==s,It="auto",Mt="manipulation",Ct="none",Lt="pan-x",jt="pan-y",zt=function(){if(!Ot)return!1;var t={},e=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(r){t[r]=!e||n.CSS.supports("touch-action",r)}),t}();function Rt(t,e){this.manager=t,this.set(e)}Rt.prototype={set:function(t){"compute"==t&&(t=this.compute()),Ot&&this.manager.element.style&&zt[t]&&(this.manager.element.style[Pt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return g(this.manager.recognizers,function(e){k(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(P(t,Ct))return Ct;var e=P(t,Lt),r=P(t,jt);if(e&&r)return Ct;if(e||r)return e?Lt:jt;if(P(t,Mt))return Mt;return It}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,r=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,n=P(i,Ct)&&!zt[Ct],a=P(i,jt)&&!zt[jt],o=P(i,Lt)&&!zt[Lt];if(n){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}if(!o||!a)return n||a&&r&Y||o&&r&K?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Ft=1,Dt=2,Bt=4,Nt=8,Ut=Nt,Vt=16;function Gt(t){this.options=u({},this.defaults,t||{}),this.id=j++,this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=Ft,this.simultaneous={},this.requireFail=[]}function qt(t){return t&Vt?"cancel":t&Nt?"end":t&Bt?"move":t&Dt?"start":""}function Zt(t){return t==H?"down":t==W?"up":t==Z?"left":t==X?"right":""}function Xt(t,e){var r=e.manager;return r?r.get(t):t}function Wt(){Gt.apply(this,arguments)}function Ht(){Wt.apply(this,arguments),this.pX=null,this.pY=null}function Yt(){Wt.apply(this,arguments)}function Kt(){Gt.apply(this,arguments),this._timer=null,this._input=null}function Jt(){Wt.apply(this,arguments)}function Qt(){Wt.apply(this,arguments)}function $t(){Gt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function te(t,e){return(e=e||{}).recognizers=E(e.recognizers,te.defaults.preset),new ee(t,e)}Gt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(m(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=Xt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return m(t,"dropRecognizeWith",this)?this:(t=Xt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(m(t,"requireFailure",this))return this;var e=this.requireFail;return-1===I(e,t=Xt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(m(t,"dropRequireFailure",this))return this;t=Xt(t,this);var e=I(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,r=this.state;function i(r){e.manager.emit(r,t)}r<Nt&&i(e.options.event+qt(r)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),r>=Nt&&i(e.options.event+qt(r))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Ft)))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!k(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(Ut|Vt|32)&&(this.state=Ft),this.state=this.process(e),this.state&(Dt|Bt|Nt|Vt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},x(Wt,Gt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,r=t.eventType,i=e&(Dt|Bt),n=this.attrTest(t);return i&&(r&G||!n)?e|Vt:i||n?r&V?e|Nt:e&Dt?e|Bt:Dt:32}}),x(Ht,Wt,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var t=this.options.direction,e=[];return t&Y&&e.push(jt),t&K&&e.push(Lt),e},directionTest:function(t){var e=this.options,r=!0,i=t.distance,n=t.direction,a=t.deltaX,o=t.deltaY;return n&e.direction||(e.direction&Y?(n=0===a?q:a<0?Z:X,r=a!=this.pX,i=Math.abs(t.deltaX)):(n=0===o?q:o<0?W:H,r=o!=this.pY,i=Math.abs(t.deltaY))),t.direction=n,r&&i>e.threshold&&n&e.direction},attrTest:function(t){return Wt.prototype.attrTest.call(this,t)&&(this.state&Dt||!(this.state&Dt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Zt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),x(Yt,Wt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ct]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Dt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),x(Kt,Gt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[It]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime>e.time;if(this._input=t,!i||!r||t.eventType&(V|G)&&!n)this.reset();else if(t.eventType&N)this.reset(),this._timer=v(function(){this.state=Ut,this.tryEmit()},e.time,this);else if(t.eventType&V)return Ut;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===Ut&&(t&&t.eventType&V?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),x(Jt,Wt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ct]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Dt)}}),x(Qt,Wt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Y|K,pointers:1},getTouchAction:function(){return Ht.prototype.getTouchAction.call(this)},attrTest:function(t){var e,r=this.options.direction;return r&(Y|K)?e=t.overallVelocity:r&Y?e=t.overallVelocityX:r&K&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&r&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&f(e)>this.options.velocity&&t.eventType&V},emit:function(t){var e=Zt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),x($t,Gt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Mt]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,i=t.distance<e.threshold,n=t.deltaTime<e.time;if(this.reset(),t.eventType&N&&0===this.count)return this.failTimeout();if(i&&n&&r){if(t.eventType!=V)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||ot(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=v(function(){this.state=Ut,this.tryEmit()},e.interval,this),Dt):Ut}return 32},failTimeout:function(){return this._timer=v(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ut&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),te.VERSION="2.0.7",te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Jt,{enable:!1}],[Yt,{enable:!1},["rotate"]],[Qt,{direction:Y}],[Ht,{direction:Y},["swipe"]],[$t],[$t,{event:"doubletap",taps:2},["tap"]],[Kt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function ee(t,e){var r;this.options=u({},te.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((r=this).options.inputClass||(F?mt:D?kt:R?Tt:ht))(r,et),this.touchAction=new Rt(this,this.options.touchAction),re(this,!0),g(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function re(t,e){var r,i=t.element;i.style&&(g(t.options.cssProps,function(n,a){r=L(i.style,a),e?(t.oldCssProps[r]=i.style[r],i.style[r]=n):i.style[r]=t.oldCssProps[r]||""}),e||(t.oldCssProps={}))}ee.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var r;this.touchAction.preventDefaults(t);var i=this.recognizers,n=e.curRecognizer;(!n||n&&n.state&Ut)&&(n=e.curRecognizer=null);for(var a=0;a<i.length;)r=i[a],2===e.stopped||n&&r!=n&&!r.canRecognizeWith(n)?r.reset():r.recognize(t),!n&&r.state&(Dt|Bt|Nt)&&(n=e.curRecognizer=r),a++}},get:function(t){if(t instanceof Gt)return t;for(var e=this.recognizers,r=0;r<e.length;r++)if(e[r].options.event==t)return e[r];return null},add:function(t){if(m(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(m(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,r=I(e,t);-1!==r&&(e.splice(r,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var r=this.handlers;return g(O(t),function(t){r[t]=r[t]||[],r[t].push(e)}),this}},off:function(t,e){if(t!==s){var r=this.handlers;return g(O(t),function(t){e?r[t]&&r[t].splice(I(r[t],e),1):delete r[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var r=a.createEvent("Event");r.initEvent(t,!0,!0),r.gesture=e,e.target.dispatchEvent(r)}(t,e);var r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](e),i++}},destroy:function(){this.element&&re(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(te,{INPUT_START:N,INPUT_MOVE:U,INPUT_END:V,INPUT_CANCEL:G,STATE_POSSIBLE:Ft,STATE_BEGAN:Dt,STATE_CHANGED:Bt,STATE_ENDED:Nt,STATE_RECOGNIZED:Ut,STATE_CANCELLED:Vt,STATE_FAILED:32,DIRECTION_NONE:q,DIRECTION_LEFT:Z,DIRECTION_RIGHT:X,DIRECTION_UP:W,DIRECTION_DOWN:H,DIRECTION_HORIZONTAL:Y,DIRECTION_VERTICAL:K,DIRECTION_ALL:J,Manager:ee,Input:tt,TouchAction:Rt,TouchInput:kt,MouseInput:ht,PointerEventInput:mt,TouchMouseInput:Tt,SingleTouchInput:bt,Recognizer:Gt,AttrRecognizer:Wt,Tap:$t,Pan:Ht,Swipe:Qt,Pinch:Yt,Rotate:Jt,Press:Kt,on:S,off:T,each:g,merge:b,extend:_,assign:u,inherit:x,bindFn:w,prefixed:L}),(void 0!==n?n:"undefined"!=typeof self?self:{}).Hammer=te,(i=function(){return te}.call(e,r,e,t))===s||(t.exports=i)}(window,document)},function(t,e,r){"use strict";r.r(e);var i=r(15),n=r(3),a=r(4),o=r(0),s=r(1),u=r(2),l=r(26),c="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",h=Object(l.a)();var p=function(){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(s.a)(this,t),this.storage=function(t){try{var e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch(t){return null}}(i),this.id=e,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return Object(u.a)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function f(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,n=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(r=Math.min(r,i/t.width));var a=t.width*r,o=t.height*r,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(n,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}var d={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function v(t){return"string"==typeof t?d[t.toUpperCase()]||d.WHITE:t}function m(t,e){if(!t)throw new Error(e||"Assertion failed")}var g=r(9);function y(){var t;if(h&&g.b.performance)t=g.b.performance.now();else if(g.a.hrtime){var e=g.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var _={debug:h&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},b={enabled:!1,priority:0};function x(){}var w={};var k=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;Object(s.a)(this,t),this.id=e,this.VERSION=c,this._startTs=y(),this._deltaTs=y(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new p("__probe-".concat(this.id,"__"),b),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),n=!0,a=!1,o=void 0;try{for(var s,u=function(){var r=s.value;"function"==typeof t[r]&&(e.find(function(t){return r===t})||(t[r]=t[r].bind(t)))},l=i[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)u()}catch(t){a=!0,o=t}finally{try{n||null==l.return||l.return()}finally{if(a)throw o}}}(this),Object.seal(this)}return Object(u.a)(t,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return Number((y()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((y()-this._deltaTs).toPrecision(10))}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({priority:t}),this}},{key:"assert",value:function(t,e){m(t,e)}},{key:"warn",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this._getLogFunction({message:t,args:r,method:_.warn,once:!0})}},{key:"error",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this._getLogFunction({message:t,args:r,method:_.error})}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this._getLogFunction({priority:t,message:e,args:i,method:_.log,time:!0,once:!0})}},{key:"log",value:function(t,e){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this._getLogFunction({priority:t,message:e,args:i,method:_.debug})}},{key:"info",value:function(t,e){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this._getLogFunction({priority:t,message:e,args:i,method:console.info})}},{key:"once",value:function(t,e){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];return this._getLogFunction({priority:t,message:e,args:i,method:_.debug||_.info,once:!0})}},{key:"table",value:function(t,e,r){if(e){var i=function(t){for(var e in t)for(var r in t[e])return r||"untitled";return"empty"}(e);return this._getLogFunction({priority:t,message:e,args:r&&[r],tag:i,method:console.table||x})}return x}},{key:"image",value:function(t){var e=t.priority,r=t.image,i=t.message,n=void 0===i?"":i,a=t.scale,o=void 0===a?1:a;return e>this.getPriority()?x:h?this._logImageInBrowser({image:r,message:n,scale:o}):this._logImageInNode({image:r,message:n,scale:o})}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(Object(o.a)({},t,e))}},{key:"_logImageInNode",value:function(t){var e=t.image,i=(t.message,t.scale),n=void 0===i?1:i,a=null;try{a=r(37)}catch(t){}return a?function(){return a(e,{fit:"box",width:"".concat(Math.round(80*n),"%")}).then(function(t){return console.log(t)})}:x}},{key:"_logImageInBrowser",value:function(t){var e=t.image,r=t.message,i=void 0===r?"":r,n=t.scale,o=void 0===n?1:n;if("string"==typeof e){var s=new Image;return s.onload=function(){var t,e=f(s,i,o);(t=console).log.apply(t,Object(a.a)(e))},s.src=e,x}var u,l=e.nodeName||"";if("img"===l.toLowerCase())return(u=console).log.apply(u,Object(a.a)(f(e,i,o))),x;if("canvas"===l.toLowerCase()){var c=new Image;return c.onload=function(){var t;return(t=console).log.apply(t,Object(a.a)(f(c,i,o)))},c.src=e.toDataURL(),x}return x}},{key:"time",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeStamp||x})}},{key:"group",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},i=(r=this._normalizeArguments({priority:t,message:e,opts:r})).collapsed;return this._getLogFunction({priority:t,message:e,opts:r,method:(i?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},r,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction({priority:t,message:"",method:console.groupEnd||x})}},{key:"withGroup",value:function(t,e,r){var i=this._normalizeArguments({priority:t,message:e});this.group(i);try{r()}finally{this.groupEnd(i.message)}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return 0===(t=this._normalizePriority(t))||this.isEnabled()&&this.getPriority()>=t}},{key:"_getElapsedTime",value:function(){var t=this.getTotal(),e=this.getDelta();return this._deltaTs=y(),{total:t,delta:e}}},{key:"_getLogFunction",value:function(t){if(this._shouldLog(t.priority)){var e=t.method;t=this._parseArguments(t),m(e);var r=t.message,i=t.tag||t.message;if(t.once){if(w[i])return x;w[i]=y()}return r=this._decorateMessage(r,t),e.bind.apply(e,[console,r].concat(Object(a.a)(t.args)))}return x}},{key:"_parseArguments",value:function(t){var e=this._normalizeArguments(t),r=this._getElapsedTime(),i=r.delta,n=r.total;return Object.assign(t,e,{delta:i,total:n})}},{key:"_normalizePriority",value:function(t){var e;switch(Object(n.a)(t)){case"number":e=t;break;case"object":e=t.priority||0;break;default:e=0}return m(Number.isFinite(e)&&e>=0),e}},{key:"_normalizeArguments",value:function(t){var e=t.priority,r=t.message,i=t.args,a=void 0===i?[]:i,o=t.opts,s={priority:this._normalizePriority(e),message:r,args:a};switch(Object(n.a)(e)){case"string":case"function":void 0!==r&&a.unshift(r),Object.assign(s,{message:e});break;case"object":Object.assign(s,e)}return"function"==typeof s.message&&(s.message=this._shouldLog(s.priority)?s.message():""),m("string"==typeof s.message||"object"===Object(n.a)(s.message)),Object.assign(s,o)}},{key:"_decorateMessage",value:function(t,e){if("string"==typeof t){var r="";if(e.time){var i=this._getElapsedTime().total;r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=Math.max(e-t.length,0);return"".concat(" ".repeat(r)).concat(t)}((s=i)<10?"".concat(s.toFixed(2),"ms"):s<100?"".concat(s.toFixed(1),"ms"):s<1e3?"".concat(s.toFixed(0),"ms"):"".concat((s/1e3).toFixed(2),"s"))}t=e.time?"".concat(this.id,": ").concat(r,"  ").concat(t):"".concat(this.id,": ").concat(t),n=t,a=e.color,o=e.background,h||"string"!=typeof n||(a&&(a=v(a),n="[".concat(a,"m").concat(n,"[39m")),o&&(a=v(o),n="[".concat(o+10,"m").concat(n,"[49m"))),t=n}var n,a,o,s;return t}},{key:"priority",set:function(t){return this._storage.updateConfiguration({priority:t}),this},get:function(){return this._storage.config.priority}}]),t}();k.VERSION=c;var E=new k({id:"deck"}).enable();if(i.a.deck&&"7.0.9"!==i.a.deck.VERSION)throw new Error("deck.gl - multiple versions detected: ".concat(i.a.deck.VERSION," vs ").concat("7.0.9"));i.a.deck||(E.log(0,"deck.gl ".concat("7.0.9"," - ").concat("set deck.log.priority=1 (or higher) to trace attribute updates"))(),i.a.deck=i.a.deck||{VERSION:"7.0.9",version:"7.0.9",log:E}),console.table||(console.table=function(){});var S=r(14),T=r(6),A=new k({id:"luma"}).enable(),P=function(){function t(e){Object(s.a)(this,t),this.name=e,this.reset()}return Object(u.a)(t,[{key:"incrementCount",value:function(){this.addCount(1)}},{key:"decrementCount",value:function(){this.subtractCount(1)}},{key:"addCount",value:function(t){this.count+=t}},{key:"subtractCount",value:function(t){this.count-=t}},{key:"addTime",value:function(t){this.time+=t,this.lastTiming=t,this.count++}},{key:"timeStart",value:function(){this._startTime=y(),this._timerPending=!0}},{key:"timeEnd",value:function(){this._timerPending&&(this.addTime(y()-this._startTime),this._timerPending=!1)}},{key:"getAverageTime",value:function(){return this.count>0?this.time/this.count:0}},{key:"getHz",value:function(){return this.time>0?this.count/(this.time/1e3):0}},{key:"reset",value:function(){this.time=0,this.count=0,this.lastTiming=0,this._startTime=0,this._timerPending=!1}}]),t}(),O=function(){function t(e){var r=e.id;Object(s.a)(this,t),this.id=r,this.stats={},Object.seal(this)}return Object(u.a)(t,[{key:"get",value:function(t){return this.stats[t]=this.stats[t]||new P(t),this.stats[t]}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach(function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}}]),t}(),I=(r(24),new(function(){function t(){Object(s.a)(this,t),this.stats=new Map}return Object(u.a)(t,[{key:"get",value:function(t){return this.stats.has(t)||this.stats.set(t,new O({id:t})),this.stats.get(t)}}]),t}()));if(T.a.luma&&"7.0.2"!==T.a.luma.VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(T.a.luma.VERSION," vs ").concat("7.0.2"));T.a.luma||(S.a&&A.log(1,"luma.gl ".concat("7.0.2"," - ").concat("set luma.log.priority=1 (or higher) to trace rendering"))(),T.a.luma=T.a.luma||{VERSION:"7.0.2",version:"7.0.2",log:A,stats:I,globals:{modules:{},nodeIO:{}}});T.a.luma;var M=r(11);function C(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);i=!0);}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function L(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var j={framebuffer:function(t,e){var r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:function(t,e){return e?t.enable(3042):t.disable(3042)},blendColor:function(t,e){return t.blendColor.apply(t,Object(a.a)(e))},blendEquation:function(t,e){e=L(e)?e:[e,e],t.blendEquationSeparate.apply(t,Object(a.a)(e))},blendFunc:function(t,e){e=L(e)&&2===e.length?[].concat(Object(a.a)(e),Object(a.a)(e)):e,t.blendFuncSeparate.apply(t,Object(a.a)(e))},clearColor:function(t,e){return t.clearColor.apply(t,Object(a.a)(e))},clearDepth:function(t,e){return t.clearDepth(e)},clearStencil:function(t,e){return t.clearStencil(e)},colorMask:function(t,e){return t.colorMask.apply(t,Object(a.a)(e))},cull:function(t,e){return e?t.enable(2884):t.disable(2884)},cullFace:function(t,e){return t.cullFace(e)},depthTest:function(t,e){return e?t.enable(2929):t.disable(2929)},depthFunc:function(t,e){return t.depthFunc(e)},depthMask:function(t,e){return t.depthMask(e)},depthRange:function(t,e){return t.depthRange.apply(t,Object(a.a)(e))},dither:function(t,e){return e?t.enable(3024):t.disable(3024)},derivativeHint:function(t,e){t.hint(35723,e)},frontFace:function(t,e){return t.frontFace(e)},mipmapHint:function(t,e){return t.hint(33170,e)},lineWidth:function(t,e){return t.lineWidth(e)},polygonOffsetFill:function(t,e){return e?t.enable(32823):t.disable(32823)},polygonOffset:function(t,e){return t.polygonOffset.apply(t,Object(a.a)(e))},sampleCoverage:function(t,e){return t.sampleCoverage.apply(t,Object(a.a)(e))},scissorTest:function(t,e){return e?t.enable(3089):t.disable(3089)},scissor:function(t,e){return t.scissor.apply(t,Object(a.a)(e))},stencilTest:function(t,e){return e?t.enable(2960):t.disable(2960)},stencilMask:function(t,e){var r=C(e=L(e)?e:[e,e],2),i=r[0],n=r[1];t.stencilMaskSeparate(1028,i),t.stencilMaskSeparate(1029,n)},stencilFunc:function(t,e){var r=C(e=L(e)&&3===e.length?[].concat(Object(a.a)(e),Object(a.a)(e)):e,6),i=r[0],n=r[1],o=r[2],s=r[3],u=r[4],l=r[5];t.stencilFuncSeparate(1028,i,n,o),t.stencilFuncSeparate(1029,s,u,l)},stencilOp:function(t,e){var r=C(e=L(e)&&3===e.length?[].concat(Object(a.a)(e),Object(a.a)(e)):e,6),i=r[0],n=r[1],o=r[2],s=r[3],u=r[4],l=r[5];t.stencilOpSeparate(1028,i,n,o),t.stencilOpSeparate(1029,s,u,l)},viewport:function(t,e){return t.viewport.apply(t,Object(a.a)(e))}};function z(t,e){for(var r in Object(M.c)(t,e),e){var i=j[r];i&&i(t,e[r],r)}}var R=r(12),F=r(10);function D(t,e,r){if(Object(F.b)(e))return r(t);var i,n=e.nocatch,a=void 0===n||n;if(Object(F.a)(!e.frameBuffer),Object(R.c)(t),z(t,e),a)i=r(t),Object(R.b)(t);else try{i=r(t)}finally{Object(R.b)(t)}return i}var B="luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL contexts can not be created. This may not be an error. For example, this is a typical configuration for isorender applications running on the server.",N=null;function U(){var t=r(38);if(!t)throw new Error(B);return t.apply(void 0,arguments)}if(!S.a)try{N=r(39)}catch(t){}var V=function t(){Object(s.a)(this,t)},G=N||T.a,q=(G.WebGLRenderingContext,G.WebGLProgram,G.WebGLShader,G.WebGLBuffer),Z=void 0===q?V:q;G.WebGLFramebuffer,G.WebGLRenderbuffer,G.WebGLTexture,G.WebGLUniformLocation,G.WebGLActiveInfo,G.WebGLShaderPrecisionFormat;var X=T.a.WebGL2RenderingContext||function t(){Object(s.a)(this,t)};T.a.Image;function W(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),i.forEach(function(e){Object(o.a)(t,e,r[e])})}return t}var H="Failed to create WebGL context in Node.js, headless gl not available",Y="Failed to create WebGL context in Node.js, headless gl returned null";function K(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}var J={};function Q(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";J[t]=J[t]||1;var e=J[t]++;return"".concat(t,"-").concat(e)}function $(t){return K("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function tt(t){var e=!0;for(var r in t){e=!1;break}return e}function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.isInteger,i=void 0!==r&&r;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){for(var r=e.maxElts,i=void 0===r?16:r,n=e.size,a=void 0===n?1:n,o="[",s=0;s<t.length&&s<i;++s)s>0&&(o+=",".concat(s%a==0?" ":"")),o+=et(t[s],e);var u=t.length>i?"...":"]";return"".concat(o).concat(u)}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var n=t.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function rt(t,e,r,i){var n="See luma.gl ".concat(r," Upgrade Guide at http://uber.github.io/luma.gl/#/documentation/overview/upgrade-guide"),a=Object.getPrototypeOf(t);i.forEach(function(t){a.methodName||(a[t]=function(){throw A.removed("Calling removed method ".concat(e,".").concat(t,": "),n)(),new Error(t)})})}function it(t,e,r){var i=r.removedProps,n=void 0===i?{}:i,a=r.deprecatedProps,o=void 0===a?{}:a,s=r.replacedProps,u=void 0===s?{}:s;for(var l in n)if(l in e){var c=n[l]?"".concat(t,".").concat(n[l]):"N/A";A.removed("".concat(t,".").concat(l),c)()}for(var h in o)if(h in e){var p=o[h];A.deprecated("".concat(t,".").concat(h),"".concat(t,".").concat(p))()}var f=null;for(var d in u)if(d in e){var v=u[d];A.deprecated("".concat(t,".").concat(d),"".concat(t,".").concat(v))(),(f=f||Object.assign({},e))[v]=e[d],delete f[d]}return f||e}var nt,at=S.a&&"undefined"!=typeof document,ot=at&&"complete"===document.readyState;function st(){return nt||(nt=at?new Promise(function(t,e){if(at&&"complete"===document.readyState)return ot=!0,void t(document);window.onload=function(){ot=!0,t(document)}}):Promise.resolve({})),nt}function ut(t){var e,r=t.canvas,i=t.width,n=t.height,a=t.onError,o=void 0===a?function(){}:a;return"string"==typeof r?(ot||o("createGLContext called on canvas '".concat(r,"' before page was loaded")),e=document.getElementById(r)):e=r||function(t){var e=t.width,r=void 0===e?800:e,i=t.height,n=void 0===i?600:i,a=t.id,o=void 0===a?"gl-canvas":a,s=t.insert,u=void 0===s||s,l=document.createElement("canvas");if(l.id=o,l.style.width=Number.isFinite(r)?"".concat(r,"px"):"100%",l.style.height=Number.isFinite(n)?"".concat(n,"px"):"100%",u){var c=document.body;c.insertBefore(l,c.firstChild)}return l}({id:"lumagl-canvas",width:i,height:n,onError:o}),e}function lt(t){var e=t.getParameter(7936),r=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info");return{vendor:i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937)||r,vendorMasked:e,rendererMasked:r,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}var ct="Invalid WebGLRenderingContext",ht="Requires WebGL2";function pt(t){return Boolean(t&&Number.isFinite(t._version))}function ft(t){return Boolean(t&&2===t._version)}function dt(t){K(pt(t),ct)}function vt(t){K(ft(t),ht)}function mt(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function gt(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var yt="Failed to deduce GL constant from typed array";function _t(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(yt)}}function bt(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,r=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function xt(t){for(var e=t.data,r=t.width,i=t.height,n=Math.round(r/2),a=Math.round(i/2),o=new Uint8Array(n*a*4),s=0;s<a;s++)for(var u=0;u<n;u++)for(var l=0;l<4;l++)o[4*(s*n+u)+l]=e[4*(2*s*r+2*u)+l];return{data:o,width:n,height:a}}function wt(t,e){if("string"!=typeof e)return e;var r=Number(e);if(!isNaN(r))return r;var i=t[e=e.replace(/^.*\./,"")];return K(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function kt(t,e){for(var r in e=Number(e),t)if(t[r]===e)return"GL.".concat(r);return String(e)}function Et(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function St(t,e){return!e||"object"!==Object(n.a)(e)&&"function"!=typeof e?Et(t):e}function Tt(t){return(Tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Pt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}var Ot="Resource subclass must define virtual methods",It=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),dt(e);var i=r.id,n=r.userData,a=void 0===n?{}:n;this.gl=e,this.id=i||Q(this.constructor.name),this.userData=a,this._bound=!1,this._handle=r.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return Object(u.a)(t,[{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.id,")")}},{key:"delete",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteChildren,e=void 0!==t&&t,r=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,r&&e&&r.filter(Boolean).forEach(function(t){t.delete()}),this}},{key:"bind",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};K(t=wt(this.gl,t));var r=(this.constructor.PARAMETERS||{})[t];if(r){var i=ft(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){var n=r.webgl1,a="webgl2"in r?r.webgl2:r.webgl1;return i?a:n}}return this._getParameter(t,e)}},{key:"getParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},r=e.parameters,i=e.keys,n=this.constructor.PARAMETERS||{},a=ft(this.gl),o={},s=r||Object.keys(n),u=!0,l=!1,c=void 0;try{for(var h,p=s[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value,d=n[f];if(d&&(!("webgl2"in d)||a)&&(!("extension"in d)||this.gl.getExtension(d.extension))){var v=i?kt(this.gl,f):f;o[v]=this.getParameter(f,t),i&&"GLenum"===d.type&&(o[v]=kt(this.gl,o[v]))}}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}return o}},{key:"setParameter",value:function(t,e){K(t=wt(this.gl,t));var r=(this.constructor.PARAMETERS||{})[t];if(r){var i=ft(this.gl);if(!((!("webgl2"in r)||i)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(e=wt(e))}return this._setParameter(t,e),this}},{key:"setParameters",value:function(t){for(var e in t)this.setParameter(e,t[e]);return this}},{key:"stubRemovedMethods",value:function(t,e,r){return rt(this,t,e,r)}},{key:"initialize",value:function(t){}},{key:"_createHandle",value:function(){throw new Error(Ot)}},{key:"_deleteHandle",value:function(){throw new Error(Ot)}},{key:"_bindHandle",value:function(){throw new Error(Ot)}},{key:"_getOptsFromHandle",value:function(){throw new Error(Ot)}},{key:"_getParameter",value:function(t,e){throw new Error(Ot)}},{key:"_setParameter",value:function(t,e){throw new Error(Ot)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var t=this.constructor.name,e=I.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var t=this.constructor.name;I.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.constructor.name,r=I.get("Memory Usage");r.get("GPU Memory").addCount(t),r.get("".concat(e," Memory")).addCount(t),this.byteLength=t}},{key:"_trackDeallocatedMemory",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.constructor.name,e=I.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}},{key:"handle",get:function(){return this._handle}}]),t}();function Mt(t,e,r){return(Mt=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&At(n,r.prototype),n}).apply(null,arguments)}var Ct,Lt,jt,zt={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Rt={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},Ft=function(){function t(){var e=this;Object(s.a)(this,t);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];i.forEach(function(t){return e._assign(t)}),Object.freeze(this)}return Object(u.a)(t,null,[{key:"getBytesPerElement",value:function(t){return bt(t.type||5126).BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(t){return K(t.size),bt(t.type||5126).BYTES_PER_ELEMENT*t.size}},{key:"resolve",value:function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return Mt(t,[zt].concat(r))}}]),Object(u.a)(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"_assign",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==(t=it("Accessor",t,Rt)).type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}}]),t}(),Dt={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Bt={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Dt},Nt={removedProps:Dt},Ut=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t,i))).stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),r.target=i.target||(r.gl.webgl2?36662:34962),r.initialize(i),Object.seal(Et(r)),r}return Pt(e,It),Object(u.a)(e,[{key:"getElementCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/Ft.getBytesPerElement(t))}},{key:"getVertexCount",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor;return Math.round(this.byteLength/Ft.getBytesPerVertex(t))}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=it("Buffer",t,Bt),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data):this._setByteLength(t.byteLength||0),this}},{key:"setProps",value:function(t){return"accessor"in(t=it("Buffer",t,Nt))&&this.setAccessor(t.accessor),this}},{key:"setAccessor",value:function(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new Ft(t),this}},{key:"reallocate",value:function(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}},{key:"setData",value:function(t){return this.initialize(t)}},{key:"subData",value:function(t){ArrayBuffer.isView(t)&&(t={data:t});var e=t,r=e.data,i=e.offset,n=void 0===i?0:i,a=e.srcOffset,o=void 0===a?0:a,s=t.byteLength||t.length;K(r);var u=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(u,this.handle),0!==o||void 0!==s?(vt(this.gl),this.gl.bufferSubData(this.target,n,r,o,s)):this.gl.bufferSubData(u,n,r),this.gl.bindBuffer(u,null),this.debugData=null,this._inferType(r),this}},{key:"copyData",value:function(t){var e=t.sourceBuffer,r=t.readOffset,i=void 0===r?0:r,n=t.writeOffset,a=void 0===n?0:n,o=t.size,s=this.gl;return vt(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,i,a,o),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dstData,r=void 0===e?null:e,i=t.srcByteOffset,n=void 0===i?0:i,a=t.dstOffset,o=void 0===a?0:a,s=t.length,u=void 0===s?0:s;vt(this.gl);var l,c,h=bt(this.accessor.type||5126,{clamped:!1}),p=this._getAvailableElementCount(n),f=o;r?l=(c=r.length)-f:c=f+(l=Math.min(p,u||p));var d=Math.min(p,l);return K((u=u||d)<=d),r=r||new h(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,r,o,u),this.gl.bindBuffer(36662,null),r}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,r=void 0===e?this.target:e,i=t.index,n=void 0===i?this.accessor&&this.accessor.index:i,a=t.offset,o=void 0===a?0:a,s=t.size;return 35345===r||35982===r?void 0!==s?this.gl.bindBufferRange(r,n,this.handle,o,s):(K(0===o),this.gl.bindBufferBase(r,n,this.handle)):this.gl.bindBuffer(r,this.handle),this}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,r=void 0===e?this.target:e,i=t.index,n=void 0===i?this.accessor&&this.accessor.index:i;return 35345===r||35982===r?this.gl.bindBufferBase(r,n,null):this.gl.bindBuffer(r,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:10}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;K(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();var r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,e),this.gl.bindBuffer(r,null),this.usage=e,this.debugData=t.slice(0,10),this.bytesUsed=t.byteLength,this._trackAllocatedMemory(t.byteLength);var i=_t(t);return K(i),this.setAccessor(new Ft(this.accessor,{type:i})),this}},{key:"_setByteLength",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;K(t>=0),this._trackDeallocatedMemory();var r=t;0===t&&(r=new Float32Array(0));var i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,e),this.gl.bindBuffer(i,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(t){var e=t/bt(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}},{key:"_inferType",value:function(t){this.accessor.type||this.setAccessor(new Ft(this.accessor,{type:_t(t)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(t){this.gl.bindBuffer(this.target,this.handle);var e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}},{key:"setByteLength",value:function(t){return A.deprecated("setByteLength","reallocate")(),this.reallocate(t)}},{key:"updateAccessor",value:function(t){return A.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Ft(this.accessor,t),this}},{key:"type",get:function(){return A.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return A.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}}]),e}(),Vt=(Ct={},Object(o.a)(Ct,6407,{dataFormat:6407,types:[5121,33635]}),Object(o.a)(Ct,6408,{dataFormat:6408,types:[5121,32819,32820]}),Object(o.a)(Ct,6406,{dataFormat:6406,types:[5121]}),Object(o.a)(Ct,6409,{dataFormat:6409,types:[5121]}),Object(o.a)(Ct,6410,{dataFormat:6410,types:[5121]}),Object(o.a)(Ct,33326,{dataFormat:6403,types:[5126],gl2:!0}),Object(o.a)(Ct,33328,{dataFormat:33319,types:[5126],gl2:!0}),Object(o.a)(Ct,34837,{dataFormat:6407,types:[5126],gl2:!0}),Object(o.a)(Ct,34836,{dataFormat:6408,types:[5126],gl2:!0}),Ct),Gt=(Lt={},Object(o.a)(Lt,6403,1),Object(o.a)(Lt,36244,1),Object(o.a)(Lt,33319,2),Object(o.a)(Lt,33320,2),Object(o.a)(Lt,6407,3),Object(o.a)(Lt,36248,3),Object(o.a)(Lt,6408,4),Object(o.a)(Lt,36249,4),Object(o.a)(Lt,6402,1),Object(o.a)(Lt,34041,1),Object(o.a)(Lt,6406,1),Object(o.a)(Lt,6409,1),Object(o.a)(Lt,6410,2),Lt),qt=(jt={},Object(o.a)(jt,5126,4),Object(o.a)(jt,5125,4),Object(o.a)(jt,5124,4),Object(o.a)(jt,5123,2),Object(o.a)(jt,5122,2),Object(o.a)(jt,5131,2),Object(o.a)(jt,5120,1),Object(o.a)(jt,5121,1),jt);var Zt=[9729,9728],Xt=function(t){function e(t,r){var i;Object(s.a)(this,e);var n=r.id,a=void 0===n?Q("texture"):n,o=r.handle,u=r.target;return(i=St(this,Tt(e).call(this,t,{id:a,handle:o}))).target=u,i.hasFloatTexture=t.getExtension("OES_texture_float"),i.textureUnit=void 0,i.loaded=!1,i.width=void 0,i.height=void 0,i.depth=void 0,i.format=void 0,i.type=void 0,i.dataFormat=void 0,i.border=void 0,i.textureUnit=void 0,i.mipmaps=void 0,i}return Pt(e,It),Object(u.a)(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.format,i=e.linearFiltering,n=!0;return r&&(n=(n=n&&function(t,e){var r=Vt[e];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;var i=ft(t)&&r.gl2||r.gl1;return"string"==typeof i?t.getExtension(i):i}(t,r))&&(!i||function(t,e){var r=Vt[e];switch(r&&r.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}(t,r))),n}}]),Object(u.a)(e,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.data;if(r instanceof Promise)return r.then(function(r){return t.initialize(Object.assign({},e,{pixels:r,data:r}))}),this;var i=e.pixels,n=void 0===i?null:i,a=e.format,s=void 0===a?6408:a,u=e.type,l=void 0===u?5121:u,c=e.border,h=void 0===c?0:c,p=e.recreate,f=void 0!==p&&p,d=e.parameters,v=void 0===d?{}:d,m=e.pixelStore,g=void 0===m?{}:m,y=e.textureUnit,_=void 0===y?void 0:y,b=e.unpackFlipY,x=void 0===b||b,w=e.mipmaps,k=void 0===w||w;r||(r=n);var E=e.width,S=e.height,T=e.dataFormat,P=e.depth,O=void 0===P?0:P,I=this._deduceParameters({format:s,type:l,dataFormat:T,compressed:!1,data:r,width:E,height:S});E=I.width,S=I.height,T=I.dataFormat,this.width=E,this.height=S,this.depth=O,this.format=s,this.type=l,this.dataFormat=T,this.border=h,this.textureUnit=_,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle));var M=Object(o.a)({},37440,x),C=Object.assign({},M,g);return k&&this._isNPOT()&&(A.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),k=!1,this._updateForNPOT(v)),this.mipmaps=k,this.setImageData({data:r,width:E,height:S,depth:O,format:s,type:l,dataFormat:T,border:h,mipmaps:k,parameters:C}),k&&this.generateMipmap(),this.setParameters(v),f&&(this.data=r),this}},{key:"resize",value:function(t){var e=t.width,r=t.height;return e!==this.width||r!==this.height?this.initialize({width:e,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:!1}):this}},{key:"generateMipmap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.gl.bindTexture(this.target,this.handle),D(this.gl,e,function(){t.gl.generateMipmap(t.target)}),this.gl.bindTexture(this.target,null),this}},{key:"setImageData",value:function(t){this._trackDeallocatedMemory("Texture");var e=t.target,r=void 0===e?this.target:e,i=t.pixels,n=void 0===i?null:i,a=t.level,o=void 0===a?0:a,s=t.format,u=void 0===s?this.format:s,l=t.border,c=void 0===l?this.border:l,h=t.offset,p=void 0===h?0:h,f=t.parameters,d=void 0===f?{}:f,v=t.data,m=void 0===v?null:v,g=t.type,y=void 0===g?this.type:g,_=t.width,b=void 0===_?this.width:_,x=t.height,w=void 0===x?this.height:x,k=t.dataFormat,E=void 0===k?this.dataFormat:k,S=t.compressed,T=void 0!==S&&S;m||(m=n);var A=this._deduceParameters({format:u,type:y,dataFormat:E,compressed:T,data:m,width:b,height:w});y=A.type,E=A.dataFormat,T=A.compressed,b=A.width,w=A.height;var P=this.gl;P.bindTexture(this.target,this.handle);var O,I=this._getDataType({data:m,compressed:T});if(m=I.data,O=I.dataType,D(this.gl,d,function(){switch(O){case"null":P.texImage2D(r,o,u,b,w,c,E,y,m);break;case"typed-array":P.texImage2D(r,o,u,b,w,c,E,y,m,p);break;case"buffer":vt(P),P.bindBuffer(35052,m.handle||m),P.texImage2D(r,o,u,b,w,c,E,y,p),P.bindBuffer(35052,null);break;case"browser-object":ft(P)?P.texImage2D(r,o,u,b,w,c,E,y,m):P.texImage2D(r,o,u,E,y,m);break;case"compressed":P.compressedTexImage2D(r,o,u,b,w,c,m);break;default:K(!1,"Unknown image data type")}}),m&&m.byteLength)this._trackAllocatedMemory(m.byteLength,"Texture");else{var M=Gt[this.dataFormat]||4,C=qt[this.type]||1;this._trackAllocatedMemory(this.width*this.height*M*C,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(t){var e=this,r=t.target,i=void 0===r?this.target:r,n=t.pixels,a=void 0===n?null:n,o=t.data,s=void 0===o?null:o,u=t.x,l=void 0===u?0:u,c=t.y,h=void 0===c?0:c,p=t.width,f=void 0===p?this.width:p,d=t.height,v=void 0===d?this.height:d,m=t.level,g=void 0===m?0:m,y=t.format,_=void 0===y?this.format:y,b=t.type,x=void 0===b?this.type:b,w=t.dataFormat,k=void 0===w?this.dataFormat:w,E=t.compressed,S=void 0!==E&&E,T=t.offset,A=void 0===T?0:T,P=t.border,O=(void 0===P&&this.border,t.parameters),I=void 0===O?{}:O,M=this._deduceParameters({format:_,type:x,dataFormat:k,compressed:S,data:s,width:f,height:v});if(x=M.type,k=M.dataFormat,S=M.compressed,f=M.width,v=M.height,K(0===this.depth,"texSubImage not supported for 3D textures"),s||(s=a),s&&s.data){var C=s;s=C.data,f=C.shape[0],v=C.shape[1]}s instanceof Ut&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),D(this.gl,I,function(){S?e.gl.compressedTexSubImage2D(i,g,l,h,f,v,_,s):null===s?e.gl.texSubImage2D(i,g,l,h,f,v,k,x,null):ArrayBuffer.isView(s)?e.gl.texSubImage2D(i,g,l,h,f,v,k,x,s,A):s instanceof Z?(vt(e.gl),e.gl.bindBuffer(35052,s),e.gl.texSubImage2D(i,g,l,h,f,v,k,x,A),e.gl.bindBuffer(35052,null)):ft(e.gl)?e.gl.texSubImage2D(i,g,l,h,f,v,k,x,s):e.gl.texSubImage2D(i,g,l,h,k,x,s)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}},{key:"_getDataType",value:function(t){var e=t.data,r=t.compressed;return void 0!==r&&r?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Ut?{data:e.handle,dataType:"buffer"}:e instanceof Z?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(t){var e=t.format,r=t.data,i=t.width,n=t.height,a=t.dataFormat,o=t.type,s=t.compressed,u=Vt[e];a=a||u&&u.dataFormat,o=o||u&&u.types[0],s=s||u&&u.compressed;var l=this._deduceImageSize(r,i,n);return{dataFormat:a,type:o,compressed:s,width:i=l.width,height:n=l.height,format:e,data:r}}},{key:"_deduceImageSize",value:function(t,e,r){var i;return K(i="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:r}:{width:e>=0?e:1,height:r>=0?r:1},"Could not deduced texture size"),K(void 0===e||i.width===e,"Deduced texture width does not match supplied width"),K(void 0===r||i.height===r,"Deduced texture height does not match supplied height"),i}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}},{key:"_setParameter",value:function(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:K(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!ft(this.gl)&&(!(!this.width||!this.height)&&(!$(this.width)||!$(this.height)))}},{key:"_updateForNPOT",value:function(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(t,e){if(this._isNPOT())switch(t){case 10241:-1===Zt.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}]),e}(),Wt="";var Ht=function(t){function e(t){var r,i,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),dt(t),(a instanceof Promise||"string"==typeof a)&&(a={data:a}),"string"==typeof a.data&&(a=Object.assign({},a,{data:(i=a.data,K("string"==typeof i),i=Wt+i,new Promise(function(t,e){try{var r=new Image;r.onload=function(){return t(r)},r.onerror=function(){return e(new Error("Could not load image ".concat(i,".")))},r.crossOrigin=n&&n.crossOrigin||"anonymous",r.src=i}catch(t){e(t)}}))})),(r=St(this,Tt(e).call(this,t,Object.assign({},a,{target:3553})))).initialize(a),Object.seal(Et(r)),r}return Pt(e,Xt),Object(u.a)(e,null,[{key:"isSupported",value:function(t,e){return Xt.isSupported(t,e)}}]),e}(),Yt=r(19),Kt=r.n(Yt);function Jt(t,e,r,i,n,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(i,n)}function Qt(t){return function(){var e=this,r=arguments;return new Promise(function(i,n){var a=t.apply(e,r);function o(t){Jt(a,i,n,o,s,"next",t)}function s(t){Jt(a,i,n,o,s,"throw",t)}o(void 0)})}}var $t=[34069,34070,34071,34072,34073,34074],te=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),dt(t),(r=St(this,Tt(e).call(this,t,Object.assign({},i,{target:34067})))).initialize(i),Object.seal(Et(r)),r}return Pt(e,Xt),Object(u.a)(e,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.mipmaps,i=void 0===r||r,n=e.parameters,a=void 0===n?{}:n;this.opts=e,this.setCubeMapImageData(e).then(function(){t.loaded=!0,i&&t.generateMipmap(e),t.setParameters(a)})}},{key:"subImage",value:function(t){var e=t.face,r=t.data,i=t.x,n=void 0===i?0:i,a=t.y,o=void 0===a?0:a,s=t.mipmapLevel,u=void 0===s?0:s;return this._subImage({target:e,data:r,x:n,y:o,mipmapLevel:u})}},{key:"setCubeMapImageData",value:function(){var t=Qt(Kt.a.mark(function t(e){var r,i,n,a,o,s,u,l,c,h,p,f,d,v=this;return Kt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.width,i=e.height,n=e.pixels,a=e.data,o=e.border,s=void 0===o?0:o,u=e.format,l=void 0===u?6408:u,c=e.type,h=void 0===c?5121:c,p=this.gl,f=n||a,t.next=5,Promise.all($t.map(function(t){var e=f[t];return Promise.all(Array.isArray(e)?e:[e])}));case 5:d=t.sent,this.bind(),$t.forEach(function(t,e){d[e].length>1&&!1!==v.opts.mipmaps&&A.warn("".concat(v.id," has mipmap and multiple LODs."))(),d[e].forEach(function(e,n){r&&i?p.texImage2D(t,n,l,r,i,s,l,h,e):p.texImage2D(t,n,l,l,h,e)})}),this.unbind();case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"setImageDataForFace",value:function(t){var e=this,r=t.face,i=t.width,n=t.height,a=t.pixels,o=t.data,s=t.border,u=void 0===s?0:s,l=t.format,c=void 0===l?6408:l,h=t.type,p=void 0===h?5121:h,f=this.gl,d=a||o;return this.bind(),d instanceof Promise?d.then(function(i){return e.setImageDataForFace(Object.assign({},t,{face:r,data:i,pixels:i}))}):this.width||this.height?f.texImage2D(r,0,c,i,n,u,c,p,d):f.texImage2D(r,0,c,c,p,d),this}}]),e}();te.FACES=$t;var ee,re=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),vt(t),i=Object.assign({depth:1},i,{target:32879,unpackFlipY:!1}),(r=St(this,Tt(e).call(this,t,i))).initialize(i),Object.seal(Et(r)),r}return Pt(e,Xt),Object(u.a)(e,null,[{key:"isSupported",value:function(t){return ft(t)}}]),Object(u.a)(e,[{key:"setImageData",value:function(t){var e=this,r=t.level,i=void 0===r?0:r,n=t.dataFormat,a=void 0===n?6408:n,o=t.width,s=t.height,u=t.depth,l=void 0===u?1:u,c=t.border,h=void 0===c?0:c,p=t.format,f=t.type,d=void 0===f?5121:f,v=t.offset,m=void 0===v?0:v,g=t.data,y=t.parameters,_=void 0===y?{}:y;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),D(this.gl,_,function(){ArrayBuffer.isView(g)&&e.gl.texImage3D(e.target,i,a,o,s,l,h,p,d,g),g instanceof Ut&&(e.gl.bindBuffer(35052,g.handle),e.gl.texImage3D(e.target,i,a,o,s,l,h,p,d,m))}),g&&g.byteLength)this._trackAllocatedMemory(g.byteLength,"Texture");else{var b=Gt[this.dataFormat]||4,x=qt[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*b*x,"Texture")}return this.loaded=!0,this}}]),e}(),ie="EXT_color_buffer_float",ne=(ee={},Object(o.a)(ee,33189,{bpp:2}),Object(o.a)(ee,33190,{gl2:!0,bpp:3}),Object(o.a)(ee,36012,{gl2:!0,bpp:4}),Object(o.a)(ee,36168,{bpp:1}),Object(o.a)(ee,34041,{bpp:4}),Object(o.a)(ee,35056,{gl2:!0,bpp:4}),Object(o.a)(ee,36013,{gl2:!0,bpp:5}),Object(o.a)(ee,32854,{bpp:2}),Object(o.a)(ee,36194,{bpp:2}),Object(o.a)(ee,32855,{bpp:2}),Object(o.a)(ee,33321,{gl2:!0,bpp:1}),Object(o.a)(ee,33330,{gl2:!0,bpp:1}),Object(o.a)(ee,33329,{gl2:!0,bpp:1}),Object(o.a)(ee,33332,{gl2:!0,bpp:2}),Object(o.a)(ee,33331,{gl2:!0,bpp:2}),Object(o.a)(ee,33334,{gl2:!0,bpp:4}),Object(o.a)(ee,33333,{gl2:!0,bpp:4}),Object(o.a)(ee,33323,{gl2:!0,bpp:2}),Object(o.a)(ee,33336,{gl2:!0,bpp:2}),Object(o.a)(ee,33335,{gl2:!0,bpp:2}),Object(o.a)(ee,33338,{gl2:!0,bpp:4}),Object(o.a)(ee,33337,{gl2:!0,bpp:4}),Object(o.a)(ee,33340,{gl2:!0,bpp:8}),Object(o.a)(ee,33339,{gl2:!0,bpp:8}),Object(o.a)(ee,32849,{gl2:!0,bpp:3}),Object(o.a)(ee,32856,{gl2:!0,bpp:4}),Object(o.a)(ee,32857,{gl2:!0,bpp:4}),Object(o.a)(ee,36220,{gl2:!0,bpp:4}),Object(o.a)(ee,36238,{gl2:!0,bpp:4}),Object(o.a)(ee,36975,{gl2:!0,bpp:4}),Object(o.a)(ee,36214,{gl2:!0,bpp:8}),Object(o.a)(ee,36232,{gl2:!0,bpp:8}),Object(o.a)(ee,36226,{gl2:!0,bpp:16}),Object(o.a)(ee,36208,{gl2:!0,bpp:16}),Object(o.a)(ee,33325,{gl2:ie,bpp:2}),Object(o.a)(ee,33327,{gl2:ie,bpp:4}),Object(o.a)(ee,34842,{gl2:ie,bpp:8}),Object(o.a)(ee,33326,{gl2:ie,bpp:4}),Object(o.a)(ee,33328,{gl2:ie,bpp:8}),Object(o.a)(ee,34836,{gl2:ie,bpp:16}),Object(o.a)(ee,35898,{gl2:ie,bpp:4}),ee);var ae,oe=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t,i))).initialize(i),Object.seal(Et(r)),r}return Pt(e,It),Object(u.a)(e,null,[{key:"isSupported",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).format;return!e||function(t,e,r){var i=r[e];if(!i)return!1;var n=ft(t)&&i.gl2||i.gl1;return"string"==typeof n?t.getExtension(n):n}(t,e,ne)}},{key:"getSamplesForFormat",value:function(t,e){var r=e.format;return t.getInternalformatParameter(36161,r,32937)}}]),Object(u.a)(e,[{key:"initialize",value:function(t){var e=t.format,r=t.width,i=void 0===r?1:r,n=t.height,a=void 0===n?1:n,o=t.samples,s=void 0===o?0:o;return K(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&ft(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,i,a):this.gl.renderbufferStorage(36161,e,i,a),this.format=e,this.width=i,this.height=a,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*ne[this.format].bpp),this}},{key:"resize",value:function(t){var e=t.width,r=t.height;return e!==this.width||r!==this.height?this.initialize({width:e,height:r,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(t){this.gl.bindRenderbuffer(36161,t)}},{key:"_syncHandle",value:function(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}]),e}(),se=256,ue=1024,le=16384,ce=6144,he=6145,pe=6146,fe=34041,de="clear: bad arguments";function ve(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.framebuffer,i=void 0===r?null:r,n=e.color,a=void 0===n?null:n,o=e.depth,s=void 0===o?null:o,u=e.stencil,l=void 0===u?null:u,c={};i&&(c.framebuffer=i);var h=0;a&&(h|=le,!0!==a&&(c.clearColor=a)),s&&(h|=se,!0!==s&&(c.clearDepth=s)),l&&(h|=ue,!0!==s&&(c.clearStencil=s)),K(0!==h,de),D(t,c,function(){t.clear(h)})}function me(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return K(!1),0}}function ge(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.sourceX,i=void 0===r?0:r,n=e.sourceY,a=void 0===n?0:n,o=e.sourceFormat,s=void 0===o?6408:o,u=e.sourceAttachment,l=void 0===u?36064:u,c=e.target,h=void 0===c?null:c,p=e.sourceWidth,f=e.sourceHeight,d=e.sourceType,v=_e(t),m=v.framebuffer,g=v.deleteFramebuffer;K(m);var y=m.gl,_=m.handle,b=m.attachments;p=p||m.width,f=f||m.height,36064===l&&null===_&&(l=1028),K(b[l]),h=function(t,e,r,i,n){if(t)return t;var a=bt(e=e||5121,{clamped:!1}),o=me(r);return new a(i*n*o)}(h,d=d||b[l].type,s,p,f),d=d||_t(h);var x=y.bindFramebuffer(36160,_);return y.readPixels(i,a,p,f,s,d,h),y.bindFramebuffer(36160,x||null),g&&m.delete(),h}function ye(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.sourceAttachment,i=void 0===r?36064:r,n=e.targetMaxHeight,a=void 0===n?Number.MAX_SAFE_INTEGER:n,o=ge(t,{sourceAttachment:i}),s=t.width,u=t.height;u>a;){var l=xt({data:o,width:s,height:u});o=l.data,s=l.width,u=l.height}!function(t){var e=t.data,r=t.width,i=t.height,n=t.bytesPerPixel,a=void 0===n?4:n,o=t.temp,s=r*a;o=o||new Uint8Array(s);for(var u=0;u<i/2;++u){var l=u*s,c=(i-u-1)*s;o.set(e.subarray(l,l+s)),e.copyWithin(l,c,c+s),e.set(o,c)}}({data:o,width:s,height:u});var c=document.createElement("canvas");c.width=s,c.height=u;var h=c.getContext("2d"),p=h.createImageData(s,u);return p.data.set(o),h.putImageData(p,0,0),c.toDataURL()}function _e(t){return t instanceof Se?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:(e=t,i=e.gl,n=e.width,a=e.height,s=e.id,u=new Se(i,Object.assign({},r,{id:"framebuffer-for-".concat(s),width:n,height:a,attachments:Object(o.a)({},36064,e)})),u),deleteFramebuffer:!0};var e,r,i,n,a,s,u}var be;ae={},Object(o.a)(ae,33902,{gl1:new Float32Array([1,1])}),Object(o.a)(ae,33901,{gl1:new Float32Array([1,1])}),Object(o.a)(ae,3379,{gl1:64,gl2:2048}),Object(o.a)(ae,34076,{gl1:16}),Object(o.a)(ae,34930,{gl1:8}),Object(o.a)(ae,35661,{gl1:8}),Object(o.a)(ae,35660,{gl1:0}),Object(o.a)(ae,34024,{gl1:1}),Object(o.a)(ae,36348,{gl1:8}),Object(o.a)(ae,34921,{gl1:8}),Object(o.a)(ae,36347,{gl1:128}),Object(o.a)(ae,36349,{gl1:16}),Object(o.a)(ae,3386,{gl1:new Int32Array([0,0])}),Object(o.a)(ae,32883,{gl1:0,gl2:256}),Object(o.a)(ae,35071,{gl1:0,gl2:256}),Object(o.a)(ae,37447,{gl1:0,gl2:0}),Object(o.a)(ae,36063,{gl1:0,gl2:4}),Object(o.a)(ae,35379,{gl1:0,gl2:0}),Object(o.a)(ae,35374,{gl1:0,gl2:0}),Object(o.a)(ae,35377,{gl1:0,gl2:0}),Object(o.a)(ae,34852,{gl1:0,gl2:4}),Object(o.a)(ae,36203,{gl1:0,gl2:0}),Object(o.a)(ae,33001,{gl1:0,gl2:0}),Object(o.a)(ae,33e3,{gl1:0,gl2:0}),Object(o.a)(ae,37157,{gl1:0,gl2:0}),Object(o.a)(ae,35373,{gl1:0,gl2:0}),Object(o.a)(ae,35657,{gl1:0,gl2:0}),Object(o.a)(ae,36183,{gl1:0,gl2:0}),Object(o.a)(ae,37137,{gl1:0,gl2:0}),Object(o.a)(ae,34045,{gl1:0,gl2:0}),Object(o.a)(ae,35978,{gl1:0,gl2:0}),Object(o.a)(ae,35979,{gl1:0,gl2:0}),Object(o.a)(ae,35968,{gl1:0,gl2:0}),Object(o.a)(ae,35376,{gl1:0,gl2:0}),Object(o.a)(ae,35375,{gl1:0,gl2:0}),Object(o.a)(ae,35659,{gl1:0,gl2:0}),Object(o.a)(ae,37154,{gl1:0,gl2:0}),Object(o.a)(ae,35371,{gl1:0,gl2:0}),Object(o.a)(ae,35658,{gl1:0,gl2:0}),Object(o.a)(ae,35076,{gl1:0,gl2:-8,negative:!0}),Object(o.a)(ae,35077,{gl1:0,gl2:7}),Object(o.a)(ae,35380,{gl1:0,gl2:0});var xe={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"},we=(be={},Object(o.a)(be,xe.WEBGL2,[function(t){return ft(t)}]),Object(o.a)(be,xe.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),Object(o.a)(be,xe.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),Object(o.a)(be,xe.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),Object(o.a)(be,xe.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),Object(o.a)(be,xe.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),Object(o.a)(be,xe.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),Object(o.a)(be,xe.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),Object(o.a)(be,xe.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),Object(o.a)(be,xe.TEXTURE_FLOAT,["OES_texture_float",!0]),Object(o.a)(be,xe.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),Object(o.a)(be,xe.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),Object(o.a)(be,xe.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),Object(o.a)(be,xe.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),Object(o.a)(be,xe.COLOR_ATTACHMENT_RGBA32F,["WEBGL_color_buffer_float","EXT_color_buffer_float"]),Object(o.a)(be,xe.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),Object(o.a)(be,xe.COLOR_ATTACHMENT_HALF_FLOAT,[!1,"EXT_color_buffer_half_float"]),Object(o.a)(be,xe.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),Object(o.a)(be,xe.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),Object(o.a)(be,xe.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),Object(o.a)(be,xe.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),be);function ke(t,e){return(e=Array.isArray(e)?e:[e]).every(function(e){return Ee(t,e)})}function Ee(t,e){var r=we[e];K(r,e);var i,n=ft(t)&&r[1]||r[0];if("function"==typeof n)i=n(t);else if(Array.isArray(n)){i=!0;var a=!0,o=!1,s=void 0;try{for(var u,l=n[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i=i&&Boolean(t.getExtension(c))}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}}else"string"==typeof n?i=Boolean(t.getExtension(n)):"boolean"==typeof n?i=n:K(!1);return i}var Se=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t,i))).width=null,r.height=null,r.attachments={},r.readBuffer=36064,r.drawBuffers=[36064],r.initialize(i),Object.seal(Et(r)),r}return Pt(e,It),Object(u.a)(e,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}}],[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.colorBufferFloat,i=e.colorBufferHalfFloat;return r&&t.getExtension(ft(t)?"EXT_color_buffer_float":"WEBGL.color_buffer_float"),i&&t.getExtension(ft(t)?"EXT_color_buffer_float":"EXT_color_buffer_half_float")}},{key:"getDefaultFramebuffer",value:function(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new e(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}}]),Object(u.a)(e,[{key:"initialize",value:function(t){var e=t.width,r=void 0===e?1:e,i=t.height,n=void 0===i?1:i,a=t.attachments,o=void 0===a?null:a,s=t.color,u=void 0===s||s,l=t.depth,c=void 0===l||l,h=t.stencil,p=void 0!==h&&h,f=t.check,d=void 0===f||f,v=t.readBuffer,m=t.drawBuffers;if(K(r>=0&&n>=0,"Width and height need to be integers"),this.width=r,this.height=n,o)for(var g in o){var y=o[g];(Array.isArray(y)?y[0]:y).resize({width:r,height:n})}else o=this._createDefaultAttachments(u,c,p,r,n);this.update({clearAttachments:!0,attachments:o,readBuffer:v,drawBuffers:m}),o&&d&&this.checkStatus()}},{key:"update",value:function(t){var e=t.attachments,r=void 0===e?{}:e,i=t.readBuffer,n=t.drawBuffers,a=t.clearAttachments,o=void 0!==a&&a,s=t.resizeAttachments,u=void 0===s||s;this.attach(r,{clearAttachments:o,resizeAttachments:u});var l=this.gl,c=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),n&&this._setDrawBuffers(n),l.bindFramebuffer(36160,c||null),this}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,r=t.height;if(null===this.handle)return K(void 0===e&&void 0===r),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var i in void 0===e&&(e=this.gl.drawingBufferWidth),void 0===r&&(r=this.gl.drawingBufferHeight),e!==this.width&&r!==this.height&&A.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(r))(),this.attachments)this.attachments[i].resize({width:e,height:r});return this.width=e,this.height=r,this}},{key:"attach",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.clearAttachments,n=void 0!==i&&i,a=r.resizeAttachments,o=void 0===a||a,s={};n&&Object.keys(this.attachments).forEach(function(t){s[t]=null}),Object.assign(s,t);var u=this.gl.bindFramebuffer(36160,this.handle);for(var l in s){K(void 0!==l,"Misspelled framebuffer binding point?");var c=Number(l),h=s[c],p=h;if(p)if(p instanceof oe)this._attachRenderbuffer({attachment:c,renderbuffer:p});else if(Array.isArray(h)){var f=C(h,3),d=f[0],v=f[1],m=void 0===v?0:v,g=f[2],y=void 0===g?0:g;p=d,this._attachTexture({attachment:c,texture:d,layer:m,level:y})}else this._attachTexture({attachment:c,texture:p,layer:0,level:0});else this._unattach(c);o&&p&&p.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(function(t){return!e.attachments[t]}).forEach(function(t){delete e.attachments[t]})}},{key:"checkStatus",value:function(){var t=this.gl,e=t.bindFramebuffer(36160,this.handle),r=t.checkFramebufferStatus(36160);if(t.bindFramebuffer(36160,e||null),36053!==r)throw new Error(function(t){return(Se.STATUS||{})[t]||"Framebuffer error ".concat(t)}(r));return this}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,r=t.depth,i=t.stencil,n=t.drawBuffers,a=void 0===n?[]:n,o=this.gl.bindFramebuffer(36160,this.handle);return(e||r||i)&&ve(this.gl,{color:e,depth:r,stencil:i}),a.forEach(function(t,e){!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.framebuffer,i=void 0===r?null:r,n=e.buffer,a=void 0===n?ce:n,o=e.drawBuffer,s=void 0===o?0:o,u=e.value,l=void 0===u?[0,0,0,0]:u;vt(t),D(t,{framebuffer:i},function(){switch(a){case ce:switch(l.constructor){case Int32Array:t.clearBufferiv(a,s,l);break;case Uint32Array:t.clearBufferuiv(a,s,l);break;case Float32Array:default:t.clearBufferfv(a,s,l)}break;case he:t.clearBufferfv(he,0,[l]);break;case pe:t.clearBufferiv(pe,0,[l]);break;case fe:var e=C(l,2),r=e[0],i=e[1];t.clearBufferfi(fe,0,r,i);break;default:K(!1,de)}})}({drawBuffer:e,value:t})}),this.gl.bindFramebuffer(36160,o||null),this}},{key:"readPixels",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return A.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(t){var e=t.attachments,r=void 0===e?[]:e,i=t.x,n=void 0===i?0:i,a=t.y,o=void 0===a?0:a,s=t.width,u=t.height,l=this.gl;vt(l);var c=l.bindFramebuffer(36008,this.handle);return 0===n&&0===o&&void 0===s&&void 0===u?l.invalidateFramebuffer(36008,r):l.invalidateFramebuffer(36008,r,n,o,s,u),l.bindFramebuffer(36008,c),this}},{key:"getAttachmentParameter",value:function(t,e,r){var i=this._getAttachmentParameterFallback(e);return null===i&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=kt(this.gl,i)),i}},{key:"getAttachmentParameters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],i={},n=!0,a=!1,o=void 0;try{for(var s,u=r[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;i[e?kt(this.gl,l):l]=this.getAttachmentParameter(t,l,e)}}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return i}},{key:"getParameters",value:function(){for(var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={},r=0,i=Object.keys(this.attachments);r<i.length;r++){var n=i[r],a=Number(n);e[t?kt(this.gl,a):a]=this.getAttachmentParameters(a,t)}return e}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open(ye(this),"luma-debug-texture"),this}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>A.priority||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);var r=ye(this,{maxHeight:100});return A.image({priority:t,message:e,image:r},e)(),this}},{key:"bind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,e=void 0===t?36160:t;return this.gl.bindFramebuffer(e,this.handle),this}},{key:"unbind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target,e=void 0===t?36160:t;return this.gl.bindFramebuffer(e,null),this}},{key:"_createDefaultAttachments",value:function(t,e,r,i,n){var a,s=null;t&&((s=s||{})[36064]=new Ht(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:n,mipmaps:!1,parameters:(a={},Object(o.a)(a,10241,9728),Object(o.a)(a,10240,9728),Object(o.a)(a,10242,33071),Object(o.a)(a,10243,33071),a)}));return e&&r?(s=s||{})[33306]=new oe(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}):e?(s=s||{})[36096]=new oe(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:n}):r&&K(!1),s}},{key:"_unattach",value:function(t){var e=this.attachments[t];e&&(e instanceof oe?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}},{key:"_attachRenderbuffer",value:function(t){var e=t.attachment,r=void 0===e?36064:e,i=t.renderbuffer;this.gl.framebufferRenderbuffer(36160,r,36161,i.handle),this.attachments[r]=i}},{key:"_attachTexture",value:function(t){var e=t.attachment,r=void 0===e?36064:e,i=t.texture,n=t.layer,a=t.level,o=this.gl;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:o.framebufferTextureLayer(36160,r,i.target,a,n);break;case 34067:var s=function(t){return t<34069?t+34069:t}(n);o.framebufferTexture2D(36160,r,s,i.handle,a);break;case 3553:o.framebufferTexture2D(36160,r,3553,i.handle,a);break;default:K(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[r]=i}},{key:"_setReadBuffer",value:function(t,e){ft(t)?t.readBuffer(e):K(36064===e||1029===e,"Multiple render targets not supported"),this.readBuffer=e}},{key:"_setDrawBuffers",value:function(t,e){if(ft(t))t.drawBuffers(e);else{var r=t.getExtension("WEBGL.draw_buffers");r?r.drawBuffersWEBGL(e):K(1===e.length&&(36064===e[0]||1029===e[0]),"Multiple render targets not supported")}this.drawBuffers=e}},{key:"_getAttachmentParameterFallback",value:function(t){var e=function(t){if(t.luma=t.luma||{},!t.luma.caps)for(var e in t.luma.caps={},t.luma.caps.webgl2=ft(t),we)t.luma.caps[e]=Ee(t,e);return t.luma.caps}(this.gl);switch(t){case 36052:return e.webgl2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.webgl2?null:8;case 33297:return e.webgl2?null:5125;case 33296:return e.webgl2||e.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(t){return this.gl.bindFramebuffer(36160,t)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}}]),e}();Se.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];function Te(t){return Boolean(t&&2===t._version)}var Ae={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Pe(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e=Object.assign({},Ae,e),i=r.width,n=r.height;function a(t){if(e.throwOnError)throw new Error(t);return null}S.a?t=function(t,e){var r=e.onError,i=void 0===r?function(t){return null}:r,n=function(t){return i("WebGL context: ".concat(t.statusMessage||"error"))};t.addEventListener("webglcontextcreationerror",n,!1);var a=e.webgl1,o=void 0===a||a,s=e.webgl2,u=void 0===s||s,l=null;return u&&(l=(l=l||t.getContext("webgl2",e))||t.getContext("experimental-webgl2",e)),o&&(l=(l=l||t.getContext("webgl",e))||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",n,!1),l||i("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context"))}(ut({canvas:e.canvas,width:i,height:n,onError:a}),e):t=function(t){var e=t.width,r=t.height,i=t.webgl1,n=t.webgl2,a=t.onError;if(n&&!i)return a("headless-gl does not support WebGL2");if(!U)return a(H);var o=U(e,r,t);return o||a(Y)}(W({},e,{width:i,height:n,onError:a}));return t?(function(t){var e=Te(t)?"WebGL2":"WebGL1",r=lt(t),i=r?"(".concat(r.vendor,",").concat(r.renderer,")"):"",n=t.debug?" debug":"";A.once(1,"".concat(e).concat(n," context ").concat(i))()}(t=Oe(t,e)),t):null}function Oe(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t._instrumented)return t;t._version=t._version||function(t){if(void 0!==X&&t instanceof X)return 2;return 1}(t);var r=e=Object.assign({},Ae,e),i=r.manageState,n=r.debug;return i&&Object(R.a)(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return A.log.apply(A,[1].concat(e))()}}),S.a&&n&&(T.a.makeDebugContext?(t=T.a.makeDebugContext(t,{debug:n}),A.priority=Math.max(A.priority,1)):A.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function Ie(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",r=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:e}var Me=35632,Ce=35633;function Le(t,e,r,i){for(var n=t.split(/\r?\n/),a={},o={},s=i||Ie(e)||"(unnamed)",u="".concat(function(t){switch(t){case Me:return"fragment";case Ce:return"vertex";default:return"unknown type"}}(r)," shader ").concat(s),l=0;l<n.length;l++){var c=n[l];if(!(c.length<=1)){var h=c.split(":"),p=h[0],f=parseInt(h[2],10);if(isNaN(f))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));"WARNING"!==p?a[f]=c:o[f]=c}}var d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",i=t.split(/\r?\n/),n=String(i.length+e-1).length;return i.map(function(t,i){var a=i+e,o=String(a).length,s=ze(a,n-o);return s+r+t})}(e);return{shaderName:u,errors:je(a,d),warnings:je(o,d)}}function je(t,e){for(var r="",i=0;i<e.length;i++){var n=e[i];if((t[i+3]||t[i+2]||t[i+1])&&(r+="".concat(n,"\n"),t[i+1])){var a=t[i+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,l=a.substring(o.join(":").length+1).trim();r+=ze("^^^ ".concat(s,": ").concat(l,"\n\n"),u)}}return r}function ze(t,e){for(var r="",i=0;i<e;++i)r+=" ";return"".concat(r).concat(t)}function Re(t){var e=100,r=t.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){var i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}return e}var Fe,De="Shader: GLSL source code must be a JavaScript string",Be=function(t){function e(t,r){var i;Object(s.a)(this,e),dt(t),K("string"==typeof r.source,De);var n=Ie(r.source,null)||r.id||Q("unnamed ".concat(e.getTypeName(r.shaderType)));return(i=St(this,Tt(e).call(this,t,{id:n}))).shaderType=r.shaderType,i.source=r.source,i.initialize(r),i}return Pt(e,It),Object(u.a)(e,null,[{key:"getTypeName",value:function(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return K(!1),"unknown"}}}]),Object(u.a)(e,[{key:"initialize",value:function(t){var e=t.source,r=Ie(e,null);r&&(this.id=Q(r)),this._compile(e)}},{key:"getParameter",value:function(t){return this.gl.getShaderParameter(this.handle,t)}},{key:"toString",value:function(){return"".concat(e.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return Ie(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var t=this.gl.getExtension("WEBGL.debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}},{key:"_compile",value:function(){if(this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var t=Le(this.gl.getShaderInfoLog(this.handle),this.source,this.shaderType,this.id),e=t.shaderName,r=t.errors,i=t.warnings;throw A.error("GLSL compilation errors in ".concat(e,"\n").concat(r))(),A.warn("GLSL compilation warnings in ".concat(e,"\n").concat(i))(),new Error("GLSL compilation errors in ".concat(e))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}]),e}(),Ne=function(t){function e(t,r){return Object(s.a)(this,e),"string"==typeof r&&(r={source:r}),St(this,Tt(e).call(this,t,Object.assign({},r,{shaderType:35633})))}return Pt(e,Be),Object(u.a)(e,[{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),e}(),Ue=function(t){function e(t,r){return Object(s.a)(this,e),"string"==typeof r&&(r={source:r}),St(this,Tt(e).call(this,t,Object.assign({},r,{shaderType:35632})))}return Pt(e,Be),Object(u.a)(e,[{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),e}();function Ve(t,e,r){return(Ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Tt(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}var Ge,qe=(Fe={},Object(o.a)(Fe,5126,function(t,e,r){return t.uniform1fv(e,Ke(r,1))}),Object(o.a)(Fe,35664,function(t,e,r){return t.uniform2fv(e,Ke(r,2))}),Object(o.a)(Fe,35665,function(t,e,r){return t.uniform3fv(e,Ke(r,3))}),Object(o.a)(Fe,35666,function(t,e,r){return t.uniform4fv(e,Ke(r,4))}),Object(o.a)(Fe,5124,function(t,e,r){return t.uniform1iv(e,Je(r,1))}),Object(o.a)(Fe,35667,function(t,e,r){return t.uniform2iv(e,Je(r,2))}),Object(o.a)(Fe,35668,function(t,e,r){return t.uniform3iv(e,Je(r,3))}),Object(o.a)(Fe,35669,function(t,e,r){return t.uniform4iv(e,Je(r,4))}),Object(o.a)(Fe,35670,function(t,e,r){return t.uniform1iv(e,Je(r,1))}),Object(o.a)(Fe,35671,function(t,e,r){return t.uniform2iv(e,Je(r,2))}),Object(o.a)(Fe,35672,function(t,e,r){return t.uniform3iv(e,Je(r,3))}),Object(o.a)(Fe,35673,function(t,e,r){return t.uniform4iv(e,Je(r,4))}),Object(o.a)(Fe,35674,function(t,e,r){return t.uniformMatrix2fv(e,!1,Ke(r,4))}),Object(o.a)(Fe,35675,function(t,e,r){return t.uniformMatrix3fv(e,!1,Ke(r,9))}),Object(o.a)(Fe,35676,function(t,e,r){return t.uniformMatrix4fv(e,!1,Ke(r,16))}),Object(o.a)(Fe,35678,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,35680,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,5125,function(t,e,r){return t.uniform1uiv(e,Qe(r,1))}),Object(o.a)(Fe,36294,function(t,e,r){return t.uniform2uiv(e,Qe(r,2))}),Object(o.a)(Fe,36295,function(t,e,r){return t.uniform3uiv(e,Qe(r,3))}),Object(o.a)(Fe,36296,function(t,e,r){return t.uniform4uiv(e,Qe(r,4))}),Object(o.a)(Fe,35685,function(t,e,r){return t.uniformMatrix2x3fv(e,!1,Ke(r,6))}),Object(o.a)(Fe,35686,function(t,e,r){return t.uniformMatrix2x4fv(e,!1,Ke(r,8))}),Object(o.a)(Fe,35687,function(t,e,r){return t.uniformMatrix3x2fv(e,!1,Ke(r,6))}),Object(o.a)(Fe,35688,function(t,e,r){return t.uniformMatrix3x4fv(e,!1,Ke(r,12))}),Object(o.a)(Fe,35689,function(t,e,r){return t.uniformMatrix4x2fv(e,!1,Ke(r,8))}),Object(o.a)(Fe,35690,function(t,e,r){return t.uniformMatrix4x3fv(e,!1,Ke(r,12))}),Object(o.a)(Fe,35679,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,35682,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36289,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36292,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36293,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36298,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36299,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36300,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36303,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36306,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36307,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36308,function(t,e,r){return t.uniform1i(e,r)}),Object(o.a)(Fe,36311,function(t,e,r){return t.uniform1i(e,r)}),Fe),Ze={},Xe={},We={},He=[0];function Ye(t,e,r,i){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(He[0]=t,t=He);var n=t.length;if(n%e&&A.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof r)return t;var a=i[n];a||(a=new r(n),i[n]=a);for(var o=0;o<n;o++)a[o]=t[o];return a}function Ke(t,e){return Ye(t,e,Float32Array,Ze)}function Je(t,e){return Ye(t,e,Int32Array,Xe)}function Qe(t,e){return Ye(t,e,Uint32Array,We)}function $e(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function tr(t,e,r){var i=qe[r.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(r.type));return i.bind(null,t,e)}function er(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;for(var e=Math.min(t.length,16),r=0;r<e;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t):!!isFinite(t)||(!0===t||!1===t||(t instanceof Xt||(t instanceof oe||t instanceof Se&&Boolean(t.texture))))}function rr(t,e){if(Array.isArray(t)||ArrayBuffer.isView(t)){if(!e)return!1;var r=t.length;if(e.length!==r)return!1;for(var i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return t===e}var ir=5120,nr=5121,ar=5122,or=5123,sr=0,ur=1,lr=2,cr=3,hr=4,pr=5,fr=6,dr=5126,vr=(Ge={},Object(o.a)(Ge,dr,[dr,1,"float"]),Object(o.a)(Ge,35664,[dr,2,"vec2"]),Object(o.a)(Ge,35665,[dr,3,"vec3"]),Object(o.a)(Ge,35666,[dr,4,"vec4"]),Object(o.a)(Ge,5124,[5124,1,"int"]),Object(o.a)(Ge,35667,[5124,2,"ivec2"]),Object(o.a)(Ge,35668,[5124,3,"ivec3"]),Object(o.a)(Ge,35669,[5124,4,"ivec4"]),Object(o.a)(Ge,5125,[5125,1,"uint"]),Object(o.a)(Ge,36294,[5125,2,"uvec2"]),Object(o.a)(Ge,36295,[5125,3,"uvec3"]),Object(o.a)(Ge,36296,[5125,4,"uvec4"]),Object(o.a)(Ge,35670,[dr,1,"bool"]),Object(o.a)(Ge,35671,[dr,2,"bvec2"]),Object(o.a)(Ge,35672,[dr,3,"bvec3"]),Object(o.a)(Ge,35673,[dr,4,"bvec4"]),Object(o.a)(Ge,35674,[dr,8,"mat2"]),Object(o.a)(Ge,35685,[dr,8,"mat2x3"]),Object(o.a)(Ge,35686,[dr,8,"mat2x4"]),Object(o.a)(Ge,35675,[dr,12,"mat3"]),Object(o.a)(Ge,35687,[dr,12,"mat3x2"]),Object(o.a)(Ge,35688,[dr,12,"mat3x4"]),Object(o.a)(Ge,35676,[dr,16,"mat4"]),Object(o.a)(Ge,35689,[dr,16,"mat4x2"]),Object(o.a)(Ge,35690,[dr,16,"mat4x3"]),Ge);function mr(t){switch(t){case sr:return sr;case ur:case cr:case lr:return ur;case hr:case pr:case fr:return hr;default:return K(!1),0}}function gr(t){var e=vr[t];if(!e)return null;var r=C(e,2);return{type:r[0],components:r[1]}}function yr(t,e){switch(t){case ir:case nr:case ar:case or:t=dr}for(var r in vr){var i=C(vr[r],3),n=i[0],a=i[1],o=i[2];if(n===t&&a===e)return{glType:r,name:o}}return null}var _r=function(){function t(e){Object(s.a)(this,t),this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}return Object(u.a)(t,[{key:"getAttributeInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}},{key:"getAttributeLocation",value:function(t){var e=this.getAttributeInfo(t);return e?e.location:-1}},{key:"getAttributeAccessor",value:function(t){var e=this.getAttributeInfo(t);return e?e.accessor:null}},{key:"getVaryingInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}},{key:"getVaryingIndex",value:function(t){var e=this.getVaryingInfo();return e?e.location:-1}},{key:"getVaryingAccessor",value:function(t){var e=this.getVaryingInfo();return e?e.accessor:null}},{key:"_readAttributesFromProgram",value:function(t){for(var e=t.gl,r=e.getProgramParameter(t.handle,35721),i=0;i<r;i++){var n=e.getActiveAttrib(t.handle,i),a=n.name,o=n.type,s=n.size,u=e.getAttribLocation(t.handle,a);u>=0&&this._addAttribute(u,a,o,s)}this.attributeInfos.sort(function(t,e){return t.location-e.location})}},{key:"_readVaryingsFromProgram",value:function(t){var e=t.gl;if(ft(e)){for(var r=e.getProgramParameter(t.handle,35971),i=0;i<r;i++){var n=e.getTransformFeedbackVarying(t.handle,i),a=n.name,o=n.type,s=n.size;this._addVarying(i,a,o,s)}this.varyingInfos.sort(function(t,e){return t.location-e.location})}}},{key:"_addAttribute",value:function(t,e,r,i){var n=gr(r),a={type:n.type,size:i*n.components};this._inferProperties(t,e,a);var o={location:t,name:e,accessor:new Ft(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[t]=o,this.attributeInfosByName[o.name]=o}},{key:"_inferProperties",value:function(t,e,r){/instance/i.test(e)&&(r.divisor=1)}},{key:"_addVarying",value:function(t,e,r,i){var n=gr(r),a=n.type,o=n.components,s={location:t,name:e,accessor:new Ft({type:a,size:i*o})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}]),t}(),br=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],xr=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t,i))).stubRemovedMethods("Program","v6.0",br),r._isCached=!1,r.initialize(i),Object.seal(Et(r)),r._setId(i.id),r}return Pt(e,It),Object(u.a)(e,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vs,r=t.fs,i=t.varyings,n=t.bufferMode,a=void 0===n?35981:n;return this.vs="string"==typeof e?new Ne(this.gl,{id:"".concat(t.id,"-vs"),source:e}):e,this.fs="string"==typeof r?new Ue(this.gl,{id:"".concat(t.id,"-fs"),source:r}):r,K(this.vs instanceof Ne),K(this.fs instanceof Ue),this.uniforms={},i&&(vt(this.gl),this.varyings=i,this.gl.transformFeedbackVaryings(this.handle,i,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new _r(this),this.setProps(t)}},{key:"delete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:Ve(Tt(e.prototype),"delete",this).call(this,t)}},{key:"setProps",value:function(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}},{key:"draw",value:function(t){var e=this,r=t.logPriority,i=t.drawMode,n=void 0===i?4:i,a=t.vertexCount,o=t.offset,s=void 0===o?0:o,u=t.start,l=t.end,c=t.isIndexed,h=void 0!==c&&c,p=t.indexType,f=void 0===p?5123:p,d=t.isInstanced,v=void 0!==d&&d,m=t.instanceCount,g=void 0===m?0:m,y=t.vertexArray,_=void 0===y?null:y,b=t.transformFeedback,x=t.framebuffer,w=t.parameters,k=void 0===w?{}:w,E=t.uniforms,S=t.samplers;if((E||S)&&(A.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(E||{})),void 0!==r){var T=x?x.id:"default",P="mode=".concat(kt(this.gl,n)," verts=").concat(a," ")+"instances=".concat(g," indexType=").concat(kt(this.gl,f)," ")+"isInstanced=".concat(v," isIndexed=").concat(h," ")+"Framebuffer=".concat(T);A.log(r,P)()}return K(_),this.gl.useProgram(this.handle),!!this._areTexturesRenderable()&&(_.bindForDraw(a,g,function(){if(void 0!==x&&(k=Object.assign({},k,{framebuffer:x})),b){var t=mr(n);b.begin(t)}e._bindTextures(),D(e.gl,k,function(){h&&v?e.gl.drawElementsInstanced(n,a,f,s,g):h&&ft(e.gl)&&!isNaN(u)&&!isNaN(l)?e.gl.drawRangeElements(n,u,l,a,f,s):h?e.gl.drawElements(n,a,f,s):v?e.gl.drawArraysInstanced(n,s,a,g):e.gl.drawArrays(n,s,a)}),b&&b.end()}),!0)}},{key:"setUniforms",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=!1,n={};for(var a in e)rr(this.uniforms[a],e[a])||(i=!0,n[a]=e[a],this.uniforms[a]=(t=e[a],Array.isArray(t)||ArrayBuffer.isView(t)?t.slice():t));return i&&(r(),function(t,e,r){for(var i in t){var n=t[i];if((!r||Boolean(r[i]))&&!er(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),n),new Error("".concat(e," Bad uniform ").concat(i))}}(n,this.id,this._uniformSetters),this._setUniforms(n)),this}},{key:"reset",value:function(){}},{key:"_areTexturesRenderable",value:function(){var t=!0;for(var e in this.uniforms){var r=this._uniformSetters[e];if(r&&void 0!==r.textureIndex){var i=this.uniforms[e];if(i instanceof Se)i=i.texture;if(i instanceof Xt)t=t&&i.loaded}}return t}},{key:"_bindTextures",value:function(){for(var t in this.uniforms){var e=this._uniformSetters[t];if(e&&void 0!==e.textureIndex){var r=this.uniforms[t];if(r instanceof Se&&(r=r.texture),r instanceof Xt)r.bind(e.textureIndex)}}}},{key:"_setUniforms",value:function(t){for(var e in this.gl.useProgram(this.handle),t){var r=t[e],i=this._uniformSetters[e];if(i)if(r instanceof Se&&(r=r.texture),r instanceof Xt){void 0===i.textureIndex&&(i.textureIndex=this._textureIndexCounter++);var n=r,a=i.textureIndex;n.bind(a),i(a)}else i(r)}return this}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(t){var e=this.gl.getAttachedShaders(t),r={},i=!0,n=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Ne({handle:u});break;case 35632:r.fs=new Ue({handle:u})}}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}},{key:"_getParameter",value:function(t){return this.gl.getProgramParameter(this.handle,t)}},{key:"_setId",value:function(t){if(!t){var e=this._getName();this.id=Q(e)}}},{key:"_getName",value:function(){var t=this.vs.getName()||this.fs.getName();return t=(t=t.replace(/shader/i,""))?"".concat(t,"-program"):"program"}},{key:"_compileAndLink",value:function(){var t=this.gl;if((t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),A.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),A.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||A.priority>0)&&(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35714)))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)))}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var t=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var e=0;e<this._uniformCount;e++){var r=this.gl.getActiveUniform(this.handle,e),i=$e(r.name),n=i.name,a=(i.isArray,t.getUniformLocation(this.handle,n));this._uniformSetters[n]=tr(t,a,r)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(t,e){return this.gl.getActiveUniforms(this.handle,t,e)}},{key:"getUniformBlockIndex",value:function(t){return this.gl.getUniformBlockIndex(this.handle,t)}},{key:"getActiveUniformBlockParameter",value:function(t,e){return this.gl.getActiveUniformBlockParameter(this.handle,t,e)}},{key:"uniformBlockBinding",value:function(t,e){this.gl.uniformBlockBinding(this.handle,t,e)}}]),e}(),wr=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t,i))).target=null,r._queryPending=!1,r._pollingPromise=null,Object.seal(Et(r)),r}return Pt(e,It),Object(u.a)(e,null,[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=ft(t),i=ke(t,xe.TIMER_QUERY),n=r||i,a=!0,o=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){switch(u.value){case"queries":n=n&&r;break;case"timers":n=n&&i;break;default:K(!1)}}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return n}}]),Object(u.a)(e,[{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).conservative,e=void 0!==t&&t;return this.begin(e?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"begin",value:function(t){return this._queryPending?this:(this.target=t,this.gl.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var t=this.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}},{key:"isTimerDisjoint",value:function(){return this.gl.getParameter(36795)}},{key:"getResult",value:function(){return this.gl.getQueryParameter(this.handle,34918)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var r=0;return this._pollingPromise=new Promise(function(i,n){requestAnimationFrame(function a(){t.isResultAvailable()?(i(t.getResult()),t._pollingPromise=null):r++>e?(n("Timed out"),t._pollingPromise=null):requestAnimationFrame(a)})}),this._pollingPromise}},{key:"_createHandle",value:function(){return e.isSupported(this.gl)?this.gl.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl.deleteQuery(this.handle)}}]),e}(),kr=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),vt(t),(r=St(this,Tt(e).call(this,t,i))).initialize(i),r.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(Et(r)),r}return Pt(e,It),Object(u.a)(e,null,[{key:"isSupported",value:function(t){return ft(t)}}]),Object(u.a)(e,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,tt(this.buffers)||this.bind(function(){return t._unbindBuffers()}),this.setProps(e),this}},{key:"setProps",value:function(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}},{key:"setBuffers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind(function(){for(var r in e)t.setBuffer(r,e[r])}),this}},{key:"setBuffer",value:function(t,e){var r=this,i=this._getVaryingIndex(t),n=this._getBufferParams(e),a=n.buffer,o=n.byteSize,s=n.byteOffset;return i<0?(this.unused[t]=a,A.warn(function(){return"".concat(r.id," unused varying buffer ").concat(t)})(),this):(this.buffers[i]=e,this.bindOnUse||this._bindBuffer(i,a,s,o),this)}},{key:"begin",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(t){var e,r,i;return t instanceof Ut==!1?(i=t.buffer,r=t.byteSize,e=t.byteOffset):i=t,void 0===e&&void 0===r||(e=e||0,r=r||i.byteLength-e),{buffer:i,byteOffset:e,byteSize:r}}},{key:"_getVaryingInfo",value:function(t){return this.configuration&&this.configuration.getVaryingInfo(t)}},{key:"_getVaryingIndex",value:function(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;var e=Number(t);return Number.isFinite(e)?e:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers){var e=this._getBufferParams(this.buffers[t]),r=e.buffer,i=e.byteSize,n=e.byteOffset;this._bindBuffer(t,r,n,i)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers)this._bindBuffer(t,null)}},{key:"_bindBuffer",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,n=e&&e.handle;return n&&void 0!==i?this.gl.bindBufferRange(35982,t,n,r,i):this.gl.bindBufferBase(35982,t,n),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(t){this.gl.bindTransformFeedback(36386,this.handle)}}]),e}(),Er=null;function Sr(t,e){var r;return new t((r=t.BYTES_PER_ELEMENT*e,(!Er||Er.byteLength<r)&&(Er=new ArrayBuffer(r)),Er),0,e)}var Tr=r(27);var Ar=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,e);var n=i.id||i.program&&i.program.id;return(r=St(this,Tt(e).call(this,t,Object.assign({},i,{id:n})))).hasVertexArrays=e.isSupported(t),r.buffer=null,r.bufferValue=null,r.initialize(i),Object.seal(Et(r)),r}return Pt(e,It),Object(u.a)(e,null,[{key:"isSupported",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero?ft(t)||"Chrome"===function(t){if(!t&&!Object(l.a)())return"Node";if(Object(Tr.a)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},r=t||e.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var i=-1!==r.indexOf("MSIE "),n=-1!==r.indexOf("Trident/");return i||n?"IE":g.b.chrome?"Chrome":g.b.safari?"Safari":g.b.mozInnerScreenX?"Firefox":"Unknown"}():ft(t)||t.getExtension("OES_vertex_array_object")}},{key:"getDefaultArray",value:function(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new e(t,{handle:null})),t.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(t){return e.MAX_ATTRIBUTES=e.MAX_ATTRIBUTES||t.getParameter(34921),e.MAX_ATTRIBUTES}},{key:"setConstant",value:function(t,r,i){switch(i.constructor){case Float32Array:e._setConstantFloatArray(t,r,i);break;case Int32Array:e._setConstantIntArray(t,r,i);break;case Uint32Array:e._setConstantUintArray(t,r,i);break;default:K(!1)}}}]),Object(u.a)(e,[{key:"delete",value:function(){Ve(Tt(e.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.setProps(t)}},{key:"setProps",value:function(t){return this}},{key:"setElementBuffer",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return K(!e||34963===e.target,"elements must be GL.ELEMENT_ARRAY_BUFFER"),this.bind(function(){t.gl.bindBuffer(34963,e?e.handle:null)}),this}},{key:"setBuffer",value:function(t,e,r){if(34963===e.target)return this.setElementBuffer(e,r);var i=r.size,n=r.type,a=r.stride,o=r.offset,s=r.normalized,u=r.integer,l=r.divisor,c=this.gl;return t=Number(t),this.bind(function(){c.bindBuffer(34962,e.handle),u?(K(ft(c)),c.vertexAttribIPointer(t,i,n,a,o)):c.vertexAttribPointer(t,i,n,s,a,o),c.enableVertexAttribArray(t),c.vertexAttribDivisor(t,l||0)}),this}},{key:"enable",value:function(t){var r=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!i&&0===t&&!e.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(function(){return i?r.gl.enableVertexAttribArray(t):r.gl.disableVertexAttribArray(t)})),this}},{key:"getConstantBuffer",value:function(t,e,r){var i=this._normalizeConstantArrayValue(e,r),n=i.byteLength*t,a=i.length*t,o=!this.buffer;if(this.buffer=this.buffer||new Ut(this.gl,n),o=(o=o||this.buffer.reallocate(n))||!this._compareConstantArrayValues(i,this.bufferValue)){var s=Sr(e.constructor,a);!function(t){for(var e=t.target,r=t.source,i=t.start,n=void 0===i?0:i,a=t.count,o=void 0===a?1:a,s=r.length,u=o*s,l=0,c=n;l<s;l++)e[c++]=r[l];for(;l<u;)l<u-l?(e.copyWithin(n+l,n,n+l),l*=2):(e.copyWithin(n+l,n,n+u-l),l=u)}({target:s,source:i,start:0,count:a}),this.buffer.subData(s),this.bufferValue=e}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(t,e){return Array.isArray(t)?new Float32Array(t):t}},{key:"_compareConstantArrayValues",value:function(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}},{key:"_createHandle",value:function(){return this.hasVertexArrays=e.isSupported(this.gl),this.hasVertexArrays?this.gl.createVertexArray():null}},{key:"_deleteHandle",value:function(t){return this.hasVertexArrays&&this.gl.deleteVertexArray(t),[this.elements]}},{key:"_bindHandle",value:function(t){this.hasVertexArrays&&this.gl.bindVertexArray(t)}},{key:"_getParameter",value:function(t,e){var r=this,i=e.location;return K(Number.isFinite(i)),this.bind(function(){switch(t){case 34373:return r.gl.getVertexAttribOffset(i,t);default:return r.gl.getVertexAttrib(i,t)}})}},{key:"MAX_ATTRIBUTES",get:function(){return e.getMaxAttributes(this.gl)}}],[{key:"_setConstantFloatArray",value:function(t,e,r){switch(r.length){case 1:t.vertexAttrib1fv(e,r);break;case 2:t.vertexAttrib2fv(e,r);break;case 3:t.vertexAttrib3fv(e,r);break;case 4:t.vertexAttrib4fv(e,r);break;default:K(!1)}}},{key:"_setConstantIntArray",value:function(t,e,r){switch(K(ft(t)),r.length){case 1:t.vertexAttribI1iv(e,r);break;case 2:t.vertexAttribI2iv(e,r);break;case 3:t.vertexAttribI3iv(e,r);break;case 4:t.vertexAttribI4iv(e,r);break;default:K(!1)}}},{key:"_setConstantUintArray",value:function(t,e,r){switch(K(ft(t)),r.length){case 1:t.vertexAttribI1uiv(e,r);break;case 2:t.vertexAttribI2uiv(e,r);break;case 3:t.vertexAttribI3uiv(e,r);break;case 4:t.vertexAttribI4uiv(e,r);break;default:K(!1)}}}]),e}(),Pr=/^(.+)__LOCATION_([0-9]+)$/,Or=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],Ir=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t);var i=r.id||r.program&&r.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.vertexArrayObject=Ar.isSupported(e)?new Ar(e):Ar.getDefaultArray(e),rt(this,"VertexArray","v6.0",Or),this.initialize(r),Object.seal(this)}return Object(u.a)(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var t=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(t){return this.drawParams=this.drawParams||this._updateDrawParams(),Object.assign({},this.drawParams,t)}},{key:"setAttributes",value:function(t){var e=this;return this.vertexArrayObject.bind(function(){for(var r in t){var i=t[r];e._setAttribute(r,i)}e.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(t,e),this}},{key:"setBuffer",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,r);var i=this._resolveLocationAndAccessor(t,e,e.accessor,r),n=i.location,a=i.accessor;return n>=0&&(this.values[n]=e,this.accessors[n]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setBuffer(n,e,a)),this}},{key:"setConstant",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},r)),n=i.location,a=i.accessor;return n>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e,a),this.values[n]=e,this.accessors[n]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.enable(n,!1)),this}},{key:"unbindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind(function(){t.elements&&t.setElementBuffer(null),t.buffer=t.buffer||new Ut(t.gl,{size:4});for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++)t.values[e]instanceof Ut&&(t.gl.disableVertexAttribArray(e),t.gl.bindBuffer(34962,t.buffer.handle),t.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind(function(){t.elements&&t.setElementBuffer(t.elements);for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++){var r=t.values[e];r instanceof Ut&&t.setBuffer(e,r)}}),this}},{key:"bindForDraw",value:function(t,e,r){var i,n=this;return this.vertexArrayObject.bind(function(){n._setConstantAttributes(t,e),n.vertexArrayObject.hasVertexArrays||n.bindBuffers(),i=r(),n.vertexArrayObject.hasVertexArrays||n.unbindBuffers()}),i}},{key:"_resolveLocationAndAccessor",value:function(t,e,r,i){var n=this,a=this._getAttributeIndex(t),o=a.location,s=a.name;if(!Number.isFinite(o)||o<0)return this.unused[t]=e,A.once(3,function(){return"unused value ".concat(t," in ").concat(n.id)})(),this;var u=this._getAttributeInfo(s||o);if(!u)return{location:-1,accessor:null};var l=Ft.resolve(u.accessor,r,i),c=l.size,h=l.type;return K(Number.isFinite(c)&&Number.isFinite(h)),{location:o,accessor:l}}},{key:"_getAttributeInfo",value:function(t){return this.configuration&&this.configuration.getAttributeInfo(t)}},{key:"_getAttributeIndex",value:function(t){var e=Number(t);if(Number.isFinite(e))return{location:e};var r=Pr.exec(t),i=r?r[1]:t,n=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+n,name:i}:{location:-1}}},{key:"_setAttribute",value:function(t,e){if(e instanceof Ut)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof Ut){var r=e[0],i=e[1];this.setBuffer(t,r,i)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){var n=e;this.setConstant(t,n)}else{if(!(e.buffer instanceof Ut))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");var a=e;this.setBuffer(t,a.buffer,a)}}},{key:"_setConstantAttributes",value:function(t,e){var r=Math.max(0|t,0|e),i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(var n=1;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)i=this.values[n],ArrayBuffer.isView(i)&&this._setConstantAttribute(n,i)}},{key:"_setConstantAttributeZero",value:function(t,e){if(Ar.isSupported(this.gl,{constantAttributeZero:!0}))this._setConstantAttribute(0,t);else{var r=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}}},{key:"_setConstantAttribute",value:function(t,e){Ar.setConstant(this.gl,t,e),this.vertexArrayObject.isDefault&&this.vertexArrayObject.enable(t,!1)}},{key:"_updateDrawParams",value:function(){for(var t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}},{key:"_updateDrawParamsForLocation",value:function(t,e){var r=this.values[e],i=this.accessors[e];if(r){var n=i.divisor>0;if(t.isInstanced=t.isInstanced||n,r instanceof Ut){var a=r;if(n){var o=a.getVertexCount(i);t.instanceCount=Math.min(t.instanceCount,o)}else{var s=a.getVertexCount(i);t.vertexCount=Math.min(t.vertexCount,s)}}}}},{key:"setElements",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return A.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}]),t}(),Mr=5126,Cr=5124,Lr=5125;!function(){function t(e){var r;for(var i in Object(s.a)(this,t),this.layout={},this.size=0,e)this._addUniform(i,e[i]);this.size+=(4-this.size%4)%4;var n=new Float32Array(this.size);this.typedArray=(r={},Object(o.a)(r,Mr,n),Object(o.a)(r,Cr,new Int32Array(n.buffer)),Object(o.a)(r,Lr,new Uint32Array(n.buffer)),r)}Object(u.a)(t,[{key:"getBytes",value:function(){return 4*this.size}},{key:"getData",value:function(){return this.typedArray[Mr]}},{key:"getSubData",value:function(t){var e,r;if(void 0===t)e=this.data,r=0;else{var i=this.offsets[t],n=i+this.sizes[t];e=this.data.subarray(i,n),r=4*i}return{data:e,offset:r}}},{key:"setUniforms",value:function(t){for(var e in t)this._setValue(e,t[e]);return this}},{key:"_setValue",value:function(t,e){var r=this.layout[t];K(r,"UniformLayoutStd140 illegal argument");var i=this.typedArray[r.type];1===r.size?i[r.offset]=e:i.set(e,r.offset)}},{key:"_addUniform",value:function(t,e){var r=gr(e);K(r,"UniformBufferLayout illegal argument");var i=r.type,n=r.components;this.size=this._alignTo(this.size,n);var a=this.size;this.size+=n,this.layout[t]={type:i,size:n,offset:a}}},{key:"_alignTo",value:function(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}}])}();function jr(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.header,r=void 0===e?"Uniforms":e,i=t.program,n=t.uniforms,a=t.undefinedOnly,s=void 0!==a&&a;K(i);var u=i._uniformSetters,l={},c=Object.keys(u).sort(),h=0,p=!0,f=!1,d=void 0;try{for(var v,m=c[Symbol.iterator]();!(p=(v=m.next()).done);p=!0){var g=v.value;g.match(".*_.*")||g.match(".*Matrix")||zr({table:l,header:r,uniforms:n,uniformName:g,undefinedOnly:s})&&h++}}catch(t){f=!0,d=t}finally{try{p||null==m.return||m.return()}finally{if(f)throw d}}var y=!0,_=!1,b=void 0;try{for(var x,w=c[Symbol.iterator]();!(y=(x=w.next()).done);y=!0){var k=x.value;k.match(".*Matrix")&&zr({table:l,header:r,uniforms:n,uniformName:k,undefinedOnly:s})&&h++}}catch(t){_=!0,b=t}finally{try{y||null==w.return||w.return()}finally{if(_)throw b}}var E=!0,S=!1,T=void 0;try{for(var A,P=c[Symbol.iterator]();!(E=(A=P.next()).done);E=!0){var O=A.value;l[O]||zr({table:l,header:r,uniforms:n,uniformName:O,undefinedOnly:s})&&h++}}catch(t){S=!0,T=t}finally{try{E||null==P.return||P.return()}finally{if(S)throw T}}var I=0,M={};if(!s)for(var C in n){var L=n[C];l[C]||(I++,M[C]=Object(o.a)({Type:"NOT USED: ".concat(L)},r,et(L)))}return{table:l,count:h,unusedTable:M,unusedCount:I}}function zr(t){var e,r=t.table,i=t.header,n=t.uniforms,a=t.uniformName,s=t.undefinedOnly,u=n[a],l=function(t){return null!=t}(u);return(!s||!l)&&(r[a]=(e={},Object(o.a)(e,i,l?et(u):"N/A"),Object(o.a)(e,"Uniform Type",l?u:"NOT PROVIDED"),e),!0)}function Rr(t,e,r,i){var n,a,s,u,l=t.gl,c="NOT PROVIDED",h="N/A",p="N/A",f="N/A";if(r&&(c=r.type,h=r.size,a=-1!==(c=String(c).replace("Array","")).indexOf("nt")),e instanceof Ut){var d,v,m=e,g=m.getDebugData(),y=g.data;if(s=g.modified?"*":"",u=y,p=(f=m.byteLength)/y.BYTES_PER_ELEMENT/h,r){var _=r.divisor>0;v="".concat(_?"I ":"P "," ").concat(p," (x").concat(h,"=").concat(f," bytes ").concat(kt(l,c),")")}else a=!0,v="".concat(f," bytes");return d={},Object(o.a)(d,i,"".concat(s).concat(et(u,{size:h,isInteger:a}))),Object(o.a)(d,"Format ",v),d}return u=e,h=e.length,a=-1!==(c=String(e.constructor.name).replace("Array","")).indexOf("nt"),n={},Object(o.a)(n,i,"".concat(et(u,{size:h,isInteger:a})," (constant)")),Object(o.a)(n,"Format ","".concat(h,"x").concat(c," (constant)")),n}function Fr(t,e){var r=yr(e.type,e.size);return r?"".concat(t," (").concat(r.name,")"):t}function Dr(t){var e=t.accessor,r=yr(e.type,e.size);return r?"".concat(r.name," ").concat(t.name):t.name}var Br={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Nr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t);var r=e.id,i=void 0===r?Q("geometry"):r,n=e.drawMode,a=void 0===n?Br.TRIANGLES:n,o=e.mode,u=e.attributes,l=void 0===u?{}:u,c=e.indices,h=void 0===c?null:c,p=e.vertexCount,f=void 0===p?null:p;this.id=i,this.drawMode=0|a||0|o,this.attributes={},this.userData={},this._setAttributes(l,h),this.vertexCount=f||this._calculateVertexCount(this.attributes,this.indices)}return Object(u.a)(t,null,[{key:"DRAW_MODE",get:function(){return Br}}]),Object(u.a)(t,[{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?W({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(t){return"Geometry ".concat(this.id," attribute ").concat(t)}},{key:"_setAttributes",value:function(t,e){for(var r in e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e),t){var i=t[r];i=ArrayBuffer.isView(i)?{value:i}:i,K(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),"indices"===r?(K(!this.indices),this.indices=i,void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed)):this.attributes[r]=i}return this}},{key:"_calculateVertexCount",value:function(t,e){if(e)return e.value.length;var r=1/0;for(var i in t){var n=t[i],a=n.value,o=n.size;!n.constant&&a&&o>=1&&(r=Math.min(r,a.length/o))}if(!Number.isFinite(r)){var s=t.POSITION||t.positions;s&&(r=s.value&&s.value.length/(s.size||3))}return K(Number.isFinite(r)),r}},{key:"mode",get:function(){return this.drawMode}}]),t}(),Ur=function t(){Object(s.a)(this,t)},Vr={};function Gr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function qr(t){return Math.round(t/Vr.EPSILON)*Vr.EPSILON}function Zr(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===e?Vr.precision||4:e;return t=qr(t),parseFloat(t.toPrecision(r))}function Xr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function Wr(t,e){if(Xr(t)){for(var r=(n=t).clone?n.clone():new Array(n),i=0;i<r.length;++i)r[i]=e(r[i],i,r);return r}var n;return e(t)}function Hr(t){return Wr(t,function(t){return t/180*Math.PI})}function Yr(t){return Wr(t,function(t){return 180*t/Math.PI})}function Kr(t,e,r){return Wr(t,function(t){return Math.max(e,Math.min(r,t))})}function Jr(t,e,r){return Xr(t)?t.map(function(t,i){return Jr(t,e[i],r)}):r*e+(1-r)*t}function Qr(t,e){if(Xr(t)&&Xr(e)){if(t===e)return!0;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(!Qr(t[r],e[r]))return!1;return!0}return Math.abs(t-e)<=Vr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}function $r(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}Vr.EPSILON=1e-12,Vr.debug=!0,Vr.precision=4,Vr.printTypes=!1,Vr.printDegrees=!1,Vr.printRowMajor=!0;var ti=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,$r(Array)),Object(u.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this).check()}},{key:"copy",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t[e];return this.check()}},{key:"set",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=(t<0||arguments.length<=t?void 0:arguments[t])||0;return this.check()}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"toString",value:function(){return this.formatString(Vr)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Zr(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Qr(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"inverse",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=1/this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var i=0;i<this.ELEMENTS;++i){var n=t[i];this[i]=n+r*(e[i]-n)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"validate",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=t&&t.length===this.ELEMENTS,r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(t[r]);return e}},{key:"check",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if(Vr.debug&&!this.validate(t))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){return this.scale(t)}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}}]),e}(),ei=function(t,e){if(!t)throw new Error(e)},ri=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,ti),Object(u.a)(e,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var i=this[r]-t[r];e+=i*i}return Gr(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Gr(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0;i<e.length;i++)for(var n=e[i],a=0;a<this.ELEMENTS;++a)this[a]+=n[a];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0;i<e.length;i++)for(var n=e[i],a=0;a<this.ELEMENTS;++a)this[a]-=n[a];return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0;i<e.length;i++)for(var n=e[i],a=0;a<this.ELEMENTS;++a)this[a]*=n[a];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0;i<e.length;i++)for(var n=e[i],a=0;a<this.ELEMENTS;++a)this[a]/=n[a];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"scaleAndAdd",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=this[r]*e+t[r];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return ei(t>=0&&t<this.ELEMENTS,"index is out of range"),Gr(this[t])}},{key:"setComponent",value:function(t,e){return ei(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){return this[0]=Gr(t)}},{key:"y",get:function(){return this[1]},set:function(t){return this[1]=Gr(t)}}]),e}(),ii=1e-6,ni="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function ai(t){var e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function oi(t,e,r){var i=new ni(3);return i[0]=t,i[1]=e,i[2]=r,i}function si(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}var ui,li,ci=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},hi=(ui=new ni(3),ni!=Float32Array&&(ui[0]=0,ui[1]=0,ui[2]=0),li=ui,[0,0,0]),pi=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Object(s.a)(this,e),t=St(this,Tt(e).call(this)),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i,n),t}return Pt(e,ri),Object(u.a)(e,[{key:"angle",value:function(t){return function(t,e){var r=oi(t[0],t[1],t[2]),i=oi(e[0],e[1],e[2]);si(r,r),si(i,i);var n=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)}(this,t)}},{key:"cross",value:function(t){return function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2];t[0]=n*u-a*s,t[1]=a*o-i*u,t[2]=i*s-n*o}(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,i){var n=[],a=[];n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?hi:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,i){var n=[],a=[];n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?hi:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,i){var n=[],a=[];n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2]}(this,this,void 0===r?hi:r,e),this.check()}},{key:"operation",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t.apply(void 0,[this,this].concat(r)),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Gr(t)}}]),e}(),fi=[255,255,255],di=[0,0,1],vi=[0,0,-1],mi=[0,0,1],gi=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),this.id=e.id||Q("light");var r=e.color,i=void 0===r?fi:r;this.color=i;var n=e.intensity,a=void 0===n?1:n;this.intensity=a},yi=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,e),(t=St(this,Tt(e).call(this,r))).type="ambient",t}return Pt(e,gi),e}(),_i=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),(t=St(this,Tt(e).call(this,r))).type="directional";var i=r.direction,n=void 0===i?vi:i;return t.direction=new pi(n).normalize().toArray(),t}return Pt(e,gi),e}(),bi=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),(t=St(this,Tt(e).call(this,r))).type="point";var i=r.position,n=void 0===i?mi:i;return t.position=n,t.attenuation=t._getAttenuation(r),t}return Pt(e,gi),Object(u.a)(e,[{key:"_getAttenuation",value:function(t){return"attenuation"in t?t.attenuation:"intensity"in t?[0,0,t.intensity]:di}}]),e}(),xi=0,wi=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t);var r=e.onCreateContext,i=void 0===r?function(t){return Pe(t)}:r,n=e.onAddHTML,a=void 0===n?null:n,o=e.onInitialize,u=void 0===o?function(){}:o,l=e.onRender,c=void 0===l?function(){}:l,h=e.onFinalize,p=void 0===h?function(){}:h,f=e.gl,d=void 0===f?null:f,v=e.glOptions,m=void 0===v?{}:v,g=e.debug,y=void 0!==g&&g,_=e.createFramebuffer,b=void 0!==_&&_,x=e.autoResizeViewport,w=void 0===x||x,k=e.autoResizeDrawingBuffer,E=void 0===k||k,S=e.stats,T=void 0===S?I.get("animation-loop-".concat(xi++)):S,P=e.useDevicePixels,O=void 0===P||P;"useDevicePixelRatio"in e&&(A.deprecated("useDevicePixelRatio","useDevicePixels")(),O=e.useDevicePixelRatio),this.props={onCreateContext:i,onAddHTML:a,onInitialize:u,onRender:c,onFinalize:p,gl:d,glOptions:m,debug:y,createFramebuffer:b},this.gl=d,this.needsRedraw=null,this.stats=T,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:w,autoResizeDrawingBuffer:E,useDevicePixels:O}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return Object(u.a)(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(t){return K("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}},{key:"setProps",value:function(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._running?this:(this._running=!0,st().then(function(){return!t._running||t._initialized?null:(t._createWebGLContext(e),t._createFramebuffer(),t._startEventHandling(),t._initializeCallbackData(),t._updateCallbackData(),t._resizeCanvasDrawingBuffer(),t._resizeViewport(),t._gpuTimeQuery=wr.isSupported(t.gl,["timers"])?new wr(t.gl):null,t._initialized=!0,t.onInitialize(t.animationProps))}).then(function(e){t._running&&(t._addCallbackData(e||{}),!1!==e&&t._startLoop())}),this)}},{key:"redraw",value:function(){return this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),gt(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"waitForRender",value:function(){var t=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(function(e){t._resolveNextFrame=e})),this._nextFramePromise}},{key:"toDataURL",value:function(){var t=Qt(Kt.a.mark(function t(){return Kt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.setNeedsRedraw("toDataURL"),t.next=3,this.waitForRender();case 3:return t.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"onCreateContext",value:function(){var t;return(t=this.props).onCreateContext.apply(t,arguments)}},{key:"onInitialize",value:function(){var t;return(t=this.props).onInitialize.apply(t,arguments)}},{key:"onRender",value:function(){var t;return(t=this.props).onRender.apply(t,arguments)}},{key:"onFinalize",value:function(){var t;return(t=this.props).onFinalize.apply(t,arguments)}},{key:"getHTMLControlValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=document.getElementById(t);return r?Number(r.value):e}},{key:"setViewParameters",value:function(){return A.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var t=this;gt(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(function e(){t._running&&(t.redraw(),t._animationFrameId=t._requestAnimationFrame(e))})}},{key:"_setDisplay",value:function(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}},{key:"_requestAnimationFrame",value:function(t){this.display&&this.display.requestAnimationFrame(t)||mt(t)}},{key:"_renderFrame",value:function(){var t;this.display?(t=this.display)._renderFrame.apply(t,arguments):this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._onSetupFrame?this._onSetupFrame(this.animationProps):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),time:0,tick:0,tock:0,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var t=this._getSizeAndAspect(),e=t.width,r=t.height,i=t.aspect;e===this.animationProps.width&&r===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.time=Date.now()-this.animationProps.startTime,this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(t){"object"===Object(n.a)(t)&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}},{key:"_createWebGLContext",value:function(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Oe(this.props.gl,t):this.onCreateContext(t),!pt(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(M.b)(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";var e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);var r=this.props.onAddHTML(e);r&&(e.innerHTML=r)}}},{key:"_getSizeAndAspect",value:function(){var t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight,r=1,i=this.gl.canvas,n=i.clientWidth,a=i.clientHeight;return n>0&&a>0?r=n/a:t>0&&e>0&&(r=t/e),{width:t,height:e,aspect:r}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas){var r=e.useDevicePixels&&window.devicePixelRatio||1,i="width"in e?e.width:t.canvas.clientWidth,n="height"in e?e.height:t.canvas.clientHeight;return t.canvas.width=i*r,void(t.canvas.height=n*r)}var a=t.getExtension("STACKGL_resize_drawingbuffer");a&&"width"in e&&"height"in e&&a.resize(e.width,e.height)}(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new Se(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){this.gl.canvas.addEventListener("mousemove",this._onMousemove),this.gl.canvas.addEventListener("mouseleave",this._onMouseleave)}},{key:"_onMousemove",value:function(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}},{key:"_onMouseleave",value:function(t){this.animationProps._mousePosition=null}}]),t}();new Uint8Array([0,0,0]);var ki={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Ei(t,e){var r=(e||{}).attributeMap,i=void 0===r?ki:r;return i&&i[t]||t}function Si(t,e){var r;switch(t){case"indices":r=r||"indices";break;case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors"}switch(r){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break;case"indices":e.size=e.size||1,e.isIndexed=void 0===e.isIndexed||e.isIndexed,K(e.value instanceof Uint16Array||e.value instanceof Uint32Array,'attribute array for "indices" must be of integer type')}K(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}var Ti="#define SHADER_NAME luma_modular_vertex\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec2 texCoords;\nattribute vec3 pickingColors;\n\nvoid main(void) {\n\n  // Set up position\n#ifdef MODULE_GEOMETRY\n  geometry_setPosition(positions);\n  geometry_setNormal(normals);\n#endif\n\n#ifdef MODULE_PROJECT\n  project_setPositionAndNormal_Model(positions, normals);\n  gl_Position = project_model_to_clipspace(positions);\n#endif\n\n  // Set up depth\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n\n#ifdef MODULE_DIFFUSE\n  diffuse_setTextureCoordinate(texCoords);\n#endif\n\n  // Set up color calculations\n#ifdef MODULE_MATERIAL\n  material_setDiffuseColor(colors);\n  material_setDiffuseTextureCoordinates(texCoords);\n#endif\n\n#ifdef MODULE_LIGHTING\n  lighting_setPositionAndNormal(positions, normals);\n  lighting_apply_light(positions);\n  lighting_apply_reflection(positions);\n#endif\n\n#ifdef MODULE_PICKING\n  picking_setPickingColor(pickingColors);\n#endif\n\n}\n",Ai="#define SHADER_NAME luma-modular-fragment\n\nprecision highp float;\n\n// varyings\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vec4(1., 0., 1., 1.);\n\n#ifdef MODULE_DIFFUSE\n  gl_FragColor = diffuse_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth(gl_Position);\n#endif\n}\n",Pi="vs",Oi="fs";function Ii(t,e,r){switch(e){case 300:return r?function(t){return t.replace(/attribute\s+/g,"in ").replace(/varying\s+/g,"out ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(+/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(t):function(t){return t.replace(/varying\s+/g,"in ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(t);case 100:return r?function(t){return t.replace(/^in\s+/gm,"attribute ").replace(/^out\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(t):function(t){return t.replace(/^in\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Mi(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}var Ci=function(){function t(e){var r=e.name,i=e.vs,n=e.fs,a=e.dependencies,o=void 0===a?[]:a,u=e.getUniforms,l=void 0===u?function(){return{}}:u,c=e.deprecations,h=void 0===c?[]:c,p=e.defines,f=void 0===p?{}:p,d=e.vertexShader,v=e.fragmentShader;Object(s.a)(this,t),Mi("string"==typeof r),this.name=r,this.vs=i||d,this.fs=n||v,this.getModuleUniforms=l,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(h),this.defines=f}return Object(u.a)(t,[{key:"getModuleSource",value:function(t,e){var r;switch(t){case"vs":r=Ii(this.vs||"",e,!0);break;case"fs":r=Ii(this.fs||"",e,!1);break;default:Mi(!1)}return"string"!=typeof r?"":"#define MODULE_".concat(this.name.toUpperCase(),"\n").concat(r,"// END MODULE_").concat(this.name,"\n\n")}},{key:"getUniforms",value:function(t,e){return this.getModuleUniforms(t,e)}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(t,e){this.deprecations.forEach(function(r){r.regex.test(t)&&(r.deprecated&&e?e.deprecated(r.old,r.new)():e&&e.removed(r.old,r.new)())})}},{key:"_parseDeprecationDefinitions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.forEach(function(t){switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),t}}]),t}(),Li=new(function(){function t(){Object(s.a)(this,t),this.shaderModules={},this.defaultShaderModules=[]}return Object(u.a)(t,[{key:"setDefaultShaderModules",value:function(t){this.defaultShaderModules=this.resolveModules(t)}},{key:"registerShaderModules",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,r=void 0!==e&&e,i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value;this._registerShaderModule(u,r)}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}}},{key:"getShaderModule",value:function(t){if(t instanceof Ci)return t;if("string"!=typeof t)return this._registerShaderModule(t,!0);var e=this.shaderModules[t];return e||Mi(!1,"Unknown shader module ".concat(t)),e}},{key:"resolveModules",value:function(t){var e=this;return t.map(function(t){return e.getShaderModule(t)})}},{key:"_registerShaderModule",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t instanceof Ci)return t;if(Mi(t.name,"shader module has no name"),this.shaderModules[t.name]&&!e)throw new Error("shader module ".concat(t.name," already registered"));return(t=new Ci(t)).dependencies=this.resolveModules(t.dependencies),this.shaderModules[t.name]=t,this.shaderModules[t.name]}}]),t}());function ji(t){var e={},r={};return zi({modules:t,level:0,moduleMap:e,moduleDepth:r}),Object.keys(r).sort(function(t,e){return r[e]-r[t]}).map(function(t){return e[t]})}function zi(t){var e=t.modules,r=t.level,i=t.moduleMap,n=t.moduleDepth;if(r>=5)throw new Error("Possible loop in shader dependency graph");var a=!0,o=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i[c.name]=c,(void 0===n[c.name]||n[c.name]<r)&&(n[c.name]=r)}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}var h=!0,p=!1,f=void 0;try{for(var d,v=e[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var m=d.value;m.dependencies&&zi({modules:m.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}}catch(t){p=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(p)throw f}}}var Ri=7936,Fi=7937,Di=7938,Bi=35724,Ni={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Ui={};Object.keys(Ni).forEach(function(t){Ui[t]=t});var Vi={};function Gi(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Ni[e];if(Mi(i,e),!function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e="undefined"!=typeof window&&window.navigator||{},r=t.userAgent||e.userAgent||"",i=-1!==r.indexOf("MSIE "),n=-1!==r.indexOf("Trident/");return i||n}(r))return!0;if(e in Vi)return Vi[e];var n=i[0],a=r.behavior||"enable",o="#extension GL_".concat(n," : ").concat(a,"\nvoid main(void) {}"),s=t.createShader(35633);t.shaderSource(s,o),t.compileShader(s);var u=t.getShaderParameter(s,35713);return t.deleteShader(s),Vi[e]=u,u}function qi(t,e){var r=Ni[e];Mi(r,e);var i=function(t){return Boolean(t&&2===t._version)}(t)&&r[1]||r[0],n="string"==typeof i?Boolean(t.getExtension(i)):i;return Mi(!1===n||!0===n),n}function Zi(t,e){return(e=Array.isArray(e)?e:[e]).every(function(e){return qi(t,e)})}function Xi(t){switch(function(t){var e=t.getExtension("WEBGL_debug_renderer_info"),r=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||Ri),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||Fi);return{gpuVendor:function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(r,i),vendor:r,renderer:i,version:t.getParameter(Di),shadingLanguageVersion:t.getParameter(Bi)}}(t).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}var Wi,Hi,Yi=(Wi={},Object(o.a)(Wi,Pi,"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"),Object(o.a)(Wi,Oi,"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),Wi),Ki=/void main\s*\([^)]*\)\s*\{\n?/,Ji=/}\n?[^{}]*$/;function Qi(t){var e={};return Mi(Array.isArray(t)&&t.length>1),t.forEach(function(t){for(var r in t)e[r]=e[r]?"".concat(e[r],"\n").concat(t[r]):t[r]}),e}var $i=(Hi={},Object(o.a)(Hi,Pi,"vertex"),Object(o.a)(Hi,Oi,"fragment"),Hi),tn="precision highp float;\n\n";function en(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.vs,i=e.fs,n=function(t){return t=t.concat(Li.defaultShaderModules),ji(t=Li.resolveModules(t))}(e.modules||[]);return{gl:t,vs:rn(t,Object.assign({},e,{source:r,type:Pi,modules:n})),fs:rn(t,Object.assign({},e,{source:i,type:Oi,modules:n})),getUniforms:nn(n),modules:an(n)}}function rn(t,e){var r=e.id,i=e.source,n=e.type,a=e.modules,o=void 0===a?[]:a,s=e.defines,u=void 0===s?{}:s,l=e.inject,c=void 0===l?{}:l,h=e.prologue,p=void 0===h||h,f=e.log;Mi("string"==typeof i,"shader source must be a string");var d=n===Pi,v=i.split("\n"),m=100,g="",y=i;0===v[0].indexOf("#version ")&&(m=300,g=v[0],y=v.slice(1).join("\n"));var _={};o.forEach(function(t){Object.assign(_,t.getDefines())}),Object.assign(_,u);var b=p?"".concat(g,"\n").concat(function(t){var e=t.id,r=t.source,i=t.type;return e&&"string"==typeof e&&-1===r.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat($i[i],"\n\n"):""}({id:r,source:i,type:n}),"\n").concat(function(t){var e=t.type;return"\n#define SHADER_TYPE_".concat($i[e].toUpperCase(),"\n")}({type:n}),"\n").concat(Xi(t),"\n").concat(function(t,e,r){var i="#if (__VERSION__ > 120)\n\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return Zi(t,Ui.GLSL_FRAG_DEPTH)&&(i+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),Zi(t,Ui.GLSL_DERIVATIVES)&&Gi(t,Ui.GLSL_DERIVATIVES)&&(i+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),Zi(t,Ui.GLSL_FRAG_DATA)&&Gi(t,Ui.GLSL_FRAG_DATA,{behavior:"require"})&&(i+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),Zi(t,Ui.GLSL_TEXTURE_LOD)&&(i+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),i}(t),"\n").concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,r="";for(var i in t){0===e&&(r+="\n// APPLICATION DEFINES\n"),e++;var n=t[i];(n||Number.isFinite(n))&&(r+="#define ".concat(i.toUpperCase()," ").concat(t[i],"\n"))}0===e&&(r+="\n");return r}(_),"\n").concat(d?"":tn,"\n"):"".concat(g,"\n"),x=!1,w=!0,k=!1,E=void 0;try{for(var S,T=o[Symbol.iterator]();!(w=(S=T.next()).done);w=!0){var A=S.value;switch(A.name){case"inject":x=!0;break;default:A.checkDeprecations(y,f),b+=A.getModuleSource(n,m)}}}catch(t){k=!0,E=t}finally{try{w||null==T.return||T.return()}finally{if(k)throw E}}return b=function(t,e,r,i){var n=e===Pi,a=function(e){var i=r[e];switch(e){case"vs:#decl":n&&(t=t.replace(Ki,function(t){return"".concat(i,"\n").concat(t)}));break;case"vs:#main-start":n&&(t=t.replace(Ki,function(t){return t+i}));break;case"vs:#main-end":n&&(t=t.replace(Ji,function(t){return i+t}));break;case"fs:#decl":n||(t=t.replace(Ki,function(t){return"".concat(i,"\n").concat(t)}));break;case"fs:#main-start":n||(t=t.replace(Ki,function(t){return t+i}));break;case"fs:#main-end":n||(t=t.replace(Ji,function(t){return i+t}));break;default:t=t.replace(e,function(t){return t+i})}};for(var o in r)a(o);return i&&(t=t.replace("}s*$",function(t){return t+Yi[e]})),t}(b+=y,n,c,x)}function nn(t){return function(e){var r={},i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value.getUniforms(e,r);Object.assign(r,u)}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}}function an(t){var e,r={},i=!0,n=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value,l=(e=u,Li.getShaderModule(e));r[u]=l}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return r}var on=r(5),sn=r.n(on),un={},ln=function t(e,r,i){e&&(r.length>1?t(e[r[0]],r.slice(1),i):e[r[0]]=i)},cn=new Map;sn.a.listenFor("luma.gl",function(t){var e=un[t.itemKey];if(e&&"edit"===t.type&&"uniforms"===t.valuePath[0]){var r=t.valuePath.slice(1);!function(t,e,r){T.b.__SEER_INITIALIZED__&&(cn.has(t)||cn.set(t,new Map),cn.get(t).set(e,r))}(t.itemKey,r,t.value);var i=e.getUniforms();ln(i,r,t.value),e.setUniforms(i)}});var hn=["renderPickingBuffer","pickingEnabled"],pn=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),K(pt(e));var i=r.id,n=void 0===i?Q("base-model"):i;this.id=n,this.gl=e,this.id=r.id||Q("Model"),this.lastLogTime=0,this.initialize(r),this._setBaseModelProps(r)}return Object(u.a)(t,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.props={},this.program=this._createProgram(t),this.vertexArray=new Ir(this.gl,{program:this.program}),this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.animatedUniforms={},this.animated=!1,this.animationLoop=null,this.timerQueryEnabled=!1,this.timeElapsedQuery=void 0,this.lastQueryReturned=!0,this.stats={accumulatedFrameTime:0,averageFrameTime:0,profileFrameCount:0},this.pickable=!0,this._setBaseModelProps(t),this.setUniforms(Object.assign({},this.getModuleUniforms(),this.getModuleUniforms(t.moduleSettings)))}},{key:"setProps",value:function(t){this._setBaseModelProps(t)}},{key:"delete",value:function(){for(var t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();var e;this.program.delete(),this.vertexArray.delete(),e=this.id,delete un[e],sn.a.deleteItem("luma.gl",e)}},{key:"destroy",value:function(){this.delete()}},{key:"isAnimated",value:function(){return this.animated}},{key:"getProgram",value:function(){return this.program}},{key:"getUniforms",value:function(){return this.program.getUniforms()}},{key:"setUniforms",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e=Object.assign({},e),function(t,e){if(T.b.__SEER_INITIALIZED__&&t){var r=cn.get(t);r&&r.forEach(function(t,r){ln(e,r,t)})}}(this.id,e),e=this._extractAnimatedUniforms(e),this.program.setUniforms(e,function(){t._checkForDeprecatedUniforms(e)}),this}},{key:"updateModuleSettings",value:function(t){var e=this.getModuleUniforms(t||{});return this.setUniforms(e)}},{key:"clear",value:function(t){return ve(this.program.gl,t),this}},{key:"drawGeometry",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.moduleSettings,i=void 0===r?null:r,n=e.framebuffer,a=e.uniforms,o=void 0===a?{}:a,s=e.attributes,u=void 0===s?{}:s,l=e.transformFeedback,c=void 0===l?this.transformFeedback:l,h=e.parameters,p=void 0===h?{}:h,f=e.vertexArray,d=void 0===f?this.vertexArray:f,v=e.animationProps;un[(t=this).id]||(un[t.id]=t,sn.a.listItem("luma.gl",t.id)),this.setAttributes(u),this.updateModuleSettings(i),this.setUniforms(o),this._refreshAnimationProps(v);var m=this._logDrawCallStart(2),g=this.vertexArray.getDrawParams(this.props);g.isInstanced&&!this.isInstanced&&A.warn("Found instanced attributes on non-instanced model",this.id)();var y=g.isIndexed,_=g.indexType,b=g.indexOffset,x=this.isInstanced,w=this.instanceCount,k=function(){},E=this.props,S=E.onBeforeRender,T=void 0===S?k:S,P=E.onAfterRender,O=void 0===P?k:P;T(),this._timerQueryStart();var I=this.program.draw(Object.assign({},e,{logPriority:m,uniforms:null,framebuffer:n,parameters:p,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:d,transformFeedback:c,isIndexed:y,indexType:_,isInstanced:x,instanceCount:w,offset:y?b:0}));return this._timerQueryEnd(),O(),this._logDrawCallEnd(m,d,n),I}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.discard,r=void 0===e||e,i=t.feedbackBuffers,n=t.unbindModels,a=void 0===n?[]:n,s=t.parameters;i&&this._setFeedbackBuffers(i),r&&(s=Object.assign({},s,Object(o.a)({},35977,r))),a.forEach(function(t){return t.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},t,{parameters:s}))}finally{a.forEach(function(t){return t.vertexArray.bindBuffers()})}return this}},{key:"_setBaseModelProps",value:function(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"timerQueryEnabled"in t&&(this.timerQueryEnabled=t.timerQueryEnabled&&wr.isSupported(this.gl,["timers"]),t.timerQueryEnabled&&!this.timerQueryEnabled&&A.warn("GPU timer not supported")()),"_animationProps"in t&&this._setAnimationProps(t._animationProps),"_animationLoop"in t&&(this.animationLoop=t._animationLoop)}},{key:"_createProgram",value:function(t){var e=t.vs,r=void 0===e?null:e,i=t.fs,n=void 0===i?null:i,a=t.modules,o=void 0===a?null:a,s=t.defines,u=void 0===s?{}:s,l=t.inject,c=void 0===l?{}:l,h=t.shaderCache,p=void 0===h?null:h,f=t.varyings,d=void 0===f?null:f,v=t.bufferMode,m=void 0===v?35981:v,g=t.program,y=void 0===g?null:g;this.getModuleUniforms=function(t){};var _=this.id;if(!y){r=r||Ti,n=n||Ai;var b=en(this.gl,{vs:r,fs:n,modules:o,inject:c,defines:u,log:A});r=b.vs,n=b.fs,y=p?p.getProgram(this.gl,{id:_,vs:r,fs:n}):new xr(this.gl,{id:_,vs:r,fs:n,varyings:d,bufferMode:m}),this.getModuleUniforms=b.getUniforms||function(t){}}return K(y instanceof xr,"Model needs a program"),y}},{key:"_checkForDeprecatedUniforms",value:function(t){hn.forEach(function(e){e in t&&A.deprecated(e,"use picking shader module and Model class updateModuleSettings()")()})}},{key:"_refreshAnimationProps",value:function(t){(t=t||this.animationLoop&&this.animationLoop.animationProps)&&this._setAnimationProps(t)}},{key:"_evaluateAnimateUniforms",value:function(t){if(!this.animated)return{};var e={};for(var r in this.animatedUniforms){var i=this.animatedUniforms[r];e[r]=i(t)}return e}},{key:"_extractAnimatedUniforms",value:function(t){var e=!1;for(var r in t){var i=t[r];"function"==typeof i?(this.animatedUniforms[r]=i,e=!0):delete this.animatedUniforms[r]}if(this.animated=!tt(this.animatedUniforms),!e)return t;var n={};for(var a in t)this.animatedUniforms[a]||(n[a]=t[a]);return n}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new wr(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var t=this.timeElapsedQuery.getTimerMilliseconds();this.stats.lastFrameTime=t,this.stats.accumulatedFrameTime+=t,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,A.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}},{key:"_logDrawCallStart",value:function(t){var e=t>3?0:1e4;if(!(A.priority<t||Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),A.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:A.priority<=2})(),t}},{key:"_logDrawCallEnd",value:function(t,e,r,i){if(void 0!==t){var n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertexArray,r=t.header,i=void 0===r?"Attributes":r;if(!e.configuration)return{};var n={};e.elements&&(n.ELEMENT_ARRAY_BUFFER=Rr(e,e.elements,null,i));var a=e.values;for(var o in a){var s=e._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),l=e.accessors[s.location];l&&(u="".concat(o,": ").concat(Fr(s.name,l))),n[u]=Rr(e,a[o],l,i)}}return n}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),a=jr({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),s=a.table,u=a.unusedTable,l=a.unusedCount,c=jr({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0}),h=c.table;c.count>0&&A.log("MISSING UNIFORMS",Object.keys(h))(),l>0&&A.log("UNUSED UNIFORMS",Object.keys(u))();var p=function(t){var e={},r="Accessors for ".concat(t.id),i=!0,n=!1,a=void 0;try{for(var s,u=t.attributeInfos[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l){var c=Dr(l);e["in ".concat(c)]=Object(o.a)({},r,JSON.stringify(l.accessor))}}}catch(t){n=!0,a=t}finally{try{i||null==u.return||u.return()}finally{if(n)throw a}}var h=!0,p=!1,f=void 0;try{for(var d,v=t.varyingInfos[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var m=d.value;if(m){var g=Dr(m);e["out ".concat(g)]=Object(o.a)({},r,JSON.stringify(m.accessor))}}}catch(t){p=!0,f=t}finally{try{h||null==v.return||v.return()}finally{if(p)throw f}}return e}(this.vertexArray.configuration);A.table(t,n)(),A.table(t,s)(),A.table(t+1,p)(),function(t,e){if(sn.a.isReady()&&!sn.a.throttle("luma.gl:".concat(t.id),1e3)){var r=t.geometry?Object.assign({},t.geometry.attributes,t.attributes):t.attributes,i=Object.assign({},t.uniforms,e);sn.a.multiUpdate("luma.gl",t.id,[{path:"objects.uniforms",data:i},{path:"objects.attributes",data:r}])}}(this,r),i&&i.log({priority:2,message:"Rendered to ".concat(i.id)}),A.groupEnd(2,">>> DRAWING MODEL ".concat(this.id))()}}}]),t}(),fn=function(t){function e(t,r){Object(s.a)(this,e);var i=r.id,n=void 0===i?Q("model"):i;return St(this,Tt(e).call(this,t,W({},r,{id:n})))}return Pt(e,pn),Object(u.a)(e,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ve(Tt(e.prototype),"initialize",this).call(this,t),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced,this._setModelProps(t),this.geometry={},K(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}},{key:"setProps",value:function(t){Ve(Tt(e.prototype),"setProps",this).call(this,t),this._setModelProps(t)}},{key:"delete",value:function(){Ve(Tt(e.prototype),"delete",this).call(this),this._deleteGeometryBuffers()}},{key:"destroy",value:function(){this.delete()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setDrawMode",value:function(t){return this.drawMode=t,this}},{key:"setVertexCount",value:function(t){return K(Number.isFinite(t)),this.vertexCount=t,this}},{key:"setInstanceCount",value:function(t){return K(Number.isFinite(t)),this.instanceCount=t,this}},{key:"setGeometry",value:function(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,r){var i={};for(var n in e.attributes){var a=e.attributes[n],o=Ei(n,r);if(a.constant)i[o]=a.value;else{var s=a.value,u=W({},a);delete u.value,i[o]=[new Ut(t,s),u],Si(n,u)}}return e.indices&&(i.indices=new Ut(t,{data:e.indices.value||e.indices,target:34963})),i}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(tt(t))return this;var e={};for(var r in t){var i=t[r];e[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(e),this}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.drawGeometry(t)}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.discard,r=void 0===e||e,i=t.feedbackBuffers,n=t.unbindModels,a=void 0===n?[]:n,s=t.parameters;i&&this._setFeedbackBuffers(i),r&&(s=Object.assign({},s,Object(o.a)({},35977,r))),a.forEach(function(t){return t.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},t,{parameters:s}))}finally{a.forEach(function(t){return t.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}},{key:"_setModelProps",value:function(t){"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}},{key:"_deleteGeometryBuffers",value:function(){for(var t in this.geometryBuffers){var e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof Ut&&e.delete()}}},{key:"_setAnimationProps",value:function(t){var e=this;if(this.animated){K(t,"Model.draw(): animated uniforms but no animationProps");var r=this._evaluateAnimateUniforms(t);this.program.setUniforms(r,function(){e._checkForDeprecatedUniforms(r)})}}},{key:"_setFeedbackBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(tt(t))return this;var e=this.program.gl;return this.transformFeedback=this.transformFeedback||new kr(e,{program:this.program}),this.transformFeedback.setBuffers(t),this}},{key:"_timerQueryStart",value:function(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new wr(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}},{key:"_timerQueryEnd",value:function(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;var t=this.timeElapsedQuery.getTimerMilliseconds();this.stats.lastFrameTime=t,this.stats.accumulatedFrameTime+=t,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,A.log(2,"GPU time ".concat(this.program.id,": ").concat(this.stats.lastFrameTime,"ms average ").concat(this.stats.averageFrameTime,"ms accumulated: ").concat(this.stats.accumulatedFrameTime,"ms count: ").concat(this.stats.profileFrameCount))()}}}]),e}(),dn="void main() {gl_FragColor = vec4(0);}",vn="#version 300 es\nout vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}";function mn(t,e){e=Array.isArray(e)?e:[e];var r=C(t.replace(/^\s+/,"").split(/\s+/),3),i=r[0],n=r[1],a=r[2];return e.includes(i)&&n&&a?{qualifier:i,type:n,name:a.split(";")[0]}:null}function gn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.version,r=void 0===e?100:e,i=t.input,n=t.inputType,a=t.output;if(!i)return 300===r?vn:dn;var o=function(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Mi(!1),null}}(i,n);return 300===r?"#version 300 es\nin ".concat(n," ").concat(i,";\nout vec4 ").concat(a,";\nvoid main() {\n  ").concat(a," = ").concat(o,";\n}"):"varying ".concat(n," ").concat(i,";\nvoid main() {\n  gl_FragColor = ").concat(o,";\n}")}var yn,_n={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},bn="transform_uSampler_",xn="transform_uSize_",wn="transform_position";function kn(t){var e=t.vs,r=t.sourceTextureMap,i=t.targetTextureVarying,n=t.targetTexture,a=Object.keys(r).length,o=null,s={},u=e,l={};if(a>0||i){var c=u.split("\n"),h=c.slice();if(c.forEach(function(t,e,n){if(a>0){var u=function(t,e){var r={},i=function(t){return mn(t,["attribute","in"])}(t);if(!i)return null;var n=i.type,a=i.name;if(a&&e[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=function(t){var e="".concat(bn).concat(t),r="".concat(xn).concat(t),i="  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(r,";");return{samplerName:e,sizeName:r,uniformDeclerations:i}}(a),u=s.samplerName,l=s.sizeName,c=s.uniformDeclerations,h=function(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Mi(!1),null}}(n),p="  ".concat(n," ").concat(a," = transform_getInput(").concat(u,", ").concat(l,").").concat(h,";\n");r[u]=a;var f={"vs:#decl":c,"vs:#main-start":p};return{updatedLine:o,inject:f,samplerTextureMap:r}}return null}(t,r);if(u){var c=u.updatedLine,p=u.inject;h[e]=c,l=Qi([l,p]),Object.assign(s,u.samplerTextureMap),a--}}i&&!o&&(o=function(t,e){var r=mn(t,["varying","out"]);if(!r)return null;return r.name===e?r.type:null}(t,i))}),i){K(n);var p="".concat(xn).concat(i),f="uniform vec2 ".concat(p,";\n"),d="     vec2 ".concat(wn," = transform_getPos(").concat(p,");\n     gl_Position = vec4(").concat(wn,", 0, 1.);\n");l=Qi([l,{"vs:#decl":f,"vs:#main-start":d}])}u=h.join("\n")}return{vs:u,targetTextureType:o,inject:l,samplerTextureMap:s}}var En=(yn={},Object(o.a)(yn,10241,9728),Object(o.a)(yn,10240,9728),Object(o.a)(yn,10242,33071),Object(o.a)(yn,10243,33071),yn),Sn=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),K(ft(e)),this.gl=e,this.model=null,this.elementCount=0,this.currentIndex=0,this.sourceBuffers=new Array(2),this.sourceTextures=new Array(2),this.feedbackBuffers=new Array(2),this.targetTextures=new Array(2),this.transformFeedbacks=new Array(2),this.framebuffers=new Array(2),this._createdBuffers={},this.elementIDBuffer=null,this._targetRefTexName=null,this._initialize(r),Object.seal(this)}return Object(u.a)(t,null,[{key:"isSupported",value:function(t){return ft(t)}}]),Object(u.a)(t,[{key:"delete",value:function(){for(var t in this._createdBuffers)this._createdBuffers[t].delete();this.model.delete()}},{key:"getBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=t?this.feedbackBuffers[this.currentIndex][t]:null;return e?e instanceof Ut?e:e.buffer:null}},{key:"_getTargetTexture",value:function(){return this.framebuffers[this.currentIndex]?this.framebuffers[this.currentIndex].attachments[36064]:null}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.varyingName,r=void 0===e?null:e,i=t.packed,n=void 0!==i&&i,a=this.getBuffer(r);if(a)return a.getData();K(!r||r===this.targetTextureVarying);var o=ge(this.framebuffers[this.currentIndex]);if(!n)return o;for(var s=o.constructor,u=function(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Mi(!1),null}}(this.targetTextureType),l=new s(o.length*u/4),c=0,h=0;h<o.length;h+=4)for(var p=0;p<u;p++)l[c++]=o[h+p];return l}},{key:"getFramebuffer",value:function(){return this.framebuffers[this.currentIndex]}},{key:"_getInputs",value:function(){var t={},e=this.currentIndex,r=Object.assign({},this.sourceBuffers[e]);if(this.hasSourceTextures||this.targetTextureVarying){for(var i in r.transform_elementID=this.elementIDBuffer,this.samplerTextureMap){var n=this.samplerTextureMap[i];t[i]=this.sourceTextures[e][n]}this._setSourceTextureParameters();var a=function(t){var e,r,i=t.sourceTextureMap,n=t.targetTextureVarying,a=t.targetTexture,o={};for(var s in n&&(e=a.width,r=a.height,o["".concat(xn).concat(n)]=[e,r]),i){var u=i[s];e=u.width,r=u.height,o["".concat(xn).concat(s)]=[e,r]}return o}({sourceTextureMap:this.sourceTextures[e],targetTextureVarying:this.targetTextureVarying,targetTexture:this.targetTextures[e]});Object.assign(t,a)}return{attributes:r,uniforms:t}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._getInputs(),r=e.attributes,i=e.uniforms;Object.assign(i,t.uniforms);var n=Object.assign({},t.parameters),a=t.clearRenderTarget,o=void 0===a||a,s=null,u=!0;this.renderingToTexture&&(u=!1,K(s=this.framebuffers[this.currentIndex]),n.viewport=[0,0,s.width,s.height],o&&this.gl.clear(this.gl.COLOR_BUFFER_BIT)),this.model.setAttributes(r),this.model.transform(Object.assign({},t,{transformFeedback:this.transformFeedbacks[this.currentIndex],uniforms:i,discard:u,framebuffer:s,parameters:n}))}},{key:"swapBuffers",value:function(){A.deprecated("swapBuffers()","swap()")(),this.swap()}},{key:"swap",value:function(){K(this.feedbackMap||this._swapTexture),this.currentIndex=(this.currentIndex+1)%2}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.elementCount&&this._setElementCount(t.elementCount);var e=t.sourceBuffers,r=void 0===e?null:e,i=t.feedbackBuffers,n=void 0===i?null:i,a=this.currentIndex;if(r||n){for(var o in n)K(n[o]instanceof Ut||n[o].buffer instanceof Ut);Object.assign(this.sourceBuffers[a],r),Object.assign(this.feedbackBuffers[a],n),this._createFeedbackBuffers({feedbackBuffers:n}),this.transformFeedbacks[a]&&this.transformFeedbacks[a].setBuffers(this.feedbackBuffers[a]),this._setupSwapBuffers()}var s=t._sourceTextures,u=t._targetTexture;(s||u)&&(Object.assign(this.sourceTextures[a],s),this._updateTargetTexture(u||this._targetRefTexName,a),this._setupSwapTextures())}},{key:"_setSourceTextureParameters",value:function(){var t=this.currentIndex;for(var e in this.sourceTextures[t])this.sourceTextures[t][e].setParameters(En)}},{key:"_setElementCount",value:function(t){this.elementCount!==t&&(this.elementCount<t&&this._updateElementIDBuffer(t),this.model.setVertexCount(t),this.elementCount=t)}},{key:"_updateTargetTexture",value:function(t,e){var r=this._buildTargetTexture(t);r&&(this.targetTextures[e]=r,this.framebuffers[e]&&(this.framebuffers[e].update({attachments:Object(o.a)({},36064,this.targetTextures[e]),resizeAttachments:!1}),this.framebuffers[e].resize({width:r.width,height:r.height})))}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._validateProps(t),r=e.feedbackBuffers,i=e.feedbackMap,n=t.sourceBuffers,a=t.varyings,o=t._targetTexture,s=t._targetTextureVarying,u=t._swapTexture,l=a;i&&!Array.isArray(a)&&(l=Object.values(i)),this.varyingsArray=l,this.feedbackMap=i,this._swapTexture=u,o&&(this.targetTextureVarying=s,this.renderingToTexture=!0,K(this.targetTextureVarying)),this._setupBuffers({sourceBuffers:n,feedbackBuffers:r}),this._setupTextures(t),this._setupSwapBuffers(),this._setupSwapTextures(),this._buildModel(Object.assign({},t,{id:t.id||"transform-model",drawMode:t.drawMode||0,varyings:l}))}},{key:"_validateProps",value:function(t){var e=t.feedbackBuffers,r=t.feedbackMap,i=t.destinationBuffers,n=t.sourceDestinationMap;i&&(A.deprecated("destinationBuffers","feedbackBuffers")(),e=e||i),n&&(A.deprecated("sourceDestinationMap","feedbackMap")(),r=r||n);var a=t.vs,o=t.elementCount,s=t.varyings,u=t._sourceTextures,l=t._targetTexture,c=t._targetTextureVarying,h=t._swapTexture;for(var p in K(a&&(s||r||l)&&o),e||{})K(e[p]instanceof Ut||e[p].buffer instanceof Ut);for(var f in u||{})K(u[f]instanceof Ht);return K(!l||c),K(!h||u[h]),{feedbackBuffers:e,feedbackMap:r}}},{key:"_setupBuffers",value:function(t){var e=t.sourceBuffers,r=void 0===e?null:e,i=t.feedbackBuffers,n=void 0===i?null:i;this.sourceBuffers[0]=Object.assign({},r),this.feedbackBuffers[0]=Object.assign({},n),this._createFeedbackBuffers({feedbackBuffers:n}),this.sourceBuffers[1]={},this.feedbackBuffers[1]={}}},{key:"_setupTextures",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t._sourceTextures,r=t._targetTexture;if(this.sourceTextures[0]=Object.assign({},e),this.sourceTextures[1]={},this.hasSourceTextures=Object.keys(this.sourceTextures[0]).length>0,this.targetTextureVarying){var i=this._buildTargetTexture(r);K(i),this.targetTextures[0]=i,this.targetTextures[1]=null}}},{key:"_buildTargetTexture",value:function(t){var e;if(t instanceof Ht)return t;var r=this.sourceTextures[0][t];return r?(this._targetRefTexName=t,function(t,e){K(t instanceof Ht||t instanceof te||t instanceof re);var r=t.constructor,i=t.gl,n=t.width,a=t.height,o=t.format,s=t.type,u=t.dataFormat,l=t.border,c=t.mipmaps;return new r(i,Object.assign({width:n,height:a,format:o,type:s,dataFormat:u,border:l,mipmaps:c},e))}(r,{parameters:(e={},Object(o.a)(e,10241,9728),Object(o.a)(e,10240,9728),Object(o.a)(e,10242,33071),Object(o.a)(e,10243,33071),e),pixelStore:Object(o.a)({},37440,!1)})):null}},{key:"_createFeedbackBuffers",value:function(t){var e=t.feedbackBuffers;if(this.feedbackMap){var r=this.currentIndex;for(var i in this.feedbackMap){var n=this.feedbackMap[i];if(!(n===this.targetTextureVarying||e&&e[n])){var a=this.sourceBuffers[r][i],o=a.byteLength,s=a.usage,u=a.accessor,l=new Ut(this.gl,{byteLength:o,usage:s,accessor:u});this._createdBuffers[n]&&this._createdBuffers[n].delete(),this._createdBuffers[n]=l,this.feedbackBuffers[r][n]=l}}}}},{key:"_createNewBuffer",value:function(t,e){var r=new Ut(this.gl,e);return this._createdBuffers[t]&&(this._createdBuffers[t].delete(),this._createdBuffers[t]=r),r}},{key:"_setupSwapBuffers",value:function(){if(this.feedbackMap){var t=this.currentIndex,e=(t+1)%2;for(var r in Object.assign(this.sourceBuffers[e],this.sourceBuffers[t]),Object.assign(this.feedbackBuffers[e],this.feedbackBuffers[t]),this.feedbackMap){var i=this.feedbackMap[r];i!==this.targetTextureVarying&&(this.sourceBuffers[e][r]=this.feedbackBuffers[t][i],this.feedbackBuffers[e][i]=this.sourceBuffers[t][r],K(this.feedbackBuffers[e][i]instanceof Ut))}this.transformFeedbacks[e]&&this.transformFeedbacks[e].setBuffers(this.feedbackBuffers[e])}}},{key:"_setupSwapTextures",value:function(){if(this._swapTexture&&this.targetTextureVarying){var t=this.currentIndex,e=(t+1)%2;Object.assign(this.sourceTextures[e],this.sourceTextures[t]),this.sourceTextures[e][this._swapTexture]=this.targetTextures[t],this._updateTargetTexture(this.sourceTextures[t][this._swapTexture],e)}}},{key:"_buildModel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._getShaders(t),r=e.vs,i=e.fs,n=e.modules,a=e.uniforms,o=e.inject,s=e.samplerTextureMap;this.model=new fn(this.gl,Object.assign({},t,{vs:r,fs:i,vertexCount:t.elementCount,modules:n,uniforms:a,inject:o})),this.samplerTextureMap=s,this._setupTransformFeedback(),this._setupFramebuffers(),this._setElementCount(t.elementCount)}},{key:"_setupTransformFeedback",value:function(){tt(this.feedbackBuffers[0])||(this.transformFeedbacks[0]=new kr(this.gl,{program:this.model.program,buffers:this.feedbackBuffers[0]}),this.feedbackMap&&(this.transformFeedbacks[1]=new kr(this.gl,{program:this.model.program,buffers:this.feedbackBuffers[1]})))}},{key:"_setupFramebuffers",value:function(){if(this.renderingToTexture){var t=this.targetTextures[0],e=t.width,r=t.height;if(this.framebuffers[0]=new Se(this.gl,{id:"".concat(this.id||"transform","-framebuffer-0"),width:e,height:r,attachments:Object(o.a)({},36064,this.targetTextures[0])}),this._swapTexture){var i=this.targetTextures[1];e=i.width,r=i.height,this.framebuffers[1]=new Se(this.gl,{id:"".concat(this.id||"transform","-framebuffer-1"),width:e,height:r,attachments:Object(o.a)({},36064,this.targetTextures[1])})}}}},{key:"_updateElementIDBuffer",value:function(t){if(this.hasSourceTextures||this.targetTextureVarying){var e=new Float32Array(t);e.forEach(function(t,e,r){r[e]=e}),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new Ut(this.gl,{data:e,size:1})}}},{key:"_getShaders",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._processVertexShader(t.vs),r=e.vs,i=e.uniforms,n=e.targetTextureType,a=e.inject,o=e.samplerTextureMap,s=Qi([t.inject||{},a]);return this.targetTextureType=n,{vs:r,fs:gn({version:Re(r),input:this.targetTextureVarying,inputType:n,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[_n].concat(t.modules||[]):t.modules,uniforms:i,inject:s,samplerTextureMap:o}}},{key:"_processVertexShader",value:function(t){return kn({vs:t,sourceTextureMap:this.sourceTextures[this.currentIndex],targetTextureVarying:this.targetTextureVarying,targetTexture:this.targetTextures[this.currentIndex]})}}]),t}(),Tn="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",An=[-1,-1,1,-1,-1,1,1,1],Pn=function(t){function e(t,r){var i;Object(s.a)(this,e);var n=An.map(function(t){return-1===t?0:t});return(i=St(this,Tt(e).call(this,t,Object.assign({},r,{vs:Tn,geometry:new Nr({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(An)},aTexCoord:{size:2,value:new Float32Array(n)},aCoordinate:{size:2,value:new Float32Array(n)}}})})))).setVertexCount(4),i}return Pt(e,fn),e}(),On=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.gl,i=e._cachePrograms,n=void 0!==i&&i;Object(s.a)(this,t),K(r),this.gl=r,this.vertexShaders={},this.fragmentShaders={},this.programs={},this._cachePrograms=n}return Object(u.a)(t,[{key:"delete",value:function(){return this}},{key:"getVertexShader",value:function(t,e){K("string"==typeof e),K(this._compareContexts(t,this.gl));var r=this.vertexShaders[e];return r||(r=new Ne(t,e),this.vertexShaders[e]=r),r}},{key:"getFragmentShader",value:function(t,e){K("string"==typeof e),K(this._compareContexts(t,this.gl));var r=this.fragmentShaders[e];return r||(r=new Ue(t,e),this.fragmentShaders[e]=r),r}},{key:"getProgram",value:function(t,e){K(this._compareContexts(t,this.gl)),K("string"==typeof e.vs),K("string"==typeof e.fs),K("string"==typeof e.id);var r=this._getProgramKey(e),i=this.programs[r];return i?(this._resetProgram(i),i):(i=this._createNewProgram(t,e),this._cachePrograms&&this._checkProgramProp(i)&&(i._isCached=!0,this.programs[r]=i),i)}},{key:"_getProgramKey",value:function(t){return"".concat(t.id,"-").concat(t.vs,"-").concat(t.fs)}},{key:"_checkProgramProp",value:function(t){return!t.varyings}},{key:"_createNewProgram",value:function(t,e){var r=e.vs,i=e.fs,n=this.getVertexShader(t,r),a=this.getFragmentShader(t,i);return new xr(this.gl,Object.assign({},e,{vs:n,fs:a}))}},{key:"_resetProgram",value:function(t,e){t.reset()}},{key:"_compareContexts",value:function(t,e){return(t.gl||t)===(e.gl||e)}}]),t}(),In=(function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t);var i=r.onInitialize,n=void 0===i?function(){}:i,a=r.onFinalize,o=void 0===a?function(){}:a,u=r.useDevicePixels,l=void 0===u||u,c=r.autoResizeDrawingBuffer,h=void 0===c||c;this.props={onInitialize:n,onFinalize:o},this.setProps({autoResizeDrawingBuffer:h,useDevicePixels:l}),K(e instanceof Worker),this.worker=e,this.canvas=null,this.width=null,this.height=null,this._running=!1,this._animationFrameId=null,this._resolveNextFrame=null,this._nextFramePromise=null,this._onMessage=this._onMessage.bind(this),this._onEvent=this._onEvent.bind(this),this._updateFrame=this._updateFrame.bind(this)}Object(u.a)(t,null,[{key:"createWorker",value:function(t){return function(e){t.setProps({useDevicePixels:!1,autoResizeDrawingBuffer:!1}),e.canvas=null,e.addEventListener("message",function(r){switch(r.data.command){case"start":i=r.data.opts.canvas,n=new Map,i.addEventListener=function(t,r){e.postMessage({command:"addEventListener",type:t}),n.has(t)||n.set(t,[]),n.get(t).push(r)},i.removeEventListener=function(t,r){e.postMessage({command:"removeEventListener",type:t});var i=n.get(t);i&&i.splice(i.indexOf(r),1)},i.dispatchEvent=function(t,e){var r=n.get(t);r&&r.forEach(function(t){return t(e)})},e.canvas=i,t.start(r.data.opts);break;case"stop":t.stop();break;case"resize":e.canvas.width=r.data.width,e.canvas.height=r.data.height;break;case"event":e.canvas.dispatchEvent(r.data.type,r.data.event)}var i,n})}}}]),Object(u.a)(t,[{key:"setProps",value:function(t){return"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._running?this:(this._running=!0,this.worker.onmessage=this._onMessage,st().then(function(){return t._running?(t._createAndTransferCanvas(e),t.props.onInitialize(t)):null}).then(function(){t._running&&(t._animationFrameId=mt(t._updateFrame))}),this)}},{key:"stop",value:function(){return this._running&&(gt(this._animationFrameId),this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1,this.props.onFinalize(this)),this.worker.postMessage({command:"stop"}),this}},{key:"waitForRender",value:function(){var t=this;return this._nextFramePromise||(this._nextFramePromise=new Promise(function(e){t._resolveNextFrame=e})),this._nextFramePromise}},{key:"_onMessage",value:function(t){switch(t.data.command){case"addEventListener":this.canvas.addEventListener(t.data.type,this._onEvent);break;case"removeEventListener":this.canvas.removeEventListener(t.data.type,this._onEvent)}}},{key:"_onEvent",value:function(t){var e=this.useDevicePixels&&window.devicePixelRatio||1,r=t.type,i={};for(var a in t){var o=t[a],s=Object(n.a)(o);"offsetX"!==a&&"offsetY"!==a||(o*=e),"number"!==s&&"boolean"!==s&&"string"!==s||(i[a]=o)}this.worker.postMessage({command:"event",type:r,event:i})}},{key:"_updateFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._animationFrameId=mt(this._updateFrame)}},{key:"_createAndTransferCanvas",value:function(t){var e=ut(t);e.transferControlToOffscreen||A.error("OffscreenCanvas is not available in your browser.")();var r=e.transferControlToOffscreen();this.worker.postMessage({command:"start",opts:Object.assign({},t,{canvas:r})},[r]),this.canvas=e}},{key:"_resizeCanvasDrawingBuffer",value:function(){if(this.autoResizeDrawingBuffer){var t=this.useDevicePixels&&window.devicePixelRatio||1,e=this.canvas.clientWidth*t,r=this.canvas.clientHeight*t;this.width===e&&this.height===r||(this.width=e,this.height=r,this.worker.postMessage({command:"resize",width:e,height:r}))}}}])}(),function(){function t(e,r){Object(s.a)(this,t);var i=r.id,n=void 0===i?"pass":i;this.id=n,this.gl=e,this.props={enabled:!0,screen:!1,swap:!1},Object.assign(this.props,r)}return Object(u.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(t,e){var r=this;if(this.props.enabled){var i=this.gl,n={gl:i,outputBuffer:t.writeBuffer,inputBuffer:t.readBuffer,animationProps:e,swapBuffers:function(){return t._swapFramebuffers()}};this.props.screen?(n.inputBuffer=n.outputBuffer,n.outputBuffer=Se.getDefaultFramebuffer(i)):this.props.swap&&(n.inputBuffer=t.writeBuffer,n.outputBuffer=t.readBuffer),D(i,{framebuffer:n.outputBuffer},function(){return r._renderPass(n)}),this.props.debug&&n.outputBuffer.log(1,this.id),this.props.swap&&t._swapFramebuffers()}}},{key:"_renderPass",value:function(t){t.gl,t.inputBuffer,t.outputBuffer,t.animationProps}}]),t}()),Mn=function(t){function e(t,r){return Object(s.a)(this,e),r=Array.isArray(r)?{passes:r}:r,St(this,Tt(e).call(this,t,Object.assign({id:"composite-pass"},r)))}return Pt(e,In),Object(u.a)(e,[{key:"render",value:function(){var t=this.props.passes,e=void 0===t?[]:t,r=!0,i=!1,n=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.render.apply(s,arguments)}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}}}]),e}(),Cn=function(){function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s.a)(this,t),this.gl=e,this.framebuffer1=new Se(e,{id:"multi-pass-1",stencil:!0}),this.framebuffer2=new Se(e,{id:"multi-pass-2",stencil:!0}),this.reset()}return Object(u.a)(t,[{key:"reset",value:function(){this.framebuffer1.resize(),this.framebuffer2.resize(),this.writeBuffer=this.framebuffer1,this.readBuffer=this.framebuffer2,this.maskActive=!1}},{key:"_swapFramebuffers",value:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}}]),t}(),Ln=(function(t){function e(t,r){var i;return Object(s.a)(this,e),r=Array.isArray(r)?{passes:r}:r,(i=St(this,Tt(e).call(this,t,Object.assign({id:"multi-pass"},r)))).renderState=new Cn(t,r),i}Pt(e,Mn),Object(u.a)(e,[{key:"render",value:function(t){this.renderState.reset();var e=this.props.passes,r=void 0===e?[]:e,i=!0,n=!1,a=void 0;try{for(var o,s=r[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.render(this.renderState,t)}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}return this}}])}(),function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),St(this,Tt(e).call(this,t,Object.assign({id:"clear-pass"},r)))}Pt(e,In),Object(u.a)(e,[{key:"_renderPass",value:function(t){var e=t.gl,r=this.props.clearBits,i=void 0===r?16640:r;e.clear(i)}}])}(),function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),St(this,Tt(e).call(this,t,Object.assign({id:"render-pass"},r)))}Pt(e,In),Object(u.a)(e,[{key:"_renderPass",value:function(t){var e=t.animationProps,r=this.props,i=r.models,n=void 0===i?[]:i,a=r.drawParams,o=!0,s=!1,u=void 0;try{for(var l,c=n[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){l.value.draw(Object.assign({},a,{animationProps:e}))}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}}])}(),"uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\n\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n"),jn=(function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t,Object.assign({id:"copy-pass",swap:!0},i)))).clipspace=new Pn(t,{id:"copy-pass",fs:Ln}),r}Pt(e,In),Object(u.a)(e,[{key:"_renderPass",value:function(t){var e=t.inputBuffer,r=this.props.opacity,i=void 0===r?1:r;this.clipspace.draw({uniforms:{uDiffuseSampler:e,uOpacity:i},parameters:{depthWrite:!1,depthTest:!1}})}}])}(),"uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n"),zn=(function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,e),r=St(this,Tt(e).call(this,t,Object.assign({id:"texture-pass"},i)));var n=i.texture,a=i.opacity,o=void 0===a?1:a;return r.clipspace=new Pn(t,{id:"texture-pass",fs:jn,uniforms:{uDiffuseSampler:n,uOpacity:o}}),r}Pt(e,In),Object(u.a)(e,[{key:"_renderPass",value:function(){this.clipspace.draw({parameters:{depthWrite:!1,depthTest:!1}})}}])}(),{boolean:{validate:function(t,e){return!0}},number:{validateType:function(t,e){return"value"in e&&(!("max"in e)||Number.isFinite(e.max))&&(!("min"in e)||Number.isFinite(e.min))},validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}}});function Rn(t,e){switch(Fn(e)){case"object":return function(t){var e=t.type;(zn[e]||{}).typeValidator;return t}(e=function(t,e){if(!("type"in e))return"value"in e?Object.assign({name:t,type:Fn(e.value)},e):{name:t,type:"object",value:e};return Object.assign({name:t},e)}(t,e));case"array":return function(t,e){if(/color/i.test(t)&&(3===e.length||4===e.length))return{name:t,type:"color",value:e};return{name:t,type:"array",value:e}}(t,e);case"boolean":return{name:t,type:"boolean",value:e};case"number":return function(t,e){var r=/radius|scale|width|height|pixel|size|miter/i.test(t)&&/^((?!scale).)*$/.test(t)?100:1;return{name:t,type:"number",max:Math.max(e,r),min:Math.min(e,0),value:e}}(t,e);case"function":return{name:t,type:"function",value:e};default:return{name:t,type:"unknown",value:e}}}function Fn(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":null===t?"null":Object(n.a)(t)}function Dn(t){if(!t.normalized){if(t.normalized=!0,t.uniforms){var e=function(t){for(var e={},r={},i=0,n=Object.entries(t);i<n.length;i++){var a=C(n[i],2),o=a[0],s=Rn(o,a[1]);e[o]=s,r[o]=s.value}return{propTypes:e,defaultProps:r}}(t.uniforms).propTypes;t.uniforms=e}t.uniforms&&!t.getUniforms&&(t.getUniforms=function(t,e){var r={};if(void 0===e){for(var i in t.uniforms)r[i]=t.uniforms[i].value;return r}for(var n in e)r[n]=e[n];return r}.bind(null,t))}return t}var Bn=function(t){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),St(this,Tt(e).call(this,t,Object.assign({swap:!0},r)))}return Pt(e,In),Object(u.a)(e,[{key:"_renderPass",value:function(t){var e=t.inputBuffer;t.swapBuffers;this.props.model.setUniforms(this.props),this.props.model.draw({uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}();!function(t){function e(t,r){var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s.a)(this,e);var a="".concat(r.name,"-pass");Dn(r);var o=function(t,e,r,i){if(e.filter||e.sampler){var n=Gn(e),a=new Bn(t,{id:r,model:Nn(t,e,n,r,i),uniforms:null});return[a]}var o=e.passes||[];return o.map(function(n){var a=Gn(e,n),s="".concat(r,"-").concat(o.length+1);return new Bn(t,Object.assign({id:s,model:Nn(t,e,a,s,i),uniforms:n.uniforms},i))})}(t,r,a,n);return(i=St(this,Tt(e).call(this,t,Object.assign({id:a,passes:o},n)))).module=r,i}Pt(e,Mn),Object(u.a)(e,[{key:"_renderPass",value:function(t){var e=t.inputBuffer,r=t.swapBuffers,i=!0,n=!0,a=!1,o=void 0;try{for(var s,u=this.module.passes[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;i||r(),i=!1,l.uniforms&&l.model.setUniforms(l.uniforms),l.model.draw({uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}}}])}();function Nn(t,e,r,i,n){var a=new Pn(t,{id:i,fs:r,modules:[e]}),o=Object.assign(e.getUniforms(),e.getUniforms(n));return a.setUniforms(o),a}var Un=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n")},Vn=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n")};function Gn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(e.filter){var r="string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor");return Un(r)}if(e.sampler){var i="string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor");return Vn(i)}return null}var qn={x:[2,0,1],y:[0,1,2],z:[1,2,0]},Zn=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("truncated-code-geometry"):r,n=function(t){for(var e=t.bottomRadius,r=void 0===e?0:e,i=t.topRadius,n=void 0===i?0:i,a=t.height,o=void 0===a?1:a,s=t.nradial,u=void 0===s?10:s,l=t.nvertical,c=void 0===l?10:l,h=t.verticalAxis,p=void 0===h?"y":h,f=t.topCap,d=void 0!==f&&f,v=t.bottomCap,m=void 0!==v&&v,g=(d?2:0)+(m?2:0),y=(u+1)*(c+1+g),_=Math.atan2(r-n,o),b=Math.sin,x=Math.cos,w=Math.PI,k=x(_),E=b(_),S=d?-2:0,T=c+(m?2:0),A=u+1,P=new Uint16Array(u*(c+g)*6),O=qn[p],I=new Float32Array(3*y),M=new Float32Array(3*y),C=new Float32Array(2*y),L=0,j=0,z=S;z<=T;z++){var R=z/c,F=o*R,D=void 0;z<0?(F=0,R=1,D=r):z>c?(F=o,R=1,D=n):D=r+z/c*(n-r),-2!==z&&z!==c+2||(D=0,R=0),F-=o/2;for(var B=0;B<A;B++){var N=b(B*w*2/u),U=x(B*w*2/u);I[L+O[0]]=N*D,I[L+O[1]]=F,I[L+O[2]]=U*D,M[L+O[0]]=z<0||z>c?0:N*k,M[L+O[1]]=z<0?-1:z>c?1:E,M[L+O[2]]=z<0||z>c?0:U*k,C[j+0]=B/u,C[j+1]=R,j+=2,L+=3}}for(var V=0;V<c+g;V++)for(var G=0;G<u;G++){var q=6*(V*u+G);P[q+0]=A*(V+0)+0+G,P[q+1]=A*(V+0)+1+G,P[q+2]=A*(V+1)+1+G,P[q+3]=A*(V+0)+0+G,P[q+4]=A*(V+1)+1+G,P[q+5]=A*(V+1)+0+G}return{indices:P,attributes:{POSITION:{size:3,value:I},NORMAL:{size:3,value:M},TEXCOORD_0:{size:2,value:C}}}}(t),a=n.indices,o=n.attributes;return St(this,Tt(e).call(this,W({},t,{id:i,indices:a,attributes:W({},o,t.attributes)})))}return Pt(e,Nr),e}();!function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("cone-geometry"):r,n=t.radius,a=void 0===n?1:n,o=t.cap,u=void 0===o||o;return St(this,Tt(e).call(this,W({},t,{id:i,topRadius:0,topCap:Boolean(u),bottomCap:Boolean(u),bottomRadius:a})))}Pt(e,Zn)}();var Xn=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Wn=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Hn=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Yn=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Kn={POSITION:{size:3,value:new Float32Array(Wn)},NORMAL:{size:3,value:new Float32Array(Hn)},TEXCOORD_0:{size:2,value:new Float32Array(Yn)}},Jn=(function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("cube-geometry"):r;return St(this,Tt(e).call(this,W({},t,{id:i,indices:{size:1,value:new Uint16Array(Xn)},attributes:W({},Kn,t.attributes)})))}Pt(e,Nr)}(),function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("cylinder-geometry"):r,n=t.radius,a=void 0===n?1:n;return St(this,Tt(e).call(this,W({},t,{id:i,bottomRadius:a,topRadius:a})))}return Pt(e,Zn),e}()),Qn=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],$n=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];!function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("ico-sphere-geometry"):r,n=function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).iterations,e=void 0===t?0:t,r=Math.PI,i=2*r,n=[].concat(Qn),a=[].concat($n);n.push(),a.push();for(var o=function(){var t={};return function(e,r){var i=(e*=3)<(r*=3)?e:r,a=e>r?e:r,o="".concat(i,"|").concat(a);if(o in t)return t[o];var s=n[e],u=n[e+1],l=n[e+2],c=n[r],h=n[r+1],p=n[r+2],f=(s+c)/2,d=(u+h)/2,v=(l+p)/2,m=Math.sqrt(f*f+d*d+v*v);return f/=m,d/=m,v/=m,n.push(f,d,v),t[o]=n.length/3-1}}(),s=0;s<e;s++){for(var u=[],l=0;l<a.length;l+=3){var c=o(a[l+0],a[l+1]),h=o(a[l+1],a[l+2]),p=o(a[l+2],a[l+0]);u.push(p,a[l+0],c,c,a[l+1],h,h,a[l+2],p,c,h,p)}a=u}for(var f=new Array(3*a.length),d=new Array(2*a.length),v=a.length-3;v>=0;v-=3){var m=a[v+0],g=a[v+1],y=a[v+2],_=3*m,b=3*g,x=3*y,w=2*m,k=2*g,E=2*y,S=n[_+0],T=n[_+1],A=n[_+2],P=Math.acos(A/Math.sqrt(S*S+T*T+A*A)),O=Math.atan2(T,S)+r,I=P/r,M=1-O/i,C=n[b+0],L=n[b+1],j=n[b+2],z=Math.acos(j/Math.sqrt(C*C+L*L+j*j)),R=Math.atan2(L,C)+r,F=z/r,D=1-R/i,B=n[x+0],N=n[x+1],U=n[x+2],V=Math.acos(U/Math.sqrt(B*B+N*N+U*U)),G=Math.atan2(N,B)+r,q=V/r,Z=1-G/i,X=[B-C,N-L,U-j],W=[S-C,T-L,A-j],H=new pi(X).cross(W).normalize(),Y=void 0;(0===M||0===D||0===Z)&&(0===M||M>.5)&&(0===D||D>.5)&&(0===Z||Z>.5)&&(n.push(n[_+0],n[_+1],n[_+2]),Y=n.length/3-1,a.push(Y),d[2*Y+0]=1,d[2*Y+1]=I,f[3*Y+0]=H.x,f[3*Y+1]=H.y,f[3*Y+2]=H.z,n.push(n[b+0],n[b+1],n[b+2]),Y=n.length/3-1,a.push(Y),d[2*Y+0]=1,d[2*Y+1]=F,f[3*Y+0]=H.x,f[3*Y+1]=H.y,f[3*Y+2]=H.z,n.push(n[x+0],n[x+1],n[x+2]),Y=n.length/3-1,a.push(Y),d[2*Y+0]=1,d[2*Y+1]=q,f[3*Y+0]=H.x,f[3*Y+1]=H.y,f[3*Y+2]=H.z),f[_+0]=f[b+0]=f[x+0]=H.x,f[_+1]=f[b+1]=f[x+1]=H.y,f[_+2]=f[b+2]=f[x+2]=H.z,d[w+0]=M,d[w+1]=I,d[k+0]=D,d[k+1]=F,d[E+0]=Z,d[E+1]=q}return{indices:{size:1,value:new Uint16Array(a)},attributes:{POSITION:{size:3,value:new Float32Array(n)},NORMAL:{size:3,value:new Float32Array(f)},TEXCOORD_0:{size:2,value:new Float32Array(d)}}}}(t),a=n.indices,o=n.attributes;return St(this,Tt(e).call(this,W({},t,{id:i,indices:a,attributes:W({},o,t.attributes)})))}Pt(e,Nr)}();!function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("plane-geometry"):r,n=function(t){var e=t.type,r=void 0===e?"x,y":e,i=t.offset,n=void 0===i?0:i,a=t.flipCull,o=void 0!==a&&a,s=t.unpack,u=void 0!==s&&s,l=r.split(","),c=t["".concat(l[0],"len")],h=t["".concat(l[1],"len")],p=t["n".concat(l[0])]||1,f=t["n".concat(l[1])]||1,d=(p+1)*(f+1),v=new Float32Array(3*d),m=new Float32Array(3*d),g=new Float32Array(2*d);o&&(c=-c);for(var y=0,_=0,b=0;b<=f;b++)for(var x=0;x<=p;x++){var w=x/p,k=b/f;switch(g[y+0]=o?1-w:w,g[y+1]=k,r){case"x,y":v[_+0]=c*w-.5*c,v[_+1]=h*k-.5*h,v[_+2]=n,m[_+0]=0,m[_+1]=0,m[_+2]=o?1:-1;break;case"x,z":v[_+0]=c*w-.5*c,v[_+1]=n,v[_+2]=h*k-.5*h,m[_+0]=0,m[_+1]=o?1:-1,m[_+2]=0;break;case"y,z":v[_+0]=n,v[_+1]=c*w-.5*c,v[_+2]=h*k-.5*h,m[_+0]=o?1:-1,m[_+1]=0,m[_+2]=0}y+=2,_+=3}for(var E=p+1,S=new Uint16Array(p*f*6),T=0;T<f;T++)for(var A=0;A<p;A++){var P=6*(T*p+A);S[P+0]=(T+0)*E+A,S[P+1]=(T+1)*E+A,S[P+2]=(T+0)*E+A+1,S[P+3]=(T+1)*E+A,S[P+4]=(T+1)*E+A+1,S[P+5]=(T+0)*E+A+1}var O={indices:{size:1,value:S},attributes:{POSITION:{size:3,value:v},NORMAL:{size:3,value:m},TEXCOORD_0:{size:2,value:g}}};return u?function(t){var e=t.indices,r=t.attributes;if(!e)return t;for(var i=r.POSITION,n=r.NORMAL,a=r.TEXCOORD_0,o=new Float32Array(3*e.length),s=new Float32Array(3*e.length),u=new Float32Array(2*e.length),l=0;l<e.length;++l){var c=e[l];o[3*l+0]=i[3*c+0],o[3*l+1]=i[3*c+1],o[3*l+2]=i[3*c+2],s[3*l+0]=n[3*c+0],s[3*l+1]=n[3*c+1],s[3*l+2]=n[3*c+2],u[2*l+0]=a[2*c+0],u[2*l+1]=a[2*c+1]}return{attributes:{POSITION:o,NORMAL:s,TEXCOORD_0:u}}}(O):O}(t),a=n.indices,o=n.attributes;return St(this,Tt(e).call(this,W({},t,{id:i,indices:a,attributes:W({},o,t.attributes)})))}Pt(e,Nr)}();!function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var r=t.id,i=void 0===r?Q("sphere-geometry"):r,n=function(t){var e=t.nlat,r=void 0===e?10:e,i=t.nlong,n=void 0===i?10:i,a=t.radius,o=void 0===a?1:a,s=Math.PI-0,u=2*Math.PI-0,l=(r+1)*(n+1);if("number"==typeof o){var c=o;o=function(t,e,r,i,n){return c}}for(var h=new Float32Array(3*l),p=new Float32Array(3*l),f=new Float32Array(2*l),d=new Uint16Array(r*n*6),v=0;v<=r;v++)for(var m=0;m<=n;m++){var g=m/n,y=v/r,_=m+v*(n+1),b=2*_,x=3*_,w=u*g,k=s*y,E=Math.sin(w),S=Math.cos(w),T=Math.sin(k),A=Math.cos(k),P=S*T,O=A,I=E*T,M=o(P,O,I,g,y);h[x+0]=M*P,h[x+1]=M*O,h[x+2]=M*I,p[x+0]=P,p[x+1]=O,p[x+2]=I,f[b+0]=g,f[b+1]=1-y}for(var C=r+1,L=0;L<r;L++)for(var j=0;j<n;j++){var z=6*(L*n+j);d[z+0]=j*C+L,d[z+1]=j*C+L+1,d[z+2]=(j+1)*C+L,d[z+3]=(j+1)*C+L,d[z+4]=j*C+L+1,d[z+5]=(j+1)*C+L+1}return{indices:{size:1,value:d},attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:p},TEXCOORD_0:{size:2,value:f}}}}(t),a=n.indices,o=n.attributes;return St(this,Tt(e).call(this,W({},t,{id:i,indices:a,attributes:W({},o,t.attributes)})))}Pt(e,Nr)}();var ta={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},ea=function(t){function e(t){var r;return Object(s.a)(this,e),r=St(this,Tt(e).call(this,t)),t=Object.assign({},ta,t),Object.assign(Et(r),t),r}return Pt(e,Ur),e}();!function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}Pt(e,Ur)}();function ra(t,e){return t.length===e&&t.every(Number.isFinite)}function ia(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function na(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function aa(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function oa(t,e){return t[0]=-e[0],t[1]=-e[1],t}var sa=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},ua=(function(){var t=function(){var t=new ni(2);return ni!=Float32Array&&(t[0]=0,t[1]=0),t}()}(),function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(s.a)(this,e),t=St(this,Tt(e).call(this)),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i),t}return Pt(e,ri),Object(u.a)(e,[{key:"cross",value:function(t){return function(t,e,r){var i=e[0]*r[1]-e[1]*r[0];t[0]=t[1]=0,t[2]=i}(this,this,t),this.check()}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"operation",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t.apply(void 0,[this,this].concat(r)),this.check()}},{key:"ELEMENTS",get:function(){return 2}}]),e}()),la=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return Object(s.a)(this,e),t=St(this,Tt(e).call(this)),Array.isArray(r)&&1===arguments.length?t.copy(r):t.set(r,i,n,a),t}return Pt(e,ri),Object(u.a)(e,[{key:"applyMatrix4",value:function(t){return t.transformVector(this,this),this}},{key:"ELEMENTS",get:function(){return 4}},{key:"z",get:function(){return this[2]},set:function(t){return this[2]=Gr(t)}},{key:"w",get:function(){return this[3]},set:function(t){return this[3]=Gr(t)}}]),e}();function ca(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=r*s-i*o,_=r*u-n*o,b=r*l-a*o,x=i*u-n*s,w=i*l-a*s,k=n*l-a*u,E=c*v-h*d,S=c*m-p*d,T=c*g-f*d,A=h*m-p*v,P=h*g-f*v,O=p*g-f*m,I=y*O-_*P+b*A+x*T-w*S+k*E;return I?(I=1/I,t[0]=(s*O-u*P+l*A)*I,t[1]=(n*P-i*O-a*A)*I,t[2]=(v*k-m*w+g*x)*I,t[3]=(p*w-h*k-f*x)*I,t[4]=(u*T-o*O-l*S)*I,t[5]=(r*O-n*T+a*S)*I,t[6]=(m*b-d*k-g*_)*I,t[7]=(c*k-p*b+f*_)*I,t[8]=(o*P-s*T+l*E)*I,t[9]=(i*T-r*P-a*E)*I,t[10]=(d*w-v*b+g*y)*I,t[11]=(h*b-c*w-f*y)*I,t[12]=(s*S-o*A-u*E)*I,t[13]=(r*A-i*S+n*E)*I,t[14]=(v*_-d*x-m*y)*I,t[15]=(c*x-h*_+p*y)*I,t):null}function ha(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*i+b*s+x*h+w*v,t[1]=_*n+b*u+x*p+w*m,t[2]=_*a+b*l+x*f+w*g,t[3]=_*o+b*c+x*d+w*y,_=r[4],b=r[5],x=r[6],w=r[7],t[4]=_*i+b*s+x*h+w*v,t[5]=_*n+b*u+x*p+w*m,t[6]=_*a+b*l+x*f+w*g,t[7]=_*o+b*c+x*d+w*y,_=r[8],b=r[9],x=r[10],w=r[11],t[8]=_*i+b*s+x*h+w*v,t[9]=_*n+b*u+x*p+w*m,t[10]=_*a+b*l+x*f+w*g,t[11]=_*o+b*c+x*d+w*y,_=r[12],b=r[13],x=r[14],w=r[15],t[12]=_*i+b*s+x*h+w*v,t[13]=_*n+b*u+x*p+w*m,t[14]=_*a+b*l+x*f+w*g,t[15]=_*o+b*c+x*d+w*y,t}function pa(t,e,r){var i,n,a,o,s,u,l,c,h,p,f,d,v=r[0],m=r[1],g=r[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*v+s*m+h*g+e[12],t[13]=n*v+u*m+p*g+e[13],t[14]=a*v+l*m+f*g+e[14],t[15]=o*v+c*m+d*g+e[15]),t}function fa(t,e,r){var i=r[0],n=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function da(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+l*i,t[5]=o*n+c*i,t[6]=s*n+h*i,t[7]=u*n+p*i,t[8]=l*n-a*i,t[9]=c*n-o*i,t[10]=h*n-s*i,t[11]=p*n-u*i,t}function va(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+l*i,t[1]=o*n+c*i,t[2]=s*n+h*i,t[3]=u*n+p*i,t[4]=l*n-a*i,t[5]=c*n-o*i,t[6]=h*n-s*i,t[7]=p*n-u*i,t}function ma(t,e,r,i,n){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(a=1/(i-n),t[10]=(n+i)*a,t[14]=2*n*i*a):(t[10]=-1,t[14]=-2*i),t}function ga(t,e,r,i){var n,a,o,s,u,l,c,h,p,f,d=e[0],v=e[1],m=e[2],g=i[0],y=i[1],_=i[2],b=r[0],x=r[1],w=r[2];return Math.abs(d-b)<ii&&Math.abs(v-x)<ii&&Math.abs(m-w)<ii?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(c=d-b,h=v-x,p=m-w,n=y*(p*=f=1/Math.sqrt(c*c+h*h+p*p))-_*(h*=f),a=_*(c*=f)-g*p,o=g*h-y*c,(f=Math.sqrt(n*n+a*a+o*o))?(n*=f=1/f,a*=f,o*=f):(n=0,a=0,o=0),s=h*o-p*a,u=p*n-c*o,l=c*a-h*n,(f=Math.sqrt(s*s+u*u+l*l))?(s*=f=1/f,u*=f,l*=f):(s=0,u=0,l=0),t[0]=n,t[1]=s,t[2]=c,t[3]=0,t[4]=a,t[5]=u,t[6]=h,t[7]=0,t[8]=o,t[9]=l,t[10]=p,t[11]=0,t[12]=-(n*d+a*v+o*m),t[13]=-(s*d+u*v+l*m),t[14]=-(c*d+h*v+p*m),t[15]=1,t)}function ya(t,e){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=e[0],_=e[1],b=e[2],x=e[3],w=e[4],k=e[5],E=e[6],S=e[7],T=e[8],A=e[9],P=e[10],O=e[11],I=e[12],M=e[13],C=e[14],L=e[15];return Math.abs(r-y)<=ii*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-_)<=ii*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(n-b)<=ii*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(a-x)<=ii*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-w)<=ii*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-k)<=ii*Math.max(1,Math.abs(s),Math.abs(k))&&Math.abs(u-E)<=ii*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-S)<=ii*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=ii*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(h-A)<=ii*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-P)<=ii*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(f-O)<=ii*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(d-I)<=ii*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(v-M)<=ii*Math.max(1,Math.abs(v),Math.abs(M))&&Math.abs(m-C)<=ii*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(g-L)<=ii*Math.max(1,Math.abs(g),Math.abs(L))}function _a(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,t}!function(){var t=function(){var t=new ni(4);return ni!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();var ba=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var xa=function(t){function e(){for(var t,r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return Object(s.a)(this,e),t=St(this,Tt(e).call(this)),Array.isArray(i[0])&&1===arguments.length?t.copy(i[0]):t.identity(),t}return Pt(e,ti),Object(u.a)(e,[{key:"setRowMajor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,d=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=t,this[1]=n,this[2]=u,this[3]=p,this[4]=e,this[5]=a,this[6]=l,this[7]=f,this[8]=r,this[9]=o,this[10]=c,this[11]=d,this[12]=i,this[13]=s,this[14]=h,this[15]=v,this.check()}},{key:"setColumnMajor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,d=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,v=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return this[0]=t,this[1]=e,this[2]=r,this[3]=i,this[4]=n,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=l,this[10]=c,this[11]=h,this[12]=p,this[13]=f,this[14]=d,this[15]=v,this.check()}},{key:"copy",value:function(t){return this.setColumnMajor.apply(this,Object(a.a)(t))}},{key:"set",value:function(){return this.setColumnMajor.apply(this,arguments)}},{key:"getElement",value:function(t,e){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this[t][e]:this[e][t]}},{key:"setElement",value:function(t,e,r){return arguments.length>3&&void 0!==arguments[3]&&arguments[3]?this[t][e]=Gr(r):this[e][t]=Gr(r),this}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],i=t[2],n=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],v=t[14],m=t[15],(e*o-r*a)*(h*m-p*v)-(e*s-i*a)*(c*m-p*d)+(e*u-n*a)*(c*v-h*d)+(r*s-i*o)*(l*m-p*f)-(r*u-n*o)*(l*v-h*f)+(i*u-n*s)*(l*d-c*f);var t,e,r,i,n,a,o,s,u,l,c,h,p,f,d,v,m}},{key:"identity",value:function(){return this.copy(ba)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,s=i+i,u=n+n,l=r*o,c=i*o,h=i*s,p=n*o,f=n*s,d=n*u,v=a*o,m=a*s,g=a*u;t[0]=1-h-d,t[1]=c+g,t[2]=p-m,t[3]=0,t[4]=c-g,t[5]=1-l-d,t[6]=f+v,t[7]=0,t[8]=p+m,t[9]=f-v,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){return function(t,e,r,i,n,a,o){var s=1/(r-e),u=1/(n-i),l=1/(a-o);t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(n+i)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0}(this,t.left,t.right,t.bottom,t.top,t.near,t.far),this.check()}},{key:"lookAt",value:function(t){var e=t.eye,r=t.center,i=void 0===r?[0,0,0]:r,n=t.up;return ga(this,e,i,void 0===n?[0,1,0]:n),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,i=t.bottom,n=t.top,a=t.near,o=void 0===a?.1:a,s=t.far;return function(t,e,r,i,n,a,o){var s=1/(e-r),u=1/(i-n),l=1/(a-o);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*u,t[14]=(o+a)*l,t[15]=1}(this,e,r,i,n,o,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var r=t.fovy,i=void 0===r?45*Math.PI/180:r,n=t.aspect,a=void 0===n?1:n,o=t.focalDistance,s=void 0===o?1:o,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?500:c;if(i>2*Math.PI)throw Error("radians");var p=i/2,f=s*Math.tan(p),d=f*a;return(new e).ortho({left:-d,right:d,bottom:-f,top:f,near:l,far:h})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=t.fov,i=void 0===r?45*Math.PI/180:r,n=t.aspect,a=void 0===n?1:n,o=t.near,s=void 0===o?.1:o,u=t.far,l=void 0===u?500:u;if((e=e||i)>2*Math.PI)throw Error("radians");return ma(this,e,a,s,l),this.check()}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return ca(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return ha(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return ha(this,this,t),this.check()}},{key:"rotateX",value:function(t){return da(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-l*i,t[1]=o*n-c*i,t[2]=s*n-h*i,t[3]=u*n-p*i,t[8]=a*i+l*n,t[9]=o*i+c*n,t[10]=s*i+h*n,t[11]=u*i+p*n}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return va(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=C(t,3),r=e[0],i=e[1],n=e[2];return this.rotateX(r).rotateY(i).rotateZ(n)}},{key:"rotateAxis",value:function(t,e){return function(t,e,r,i){var n,a,o,s,u,l,c,h,p,f,d,v,m,g,y,_,b,x,w,k,E,S,T,A,P=i[0],O=i[1],I=i[2],M=Math.sqrt(P*P+O*O+I*I);M<ii||(P*=M=1/M,O*=M,I*=M,n=Math.sin(r),o=1-(a=Math.cos(r)),s=e[0],u=e[1],l=e[2],c=e[3],h=e[4],p=e[5],f=e[6],d=e[7],v=e[8],m=e[9],g=e[10],y=e[11],_=P*P*o+a,b=O*P*o+I*n,x=I*P*o-O*n,w=P*O*o-I*n,k=O*O*o+a,E=I*O*o+P*n,S=P*I*o+O*n,T=O*I*o-P*n,A=I*I*o+a,t[0]=s*_+h*b+v*x,t[1]=u*_+p*b+m*x,t[2]=l*_+f*b+g*x,t[3]=c*_+d*b+y*x,t[4]=s*w+h*k+v*E,t[5]=u*w+p*k+m*E,t[6]=l*w+f*k+g*E,t[7]=c*w+d*k+y*E,t[8]=s*S+h*T+v*A,t[9]=u*S+p*T+m*A,t[10]=l*S+f*T+g*A,t[11]=c*S+d*T+y*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?fa(this,this,t):fa(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return pa(this,this,t),this.check()}},{key:"transformVector2",value:function(t,e){return function(t,e,r){var i=e[0],n=e[1];t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13]}(e=e||new ua,t,this),ra(e,2),e}},{key:"transformVector3",value:function(t,e){return function(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o}(e=e||new pi,t,this),ra(e,3),e}},{key:"transformVector4",value:function(t,e){return _a(e=e||new la,t,this),ra(e,4),e.check()}},{key:"transformVector",value:function(t,e){switch(t.length){case 2:return this.transformVector2(t,e);case 3:return this.transformVector3(t,e);case 4:return this.transformVector4(t,e);default:throw new Error("Illegal vector")}}},{key:"transformDirection",value:function(t,e){return this._transformVector(t,e,0)}},{key:"transformPoint",value:function(t,e){return this._transformVector(t,e,1)}},{key:"_transformVector",value:function(t,e,r){switch(t.length){case 2:_a(e=e||new ua,[t[0],t[1],0,r],this),e.length=2,ra(e,2);break;case 3:_a(e=e||new pi,[t[0],t[1],t[2],r],this),e.length=3,ra(e,3);break;case 4:if(Boolean(r)!==Boolean(t[3]))throw new Error("math.gl: Matrix4.transformPoint - invalid vector");_a(e=e||new la,t,this),ra(e,4);break;default:throw new Error("Illegal vector")}return e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"ELEMENTS",get:function(){return 16}}]),e}(),wa=function(){function t(e){Object(s.a)(this,t);var r=e.id;this.id=r||Q(this.constructor.name),this.display=!0,this.position=new pi,this.rotation=new pi,this.scale=new pi(1,1,1),this.matrix=new xa,this.userData={},this.props={},this._setScenegraphNodeProps(e)}return Object(u.a)(t,[{key:"delete",value:function(){}},{key:"setProps",value:function(t){return this._setScenegraphNodeProps(t),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"setPosition",value:function(t){return K(3===t.length,"setPosition requires vector argument"),this.position=t,this}},{key:"setRotation",value:function(t){return K(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}},{key:"setScale",value:function(t){return K(3===t.length,"setScale requires vector argument"),this.scale=t,this}},{key:"setMatrix",value:function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?this.matrix.copy(t):this.matrix=t}},{key:"setMatrixComponents",value:function(t){var e=t.position,r=t.rotation,i=t.scale,n=t.update,a=void 0===n||n;return e&&this.setPosition(e),r&&this.setRotation(r),i&&this.setScale(i),a&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var t=this.position,e=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(r),this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.position,r=t.rotation,i=t.scale;return e&&this.setPosition(e),r&&this.setRotation(r),i&&this.setScale(i),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(t,e){K(t),e=e||this.matrix;var r=new xa(t).multiplyRight(e),i=r.invert(),n=i.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:r,worldInverseMatrix:i,worldInverseTransposeMatrix:n}}},{key:"transform",value:function(){if(this.parent){var t=this.parent;this.endPosition.set(this.position.add(t.endPosition)),this.endRotation.set(this.rotation.add(t.endRotation)),this.endScale.set(this.scale.add(t.endScale))}else this.endPosition.set(this.position),this.endRotation.set(this.rotation),this.endScale.set(this.scale);for(var e=this.children,r=0;r<e.length;++r)e[r].transform();return this}},{key:"_setScenegraphNodeProps",value:function(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setPosition(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setPosition(t.matrix),Object.assign(this.props,t)}}]),t}(),ka=(function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var i=(r=Array.isArray(r)?{children:r}:r).children,n=void 0===i?[]:i;return n.every(function(t){return K(t instanceof wa)}),(t=St(this,Tt(e).call(this,r))).children=n,t}Pt(e,wa),Object(u.a)(e,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var i=0,n=e;i<n.length;i++){var o=n[i];Array.isArray(o)?this.add.apply(this,Object(a.a)(o)):this.children.push(o)}return this}},{key:"remove",value:function(t){var e=this.children,r=e.indexOf(t);return r>-1&&e.splice(r,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach(function(t){return t.delete()}),this.removeAll(),Ve(Tt(e.prototype),"delete",this).call(this)}},{key:"traverse",value:function(t){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).worldMatrix,i=void 0===r?new xa:r,n=new xa(i).multiplyRight(this.matrix),a=!0,o=!1,s=void 0;try{for(var u,l=this.children[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;c instanceof e?c.traverse(t,{worldMatrix:n}):t(c,{worldMatrix:n})}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}}},{key:"traverseReverse",value:function(t,e){return A.warn("traverseReverse is not reverse")(),this.traverse(t,e)}}])}(),function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,i))).onBeforeRender=null,r.AfterRender=null,t instanceof fn?(r.model=t,r._setModelNodeProps(i)):r.model=new fn(t,i),r.managedResources=i.managedResources||[],r}Pt(e,wa),Object(u.a)(e,[{key:"setProps",value:function(t){return Ve(Tt(e.prototype),"setProps",this).call(this,t),this._setModelNodeProps(t),this}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(function(t){return t.delete()}),this.managedResources=[]}},{key:"draw",value:function(){var t;return(t=this.model).draw.apply(t,arguments)}},{key:"setUniforms",value:function(){var t;return(t=this.model).setUniforms.apply(t,arguments),this}},{key:"setAttributes",value:function(){var t;return(t=this.model).setAttributes.apply(t,arguments),this}},{key:"updateModuleSettings",value:function(){var t;return(t=this.model).updateModuleSettings.apply(t,arguments),this}},{key:"_setModelNodeProps",value:function(t){this.model.setProps(t)}}])}(),function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,e),(t=St(this,Tt(e).call(this,r))).projectionMatrix=r.projectionMatrix,t}Pt(e,wa)}(),{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null});function Ea(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.fround(t),n=t-i;return e[r]=i,e[r+1]=n,e}var Sa="uniform float ONE;\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",Ta="".concat(Sa,"\n").concat("const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09);\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09);\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10);\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11);\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12);\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13);\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14);\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15);\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\nvec2 exp_fp64(vec2 a) {\n\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n\n\n\n\n\n  s = sum_fp64(s, t);\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n\n\n\n\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n"),Aa={ONE:1};var Pa={name:"fp64",vs:Ta,fs:null,fp64ify:Ea,fp64LowPart:function(t){return t-Math.fround(t)},fp64ifyMatrix4:function(t){for(var e=new Float32Array(32),r=0;r<4;++r)for(var i=0;i<4;++i){var n=4*r+i;Ea(t[4*i+r],e,2*n)}return e},getUniforms:function(){return Object.assign({},Aa)}},Oa=("".concat(Sa),{pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingThreshold:1,pickingActive:!1});var Ia={name:"picking",vs:"uniform vec3 picking_uSelectedColor;\nuniform float picking_uThreshold;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    abs(vertexColor.r - picking_uSelectedColor.r) < picking_uThreshold &&\n    abs(vertexColor.g - picking_uSelectedColor.g) < picking_uThreshold &&\n    abs(vertexColor.b - picking_uSelectedColor.b) < picking_uThreshold;\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  picking_vRGBcolor_Aselected.a =\n    float(isVertexPicked(pickingColor));\n  picking_vRGBcolor_Aselected.rgb = pickingColor * COLOR_SCALE;\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\nvec4 picking_filterHighlightColor(vec4 color) {\n  bool selected = bool(picking_vRGBcolor_Aselected.a);\n\n  if (selected) {\n    vec4 highLightColor = picking_uHighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  vec3 pickingColor = picking_vRGBcolor_Aselected.rgb;\n  if (picking_uActive && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return picking_uActive ? vec4(pickingColor, 1.0) : color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oa,e={};if(void 0!==t.pickingSelectedColor)if(null===t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{var r=[t.pickingSelectedColor[0],t.pickingSelectedColor[1],t.pickingSelectedColor[2]];e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=r}return void 0!==t.pickingHighlightColor&&(e.picking_uHighlightColor=t.pickingHighlightColor),void 0!==t.pickingThreshold&&(e.picking_uThreshold=t.pickingThreshold),void 0!==t.pickingActive&&(e.picking_uActive=t.pickingActive?1:0),e}},Ma="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",Ca={name:"lights",vs:Ma,fs:Ma,getUniforms:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:La;if("lightSources"in e){var r=e.lightSources||{},i=r.ambientLight,n=r.pointLights,a=r.directionalLights,o=i||n&&n.length>0||a&&a.length>0;return o?Object.assign({},function(t){var e=t.ambientLight,r=t.pointLights,i=void 0===r?[]:r,n=t.directionalLights,a=void 0===n?[]:n,o={};o["lighting_uAmbientLight.color"]=e?ja(e):[0,0,0];return i.forEach(function(t,e){o["lighting_uPointLight[".concat(e,"].color")]=ja(t),o["lighting_uPointLight[".concat(e,"].position")]=t.position,o["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation}),o.lighting_uPointLightCount=i.length,a.forEach(function(t,e){o["lighting_uDirectionalLight[".concat(e,"].color")]=ja(t),o["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction}),o.lighting_uDirectionalLightCount=a.length,o}({ambientLight:i,pointLights:n,directionalLights:a}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){var s={pointLights:[],directionalLights:[]},u=!0,l=!1,c=void 0;try{for(var h,p=(e.lights||[])[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;switch(f.type){case"ambient":s.ambientLight=f;break;case"directional":s.directionalLights.push(f);break;case"point":s.pointLights.push(f)}}}catch(t){l=!0,c=t}finally{try{u||null==p.return||p.return()}finally{if(l)throw c}}return t({lightSources:s})}return{}},defines:{MAX_LIGHTS:3}},La={};function ja(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,r=void 0===e?[0,0,0]:e,i=t.intensity,n=void 0===i?1:i;return r.map(function(t){return t*n/255})}var za="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",Ra={name:"gouraud-lighting",dependencies:[Ca],vs:za,defines:{LIGHTING_VERTEX:1},getUniforms:Ba},Fa={name:"phong-lighting",dependencies:[Ca],fs:za,defines:{LIGHTING_FRAGMENT:1},getUniforms:Ba},Da={};function Ba(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Da;if(!("material"in t))return{};var e=t.material;return e?function(t){var e={};return e.lighting_uAmbient=t.ambient,e.lighting_uDiffuse=t.diffuse,e.lighting_uShininess=t.shininess,e.lighting_uSpecularColor=t.specularColor,e}(e):{lighting_uEnabled:!1}}var Na={LNG_LAT:1,LNGLAT_AUTO_OFFSET:4,METER_OFFSETS:2,LNGLAT_OFFSETS:3,IDENTITY:0},Ua=Object.keys(Na).map(function(t){return"const float COORDINATE_SYSTEM_".concat(t," = ").concat(Na[t],".;")}).join(""),Va="".concat(Ua,"\n\nuniform float project_uCoordinateSystem;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform float project_uAntimeridian;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec2 project_uCoordinateOrigin;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z;\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy;\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter;\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nvec3 project_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    dy = clamp(dy, -1., 1.);\n  }\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x - project_uAntimeridian, 360.0) + project_uAntimeridian;\n  }\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan_fp32(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT) {\n    return project_uModelMatrix * vec4(\n      project_mercator_(position.xy) * WORLD_SCALE * project_uScale,\n      project_size(position.z),\n      position.w\n    );\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    float X = position.x - project_uCoordinateOrigin.x;\n    float Y = position.y - project_uCoordinateOrigin.y;\n    return project_offset_(vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w));\n  }\n\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    return project_offset_(position);\n  }\n  vec4 position_modelspace = project_uModelMatrix * position;\n  return project_offset_(position_modelspace);\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec3 project_position(vec3 position, vec2 position64xyLow) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64xyLow);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_XY_LOW);\n  return projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_METER_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\n    position.w *= project_uCommonUnitsPerMeter.z;\n  }\n  return project_uViewProjectionMatrix * position + project_uCenter;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters);\n}\nfloat project_pixel_size(float pixels) {\n  return pixels;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels;\n}\nfloat project_scale(float meters) {\n  return project_size(meters);\n}\nvec2 project_scale(vec2 meters) {\n  return project_size(meters);\n}\nvec3 project_scale(vec3 meters) {\n  return project_size(meters);\n}\nvec4 project_scale(vec4 meters) {\n  return project_size(meters);\n}\nvec4 project_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position);\n}\nvec4 project_pixel_to_clipspace(vec2 pixels) {\n  return vec4(project_pixel_size_to_clipspace(pixels), 0.0, 0.0);\n}\n"),Ga={LNGLAT:1,LNGLAT_DEPRECATED:5,METER_OFFSETS:2,METERS:2,LNGLAT_OFFSETS:3,IDENTITY:0},qa={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}};function Za(t,e){if(t===e)return!0;if(Array.isArray(t)){var r=t.length;if(!e||e.length!==r)return!1;for(var i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Xa(t){var e,r={};return function(i){for(var n in i)if(!Za(i[n],r[n])){e=t(i),r=i;break}return e}}function Wa(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var Ha=[0,0,0,0],Ya=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Ka=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Ja=[0,0,0],Qa=[0,0,0],$a=12,to=Xa(function(t){var e=t.viewport,r=t.devicePixelRatio,i=t.coordinateSystem,n=t.coordinateOrigin,a=t.wrapLongitude,o=e.zoom,s=function(t){var e,r=t.viewport,i=t.coordinateSystem,n=t.coordinateOrigin,a=t.coordinateZoom,o=r.viewMatrixUncentered,s=r.viewMatrix,u=r.projectionMatrix,l=r.viewProjectionMatrix,c=r.cameraPosition,h=function(t){switch(t){case Ga.LNGLAT:case Ga.LNGLAT_EXPERIMENTAL:default:return Na.LNGLAT_AUTO_OFFSET;case Ga.LNGLAT_DEPRECATED:return Na.LNG_LAT;case Ga.METER_OFFSETS:case Ga.METERS:return Na.METER_OFFSETS;case Ga.LNGLAT_OFFSETS:return Na.LNGLAT_OFFSETS;case Ga.IDENTITY:return Na.IDENTITY}}(i),p=n;if(h===Na.LNGLAT_AUTO_OFFSET)if(a<$a)h=Na.LNG_LAT;else{var f=Math.fround(r.longitude),d=Math.fround(r.latitude);p=[f,d]}switch(h){case Na.IDENTITY:case Na.LNG_LAT:e=Ha;break;case Na.LNGLAT_OFFSETS:case Na.METER_OFFSETS:case Na.LNGLAT_AUTO_OFFSET:var v=r.projectFlat(p,Math.pow(2,a));c=[c[0]-v[0],c[1]-v[1],c[2]],e=_a([],[v[0],v[1],0,1],l),l=ha([],u,s=o||s),l=ha([],l,Ya);break;default:throw new Error("Unknown projection mode")}return{viewMatrix:s,viewProjectionMatrix:l,projectionCenter:e,cameraPos:c,shaderCoordinateSystem:h,shaderCoordinateOrigin:p}}({coordinateSystem:i,coordinateOrigin:n,coordinateZoom:o,viewport:e}),u=s.projectionCenter,l=s.viewProjectionMatrix,c=s.cameraPos,h=s.shaderCoordinateSystem,p=s.shaderCoordinateOrigin;Wa(l,"Viewport missing modelViewProjectionMatrix");var f=e.getDistanceScales(),d=[e.width*r,e.height*r],v={project_uCoordinateSystem:h,project_uCenter:u,project_uWrapLongitude:a,project_uAntimeridian:(e.longitude||0)-180,project_uViewportSize:d,project_uDevicePixelRatio:r,project_uFocalDistance:e.focalDistance||1,project_uCommonUnitsPerMeter:f.pixelsPerMeter,project_uCommonUnitsPerWorldUnit:f.pixelsPerMeter,project_uCommonUnitsPerWorldUnit2:Ja,project_uScale:e.scale,project_uViewProjectionMatrix:l,project_uCameraPosition:c},m=e.getDistanceScales(p);switch(h){case Na.METER_OFFSETS:v.project_uCommonUnitsPerWorldUnit=m.pixelsPerMeter,v.project_uCommonUnitsPerWorldUnit2=m.pixelsPerMeter2;break;case Na.LNGLAT_AUTO_OFFSET:v.project_uCoordinateOrigin=p;case Na.LNG_LAT:case Na.LNGLAT_OFFSETS:v.project_uCommonUnitsPerWorldUnit=m.pixelsPerDegree,v.project_uCommonUnitsPerWorldUnit2=m.pixelsPerDegree2}return v});function eo(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,r=t.devicePixelRatio,i=void 0===r?1:r,n=t.modelMatrix,a=void 0===n?null:n,o=t.coordinateSystem,s=void 0===o?Ga.LNGLAT:o,u=t.coordinateOrigin,l=void 0===u?Qa:u,c=t.wrapLongitude,h=void 0!==c&&c,p=t.projectionMode,f=t.positionOrigin;return Wa(e),void 0!==p&&E.removed("projectionMode","coordinateSystem")(),void 0!==f&&E.removed("positionOrigin","coordinateOrigin")(),Object.assign({project_uModelMatrix:a||Ka},to({viewport:e,devicePixelRatio:i,coordinateSystem:s,coordinateOrigin:l,wrapLongitude:h}))}var ro={};var io,no={name:"project",dependencies:[ka],vs:Va,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ro;return t.viewport?eo(t):{}},deprecations:[{type:"function",old:"project_scale",new:"project_size"},{type:"function",old:"project_to_clipspace",new:"project_common_position_to_clipspace"},{type:"function",old:"project_pixel_to_clipspace",new:"project_pixel_size_to_clipspace"}]},ao={name:"project32",dependencies:[no],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64xyLow);\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64xyLow, offset, commonPosition);\n}\n"},oo=Pa.fp64ify,so=Pa.fp64ifyMatrix4,uo={name:"project64",dependencies:[no,Pa],vs:"\nconst vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);\n\nuniform vec2 project64_uScale;\nuniform vec2 project_uViewProjectionMatrixFP64[16];\nvoid mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {\n\n#if defined(NVIDIA_FP64_WORKAROUND)\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);\n#else\n  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);\n#endif\n  out_val[1] = sub_fp64(PI_FP64,\n    log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));\n  return;\n}\n\nvoid project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {\n  vec2 pos_fp64[2];\n  mercatorProject_fp64(position_fp64, pos_fp64);\n  vec2 x_fp64 = mul_fp64(pos_fp64[0], project64_uScale);\n  vec2 y_fp64 = mul_fp64(pos_fp64[1], project64_uScale);\n  out_val[0] = mul_fp64(x_fp64, WORLD_SCALE_FP64);\n  out_val[1] = mul_fp64(y_fp64, WORLD_SCALE_FP64);\n\n  return;\n}\n\nvoid project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {\n  vec4 position64xy = vec4(\n    position.x, position64xyLow.x,\n    position.y, position64xyLow.y);\n\n  project_position_fp64(position64xy, out_val);\n}\n\nvec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  vec2 vertex_pos_clipspace[4];\n  mat4_vec4_mul_fp64(project_uViewProjectionMatrixFP64, vertex_pos_modelspace,\n    vertex_pos_clipspace);\n  return vec4(\n    vertex_pos_clipspace[0].x,\n    vertex_pos_clipspace[1].x,\n    vertex_pos_clipspace[2].x,\n    vertex_pos_clipspace[3].x\n    );\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset, out vec4 commonPosition\n) {\n  vec2 offset64[4];\n  vec4_fp64(vec4(offset, 0.0), offset64);\n\n  float z = project_size(position.z);\n  vec2 projectedPosition64xy[2];\n  project_position_fp64(position.xy, position64xyLow, projectedPosition64xy);\n\n  vec2 commonPosition64[4];\n  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);\n  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);\n  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));\n  commonPosition64[3] = vec2(1.0, 0.0);\n\n  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);\n\n  return project_common_position_to_clipspace_fp64(commonPosition64);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec2 position64xyLow, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(\n    position, position64xyLow, offset, commonPosition\n  );\n}\nvec4 project_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {\n  return project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",getUniforms:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=t.project_uViewProjectionMatrix,r=t.project_uScale;if(e&&r)return lo({project_uViewProjectionMatrix:e,project_uScale:r});return{}},deprecations:[{type:"function",old:"project_to_clipspace_fp64",new:"project_common_position_to_clipspace_fp64"}]},lo=Xa(function(t){var e=t.project_uViewProjectionMatrix,r=t.project_uScale,i=so(e),n=oo(r);return{project_uViewProjectionMatrixFP64:i,project64_uViewProjectionMatrix:i,project64_uScale:n}});!function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).ignoreMultipleRegistrations,r=void 0!==e&&e;Li.registerShaderModules(t,{ignoreMultipleRegistrations:r})}([ka,Pa,no,ao,uo,Ra,Fa,Ia]),io=[no],Li.setDefaultShaderModules(io);var co=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,_i),Object(u.a)(e,[{key:"getProjectedLight",value:function(){return this}}]),e}(),ho=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t);var r=e.id,i=void 0===r?"effect":r;this.id=i,this.props={},Object.assign(this.props,e)}return Object(u.a)(t,[{key:"prepare",value:function(){}},{key:"getParameters",value:function(){}}]),t}(),po={color:[255,255,255],intensity:1},fo=[{color:[255,255,255],intensity:1,direction:[-1,-3,-1]},{color:[255,255,255],intensity:.9,direction:[1,8,-2.5]}],vo=function(t){function e(t){var r;for(var i in Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t))).ambientLight=null,r.directionalLights=[],r.pointLights=[],t){var n=t[i];switch(n.type){case"ambient":r.ambientLight=n;break;case"directional":r.directionalLights.push(n);break;case"point":r.pointLights.push(n)}}return r.applyDefaultLights(),r}return Pt(e,ho),Object(u.a)(e,[{key:"getParameters",value:function(t){var e=this.ambientLight,r=this.getProjectedPointLights(t);return{lightSources:{ambientLight:e,directionalLights:this.getProjectedDirectionalLights(t),pointLights:r}}}},{key:"applyDefaultLights",value:function(){var t=this.ambientLight,e=this.pointLights,r=this.directionalLights;t||0!==e.length||0!==r.length||(this.ambientLight=new yi(po),this.directionalLights.push(new co(fo[0])),this.directionalLights.push(new co(fo[1])))}},{key:"getProjectedPointLights",value:function(t){for(var e=[],r=0;r<this.pointLights.length;r++){var i=this.pointLights[r];e.push(i.getProjectedLight({layer:t}))}return e}},{key:"getProjectedDirectionalLights",value:function(t){for(var e=[],r=0;r<this.directionalLights.length;r++){var i=this.directionalLights[r];e.push(i.getProjectedLight({layer:t}))}return e}}]),e}();function mo(t,e){var r=_a([],e,t);return function(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r}(r,r,1/r[3]),r}function go(t,e){var r=t%e;return r<0?e+r:r}function yo(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var _o=Math.PI,bo=_o/4,xo=_o/180,wo=180/_o,ko=512,Eo=4003e4,So=1.5;function To(t){return Math.pow(2,t)}function Ao(t){return Math.log2(t)}function Po(t,e){var r=C(t,2),i=r[0],n=r[1];yo(Number.isFinite(i)&&Number.isFinite(e)),yo(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var a=n*xo;return[(e*=ko)*(i*xo+_o)/(2*_o),e*(_o-Math.log(Math.tan(bo+.5*a)))/(2*_o)]}function Oo(t,e){var r=C(t,2),i=r[0],n=r[1],a=i/(e*=ko)*(2*_o)-_o,o=2*(Math.atan(Math.exp(_o-n/e*(2*_o)))-bo);return[a*wo,o*wo]}function Io(t){var e=t.latitude,r=t.longitude,i=t.zoom,n=t.scale,a=t.highPrecision,o=void 0!==a&&a;n=void 0!==n?n:To(i),yo(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(n));var s={},u=ko*n,l=Math.cos(e*xo),c=u/360,h=c/l,p=u/Eo/l;if(s.pixelsPerMeter=[p,-p,p],s.metersPerPixel=[1/p,-1/p,1/p],s.pixelsPerDegree=[c,-h,p],s.degreesPerPixel=[1/c,-1/h,1/p],o){var f=xo*Math.tan(e*xo)/l,d=c*f/2,v=u/Eo*f,m=v/h*p;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[m,0,m]}return s}function Mo(t,e){var r=C(t,3),i=r[0],n=r[1],a=r[2],o=C(e,3),s=o[0],u=o[1],l=o[2],c=Io({longitude:i,latitude:n,scale:1,highPrecision:!0}),h=c.pixelsPerMeter,p=c.pixelsPerMeter2,f=Po(t,1);f[0]+=s*(h[0]+p[0]*u),f[1]+=u*(h[1]+p[1]*u);var d=Oo(f,1),v=(a||0)+(l||0);return Number.isFinite(a)||Number.isFinite(l)?[d[0],d[1],v]:d}function Co(t){var e=t.height,r=t.pitch,i=t.bearing,n=t.altitude,a=t.center,o=void 0===a?null:a,s=t.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return pa(l,l,[0,0,-n]),fa(l,l,[1,1,1/e]),da(l,l,-r*xo),va(l,l,i*xo),u&&fa(l,l,[1,-1,1]),o&&pa(l,l,function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}([],o)),l}function Lo(t){var e=t.width,r=t.height,i=t.altitude,n=void 0===i?So:i,a=t.pitch,o=void 0===a?0:a,s=t.nearZMultiplier,u=void 0===s?1:s,l=t.farZMultiplier,c=void 0===l?1:l,h=o*xo,p=Math.atan(.5/n),f=Math.sin(p)*n/Math.sin(Math.PI/2-h-p),d=Math.cos(Math.PI/2-h)*f+n;return{fov:2*Math.atan(r/2/n),aspect:e/r,focalDistance:n,near:u,far:d*c}}function jo(t,e){var r=C(t,3),i=r[0],n=r[1],a=r[2],o=void 0===a?0:a;return yo(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(o)),mo(e,[i,n,o,1])}function zo(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=C(t,3),n=i[0],a=i[1],o=i[2];if(yo(Number.isFinite(n)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o))return mo(e,[n,a,o,1]);var s=mo(e,[n,a,0,1]),u=mo(e,[n,a,1,1]),l=s[2],c=u[2];return function(t,e,r,i){var n=e[0],a=e[1];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t}([],s,u,l===c?0:((r||0)-l)/(c-l))}function Ro(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=C(t,3),n=i[0],a=i[1],o=i[2],s=void 0===o?0:o,u=C(e.projectFlat(t),2);return[u[0],u[1],s*(r?Io({longitude:n,latitude:a,scale:e.scale}):e.getDistanceScales()).pixelsPerMeter[2]]}function Fo(t,e){var r=e.viewport,i=e.modelMatrix,n=e.coordinateSystem,a=e.coordinateOrigin,o=e.offsetMode,s=C(t,3),u=s[0],l=s[1],c=s[2];if(i){var h=C(_a([],[u,l,c,1],i),3);u=h[0],l=h[1],c=h[2]}switch(n){case Ga.LNGLAT:case Ga.LNGLAT_DEPRECATED:return Ro([u,l,c],r,o);case Ga.LNGLAT_OFFSETS:return Ro([u+a[0],l+a[1],c+(a[2]||0)],r,o);case Ga.METER_OFFSETS:return Ro(Mo(a,[u,l,c]),r,o);case Ga.IDENTITY:default:return r.projectPosition([u,l,c])}}function Do(t,e){var r=function(t){var e=Object.assign({},t),r=t.viewport,i=t.coordinateSystem,n=t.coordinateOrigin,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return void 0===a&&(e.fromCoordinateSystem=i),void 0===o&&(e.fromCoordinateOrigin=n),i===Ga.LNGLAT&&r.zoom>=$a&&(e.coordinateSystem=Ga.LNGLAT_OFFSETS,e.coordinateOrigin=[Math.fround(r.longitude),Math.fround(r.latitude)]),e}(e),i=r.viewport,n=r.coordinateSystem,a=r.coordinateOrigin,o=r.modelMatrix,s=r.fromCoordinateSystem,u=r.fromCoordinateOrigin;switch(n){case Ga.LNGLAT_OFFSETS:case Ga.METER_OFFSETS:var l=Fo(t,{viewport:i,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:!0}),c=Ro(a,i,!0);return ci(l,l,c),l;case Ga.LNGLAT:case Ga.LNGLAT_DEPRECATED:case Ga.IDENTITY:default:return Fo(t,{viewport:i,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:!1})}}var Bo=[],No=[];function Uo(t){var e=Bo,r={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?e=t:t.length>0&&(No.length=t.length,e=No):e=Bo,{iterable:e,objectInfo:r}}var Vo=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t);var i=r.id,n=void 0===i?Q("attribute"):i,a=r.type,o=r.isIndexed,u=void 0!==o&&o;this.gl=e,this.id=n,this.isIndexed=u,this.target=u?34963:34962,this.type=a,u&&!a&&(this.type=e&&function(t,e){return ke(t,e)}(e,xe.ELEMENT_INDEX_UINT32)?5125:5123),this.value=null,this.externalBuffer=null,this.buffer=null,this.userData={},this.update(r),this._validateAttributeDefinition()}return Object(u.a)(t,[{key:"delete",value:function(){this.buffer&&(this.buffer.delete(),this.buffer=null)}},{key:"update",value:function(t){var e=t.value,r=t.buffer,i=t.constant,n=void 0===i?this.constant||!1:i;if(this.constant=n,r)this.externalBuffer=r,this.constant=!1,this.type=t.type||r.accessor.type,void 0!==r.accessor.divisor&&(this.divisor=r.accessor.divisor),void 0!==t.divisor&&(this.divisor=t.divisor);else if(e){this.externalBuffer=null;var a=this.size||t.size||0;if(n&&e.length!==a){this.value=new Float32Array(a);for(var o=this.offset/4,s=0;s<this.size;++s)this.value[s]=e[o+s]}else this.value=e;if(!n&&this.gl){var u=W({},t,{id:this.id,target:this.target,accessor:{type:this.type}});Number.isFinite(u.divisor)&&(u.accessor.divisor=u.divisor),delete u.divisor,Number.isFinite(u.size)&&(u.accessor.size=u.size),delete u.size,this.buffer=this.buffer||new Ut(this.gl,u),this.buffer.setData({data:e}),this.type=this.buffer.accessor.type}}this._setAccessor(t)}},{key:"getBuffer",value:function(){return this.constant?null:this.externalBuffer||this.buffer}},{key:"getValue",value:function(){if(this.constant)return this.value;var t=this.externalBuffer||this.buffer;return t?[t,this]:null}},{key:"_setAccessor",value:function(t){var e=t.size,r=void 0===e?this.size:e,i=t.offset,n=void 0===i?this.offset||0:i,a=t.stride,o=void 0===a?this.stride||0:a,s=t.normalized,u=void 0===s?this.normalized||!1:s,l=t.integer,c=void 0===l?this.integer||!1:l,h=t.divisor,p=void 0===h?this.divisor||0:h,f=t.instanced,d=t.isInstanced;this.size=r,this.offset=n,this.stride=o,this.normalized=u,this.integer=c,this.divisor=p,void 0!==d&&(A.deprecated("Attribute.isInstanced")(),this.divisor=d?1:0),void 0!==f&&(A.deprecated("Attribute.instanced")(),this.divisor=f?1:0)}},{key:"_validateAttributeDefinition",value:function(){}}]),t}(),Go={isExternalBuffer:!1,needsUpdate:!0,needsRedraw:!1,allocedInstances:-1},qo=function(t){function e(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,e),r=St(this,Tt(e).call(this,t,i));var n=i.transition,a=void 0!==n&&n,o=i.noAlloc,u=void 0!==o&&o,l=i.update,c=void 0===l?null:l,h=i.accessor,p=void 0===h?null:h,f=i.bufferLayout,d=void 0===f?null:f,v=i.defaultValue,m=void 0===v?[0,0,0,0]:v;if(m=Array.isArray(m)?m:[m],r.shaderAttributes={},r.hasShaderAttributes=!1,i.shaderAttributes){var g=i.shaderAttributes;for(var y in g){var _=g[y];r.shaderAttributes[y]=new e(r.gl,Object.assign({},_,{id:y,constant:_.constant||!1,isIndexed:_.isIndexed||_.elements,size:(_.elements?1:_.size)||r.size,value:_.value||null,divisor:_.instanced||_.divisor||r.divisor,buffer:r.getBuffer(),noAlloc:!0})),r.hasShaderAttributes=!0}}return Object.assign(r.userData,Go,i,{transition:a,noAlloc:u,update:c,accessor:p,defaultValue:m,bufferLayout:d}),Object.seal(r.userData),r._validateAttributeUpdaters(),r}return Pt(e,Vo),Object(u.a)(e,[{key:"needsUpdate",value:function(){return this.userData.needsUpdate}},{key:"needsRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,e=void 0!==t&&t,r=this.userData.needsRedraw;return this.userData.needsRedraw=this.userData.needsRedraw&&!e,r}},{key:"getInstanceCount",value:function(){return null!==this.value?this.value.length/this.size:0}},{key:"getUpdateTriggers",value:function(){var t=this.userData.accessor;return[this.id].concat(t||[])}},{key:"getAccessor",value:function(){return this.userData.accessor}},{key:"getShaderAttributes",value:function(){var t={};return this.hasShaderAttributes?Object.assign(t,this.shaderAttributes):t[this.id]=this,t}},{key:"supportsTransition",value:function(){return this.userData.transition}},{key:"getTransitionSetting",value:function(t){var e=this.userData,r=e.transition,i=e.accessor;if(!r)return null;var n=Array.isArray(i)?t[i.find(function(e){return t[e]})]:t[i];return Number.isFinite(n)&&(n={duration:n}),n&&n.duration>0?Object.assign({},r,n):null}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsUpdate=this.userData.needsUpdate||t}},{key:"setNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id;this.userData.needsRedraw=this.userData.needsRedraw||t}},{key:"allocate",value:function(t){var e=this.userData;if(e.isExternalBuffer||e.noAlloc)return!1;var r=this.getInstanceCount();if((0===r||r<t)&&(e.update||e.accessor)){Wa(Number.isFinite(t));var i=Math.max(t,1),n=Zo(this.type||5126);return this.constant=!1,this.value=new n(this.size*i),e.needsUpdate=!0,e.allocedInstances=i,!0}return!1}},{key:"updateBuffer",value:function(t){var e=t.numInstances,r=t.data,i=t.props,n=t.context;if(!this.needsUpdate())return!1;var a=this.userData,o=a.update,s=a.accessor,u=!0;return o?(o.call(n,this,{data:r,props:i,numInstances:e}),this.update({value:this.value,constant:this.constant}),this._checkAttributeArray()):s?(this._updateBufferViaStandardAccessor(r,i),this._checkAttributeArray()):u=!1,this._updateShaderAttributes(),a.needsUpdate=!1,a.needsRedraw=!0,u}},{key:"update",value:function(t){Ve(Tt(e.prototype),"update",this).call(this,t),this._updateShaderAttributes()}},{key:"setGenericValue",value:function(t){var e=this.userData;if(void 0===t||"function"==typeof t)return e.isExternalBuffer=!1,!1;t=this._normalizeValue(t);var r=!this.constant||!this._areValuesEqual(t,this.value);return r&&this.update({constant:!0,value:t}),e.needsRedraw=e.needsUpdate||r,e.needsUpdate=!1,e.isExternalBuffer=!0,this._updateShaderAttributes(),!0}},{key:"setExternalBuffer",value:function(t,e){var r=this.userData;if(t){if(r.isExternalBuffer=!0,r.needsUpdate=!1,t instanceof Ut)this.externalBuffer!==t&&(this.update({constant:!1,buffer:t}),r.needsRedraw=!0);else if(this.value!==t){if(!ArrayBuffer.isView(t))throw new Error("Attribute prop must be typed array");if(r.auto&&t.length<=e*this.size)throw new Error("Attribute prop array must match length and size");var i=Zo(this.type||5126);t instanceof i?this.update({constant:!1,value:t}):(E.warn("Attribute prop ".concat(this.id," is casted to ").concat(i.name))(),this.update({constant:!1,value:new i(t)})),this.value=t,r.needsRedraw=!0}return this._updateShaderAttributes(),!0}return r.isExternalBuffer=!1,!1}},{key:"_normalizeValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.userData.defaultValue;if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return e[r]=Number.isFinite(t)?t:i[0],e;switch(this.size){case 4:e[r+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[r+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[r+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[r+0]=Number.isFinite(t[0])?t[0]:i[0]}return e}},{key:"_areValuesEqual",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.size,i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}},{key:"_updateBufferViaStandardAccessor",value:function(t,e){var r=this.userData.accessor,i=this.value,n=this.size,a=e[r];Wa("function"==typeof a,'accessor "'.concat(r,'" is not a function'));var o=0,s=Uo(t),u=s.iterable,l=s.objectInfo,c=!0,h=!1,p=void 0;try{for(var f,d=u[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=f.value;l.index++;var m=a(v,l);this._normalizeValue(m,i,o),o+=n}}catch(t){h=!0,p=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw p}}this.update({value:i})}},{key:"_validateAttributeUpdaters",value:function(){var t=this.userData;if(!(t.noAlloc||"function"==typeof t.update||"string"==typeof t.accessor))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value;if(t&&t.length>=4&&!(Number.isFinite(t[0])&&Number.isFinite(t[1])&&Number.isFinite(t[2])&&Number.isFinite(t[3])))throw new Error("Illegal attribute generated for ".concat(this.id))}},{key:"_updateShaderAttributes",value:function(){var t=this.shaderAttributes;for(var e in t){t[e].update({buffer:this.getBuffer(),value:this.value,constant:this.constant})}}},{key:"bufferLayout",get:function(){return this.userData.bufferLayout},set:function(t){this.userData.bufferLayout=t}}]),e}();function Zo(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,r=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce type from array")}}function Xo(t){var e=t.source,r=t.target,i=t.start,n=void 0===i?0:i,a=t.end,o=t.getData;a=a||r.length;var s=e.length,u=a-n;if(s>u)r.set(e.subarray(0,u),n);else if(r.set(e,n),o)for(var l=s;l<u;)for(var c=o(l,e),h=0;h<c.length;h++)r[n+l]=c[h],l++}var Wo={1:"float",2:"vec2",3:"vec3",4:"vec4"};function Ho(t){var e={},r={};for(var i in t){var n=t[i],a=n.fromState,o=n.toState,s=n.buffer;e["".concat(i,"From")]=a instanceof Ut?[a,{divisor:0}]:a,e["".concat(i,"To")]=o,r["".concat(i)]=s}return{sourceBuffers:e,feedbackBuffers:r}}function Yo(t){var e=t.fromState,r=t.toState,i=t.fromLength,n=t.toLength,a=t.fromBufferLayout,o=t.toBufferLayout,s=t.getData,u=void 0===s?function(t){return t}:s;if((a&&o||!(i>=n))&&e instanceof Ut){var l=new Float32Array(n),c=e.getData({}),h=r.size,p=r.constant,f=p?r.getValue():r.getBuffer().getData({}),d=p?function(t,e){return u(f,e)}:function(t,e){return u(f.subarray(t,t+h),e)};!function(t){var e=t.source,r=t.target,i=t.size,n=t.getData,a=t.sourceLayout,o=t.targetLayout;if(!Array.isArray(o))return Xo({source:e,target:r,getData:n}),r;for(var s=0,u=0,l=n&&function(t,e){return n(t+u,e)},c=Math.min(a.length,o.length),h=0;h<c;h++){var p=a[h]*i,f=o[h]*i;Xo({source:e.subarray(s,s+p),target:r,start:u,end:u+f,getData:l}),s+=p,u+=f}u<r.length&&Xo({source:[],target:r,start:u,getData:l})}({source:c,target:l,sourceLayout:a,targetLayout:o,size:r.size,getData:d}),e.setData({data:l})}}var Ko={NONE:"none",PENDING:"pending",IN_PROGRESS:"in_progress",ENDED:"ended"};function Jo(){}var Qo=function(){function t(e){Object(s.a)(this,t),this._startTime=null,this._state=Ko.NONE,this.duration=1,this.easing=function(t){return t},this.onStart=Jo,this.onUpdate=Jo,this.onInterrupt=Jo,this.onEnd=Jo,Object.assign(this,e)}return Object(u.a)(t,[{key:"start",value:function(t){this.inProgress&&this.onInterrupt(this),Object.assign(this,t),this._setState(Ko.PENDING)}},{key:"cancel",value:function(){this.inProgress&&(this.onInterrupt(this),this._setState(Ko.NONE))}},{key:"update",value:function(t){if(this.state===Ko.PENDING&&(this._startTime=t,this._setState(Ko.IN_PROGRESS)),this.state===Ko.IN_PROGRESS){var e=!1,r=(t-this._startTime)/this.duration;return r>=1&&(r=1,e=!0),this.time=this.easing(r),this.onUpdate(this),e&&this._setState(Ko.ENDED),!0}return!1}},{key:"_setState",value:function(t){if(this._state!==t)switch(this._state=t,t){case Ko.PENDING:this.onStart(this);break;case Ko.ENDED:this.onEnd(this)}}},{key:"state",get:function(){return this._state}},{key:"inProgress",get:function(){return this._state===Ko.PENDING||this._state===Ko.IN_PROGRESS}}]),t}(),$o=function(){},ts={duration:0,easing:function(t){return t},onStart:$o,onEnd:$o,onInterrupt:$o},es=function(){function t(e,r){var i=r.id;Object(s.a)(this,t),this.id=i,this.gl=e,this.attributeTransitions={},this.needsRedraw=!1,this.transform=null,this.numInstances=0,Sn.isSupported(e)?this.isSupported=!0:e&&E.warn("WebGL2 not supported by this browser. Transition animation is disabled.")()}return Object(u.a)(t,[{key:"finalize",value:function(){for(var t in this.transform&&this.transform.delete(),this.attributeTransitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,r=t.transitions,i=void 0===r?{}:r,n=t.numInstances;if(this.opts=i,this.numInstances=n||1,this.isSupported){var a=this.attributeTransitions,o={};for(var s in e){this._updateAttribute(s,e[s])&&(o[s]=a[s])}for(var u in a){var l=e[u];l&&l.supportsTransition()||this._removeTransition(u)}if(this.transform){if(this.transform){var c=Ho(o),h=c.sourceBuffers,p=c.feedbackBuffers;this.transform.update({elementCount:this.numInstances,sourceBuffers:h,feedbackBuffers:p})}}else this._createModel()}}},{key:"hasAttribute",value:function(t){return t in this.attributeTransitions}},{key:"getAttributes",value:function(){var t={};for(var e in this.attributeTransitions){var r=this.attributeTransitions[e];r.buffer&&(t[e]=r.attributeInTransition)}return t}},{key:"setCurrentTime",value:function(t){if(!this.transform||0===this.numInstances)return!1;var e={},r=this.needsRedraw;for(var i in this.needsRedraw=!1,this.attributeTransitions){var n=this.attributeTransitions[i];n.update(t)&&(e["".concat(i,"Time")]=n.time,r=!0)}return r&&this.transform.run({uniforms:e}),r}},{key:"_createTransition",value:function(t,e){var r=this.attributeTransitions[t];return r?null:(r=new Qo({name:t,attribute:e,attributeInTransition:new qo(this.gl,e),bufferLayout:e.bufferLayout}),this.attributeTransitions[t]=r,this._invalidateModel(),r)}},{key:"_removeTransition",value:function(t){var e=this.attributeTransitions[t];e&&(e.buffer&&e.buffer.delete(),e._swapBuffer&&e._swapBuffer.delete(),delete this.attributeTransitions[t],this._invalidateModel())}},{key:"_updateAttribute",value:function(t,e){var r=e.getTransitionSetting(this.opts);if(r){var i,n=this.attributeTransitions[t];if(n?i=e.needsRedraw():(n=this._createTransition(t,e),i=!0),i)return this._triggerTransition(n,r),!0}return!1}},{key:"_invalidateModel",value:function(){this.transform&&(this.transform.delete(),this.transform=null)}},{key:"_createModel",value:function(){0!==Object.keys(this.attributeTransitions).length&&(this.transform=new Sn(this.gl,Object.assign({elementCount:this.numInstances},Ho(this.attributeTransitions),function(t){var e=[],r=[],i=[],n=[],a=[];for(var o in t){var s=t[o],u=Wo[s.attribute.size];u&&(s.bufferIndex=e.length,e.push(o),r.push("attribute ".concat(u," ").concat(o,"From;")),r.push("attribute ".concat(u," ").concat(o,"To;")),i.push("uniform float ".concat(o,"Time;")),n.push("varying ".concat(u," ").concat(o,";")),a.push("".concat(o," = mix(").concat(o,"From, ").concat(o,"To,\n        ").concat(o,"Time);")))}return{vs:"\n#define SHADER_NAME feedback-vertex-shader\n".concat(r.join("\n"),"\n").concat(i.join("\n"),"\n").concat(n.join("\n"),"\n\nvoid main(void) {\n  ").concat(a.join("\n"),"\n  gl_Position = vec4(0.0);\n}\n"),fs:"#define SHADER_NAME feedback-fragment-shader\n\nprecision highp float;\n\n".concat(n.join("\n"),"\n\nvoid main(void) {\n  gl_FragColor = vec4(0.0);\n}\n"),varyings:e}}(this.attributeTransitions))))}},{key:"_getNextTransitionStates",value:function(t,e){var r,i=t.attribute,n=i.size;r=i.constant?new Vo(this.gl,{constant:!0,value:i.value,size:n}):new Vo(this.gl,{constant:!1,buffer:i.getBuffer(),divisor:0,size:n,value:i.externalBuffer?null:i.value});var a=t.buffer||r,o=this.numInstances*n,s=a instanceof Ut&&a.getElementCount()||o,u=t._swapBuffer;return t._swapBuffer=t.buffer,u?u.getElementCount()<o&&u.setData({data:new Float32Array(o)}):u=new Ut(this.gl,{data:new Float32Array(o),usage:35050}),t.attributeInTransition.update({buffer:u}),Yo({fromState:a,toState:r,fromLength:s,toLength:o,fromBufferLayout:t.bufferLayout,toBufferLayout:i.bufferLayout,getData:e.enter}),t.bufferLayout=i.bufferLayout,{fromState:a,toState:r,buffer:u}}},{key:"_triggerTransition",value:function(t,e){Wa(e&&e.duration>0),this.needsRedraw=!0;var r=Object.assign({},ts,e);t.start(Object.assign({},this._getNextTransitionStates(t,e),r))}}]),t}();function rs(){}var is={savedMessages:null,timeStart:null,onLog:function(t){var e=t.level,r=t.message;E.log(e,r)()},onUpdateStart:function(t){t.level,t.numInstances;is.savedMessages=[],is.timeStart=new Date},onUpdate:function(t){t.level;var e=t.message;is.savedMessages&&is.savedMessages.push(e)},onUpdateEnd:function(t){var e=t.level,r=t.id,i=t.numInstances,n=Math.round(new Date-is.timeStart),a="".concat(n,"ms");E.group(e,"Updated attributes for ".concat(i," instances in ").concat(r," in ").concat(a),{collapsed:!0})();var o=!0,s=!1,u=void 0;try{for(var l,c=is.savedMessages[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;E.log(e,h)()}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}E.groupEnd(e,"Updated attributes for ".concat(i," instances in ").concat(r," in ").concat(a))(),is.savedMessages=null}},ns=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.id,n=void 0===i?"attribute-manager":i,a=r.stats;Object(s.a)(this,t),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new es(e,{id:"".concat(n,"-transitions")}),Object.seal(this)}return Object(u.a)(t,null,[{key:"setDefaultLogFunctions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.onLog,r=t.onUpdateStart,i=t.onUpdate,n=t.onUpdateEnd;void 0!==e&&(is.onLog=e||rs),void 0!==r&&(is.onUpdateStart=r||rs),void 0!==i&&(is.onUpdate=i||rs),void 0!==n&&(is.onUpdateEnd=n||rs)}}]),Object(u.a)(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,e&&this.id}},{key:"setNeedsRedraw",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var r=t[e];void 0!==this.attributes[r]&&(this.attributes[r].delete(),delete this.attributes[r])}}},{key:"invalidate",value:function(t){var e=this._invalidateTrigger(t);is.onLog({level:3,message:"invalidated attributes ".concat(e," (").concat(t,") for ").concat(this.id)})}},{key:"invalidateAll",value:function(){for(var t in this.attributes)this.attributes[t].setNeedsUpdate();is.onLog({level:3,message:"invalidated all attributes for ".concat(this.id)})}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,r=t.numInstances,i=t.transitions,n=t.props,a=void 0===n?{}:n,o=t.buffers,s=void 0===o?{}:o,u=t.context,l=void 0===u?{}:u,c=!1;for(var h in is.onUpdateStart({level:2,id:this.id,numInstances:r}),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var p=this.attributes[h];p.setExternalBuffer(s[h],this.numInstances)||p.setGenericValue(a[p.getAccessor()])||p.needsUpdate()&&(c=!0,this._updateAttribute({attribute:p,numInstances:r,data:e,props:a,context:l})),this.needsRedraw|=p.needsRedraw()}c&&is.onUpdateEnd({level:2,id:this.id,numInstances:r}),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}},{key:"updateTransition",value:function(t){var e=this.attributeTransitionManager.setCurrentTime(t);return this.needsRedraw=this.needsRedraw||e,e}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,r=this.attributeTransitionManager,i=Object.assign({},r.getAttributes());for(var n in e){var a=e[n];a.needsRedraw(t)&&!r.hasAttribute(n)&&(i[n]=a)}return i}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&E.warn("AttributeManager.add({updaters}) - updater map no longer supported")();var i={};for(var n in t){var a=t[n],o=this._createAttribute(n,a,r);i[n]=o}Object.assign(this.attributes,i),this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(t,e,r){var i={id:t,constant:e.constant||!1,isIndexed:e.isIndexed||e.elements,size:e.elements?1:e.size,value:e.value||null,divisor:e.instanced||r.instanced?1:e.divisor};return new qo(this.gl,Object.assign({},e,i))}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},r=function(r){t.attributes[r].getUpdateTriggers().forEach(function(t){e[t]||(e[t]=[]),e[t].push(r)})};for(var i in this.attributes)r(i);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t){var e=this.attributes,r=this.updateTriggers[t];if(r)r.forEach(function(t){var r=e[t];r&&r.setNeedsUpdate()});else{var i="invalidating non-existent trigger ".concat(t," for ").concat(this.id,"\n");i+="Valid triggers: ".concat(Object.keys(e).join(", ")),E.warn(i,r)()}return r}},{key:"_updateAttribute",value:function(t){var e=t.attribute,r=t.numInstances,i=t.data,n=t.props,a=t.context;e.allocate(r)&&is.onUpdate({level:3,message:"".concat(e.id," allocated ").concat(r),id:this.id});var o=Date.now();if(e.updateBuffer({numInstances:r,data:i,props:n,context:a})){this.needsRedraw=!0;var s=Math.round(Date.now()-o);is.onUpdate({level:3,message:"".concat(e.id," updated ").concat(r," in ").concat(s,"ms")})}}}]),t}(),as=new Map,os=function(t){if(sn.a.isReady()&&t.id){var e=as.get(t.id);e&&e.forEach(function(e,r){!function t(e,r,i){e&&(r.length>1?t(e[r[0]],r.slice(1),i):e[r[0]]=i)}(t,r,e),"data"===r[0]&&(t.data=Object(a.a)(t.data))})}},ss=function(t){sn.a.isReady()&&sn.a.listenFor("deck.gl",t)},us=function(t){sn.a.isReady()&&sn.a.listenFor("init",t)},ls=function(t){if(sn.a.isReady()&&t){var e=[t.constructor.layerName];sn.a.listItem("deck.gl",t.id,{badges:e,links:t.state&&t.state.model?["luma.gl:".concat(t.state.model.id)]:void 0,parent:t.parent?t.parent.id:void 0})}},cs=function(t){if(sn.a.isReady()&&!sn.a.throttle("deck.gl:".concat(t.id),1e3)){var e=function(t){var e=[{path:"objects.props",data:t.props}],r=[t.constructor.layerName];if(t.state){if(t.getAttributeManager()){var i=t.getAttributeManager().getAttributes();e.push({path:"objects.attributes",data:i})}if(t.state.model){t.state.model.setProps({timerQueryEnabled:!0});var n=t.state.model.stats.lastFrameTime;n&&r.push("".concat((1e3*n).toFixed(0),"μs"))}}return e.push({path:"badges",data:r}),e}(t);sn.a.multiUpdate("deck.gl",t.id,e)}};function hs(t,e){var r=ps({newProps:t,oldProps:e,propTypes:ds(t),ignoreProps:{data:null,updateTriggers:null}}),i=function(t,e){if(null===e)return"oldProps is null, initial diff";var r=t.dataComparator;if(r){if(!r(t.data,e.data))return"Data comparator detected a change"}else if(t.data!==e.data)return"A new data container was supplied";return null}(t,e),n=!1;return i||(n=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers){var r=fs(t,e,"all");if(r)return{all:!0}}var i={},n=!1;for(var a in t.updateTriggers)if("all"!==a){var o=fs(t,e,a);o&&(i[a]=!0,n=i)}return n}(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n}}function ps(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.newProps,r=t.oldProps,i=t.ignoreProps,a=void 0===i?{}:i,o=t.propTypes,s=void 0===o?{}:o,u=t.triggerName,l=void 0===u?"props":u;if(Wa(void 0!==r&&void 0!==e,"compareProps args"),r===e)return null;if("object"!==Object(n.a)(e)||null===e)return"".concat(l," changed shallowly");if("object"!==Object(n.a)(r)||null===r)return"".concat(l," changed shallowly");for(var c in r)if(!(c in a)){if(!(c in e))return"".concat(l,".").concat(c," dropped");var h=e[c],p=r[c],f=s[c],d=f&&f.equal;if(d&&!d(h,p,f))return"".concat(l,".").concat(c," changed deeply");if(!d&&(d=h&&p&&h.equals)&&!d.call(h,p))return"".concat(l,".").concat(c," changed deeply");if(!d&&p!==h)return"".concat(l,".").concat(c," changed shallowly")}for(var v in e)if(!(v in a||v in r))return"".concat(l,".").concat(v," added: undefined -> ").concat(e[v]);return null}function fs(t,e,r){var i=t.updateTriggers[r];i=null==i?{}:i;var n=e.updateTriggers[r];return ps({oldProps:n=null==n?{}:n,newProps:i,triggerName:r})}function ds(t){var e=t._component,r=e&&e.constructor;return r?r._propTypes:{}}var vs="count(): argument not an object",ms="count(): argument not a container";function gs(t){if(null===(e=t)||"object"!==Object(n.a)(e))throw new Error(vs);var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===Object(n.a)(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error(ms)}var ys={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},_s={boolean:{validate:function(t,e){return!0},equal:function(t,e,r){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return ks(t)&&(3===t.length||4===t.length)},equal:function(t,e,r){return bs(t,e)}},accessor:{validate:function(t,e){var r=Es(t);return"function"===r||r===Es(e.value)},equal:function(t,e,r){return"function"==typeof e||bs(t,e)}},array:{validate:function(t,e){return e.optional&&!t||ks(t)},equal:function(t,e,r){return r.compare?bs(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"==typeof t},equal:function(t,e,r){return!r.compare||t===e}}};function bs(t,e){if(t===e)return!0;if(!ks(t)||!ks(e))return!1;var r=t.length;if(r!==e.length)return!1;for(var i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}function xs(t,e){switch(Es(e)){case"object":return ws(t,e);case"array":return ws(t,{type:"array",value:e,compare:!1});case"boolean":return ws(t,{type:"boolean",value:e});case"number":return ws(t,{type:"number",value:e});case"function":return ws(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ws(t,e){return"type"in e?Object.assign({name:t},_s[e.type],e):"value"in e?Object.assign({name:t,type:Es(e.value)},e):{name:t,type:"object",value:e}}function ks(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Es(t){return ks(t)?"array":null===t?"null":Object(n.a)(t)}function Ss(t,e,r){if(e)for(var i in r)if(Ps(e,i)){var n="".concat(t||"Layer",": ").concat(i),a=!0,o=!1,s=void 0;try{for(var u,l=r[i][Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;Ps(e,c)||(e[c]=e[i])}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}E.deprecated(n,r[i].join("/"))()}}function Ts(t){var e=Os(t,"_mergedDefaultProps");return e?{defaultProps:e,propTypes:Os(t,"_propTypes"),deprecatedProps:Os(t,"_deprecatedProps")}:function(t){var e=t.prototype;if(!e)return{defaultProps:{}};var r=Object.getPrototypeOf(t),i=e&&Ts(r)||null,n=function(t){for(var e={},r={},i={},n=Object.entries(t),a=0;a<n.length;a++){var o=C(n[a],2),s=o[0],u=o[1];if(u&&u.deprecatedFor)i[s]=Array.isArray(u.deprecatedFor)?u.deprecatedFor:[u.deprecatedFor];else{var l=xs(s,u);e[s]=l,r[s]=l.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}(Os(t,"defaultProps")||{}),a=Object.assign({},i&&i.propTypes,n.propTypes),o=function(t,e,r,i){var n=Object.create(null);Object.assign(n,e,t);var a=function(t){var e=Os(t,"layerName")||Os(t,"componentName");e||E.once(0,"".concat(t.name,".componentName not specified"))();return e||t.name}(i);return delete t.id,Object.defineProperties(n,{id:{configurable:!1,writable:!0,value:a}}),function(t,e){var r={},i={_asyncPropDefaultValues:{enumerable:!1,value:r},_asyncPropOriginalValues:{enumerable:!1,value:{}}};for(var n in e){var a=e[n],o=a.name,s=a.value;a.async&&(r[o]=s,i[o]=As(o))}Object.defineProperties(t,i)}(n,r),n}(n.defaultProps,i&&i.defaultProps,a,t),s=Object.assign({},i&&i.deprecatedProps,n.deprecatedProps);return t._mergedDefaultProps=o,t._propTypes=a,t._deprecatedProps=s,{propTypes:a,defaultProps:o,deprecatedProps:s}}(t)}function As(t){return{configurable:!1,enumerable:!0,set:function(e){"string"==typeof e||e instanceof Promise?this._asyncPropOriginalValues[t]=e:this._asyncPropResolvedValues[t]=e},get:function(){if(this._asyncPropResolvedValues){if(t in this._asyncPropResolvedValues){var e=this._asyncPropResolvedValues[t];return"data"===t?e||this._asyncPropDefaultValues[t]:e}if(t in this._asyncPropOriginalValues){var r=this._component&&this._component.internalState;if(r&&r.hasAsyncProp(t))return r.getAsyncProp(t)}}return this._asyncPropDefaultValues[t]}}}function Ps(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Os(t,e){return Ps(t,e)&&t[e]}var Is=Object.freeze({}),Ms=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;Object(s.a)(this,t),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=Is,this.oldAsyncProps=null}return Object(u.a)(t,[{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps)for(var t in this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps={},this.oldProps)this.oldAsyncProps[t]=this.oldProps[t]}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}},{key:"setAsyncProps",value:function(t){var e=t._asyncPropResolvedValues||{},r=t._asyncPropOriginalValues||t,i=t._asyncPropDefaultValues||{};for(var n in e){var a=e[n];this._createAsyncPropData(n,a,i[n]),this._updateAsyncProp(n,a)}for(var o in r){var s=r[o];this._createAsyncPropData(o,s,i[o]),this._updateAsyncProp(o,s)}}},{key:"_updateAsyncProp",value:function(t,e){if(this._didAsyncInputValueChange(t,e)){if("string"==typeof e)e=(0,this.layer.props.fetch)(e,{propName:t,layer:this.layer});e instanceof Promise?this._watchPromise(t,e):this._setPropValue(t,e)}}},{key:"_didAsyncInputValueChange",value:function(t,e){var r=this.asyncProps[t];return e!==r.lastValue&&(r.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){var r=this.asyncProps[t];r.value=e,r.resolvedValue=e,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount}},{key:"_setAsyncPropValue",value:function(t,e,r){var i=this.asyncProps[t];i&&r>=i.resolvedLoadCount&&(Wa(void 0!==e),this.freezeAsyncOldProps(),e=this._postProcessValue(t,e),i.resolvedValue=e,i.resolvedLoadCount=r,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var r=this,i=this.asyncProps[t];i.pendingLoadCount++;var n=i.pendingLoadCount;e.then(function(e){return r._setAsyncPropValue(t,e,n)}).catch(function(t){return E.error(t)()})}},{key:"_postProcessValue",value:function(t,e){var r=(this.component?this.component.props:{}).dataTransform;return"data"===t&&r&&(e=r(e)),e}},{key:"_createAsyncPropData",value:function(t,e,r){this.asyncProps[t]||(this.asyncProps[t]={lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0})}}]),t}(),Cs=0,Ls=function(){function t(){Object(s.a)(this,t),this.props=function(){for(var t=Ts(this.constructor),e=t.defaultProps,r=Object.create(e,{_component:{enumerable:!1,value:this},_asyncPropOriginalValues:{enumerable:!1,value:{}},_asyncPropResolvedValues:{enumerable:!1,value:{}}}),i=0;i<arguments.length;++i)Object.assign(r,arguments[i]);var n=this.constructor.layerName,a=t.deprecatedProps;return Ss(n,r,a),Ss(n,r.updateTriggers,a),Ss(n,r.transitions,a),os(r),Object.freeze(r),r}.apply(this,arguments),this.id=this.props.id,this.count=Cs++,this.lifecycle=ys.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return Object(u.a)(t,[{key:"clone",value:function(t){var e=this.props,r={};for(var i in e._asyncPropDefaultValues)i in e._asyncPropResolvedValues?r[i]=e._asyncPropResolvedValues[i]:i in e._asyncPropOriginalValues&&(r[i]=e._asyncPropOriginalValues[i]);return new this.constructor(Object.assign({},e,r,t))}},{key:"_initState",value:function(){this.internalState=new Ms({})}},{key:"stats",get:function(){return this.internalState.stats}}]),t}();Ls.componentName="Component",Ls.defaultProps={};var js=function(t){function e(t){var r,i=t.attributeManager,n=t.layer;return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,n))).attributeManager=i,r.model=null,r.needsRedraw=!0,r.subLayers=null,r}return Pt(e,Ms),Object(u.a)(e,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}}]),e}(),zs=Object.freeze([]),Rs=new Uint8ClampedArray(0),Fs={data:{type:"data",value:zs,async:!0},dataComparator:null,dataTransform:{type:"function",value:function(t){return t},compare:!1},fetch:{type:"function",value:function(t){return fetch(t).then(function(t){return t.json()})},compare:!1},updateTriggers:{},numInstances:void 0,visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:.8},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:Ga.LNGLAT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,parameters:{},uniforms:{},framebuffer:null,animation:null,getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"color",value:[0,0,128,128]}},Ds=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Ls),Object(u.a)(e,[{key:"toString",value:function(){var t=this.constructor.layerName||this.constructor.name;return"".concat(t,"({id: '").concat(this.props.id,"'})")}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.internalState&&(this.internalState.needsRedraw=t)}},{key:"setLayerNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this))}},{key:"getNeedsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this.shouldUpdateState(this._getUpdateParams())}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getSingleModel",value:function(){return this.state&&this.state.model}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getFirstObject",value:function(){var t=this.props.data,e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){return n.value}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}return null}},{key:"project",value:function(t){var e=this.context.viewport,r=C(jo(Fo(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),e.pixelProjectionMatrix),3),i=r[0],n=r[1],a=r[2];return 2===t.length?[i,n]:[i,n,a]}},{key:"unproject",value:function(t){var e=this.context.viewport;return Wa(Array.isArray(t)),e.unproject(t)}},{key:"projectPosition",value:function(t){return Wa(Array.isArray(t)),Do(t,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}},{key:"projectFlat",value:function(t){E.deprecated("layer.projectFlat","layer.projectPosition")();var e=this.context.viewport;return Wa(Array.isArray(t)),e.projectFlat(t)}},{key:"unprojectFlat",value:function(t){E.deprecated("layer.unprojectFlat")();var e=this.context.viewport;return Wa(Array.isArray(t)),e.unprojectFlat(t)}},{key:"use64bitProjection",value:function(){if(this.props.fp64){if(this.props.coordinateSystem===Ga.LNGLAT_DEPRECATED)return!0;E.once(0,"Legacy 64-bit mode only works with coordinateSystem set to\n        COORDINATE_SYSTEM.LNGLAT_DEPRECATED. Rendering in 32-bit mode instead")()}return!1}},{key:"use64bitPositions",value:function(){return this.props.fp64||this.props.coordinateSystem===Ga.LNGLAT}},{key:"screenToDevicePixels",value:function(t){return E.deprecated("screenToDevicePixels","DeckGL prop useDevicePixels for conversion")(),t*("undefined"!=typeof window?window.devicePixelRatio:1)}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Wa(t<16777215,"index out of picking color range"),e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){Wa(t instanceof Uint8Array);var e=C(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"shouldUpdateState",value:function(t){t.oldProps,t.props,t.context;return t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){t.oldProps,t.props,t.context;var e=t.changeFlags,r=this.getAttributeManager();e.dataChanged&&r&&r.invalidateAll()}},{key:"finalizeState",value:function(){var t=!0,e=!1,r=void 0;try{for(var i,n=this.getModels()[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){i.value.delete()}}catch(t){e=!0,r=t}finally{try{t||null==n.return||n.return()}finally{if(e)throw r}}var a=this.getAttributeManager();a&&a.finalize()}},{key:"draw",value:function(t){var e=!0,r=!1,i=void 0;try{for(var n,a=this.getModels()[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.draw(t)}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"getPickingInfo",value:function(t){var e=t.info,r=(t.mode,e.index);return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this.getAttributeManager();r&&("all"===t?(E.log(1,"updateTriggers invalidating all attributes: ".concat(e))(),r.invalidateAll()):(E.log(1,"updateTriggers invalidating attribute ".concat(t,": ").concat(e))(),r.invalidate(t)))}},{key:"updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var r=this.getNumInstances(t);e.update({data:t.data,numInstances:r,props:t,transitions:t.transitions,buffers:t,context:this,ignoreUnknownAttributes:!0});var i=this.getModels();if(i.length>0)for(var n=e.getChangedAttributes({clearChangedFlags:!0}),a=0,o=i.length;a<o;++a)this._setModelAttributes(i[a],n)}}},{key:"updateTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition(this.context.time)}},{key:"calculateInstancePickingColors",value:function(t,e){var r=e.numInstances,i=t.value,n=t.size;if(1!==i[0]){var a=Rs.length/n;if(a<r){var o=new Uint8ClampedArray(r*n);o.set(Rs);for(var s=[],u=a;u<r;u++)this.encodePickingColor(u,s),o[u*n+0]=s[0],o[u*n+1]=s[1],o[u*n+2]=s[2];Rs=o}i.set(r<a?Rs.subarray(0,r*n):Rs)}}},{key:"_setModelAttributes",value:function(t,e){var r={},i=t.userData.excludeAttributes||{};for(var n in e)i[n]||Object.assign(r,e[n].getShaderAttributes());t.setAttributes(r)}},{key:"_clearInstancePickingColor",value:function(t){var e=this.getAttributeManager().attributes.instancePickingColors,r=e.value,i=e.size,n=this.decodePickingColor(t);r[n*i+0]=0,r[n*i+1]=0,r[n*i+2]=0,e.update({value:r})}},{key:"_clearPickingColor",value:function(t){for(var e=this.getAttributeManager().attributes.pickingColors,r=e.value,i=0;i<r.length;i+=3)r[i+0]===t[0]&&r[i+1]===t[1]&&r[i+2]===t[2]&&(r[i+0]=0,r[i+1]=0,r[i+2]=0);e.update({value:r})}},{key:"clearPickingColor",value:function(t){this.getAttributeManager().attributes.pickingColors?this._clearPickingColor(t):this._clearInstancePickingColor(t)}},{key:"copyPickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors,r=t.instancePickingColors;return new Uint8ClampedArray((e||r).value)}},{key:"restorePickingColors",value:function(t){var e=this.getAttributeManager().attributes,r=e.pickingColors,i=e.instancePickingColors;(r||i).update({value:t})}},{key:"getNumInstances",value:function(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:gs(this.props.data)}},{key:"_initialize",value:function(){this._initState(),this.initializeState(this.context),this.state.attributeManager=this.getAttributeManager(),this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0}),this._updateState();var t=this.getSingleModel();t&&(t.id=this.props.id,t.program.id="".concat(this.props.id,"-program"))}},{key:"_update",value:function(){this.needsUpdate()&&this._updateState()}},{key:"_updateState",value:function(){var t=this._getUpdateParams();if(this.context.gl)this.updateState(t);else try{this.updateState(t)}catch(t){}this.isComposite?this._renderLayers(t):(this.setNeedsRedraw(),this.updateAttributes(this.props),this._updateBaseUniforms(),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances())),this.clearChangeFlags(),this.internalState.resetOldProps()}},{key:"_finalize",value:function(){var t;Wa(this.internalState&&this.state),this.finalizeState(this.context),t=this.id,sn.a.isReady()&&t&&sn.a.deleteItem("deck.gl",t)}},{key:"drawLayer",value:function(t){var e=this,r=t.moduleParameters,i=void 0===r?null:r,n=t.uniforms,a=void 0===n?{}:n,o=t.parameters,s=void 0===o?{}:o;a.picking_uActive||this.updateTransition(),i&&this.setModuleParameters(i);var u=this.context.animationProps;if(u){var l=!0,c=!1,h=void 0;try{for(var p,f=this.getModels()[Symbol.iterator]();!(l=(p=f.next()).done);l=!0){p.value._setAnimationProps(u)}}catch(t){c=!0,h=t}finally{try{l||null==f.return||f.return()}finally{if(c)throw h}}}var d=this.props.getPolygonOffset,v=d&&d(a)||[0,0];s.polygonOffset=v,D(this.context.gl,s,function(){e.draw({moduleParameters:i,uniforms:a,parameters:s,context:e.context})})}},{key:"pickLayer",value:function(t){return this.getPickingInfo(t)}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this;this.internalState.changeFlags=this.internalState.changeFlags||{};var r=this.internalState.changeFlags;t.dataChanged&&!r.dataChanged&&(r.dataChanged=t.dataChanged,E.log(2,function(){return"dataChanged: ".concat(t.dataChanged," in ").concat(e.id)})()),t.updateTriggersChanged&&!r.updateTriggersChanged&&(r.updateTriggersChanged=r.updateTriggersChanged&&t.updateTriggersChanged?Object.assign({},t.updateTriggersChanged,r.updateTriggersChanged):t.updateTriggersChanged||r.updateTriggersChanged,E.log(2,function(){return"updateTriggersChanged: "+"".concat(Object.keys(t.updateTriggersChanged).join(", ")," in ").concat(e.id)})()),t.propsChanged&&!r.propsChanged&&(r.propsChanged=t.propsChanged,E.log(2,function(){return"propsChanged: ".concat(t.propsChanged," in ").concat(e.id)})()),t.viewportChanged&&!r.viewportChanged&&(r.viewportChanged=t.viewportChanged,E.log(3,function(){return"viewportChanged: ".concat(t.viewportChanged," in ").concat(e.id)})()),t.stateChanged&&!r.stateChanged&&(r.stateChanged=t.stateChanged,E.log(2,function(){return"stateChanged: ".concat(t.stateChanged," in ").concat(e.id)})());var i=t.dataChanged||t.updateTriggersChanged||t.propsChanged;r.propsOrDataChanged=r.propsOrDataChanged||i,r.somethingChanged=r.somethingChanged||i||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"printChangeFlags",value:function(){var t=this.internalState.changeFlags;return"".concat(t.dataChanged?"data ":"").concat(t.propsChanged?"props ":"").concat(t.updateTriggersChanged?"triggers ":"").concat(t.viewportChanged?"viewport":"")}},{key:"diffProps",value:function(t,e){var r=hs(t,e);if(r.updateTriggersChanged)for(var i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this._activeUpdateTrigger(i);return this.setChangeFlags(r)}},{key:"validateProps",value:function(){!function(t){var e=ds(t);for(var r in e){var i=e[r],n=i.validate;if(n&&!n(t[r],i))throw new Error("Invalid prop ".concat(r,": ").concat(t[r]))}}(this.props)}},{key:"setModuleParameters",value:function(t){var e=!0,r=!1,i=void 0;try{for(var n,a=this.getModels()[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.updateModuleSettings(t)}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var r=this.getAttributeManager(),i=r&&r.getNeedsRedraw(t);return e=e||i}},{key:"_getAttributeManager",value:function(){return new ns(this.context.gl,{id:this.props.id,stats:this.context.stats})}},{key:"_initState",value:function(){Wa(!this.internalState&&!this.state);var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,update:this.calculateInstancePickingColors}}),this.internalState=new js({attributeManager:t,layer:this}),this.state={},this.state.attributeManager=t,this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){var e=t.state,r=t.internalState;if(Wa(e&&r),this!==t){this.internalState=r,this.internalState.component=this,this.state=e,e.layer=this,this.internalState.setAsyncProps(this.props);var i=!0,n=!1,a=void 0;try{for(var o,s=this.getModels()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){o.value.userData.layer=this}}catch(t){n=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw a}}this.diffProps(this.props,this.internalState.getOldProps())}}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setLayerNeedsUpdate()}},{key:"_activeUpdateTrigger",value:function(t){this.invalidateAttribute(t)}},{key:"_updateBaseUniforms",value:function(){var t=this,e={opacity:"function"==typeof this.props.opacity?function(e){return Math.pow(t.props.opacity(e),1/2.2)}:Math.pow(this.props.opacity,1/2.2)},r=!0,i=!1,n=void 0;try{for(var a,o=this.getModels()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){a.value.setUniforms(e)}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}}},{key:"setUniforms",value:function(t){var e=!0,r=!1,i=void 0;try{for(var n,a=this.getModels()[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.setUniforms(t)}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}this.setNeedsRedraw(),E.deprecated("layer.setUniforms","model.setUniforms")()}},{key:"is64bitEnabled",value:function(){return E.deprecated("is64bitEnabled","use64bitProjection")(),this.use64bitProjection()}}]),e}();function Bs(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.filter,i=void 0===r?function(){return!0}:r,n=e.map,a=void 0===n?function(t){return t}:n,o=e.result,s=void 0===o?[]:o;return Array.isArray(t)?function t(e,r,i,n){var a=-1;for(;++a<e.length;){var o=e[a];Array.isArray(o)?t(o,r,i,n):r(o)&&n.push(i(o))}return n}(t,i,a,s):i(t)?[a(t)]:[]}function Ns(t){for(var e=t.target,r=t.source,i=t.start,n=void 0===i?0:i,a=t.count,o=void 0===a?1:a,s=r.length,u=o*s,l=0,c=n;l<s;l++)e[c++]=r[l];for(;l<u;)l<u-l?(e.copyWithin(n+l,n,n+l),l*=2):(e.copyWithin(n+l,n,n+u-l),l=u);return e}Ds.layerName="Layer",Ds.defaultProps=Fs;var Us=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Ds),Object(u.a)(e,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){Ve(Tt(e.prototype),"setState",this).call(this,t),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(t){return t.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(t,e){var r=this.props._subLayerProps;return e&&e.length||r&&r[t]}},{key:"getSubLayerClass",value:function(t,e){var r=this.props._subLayerProps;return r&&r[t]&&r[t].type||e}},{key:"getSubLayerProps",value:function(t){var e=this.props,r=e.opacity,i=e.pickable,n=e.visible,a=e.parameters,o=e.getPolygonOffset,s=e.highlightedObjectIndex,u=e.autoHighlight,l=e.highlightColor,c=e.coordinateSystem,h=e.coordinateOrigin,p=e.wrapLongitude,f=e.positionFormat,d=e.modelMatrix,v=e._subLayerProps,m={opacity:r,pickable:i,visible:n,parameters:a,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:u,highlightColor:l,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:p,positionFormat:f,modelMatrix:d};return t&&Object.assign(m,t,v&&v[t.id],{id:"".concat(this.props.id,"-").concat(t.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},t.updateTriggers)}),m}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers;t&&!this.needsUpdate()?E.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(t=Bs(t=this.renderLayers(),{filter:Boolean}),this.internalState.subLayers=t,E.log(2,"Composite layer rendered new subLayers ".concat(this),t)());var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.parent=this}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"isComposite",get:function(){return!0}}]),e}();Us.layerName="CompositeLayer";var Vs=Math.PI/180,Gs=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],qs=[0,0,0],Zs=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t);var r=e.id,i=void 0===r?null:r,n=e.x,a=void 0===n?0:n,o=e.y,u=void 0===o?0:o,l=e.width,c=void 0===l?1:l,h=e.height,p=void 0===h?1:h;this.id=i||this.constructor.displayName||"viewport",this.x=a,this.y=u,this.width=c||1,this.height=p||1,this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this),this.getMatrices=this.getMatrices.bind(this)}return Object(u.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Qr(e.projectionMatrix,this.projectionMatrix)&&Qr(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,r=void 0===e||e,i=jo(this.projectPosition(t),this.pixelProjectionMatrix),n=C(i,2),a=n[0],o=n[1],s=r?o:this.height-o;return 2===t.length?[a,s]:[a,s,i[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,i=void 0===r||r,n=e.targetZ,a=C(t,3),o=a[0],s=a[1],u=a[2],l=i?s:this.height-s,c=n&&n*this.distanceScales.pixelsPerMeter[2],h=zo([o,l,u],this.pixelUnprojectionMatrix,c),p=C(this.unprojectPosition(h),3),f=p[0],d=p[1],v=p[2];return Number.isFinite(u)?[f,d,v]:Number.isFinite(n)?[f,d,n]:[f,d]}},{key:"projectPosition",value:function(t){var e=C(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.distanceScales.pixelsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=C(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.distanceScales.metersPerPixel[2]]}},{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Po(t,e);var r=this.distanceScales.pixelsPerMeter;return[t[0]*r[0],t[1]*r[1]]}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;if(this.isGeospatial)return Oo(t,e);var r=this.distanceScales.metersPerPixel;return[t[0]*r[0],t[1]*r[1]]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Io({longitude:t[0],latitude:t[1],scale:this.scale,highPrecision:!0}):this.distanceScales}},{key:"getMatrices",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).modelMatrix,e=void 0===t?null:t,r=this.viewProjectionMatrix,i=this.pixelProjectionMatrix,n=this.pixelUnprojectionMatrix;return e&&(r=ha([],this.viewProjectionMatrix,e),n=ca([],i=ha([],this.pixelProjectionMatrix,e))),Object.assign({modelViewProjectionMatrix:r,viewProjectionMatrix:this.viewProjectionMatrix,viewMatrix:this.viewMatrix,projectionMatrix:this.projectionMatrix,pixelProjectionMatrix:i,pixelUnprojectionMatrix:n,width:this.width,height:this.height,scale:this.scale})}},{key:"containsPixel",value:function(t){var e=t.x,r=t.y,i=t.width,n=void 0===i?1:i,a=t.height,o=void 0===a?1:a;return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+o}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_addMetersToLngLat",value:function(t,e){var r=C(t,3),i=r[0],n=r[1],a=r[2],o=void 0===a?0:a,s=C(this._metersToLngLatDelta(e),3),u=s[0],l=s[1],c=s[2],h=void 0===c?0:c;return 2===t.length?[i+u,n+l]:[i+u,n+l,o+h]}},{key:"_metersToLngLatDelta",value:function(t){var e=C(t,3),r=e[0],i=e[1],n=e[2],a=void 0===n?0:n;Wa(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a),"Illegal argument to Viewport");var o=this.distanceScales,s=o.pixelsPerMeter,u=o.degreesPerPixel,l=r*s[0]*u[0],c=i*s[1]*u[1];return 2===t.length?[l,c]:[l,c,a]}},{key:"_createProjectionMatrix",value:function(t){var e=t.orthographic,r=t.fovyRadians,i=t.aspect,n=t.focalDistance,a=t.near,o=t.far;return Wa(Number.isFinite(r)),e?(new xa).orthographic({fovy:r,aspect:i,focalDistance:n,near:a,far:o}):(new xa).perspective({fovy:r,aspect:i,near:a,far:o})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,r=void 0===e?Gs:e,i=t.longitude,n=void 0===i?null:i,a=t.latitude,o=void 0===a?null:a,s=t.zoom,u=void 0===s?null:s,l=t.position,c=void 0===l?null:l,h=t.modelMatrix,p=void 0===h?null:h,f=t.focalDistance,d=void 0===f?1:f,v=t.distanceScales,m=void 0===v?null:v;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(n),this.zoom=u,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?function(t){var e=t.latitude;yo(Number.isFinite(e));var r=Math.cos(e*xo);return Ao(Eo*r)-9}({latitude:o})+Math.log2(d):0);var g=Math.pow(2,this.zoom);this.scale=g,this.distanceScales=this.isGeospatial?Io({latitude:o,longitude:n,scale:this.scale}):m||{pixelsPerMeter:[g,g,g],metersPerPixel:[1/g,1/g,1/g]},this.focalDistance=d,this.distanceScales.metersPerPixel=new pi(this.distanceScales.metersPerPixel),this.distanceScales.pixelsPerMeter=new pi(this.distanceScales.pixelsPerMeter),this.position=qs,this.meterOffset=qs,c&&(this.position=c,this.modelMatrix=p,this.meterOffset=p?p.transformVector(c):c),this.isGeospatial?(this.longitude=n,this.latitude=o,this.center=this._getCenterInWorld({longitude:n,latitude:o}),this.viewMatrixUncentered=fa([],r,[1,-1,1])):(this.center=c?this.projectPosition(c):[0,0,0],this.viewMatrixUncentered=r),this.viewMatrix=(new xa).multiplyRight(this.viewMatrixUncentered).translate(new pi(this.center||qs).negate())}},{key:"_getCenterInWorld",value:function(t){var e=t.longitude,r=t.latitude,i=this.meterOffset,n=this.scale,a=this.distanceScales,o=this.projectFlat([e,r],n),s=new pi(o[0],o[1],0);if(i){var u=new pi(i).scale(a.pixelsPerMeter);s.add(u)}return s}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,r=void 0===e?null:e,i=t.orthographic,n=void 0!==i&&i,a=t.fovyRadians,o=t.fovyDegrees,s=t.fovy,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?1e3:c,p=t.focalDistance,f=void 0===p?1:p,d=t.orthographicFocalDistance,v=a||(o||s||75)*Vs;this.projectionMatrix=r||this._createProjectionMatrix({orthographic:n,fovyRadians:v,aspect:this.width/this.height,focalDistance:d||f,near:l,far:h})}},{key:"_initPixelMatrices",value:function(){var t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ha(t,t,this.projectionMatrix),ha(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=ca([],this.viewMatrix)||this.viewMatrix;var e,r,i,n=(e={viewMatrix:this.viewMatrix,viewMatrixInverse:this.viewMatrixInverse},r=e.viewMatrix,{eye:[(i=e.viewMatrixInverse)[12],i[13],i[14]],direction:[r[2],r[6],r[10]],up:[r[1],r[5],r[9]]}),a=n.eye,o=n.direction,s=n.up;this.cameraPosition=a,this.cameraDirection=o,this.cameraUp=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];fa(u,u,[this.width/2,-this.height/2,1]),pa(u,u,[1,-1,0]),ha(l,u,this.viewProjectionMatrix),this.pixelProjectionMatrix=l,this.viewportMatrix=u,this.pixelUnprojectionMatrix=ca([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||E.warn("Pixel project matrix not invertible")()}}]),t}();Zs.displayName="Viewport";var Xs=Object.seal({layerManager:null,deck:null,gl:null,time:-1,useDevicePixels:!0,stats:null,shaderCache:null,pickingFBO:null,animationProps:null,userData:{}}),Ws=function(t){return t instanceof Ds?"".concat(t):t?"invalid":"null"},Hs=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.deck,n=r.stats,a=r.viewport,o=void 0===a?null:a;Object(s.a)(this,t),this.lastRenderedLayers=[],this.layers=[],this.context=Object.assign({},Xs,{layerManager:this,deck:i,gl:e,shaderCache:e&&new On({gl:e,_cachePrograms:!0}),stats:n||new O({id:"deck.gl"}),viewport:o||new Zs({id:"DEFAULT-INITIAL-VIEWPORT"})}),this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),this._initSeer=this._initSeer.bind(this),this._editSeer=this._editSeer.bind(this),Object.seal(this),us(this._initSeer),ss(this._editSeer)}return Object(u.a)(t,[{key:"finalize",value:function(){var t=!0,e=!1,r=void 0;try{for(var i,n=this.layers[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var a=i.value;this._finalizeLayer(a)}}catch(t){e=!0,r=t}finally{try{t||null==n.return||n.return()}finally{if(e)throw r}}sn.a.removeListener(this._initSeer),sn.a.removeListener(this._editSeer)}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};return this._checkIfNeedsRedraw(t)}},{key:"needsUpdate",value:function(){return this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds,e=void 0===t?null:t;return e?this.layers.filter(function(t){return e.find(function(e){return 0===t.id.indexOf(e)})}):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"useDevicePixels"in t&&(this.context.useDevicePixels=t.useDevicePixels),"layers"in t&&this.setLayers(t.layers)}},{key:"setLayers",value:function(t){if(t===this.lastRenderedLayers)return E.log(3,"Ignoring layer update due to layer array not changed")(),this;this.lastRenderedLayers=t,t=Bs(t,{filter:Boolean});var e=!0,r=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.context=this.context}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}var o=this._updateLayers({oldLayers:this.layers,newLayers:t}),s=o.error,u=o.generatedLayers;if(this.layers=u,s)throw s;return this}},{key:"updateLayers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"time"in t&&(this.context.time=t.time);var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(Object(a.a)(this.lastRenderedLayers)))}},{key:"_checkIfNeedsRedraw",value:function(t){var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var r=!0,i=!1,n=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value.getNeedsRedraw(t);e=e||s}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}return e}},{key:"activateViewport",value:function(t){var e=this.context.viewport;if(!e||!t.equals(e)){E.log(4,"Viewport changed",t)(),this.context.viewport=t;var r=!0,i=!1,n=void 0;try{for(var a,o=this.layers[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;s.setChangeFlags({viewportChanged:"Viewport changed"}),this._updateLayer(s)}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}}return Wa(this.context.viewport,"LayerManager: viewport not set"),this}},{key:"_updateLayers",value:function(t){var e=t.oldLayers,r=t.newLayers,i={},n=!0,a=!1,o=void 0;try{for(var s,u=e[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=s.value;i[l.id]?E.warn("Multiple old layers with same id ".concat(Ws(l)))():i[l.id]=l}}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}var c=[],h=this._updateSublayersRecursively({newLayers:r,oldLayerMap:i,generatedLayers:c}),p=this._finalizeOldLayers(i);return this._needsUpdate=!1,{error:h||p,generatedLayers:c}}},{key:"_updateSublayersRecursively",value:function(t){var e=t.newLayers,r=t.oldLayerMap,i=t.generatedLayers,n=null,a=!0,o=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;c.context=this.context;var h=r[c.id];null===h&&E.warn("Multiple new layers with same id ".concat(Ws(c)))(),r[c.id]=null;var p=null;try{if(this._debug&&h!==c&&c.validateProps(),h){this._transferLayerState(h,c);var f=this._updateLayer(c);n=n||f,cs(c)}else{var d=this._initializeLayer(c);n=n||d,ls(c)}i.push(c),p=c.isComposite&&c.getSubLayers()}catch(d){E.warn("error during matching of ".concat(Ws(c)),d)(),n=n||d}if(p){var v=this._updateSublayersRecursively({newLayers:p,oldLayerMap:r,generatedLayers:i});n=n||v}}}catch(d){o=!0,s=d}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return n}},{key:"_finalizeOldLayers",value:function(t){var e=null;for(var r in t){var i=t[r];i&&(e=e||this._finalizeLayer(i))}return e}},{key:"_initializeLayer",value:function(t){E.log(2,"initializing ".concat(Ws(t)))();var e=null;try{t._initialize(),t.lifecycle=ys.INITIALIZED}catch(r){E.warn("error while initializing ".concat(Ws(t),"\n"),r)(),e=e||r}t.internalState.layer=t;var r=!0,i=!1,n=void 0;try{for(var a,o=t.getModels()[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){a.value.userData.layer=t}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}return e}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=ys.MATCHED,e!==t?(E.log(4,"matched ".concat(Ws(e)),t,"->",e)(),t.lifecycle=ys.AWAITING_GC):E.log(4,"Matching layer is unchanged ".concat(e.id))()}},{key:"_updateLayer",value:function(t){E.log(4,"updating ".concat(t," because: ").concat(t.printChangeFlags()))();var e=null;try{t._update()}catch(r){E.warn("error during update of ".concat(Ws(t)),r)(),e=r}return e}},{key:"_finalizeLayer",value:function(t){Wa(t.lifecycle!==ys.AWAITING_FINALIZATION),t.lifecycle=ys.AWAITING_FINALIZATION;var e=null;this.setNeedsRedraw("finalized ".concat(Ws(t)));try{t._finalize()}catch(r){E.warn("error during finalization of ".concat(Ws(t)),r)(),e=r}return t.lifecycle=ys.FINALIZED,E.log(2,"finalizing ".concat(Ws(t)))(),e}},{key:"_initSeer",value:function(){this.layers.forEach(function(t){ls(t),cs(t)})}},{key:"_editSeer",value:function(t){var e,r,i;"edit"===t.type&&"props"===t.valuePath[0]&&(e=t.itemKey,r=t.valuePath.slice(1),i=t.value,sn.a.isReady()&&(as.has(e)||as.set(e,new Map),as.get(e).set(r,i)),this.updateLayers())}}]),t}(),Ys=function(t){function e(t){var r;return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,t))).projectedLight=new bi(t),r}return Pt(e,bi),Object(u.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,r=e.context.viewport,i=e.props,n=i.coordinateSystem,a=i.coordinateOrigin,o=Do(this.position,{viewport:r,coordinateSystem:n,coordinateOrigin:a,fromCoordinateSystem:r.isGeospatial?Ga.LNGLAT:Ga.IDENTITY,fromCoordinateOrigin:[0,0,0]});return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=o,this.projectedLight}}]),e}();!function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}Pt(e,Ys),Object(u.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer,r=e.context.viewport,i=e.props,n=i.coordinateSystem,a=i.coordinateOrigin,o=eo({viewport:r,modelMatrix:i.modelMatrix,coordinateSystem:n,coordinateOrigin:a}).project_uCameraPosition;return this.projectedLight.color=this.color,this.projectedLight.intensity=this.intensity,this.projectedLight.position=o,this.projectedLight}}])}();function Ks(t,e){if(null==t)return{};var r,i,n=function(t,e){if(null==t)return{};var r,i,n={},a=Object.keys(t);for(i=0;i<a.length;i++)r=a[i],e.indexOf(r)>=0||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)r=a[i],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}var Js=Math.PI/180,Qs=864e5,$s=2440588,tu=2451545,eu=23.4397*Js,ru=357.5291,iu=.98560028,nu=280.147,au=360.9856235;function ou(t,e,r){var i,n,a,o,s,u,l=Js*-r,c=Js*e,h=function(t){return function(t){return t/Qs-.5+$s}(t)-tu}(t),p=(i=Js*(ru+iu*h),n=Js*(1.9148*Math.sin(i)+.02*Math.sin(2*i)+3e-4*Math.sin(3*i)),a=i+n+102.9372*Js+Math.PI,{declination:(o=a,s=0,u=o,Math.asin(Math.sin(s)*Math.cos(eu)+Math.cos(s)*Math.sin(eu)*Math.sin(u))),rightAscension:su(a,0)}),f=function(t,e){return Js*(nu+au*t)-e}(h,l)-p.rightAscension;return{azimuth:uu(f,c,p.declination),altitude:lu(f,c,p.declination)}}function su(t,e){var r=t;return Math.atan2(Math.sin(r)*Math.cos(eu)-Math.tan(e)*Math.sin(eu),Math.cos(r))}function uu(t,e,r){var i=t,n=e,a=r;return Math.atan2(Math.sin(i),Math.cos(i)*Math.sin(n)-Math.tan(a)*Math.cos(n))}function lu(t,e,r){var i=t,n=e,a=r;return Math.asin(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(i))}!function(t){function e(t){var r,i=t.timestamp,n=Ks(t,["timestamp"]);return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,n))).timestamp=i,r}Pt(e,_i),Object(u.a)(e,[{key:"getProjectedLight",value:function(t){var e=t.layer.context.viewport,r=e.latitude,i=e.longitude;return this.direction=function(t,e,r){var i=ou(t,e,r),n=i.azimuth,a=i.altitude,o=n+Math.PI;return[-Math.sin(o),-Math.cos(o),-Math.sin(a)]}(this.timestamp,r,i),this}}])}();function cu(t,e){return t===e||Object.keys(t).every(function(r){return Array.isArray(t[r])&&Array.isArray(e[r])?cu(t[r],e[r]):t[r]===e[r]})}var hu=/([0-9]+\.?[0-9]*)(%|px)/;function pu(t){switch(Object(n.a)(t)){case"number":return{position:t,relative:!1};case"string":var e=t.match(hu);if(e&&e.length>=3){var r="%"===e[2],i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error("Could not parse position string ".concat(t))}}function fu(t,e){return t.relative?Math.round(t.position*e):t.position}var du=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t);var r=e.id,i=void 0===r?null:r,n=e.x,a=void 0===n?0:n,o=e.y,u=void 0===o?0:o,l=e.width,c=void 0===l?"100%":l,h=e.height,p=void 0===h?"100%":h,f=e.projectionMatrix,d=void 0===f?null:f,v=e.fovy,m=void 0===v?50:v,g=e.near,y=void 0===g?.1:g,_=e.far,b=void 0===_?1e3:_,x=e.modelMatrix,w=void 0===x?null:x,k=e.viewportInstance,E=void 0===k?null:k,S=e.type,T=void 0===S?Zs:S;Wa(!E||E instanceof Zs),this.viewportInstance=E,this.id=i||this.constructor.displayName||"view",this.type=T,this.props=Object.assign({},e,{projectionMatrix:d,fovy:m,near:y,far:b,modelMatrix:w}),this._parseDimensions({x:a,y:u,width:c,height:p}),this.equals=this.equals.bind(this),Object.seal(this)}return Object(u.a)(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):cu(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,r=t.height,i=t.viewState;if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);var n=this.getDimensions({width:e,height:r}),a=Object.assign({viewState:i},i,this.props,n);return this._getViewport(a)}},{key:"getViewStateId",value:function(){switch(Object(n.a)(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===Object(n.a)(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=Object.assign({},t);for(var r in this.props.viewState)"id"!==r&&(e[r]=this.props.viewState[r]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,r=t.height;return{x:fu(this._x,e),y:fu(this._y,r),width:fu(this._width,e),height:fu(this._height,r)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),Object.assign({},t,e)):null}},{key:"_getViewport",value:function(t){return new(0,this.type)(t)}},{key:"_parseDimensions",value:function(t){var e=t.x,r=t.y,i=t.width,n=t.height;this._x=pu(e),this._y=pu(r),this._width=pu(i),this._height=pu(n)}}]),t}(),vu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractiveStateChange:e.onInteractiveStateChange},Object.seal(this),this.setProps(e)}return Object(u.a)(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("time"in t)for(var e in this.controllers){var r=this.controllers[e];r&&r.updateTransition(t.time)}}},{key:"getViewports",value:function(t){return t?this._viewports.filter(function(e){return e.containsPixel(t)}):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach(function(e){t[e.id]=e}),t}},{key:"getView",value:function(t){return"string"==typeof t?this.views.find(function(e){return e.id===t}):t}},{key:"getViewState",value:function(t){var e=this.getView(t),r=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(r):r}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"project",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{topLeft:!0},r=this.getViewports(),i=r.length-1;i>=0;--i){var n=r[i];if(n.contains(t,e))return n.project(t,e)}return null}},{key:"unproject",value:function(t,e){for(var r=this.getViewports(),i=r.length-1;i>=0;--i){var n=r[i];if(n.containsPixel(t,e))return n.unproject(t)}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){Wa(Number.isFinite(t)&&Number.isFinite(e)),t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=Bs(t,{filter:Boolean}).map(function(t){return t instanceof Zs?new du({viewportInstance:t}):t}),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!cu(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):E.warn("setting null viewState")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t){return new(0,t.type)(Object.assign({eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractiveStateChange},t))}},{key:"_updateController",value:function(t,e,r,i){if(t.controller){var n=Object.assign({},t.controller,e,{id:t.id,x:r.x,y:r.y,width:r.width,height:r.height});return i?i.setProps(n):i=this._createController(n),i}return null}},{key:"_rebuildViewports",value:function(){var t=this,e=this.width,r=this.height,i=this.views,n=this.controllers;for(var a in this.controllers={},this._viewports=i.map(function(i){var a=t.getViewState(i),o=i.makeViewport({width:e,height:r,viewState:a});return t.controllers[i.id]=t._updateController(i,a,o,n[i.id]),o}),n)n[a]&&!this.controllers[a]&&n[a].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach(function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)})}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some(function(r,i){return!t[i].equals(e[i])})}}]),t}(),mu=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],gu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,i=e.height,n=e.viewMatrix,a=void 0===n?mu:n,o=e.projectionMatrix,u=void 0===o?mu:o;Object(s.a)(this,t),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];ha(l,l,this.projectionMatrix),ha(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];fa(c,c,[this.width/2,-this.height/2,1]),pa(c,c,[1,-1,0]),ha(c,c,this.viewProjectionMatrix);var h=ca([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c);if(!h)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=h,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(u.a)(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&ya(e.projectionMatrix,this.projectionMatrix)&&ya(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,r=void 0===e||e,i=jo(this.projectPosition(t),this.pixelProjectionMatrix),n=C(i,2),a=n[0],o=n[1],s=r?o:this.height-o;return 2===t.length?[a,s]:[a,s,i[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,i=void 0===r||r,n=e.targetZ,a=C(t,3),o=a[0],s=a[1],u=a[2],l=i?s:this.height-s,c=n&&n*this.pixelsPerMeter,h=zo([o,l,u],this.pixelUnprojectionMatrix,c),p=C(this.unprojectPosition(h),3),f=p[0],d=p[1],v=p[2];return Number.isFinite(u)?[f,d,v]:Number.isFinite(n)?[f,d,n]:[f,d]}},{key:"projectPosition",value:function(t){var e=C(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=C(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return t}}]),t}(),yu=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.width,n=r.height,a=r.latitude,o=void 0===a?0:a,u=r.longitude,l=void 0===u?0:u,c=r.zoom,h=void 0===c?0:c,p=r.pitch,f=void 0===p?0:p,d=r.bearing,v=void 0===d?0:d,m=r.altitude,g=void 0===m?1.5:m,y=r.nearZMultiplier,_=r.farZMultiplier;Object(s.a)(this,e),i=i||1,n=n||1;var b=To(h);g=Math.max(.75,g);var x=Po([l,o],b);x[2]=0;var w=function(t){var e=t.width,r=t.height,i=t.pitch,n=Lo({width:e,height:r,altitude:t.altitude,pitch:i,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return ma([],n.fov,n.aspect,n.near,n.far)}({width:i,height:n,pitch:f,bearing:v,altitude:g,nearZMultiplier:y||1/n,farZMultiplier:_||1.01}),k=Co({height:n,center:x,pitch:f,bearing:v,altitude:g,flipY:!0});return(t=St(this,Tt(e).call(this,{width:i,height:n,viewMatrix:k,projectionMatrix:w}))).latitude=o,t.longitude=l,t.zoom=h,t.pitch=f,t.bearing=v,t.altitude=g,t.scale=b,t.center=x,t.pixelsPerMeter=Io(Et(Et(t))).pixelsPerMeter[2],Object.freeze(Et(Et(t))),t}return Pt(e,gu),Object(u.a)(e,[{key:"projectFlat",value:function(t){return Po(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"unprojectFlat",value:function(t){return Oo(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,r=zo(t.pos,this.pixelUnprojectionMatrix),i=ia([],Po(e,this.scale),oa([],r));return Oo(ia([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,n=this.height,a=_u(Object.assign({width:i,height:n,bounds:t},r));return new e({width:i,height:n,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}();function _u(t){var e=t.width,r=t.height,i=t.bounds,n=t.padding,a=void 0===n?0:n,o=t.offset,s=void 0===o?[0,0]:o,u=C(i,2),l=C(u[0],2),c=l[0],h=l[1],p=C(u[1],2),f=p[0],d=p[1];if(Number.isFinite(a)){a={top:a,bottom:a,left:a,right:a}}else yo(Number.isFinite(a.top)&&Number.isFinite(a.bottom)&&Number.isFinite(a.left)&&Number.isFinite(a.right));var v=new yu({width:e,height:r,longitude:0,latitude:0,zoom:0}),m=v.project([c,d]),g=v.project([f,h]),y=[Math.abs(g[0]-m[0]),Math.abs(g[1]-m[1])],_=[e-a.left-a.right-2*Math.abs(s[0]),r-a.top-a.bottom-2*Math.abs(s[1])];yo(_[0]>0&&_[1]>0);var b=_[0]/y[0],x=_[1]/y[1],w=(a.right-a.left)/2/b,k=(a.bottom-a.top)/2/x,E=[(g[0]+m[0])/2+w,(g[1]+m[1])/2+k],S=v.unproject(E),T=v.zoom+Math.log2(Math.abs(Math.min(b,x)));return{longitude:S[0],latitude:S[1],zoom:T}}var bu=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e);var i=r.latitude,n=void 0===i?0:i,a=r.longitude,o=void 0===a?0:a,u=r.zoom,l=void 0===u?11:u,c=r.pitch,h=void 0===c?0:c,p=r.bearing,f=void 0===p?0:p,d=r.nearZMultiplier,v=void 0===d?.1:d,m=r.farZMultiplier,g=void 0===m?10:m,y=r.orthographic,_=void 0!==y&&y,b=r.width,x=r.height,w=r.altitude,k=void 0===w?1.5:w,E=Lo({width:b=b||1,height:x=x||1,pitch:h,altitude:k=Math.max(.75,k),nearZMultiplier:v,farZMultiplier:g}),S=E.fov,T=E.aspect,A=E.focalDistance,P=E.near,O=E.far,I=Co({height:x,pitch:h,bearing:f,altitude:k}),M=Object.assign({},r,{width:b,height:x,viewMatrix:I,longitude:o,latitude:n,zoom:l,orthographic:_,fovyRadians:S,aspect:T,orthographicFocalDistance:A,near:P,far:O});return(t=St(this,Tt(e).call(this,M))).latitude=n,t.longitude=o,t.zoom=l,t.pitch=h,t.bearing=f,t.altitude=k,t.orthographic=_,t.metersToLngLatDelta=t.metersToLngLatDelta.bind(Et(Et(t))),t.lngLatDeltaToMeters=t.lngLatDeltaToMeters.bind(Et(Et(t))),t.addMetersToLngLat=t.addMetersToLngLat.bind(Et(Et(t))),Object.freeze(Et(Et(t))),t}return Pt(e,Zs),Object(u.a)(e,[{key:"metersToLngLatDelta",value:function(t){var e=C(t,3),r=e[0],i=e[1],n=e[2],a=void 0===n?0:n;Wa(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerMeter,u=o.degreesPerPixel,l=r*s[0]*u[0],c=i*s[1]*u[1];return 2===t.length?[l,c]:[l,c,a]}},{key:"lngLatDeltaToMeters",value:function(t){var e=C(t,3),r=e[0],i=e[1],n=e[2],a=void 0===n?0:n;Wa(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a),"Illegal argument to WebMercatorViewport");var o=this.distanceScales,s=o.pixelsPerDegree,u=o.metersPerPixel,l=r*s[0]*u[0],c=i*s[1]*u[1];return 2===t.length?[l,c]:[l,c,a]}},{key:"addMetersToLngLat",value:function(t,e){return Mo(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,r=zo(t.pos,this.pixelUnprojectionMatrix),i=ia([],this.projectFlat(e),oa([],r)),n=ia([],this.center,i);return this.unprojectFlat(n)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,r=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,n=this.height,a=_u(Object.assign({width:i,height:n,bounds:t},r));return new e({width:i,height:n,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),e}();bu.displayName="WebMercatorViewport";var xu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var r=e,i=r.compare,n=r.extract,a=r.required;this._propsToCompare=i,this._propsToExtract=n,this._requiredProps=a}return Object(u.a)(t,[{key:"arePropsEqual",value:function(t,e){var r=!0,i=!1,n=void 0;try{for(var a,o=(this._propsToCompare||Object.keys(e))[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;if(!Qr(t[s],e[s]))return!1}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}return!0}},{key:"initializeProps",value:function(t,e){var r;if(this._propsToExtract){var i={},n={},a=!0,o=!1,s=void 0;try{for(var u,l=this._propsToExtract[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;i[c]=t[c],n[c]=e[c]}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}r={start:i,end:n}}else r={start:t,end:e};return this._checkRequiredProps(r.start),this._checkRequiredProps(r.end),r}},{key:"interpolateProps",value:function(t,e,r){Wa(!1,"interpolateProps is not implemented")}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach(function(e){var r=t[e];Wa(Number.isFinite(r)||Array.isArray(r),"".concat(e," is required for transition"))})}}]),t}(),wu=["longitude","latitude","zoom","bearing","pitch"],ku=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wu;return Object(s.a)(this,e),St(this,Tt(e).call(this,t))}return Pt(e,xu),Object(u.a)(e,[{key:"interpolateProps",value:function(t,e,r){var i={};for(var n in e)i[n]=Jr(t[n],e[n],r);return i}}]),e}(),Eu=function(){},Su=1,Tu=2,Au=3,Pu={transitionDuration:0,transitionEasing:function(t){return t},transitionInterpolator:new ku,transitionInterruption:Su,onTransitionStart:Eu,onTransitionInterrupt:Eu,onTransitionEnd:Eu},Ou=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),Wa(e),this.ControllerState=e,this.props=Object.assign({},Pu,r),this.propsInTransition=null,this.time=0,this.transition=new Qo,this.onViewStateChange=r.onViewStateChange,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return Object(u.a)(t,[{key:"finalize",value:function(){}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,r=this.props;if(t=Object.assign({},Pu,t),this.props=t,this._shouldIgnoreViewportChange(r,t))return e;if(this._isTransitionEnabled(t)){var i=Object.assign({},r,this.transition.interruption===Tu?this.transition.endProps:this.propsInTransition||r);this._triggerTransition(i,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(t){this.time=t,this._updateTransition()}},{key:"_isTransitionEnabled",value:function(t){return t.transitionDuration>0&&t.transitionInterpolator}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.interruption===Au||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){Wa(this._isTransitionEnabled(e),"Transition is not enabled");var r=new this.ControllerState(t),i=new this.ControllerState(e).shortestPathFrom(r),n=e.transitionInterpolator.initializeProps(t,i);this.propsInTransition={},this.transition.start({duration:e.transitionDuration,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:n.start,endProps:n.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this._updateTransition()}},{key:"_updateTransition",value:function(){this.transition.update(this.time)}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(r){e.propsInTransition=null,t(r)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.interpolator,r=t.startProps,i=t.endProps,n=t.time,a=e.interpolateProps(r,i,n);this.propsInTransition=new this.ControllerState(Object.assign({},this.props,a)).getViewportProps(),this.onViewStateChange&&this.onViewStateChange({viewState:this.propsInTransition,interactionState:{inTransition:!0}})}}]),t}();Ou.defaultProps=Pu;var Iu={transitionDuration:0},Mu=["wheel"],Cu=["panstart","panmove","panend"],Lu=["pinchstart","pinchmove","pinchend"],ju=["doubletap"],zu=["keydown"],Ru=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),Wa(e),this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new Ou(e,r),this._events=null,this._state={isDragging:!1},this.events=[],this.onViewStateChange=null,this.onStateChange=null,this.invertPan=!1,this.handleEvent=this.handleEvent.bind(this),this.setProps(r)}return Object(u.a)(t,[{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){var e=this.ControllerState;switch(this.controllerState=new e(Object.assign({},this.controllerStateProps,this._state)),t.type){case"panstart":return this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,r=e.x,i=e.y,n=t.offsetCenter;return[n.x-r,n.y-i]}},{key:"isPointInBounds",value:function(t){var e=this.controllerStateProps,r=e.width,i=e.height;return t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=i}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._state.isDragging}},{key:"setProps",value:function(t){"onViewportChange"in t&&E.removed("onViewportChange")(),"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this.events,!0)),this.transitionManager.processViewStateChange(this.controllerStateProps);var e=t.scrollZoom,r=void 0===e||e,i=t.dragPan,n=void 0===i||i,a=t.dragRotate,o=void 0===a||a,s=t.doubleClickZoom,u=void 0===s||s,l=t.touchZoom,c=void 0===l||l,h=t.touchRotate,p=void 0!==h&&h,f=t.keyboard,d=void 0===f||f,v=Boolean(this.onViewStateChange);this.toggleEvents(Mu,v&&r),this.toggleEvents(Cu,v&&(n||o)),this.toggleEvents(Lu,v&&(c||p)),this.toggleEvents(ju,v&&u),this.toggleEvents(zu,v&&d),this.scrollZoom=r,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=u,this.touchZoom=c,this.touchRotate=p,this.keyboard=d}},{key:"updateTransition",value:function(t){this.transitionManager.updateTransition(t)}},{key:"toggleEvents",value:function(t,e){var r=this;this.eventManager&&t.forEach(function(t){r._events[t]!==e&&(r._events[t]=e,e?r.eventManager.on(t,r.handleEvent):r.eventManager.off(t,r.handleEvent))})}},{key:"setOptions",value:function(t){return this.setProps(t)}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.assign({},t.getViewportProps(),e);if(this.controllerState!==t){var n=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:r,oldViewState:n})}Object.assign(this._state,Object.assign({},t.getInteractiveState(),r)),this.onStateChange&&this.onStateChange(this._state)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var r=this.controllerState.panStart({pos:e}).rotateStart({pos:e});return this.updateViewport(r,Iu,{isDragging:!0})}},{key:"_onPan",value:function(t){var e=this.isFunctionKeyPressed(t)||t.rightButton;return(e=this.invertPan?!e:e)?this._onPanMove(t):this._onPanRotate(t)}},{key:"_onPanEnd",value:function(t){var e=this.controllerState.panEnd().rotateEnd();return this.updateViewport(e,null,{isDragging:!1})}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t);if(!this.isDragging())return!1;var r=this.controllerState.pan({pos:e});return this.updateViewport(r,Iu,{isDragging:!0})}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,r=t.deltaY,i=this.controllerState.getViewportProps(),n=e/i.width,a=r/i.height,o=this.controllerState.rotate({deltaScaleX:n,deltaScaleY:a});return this.updateViewport(o,Iu,{isDragging:!0})}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var r=t.delta,i=2/(1+Math.exp(-Math.abs(.01*r)));r<0&&0!==i&&(i=1/i);var n=this.controllerState.zoom({pos:e,scale:i});return this.updateViewport(n,Iu)}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var r=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._state.startPinchRotation=t.rotation,this.updateViewport(r,Iu,{isDragging:!0})}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;var e=this.controllerState;if(this.touchZoom){var r=t.scale,i=this.getCenter(t);e=e.zoom({pos:i,scale:r})}if(this.touchRotate){var n=t.rotation,a=this._state.startPinchRotation;e=e.rotate({deltaScaleX:-(n-a)/180})}return this.updateViewport(e,Iu,{isDragging:!0})}},{key:"_onPinchEnd",value:function(t){var e=this.controllerState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(e,null,{isDragging:!1})}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e))return!1;var r=this.isFunctionKeyPressed(t),i=this.controllerState.zoom({pos:e,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps())}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,r=this.isFunctionKeyPressed(t),i=this.controllerState;switch(t.srcEvent.keyCode){case 189:e=r?i.zoomOut().zoomOut():i.zoomOut();break;case 187:e=r?i.zoomIn().zoomIn():i.zoomIn();break;case 37:e=r?i.rotateLeft():i.moveLeft();break;case 39:e=r?i.rotateRight():i.moveRight();break;case 38:e=r?i.rotateUp():i.moveUp();break;case 40:e=r?i.rotateDown():i.moveDown();break;default:return!1}return this.updateViewport(e,this._getTransitionProps())}},{key:"_getTransitionProps",value:function(){return Iu}}]),t}(),Fu=6371e3,Du=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.phi,i=e.theta,n=e.radius,a=e.bearing,o=e.pitch,u=(e.altitude,e.radiusScale),l=void 0===u?Fu:u;Object(s.a)(this,t),0===arguments.length?(this.phi=0,this.theta=0,this.radius=1):Number.isFinite(r)||Number.isFinite(i)?(this.phi=r||0,this.theta=i||0):(Number.isFinite(a)||Number.isFinite(o))&&(this.bearing=a||0,this.pitch=o||0),this.radius=n||1,this.radiusScale=l||1,this.check()}return Object(u.a)(t,[{key:"toString",value:function(){return this.formatString(Vr)}},{key:"formatString",value:function(t){var e=t.printTypes,r=(t.printDegrees,Zr);return"".concat(e?"Spherical":"","[rho:").concat(r(this.radius),",theta:").concat(r(this.theta),",phi:").concat(r(this.phi),"]")}},{key:"equals",value:function(t){return Qr(this.radius,t.radius)&&Qr(this.theta,t.theta)&&Qr(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"set",value:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this.check()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=C(t,3),r=e[0],i=e[1],n=e[2];this.radius=1+n/this.radiusScale,this.phi=Hr(i),this.theta=Hr(r)}},{key:"fromVector3",value:function(t){return this.radius=ai(t),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Kr(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new pi(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}},{key:"bearing",get:function(){return 180-Yr(this.phi)},set:function(t){this.phi=Math.PI-Hr(t)}},{key:"pitch",get:function(){return Yr(this.theta)},set:function(t){this.theta=Hr(t)}},{key:"longitude",get:function(){return Yr(this.phi)}},{key:"latitude",get:function(){return Yr(this.theta)}},{key:"lng",get:function(){return Yr(this.phi)}},{key:"lat",get:function(){return Yr(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}}]),t}(),Bu={position:[0,0,0],lookAt:[0,0,0],up:[0,0,1],rotationX:0,rotationY:0,fov:50,near:1,far:100},Nu=function(){function t(e){Object(s.a)(this,t);var r=e.width,i=e.height,n=e.position,a=void 0===n?Bu.position:n;Wa(Number.isFinite(r),"`width` must be supplied"),Wa(Number.isFinite(i),"`height` must be supplied"),this._viewportProps=this._applyConstraints(Object.assign({},e,{position:new pi(a)}))}return Object(u.a)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getDirection",value:function(){return new Du({bearing:this._viewportProps.bearing,pitch:this._viewportProps.pitch}).toVector3().normalize()}},{key:"getDirectionFromBearing",value:function(t){return new Du({bearing:t,pitch:90}).toVector3().normalize()}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}(),Uu=85.05113,Vu=-85.05113;var Gu={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new ku,transitionInterruption:Su},qu={transitionDuration:0},Zu={minZoom:0,maxZoom:20,minPitch:0,maxPitch:60},Xu={pitch:0,bearing:0,altitude:1.5},Wu=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.width,n=r.height,a=r.latitude,o=r.longitude,u=r.zoom,l=r.bearing,c=void 0===l?Xu.bearing:l,h=r.pitch,p=void 0===h?Xu.pitch:h,f=r.altitude,d=void 0===f?Xu.altitude:f,v=r.maxZoom,m=void 0===v?Zu.maxZoom:v,g=r.minZoom,y=void 0===g?Zu.minZoom:g,_=r.maxPitch,b=void 0===_?Zu.maxPitch:_,x=r.minPitch,w=void 0===x?Zu.minPitch:x,k=r.startPanLngLat,E=r.startZoomLngLat,S=r.startBearing,T=r.startPitch,A=r.startZoom;return Object(s.a)(this,e),Wa(Number.isFinite(o),"`longitude` must be supplied"),Wa(Number.isFinite(a),"`latitude` must be supplied"),Wa(Number.isFinite(u),"`zoom` must be supplied"),(t=St(this,Tt(e).call(this,{width:i,height:n,latitude:a,longitude:o,zoom:u,bearing:c,pitch:p,altitude:d,maxZoom:m,minZoom:y,maxPitch:b,minPitch:w})))._interactiveState={startPanLngLat:k,startZoomLngLat:E,startBearing:S,startPitch:T,startZoom:A},t}return Pt(e,Nu),Object(u.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos;return this._getUpdatedState({startPanLngLat:this._unproject(e)})}},{key:"pan",value:function(t){var e=t.pos,r=t.startPos,i=this._interactiveState.startPanLngLat||this._unproject(r);if(!i)return this;var n=C(this._calculateNewLngLat({startPanLngLat:i,pos:e}),2),a=n[0],o=n[1];return this._getUpdatedState({longitude:a,latitude:o})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,r=void 0===e?0:e,i=t.deltaScaleY,n=void 0===i?0:i,a=this._interactiveState,o=a.startBearing,s=a.startPitch;if(!Number.isFinite(o)||!Number.isFinite(s))return this;var u=this._calculateNewPitchAndBearing({deltaScaleX:r,deltaScaleY:n,startBearing:o,startPitch:s}),l=u.pitch,c=u.bearing;return this._getUpdatedState({bearing:c,pitch:l})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,r=t.startPos,i=t.scale;Wa(i>0,"`scale` must be a positive number");var n=this._interactiveState,a=n.startZoom,o=n.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(r)||this._unproject(e)),Wa(o,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var s=this._calculateNewZoom({scale:i,startZoom:a}),u=C(new yu(Object.assign({},this._viewportProps,{zoom:s})).getLocationAtPoint({lngLat:o,pos:e}),2),l=u[0],c=u[1];return this._getUpdatedState({zoom:s,longitude:l,latitude:c})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(.5)}},{key:"moveLeft",value:function(){return this._panFromCenter([100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-100,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-100])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-10})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),r=Object.assign({},this._viewportProps),i=r.bearing,n=r.longitude;return Math.abs(i-e.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(n-e.longitude)>180&&(r.longitude=n<0?n+360:n-360),r}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps,r=e.width,i=e.height;return this.zoom({pos:[r/2,i/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,r=e.width,i=e.height;return this.pan({startPos:[r/2,i/2],pos:[r/2+t[0],i/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,r=t.minZoom,i=t.zoom;t.zoom=Kr(i,r,e);var n=t.maxPitch,a=t.minPitch,o=t.pitch;return t.pitch=Kr(o,a,n),Object.assign(t,function(t){var e=t.width,r=t.height,i=t.longitude,n=t.latitude,a=t.zoom,o=t.pitch,s=void 0===o?0:o,u=t.bearing,l=void 0===u?0:u;(i<-180||i>180)&&(i=go(i+180,360)-180),(l<-180||l>180)&&(l=go(l+180,360)-180);var c=new yu({width:e,height:r,longitude:i,latitude:n,zoom:a}),h=c.project([i,Uu])[1],p=c.project([i,Vu])[1],f=0;return p-h<r&&(a+=Math.log2(r/(p-h)),h=(c=new yu({width:e,height:r,longitude:i,latitude:n,zoom:a})).project([i,Uu])[1],p=c.project([i,Vu])[1]),h>0?f=h:p<r&&(f=p-r),f&&(n=c.unproject([e/2,r/2+f])[1]),{width:e,height:r,longitude:i,latitude:n,zoom:a,pitch:s,bearing:l}}(t)),t}},{key:"_unproject",value:function(t){var e=new yu(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var e=t.startPanLngLat,r=t.pos;return new yu(this._viewportProps).getMapCenterByLngLatPosition({lngLat:e,pos:r})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,r=t.startZoom,i=this._viewportProps,n=i.maxZoom,a=i.minZoom;return Kr(r+Math.log2(e),a,n)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,r=t.deltaScaleY,i=t.startBearing,n=t.startPitch;r=Kr(r,-1,1);var a=this._viewportProps,o=a.minPitch,s=a.maxPitch,u=n;return r>0?u=n+r*(s-n):r<0&&(u=n-r*(o-n)),{pitch:u,bearing:i+180*e}}}]),e}(),Hu=function(t){function e(t){var r;return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,Wu,t))).invertPan=!0,r}return Pt(e,Ru),Object(u.a)(e,[{key:"_getTransitionProps",value:function(){return Gu}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=t.deltaX,r=t.deltaY,i=C(this.getCenter(t),2)[1],n=i-r,a=this.controllerState.getViewportProps(),o=a.width,s=a.height,u=e/o,l=0;r>0?Math.abs(s-n)>5&&(l=r/(n-s)*1.2):r<0&&n>5&&(l=1-i/n),l=Math.min(1,Math.max(-1,l));var c=this.controllerState.rotate({deltaScaleX:u,deltaScaleY:l});return this.updateViewport(c,qu,{isDragging:!0})}}]),e}(),Yu=function(t){function e(t){return Object(s.a)(this,e),St(this,Tt(e).call(this,Object.assign({},t,{type:bu})))}return Pt(e,du),Object(u.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:Hu})}}]),e}();Yu.displayName="MapView";var Ku=function(){function t(){Object(s.a)(this,t),this.effects=[],this._needsRedraw="Initial render",this.defaultLightingEffect=new vo,this.needApplyDefaultLighting=!1}return Object(u.a)(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&cu(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed")),this.checkLightingEffect()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"getEffects",value:function(){var t=this.effects;return this.needApplyDefaultLighting&&(t=this.effects.slice()).push(this.defaultLightingEffect),t}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.effects=t}},{key:"checkLightingEffect",value:function(){var t=!1,e=!0,r=!1,i=void 0;try{for(var n,a=this.effects[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){if(n.value instanceof vo){t=!0;break}}}catch(t){r=!0,i=t}finally{try{e||null==a.return||a.return()}finally{if(r)throw i}}this.needApplyDefaultLighting=!t}}]),t}(),Ju=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t);var i=r.id,n=void 0===i?"pass":i;this.id=n,this.gl=e,this.props={},Object.assign(this.props,r)}return Object(u.a)(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(){}}]),t}(),Qu=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Ju),Object(u.a)(e,[{key:"render",value:function(t){return this.drawLayers(t)}},{key:"drawLayers",value:function(t){var e=this,r=t.layers,i=t.viewports,n=t.views,a=t.onViewportActive,o=t.deviceRect,s=void 0===o?null:o,u=t.parameters,l=void 0===u?{}:u,c=t.pass,h=void 0===c?"draw":c,p=t.redrawReason,f=void 0===p?"":p,d=t.clearCanvas,v=void 0===d||d,m=t.effects,g=t.effectProps,y=this.gl;v&&this.clearCanvas(y);var _=[];return i.forEach(function(t,i){var o=e.getViewportFromDescriptor(t),u=n&&n[o.id];a(o);var c=e.drawLayersInViewport(y,{layers:r,viewport:o,view:u,deviceRect:s,parameters:l,pass:h,redrawReason:f,effects:m,effectProps:g});_.push(c)}),_}},{key:"drawLayersInViewport",value:function(t,e){var r=this,i=e.layers,n=e.viewport,a=e.view,o=(e.deviceRect,e.parameters),s=void 0===o?{}:o,u=(e.pass,e.redrawReason,e.effects),l=e.effectProps,c=this.getGLViewport(t,{viewport:n});if(a&&a.props.clear){var h=!0===a.props.clear?{color:!0,depth:!0}:a.props.clear;D(t,{scissorTest:!0,scissor:c},function(){return ve(t,h)})}var p={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};return z(t,s||{}),i.forEach(function(e,i){var a=r.shouldDrawLayer(e,n);a&&e.props.pickable&&p.pickableCount++,e.isComposite&&p.compositeCount++,a&&(p.visibleCount++,r.drawLayerInViewport({gl:t,layer:e,layerIndex:i,glViewport:c,parameters:s,effects:u,effectProps:l}))}),p}},{key:"drawLayerInViewport",value:function(t){t.gl;var e=t.layer,r=t.layerIndex,i=t.glViewport,n=t.parameters,a=t.effects,o=t.effectProps,s=this.getModuleParameters(e,a,o),u=Object.assign({},e.context.uniforms,{layerIndex:r}),l=this.getLayerParameters(e,r,i,n);e.drawLayer({moduleParameters:s,uniforms:u,parameters:l})}},{key:"getViewportFromDescriptor",value:function(t){return t.viewport?t.viewport:t}},{key:"shouldDrawLayer",value:function(t,e){var r=this.props.layerFilter,i=!t.isComposite&&t.props.visible;return i&&r&&(i=r({layer:t,viewport:e,isPicking:!1})),i}},{key:"getModuleParameters",value:function(t){return Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:0,devicePixelRatio:this.props.pixelRatio})}},{key:"getLayerParameters",value:function(t,e,r,i){var n=Object.assign({},t.props.parameters||{},i);return Object.assign(n,{viewport:r}),n}},{key:"getGLViewport",value:function(t,e){var r=e.viewport,i=t.canvas?t.canvas.clientHeight||t.canvas.height:100,n=r,a=this.props.pixelRatio;return[n.x*a,(i-n.y-n.height)*a,n.width*a,n.height*a]}},{key:"clearCanvas",value:function(t){var e=t.drawingBufferWidth,r=t.drawingBufferHeight;D(t,{viewport:[0,0,e,r]},function(){t.clear(16640)})}}]),e}(),$u=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Qu),Object(u.a)(e,[{key:"getModuleParameters",value:function(t,r,i){var n=Ve(Tt(e.prototype),"getModuleParameters",this).call(this,t);Object.assign(n,this.getObjectHighlightParameters(t),i);var a=!0,o=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;Object.assign(n,c.getParameters(t))}}catch(t){o=!0,s=t}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return n}},{key:"getObjectHighlightParameters",value:function(t){var e=t.props,r=e.highlightedObjectIndex,i=e.highlightColor,n={pickingHighlightColor:[i[0],i[1],i[2],i[3]||255]};return Number.isInteger(r)&&(n.pickingSelectedColor=r>=0?t.encodePickingColor(r):null),n}}]),e}(),tl=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Qu),Object(u.a)(e,[{key:"render",value:function(t){t.pickingFBO?this.drawPickingBuffer(t):Ve(Tt(e.prototype),"render",this).call(this,t)}},{key:"drawPickingBuffer",value:function(t){var e=this,r=t.layers,i=t.viewports,n=t.onViewportActive,a=t.pickingFBO,o=t.effectProps,s=t.deviceRect,u=s.x,l=s.y,c=s.width,h=s.height,p=t.redrawReason,f=void 0===p?"":p;return D(this.gl,{framebuffer:a,scissorTest:!0,scissor:[u,l,c,h],clearColor:[0,0,0,0]},function(){e.drawLayers({layers:r,viewports:i,onViewportActive:n,pass:"picking",redrawReason:f,effectProps:o,parameters:{blend:!0,blendFunc:[1,0,32771,0],blendEquation:32774,blendColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]}})})}},{key:"shouldDrawLayer",value:function(t,e){var r=this.props.layerFilter,i=!t.isComposite&&t.props.visible&&t.props.pickable;return i&&r&&(i=r({layer:t,viewport:e,isPicking:!0})),i}},{key:"getModuleParameters",value:function(t,e,r){var i=Object.assign(Object.create(t.props),{viewport:t.context.viewport,pickingActive:1,devicePixelRatio:this.props.pixelRatio});return Object.assign(i,r),i}},{key:"getLayerParameters",value:function(t,e,r,i){var n=Object.assign({},t.props.parameters||{},i);return Object.assign(n,{viewport:r,blendColor:[0,0,0,(e+1)/255]}),n}}]),e}();function el(t){return Wa("boolean"==typeof t,"Invalid useDevicePixels"),t&&"undefined"!=typeof window?window.devicePixelRatio:1}var rl=function(){function t(e){Object(s.a)(this,t),this.gl=e,this.pixelRatio=null,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new $u(e),this.pickLayersPass=new tl(e),this.renderCount=0,this._needsRedraw="Initial render"}return Object(u.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=el(t.useDevicePixels)),"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed");var e=this.pixelRatio,r=this.layerFilter;this.drawLayersPass.setProps({pixelRatio:e,layerFilter:r}),this.pickLayersPass.setProps({pixelRatio:e,layerFilter:r})}},{key:"renderLayers",value:function(t){var e=this,r=t.layers,i=t.viewports,n=t.activateViewport,a=t.views,o=t.redrawReason,s=void 0===o?"unknown reason":o,u=t.clearCanvas,l=void 0===u||u,c=t.effects,h=void 0===c?[]:c,p=t.pass,f=t.stats,d=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,v=this.prepareEffects(h),m=d.render({layers:r,viewports:i,views:a,onViewportActive:n,redrawReason:s,clearCanvas:l,effects:h,effectProps:v});this.renderCount++,E.priority>=2&&m.forEach(function(t){e.logRenderStats({status:t,pass:p,redrawReason:s,stats:f,renderStats:m})})}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),e}},{key:"prepareEffects",value:function(t){var e={},r=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var s=a.value;Object.assign(e,s.prepare())}}catch(t){i=!0,n=t}finally{try{r||null==o.return||o.return()}finally{if(i)throw n}}return e}},{key:"logRenderStats",value:function(t){var e=t.renderStats,r=t.pass,i=t.redrawReason,n=t.stats,a=e.totalCount,o=e.visibleCount,s=e.compositeCount,u=e.pickableCount,l=a-s-o,c="";c+="RENDER #".concat(this.renderCount," ").concat(o," (of ").concat(a," layers) to ").concat(r," because ").concat(i," "),E.priority>2&&(c+="(".concat(l," hidden, ").concat(s," composite ").concat(u," pickable)")),E.log(2,c)(),n&&n.get("Redraw Layers").add(o)}}]),t}(),il={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function nl(t){var e=t.pickedColors,r=t.layers,i=t.deviceX,n=t.deviceY,a=t.deviceRadius,o=t.deviceRect;if(e){for(var s=o.x,u=o.y,l=o.width,c=o.height,h=a*a,p=-1,f=0,d=0;d<c;d++){var v=d+u-n,m=v*v;if(m>h)f+=4*l;else for(var g=0;g<l;g++){if(e[f+3]-1>=0){var y=g+s-i,_=y*y+m;_<=h&&(h=_,p=f)}f+=4}}if(p>=0){var b=e[p+3]-1,x=e.slice(p,p+4),w=r[b];if(w){var k=w.decodePickingColor(x);return{pickedColor:x,pickedLayer:w,pickedObjectIndex:k}}E.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return il}function al(t){var e=t.pickInfo,r=t.lastPickedInfo,i=t.mode,n=t.layers,a=t.viewports,o=t.x,s=t.y,u=t.deviceX,l=t.deviceY,c=t.pixelRatio,h=e.pickedColor,p=e.pickedLayer,f=e.pickedObjectIndex,d=p?[p]:[];if("hover"===i){var v=r.index,m=r.layerId,g=p&&p.props.id;if(g!==m||f!==v){if(g!==m){var y=n.find(function(t){return t.props.id===m});y&&d.unshift(y)}r.layerId=g,r.index=f,r.info=null}}var _={viewports:a}.viewports[0],b=_&&_.unproject([o,s]),x={color:null,layer:null,index:-1,picked:!1,x:o,y:s,pixel:[o,s],coordinate:b,lngLat:b,devicePixel:[u,l],pixelRatio:c},w=new Map;return w.set(null,x),d.forEach(function(t){var e=Object.assign({},x);if(t===p&&(e.color=h,e.index=f,e.picked=!0),e=ol({layer:t,info:e,mode:i}),t===p&&"hover"===i&&(r.info=e),e&&w.set(e.layer.id,e),"hover"===i){var n=t.props.autoHighlight&&p===t?h:null;t.setModuleParameters({pickingSelectedColor:n}),t.setNeedsRedraw()}}),w}function ol(t){for(var e=t.layer,r=t.info,i=t.mode;e&&r;){var n=r.layer||e;r.layer=e,r=e.pickLayer({info:r,mode:i,sourceLayer:n}),e=e.parent}return r}var sl=function(){function t(e){Object(s.a)(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new tl(e),this.pixelRatio=null,this.layerFilter=null,this.pickingEvent=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}return Object(u.a)(t,[{key:"setProps",value:function(t){"useDevicePixels"in t&&(this.pixelRatio=el(t.useDevicePixels)),"layerFilter"in t&&(this.layerFilter=t.layerFilter),this.pickLayersPass.setProps({pixelRatio:this.pixelRatio,layerFilter:this.layerFilter})}},{key:"pickObject",value:function(t){var e=t.x,r=t.y,i=t.mode,n=t.radius,a=void 0===n?0:n,o=t.layers,s=t.viewports,u=t.activateViewport,l=t.depth,c=void 0===l?1:l,h=t.event,p=void 0===h?null:h;this.pickingEvent=p;var f=this.pickClosestObject({x:e,y:r,radius:a,layers:o,mode:i,depth:c,viewports:s,onViewportActive:u});return this.pickingEvent=null,f}},{key:"pickObjects",value:function(t){var e=t.x,r=t.y,i=t.width,n=t.height,a=t.layers,o=t.viewports,s=t.activateViewport;return this.pickVisibleObjects({x:e,y:r,width:i,height:n,layers:a,mode:"pickObjects",viewports:o,onViewportActive:s})}},{key:"getLastPickedObject",value:function(t){var e=t.x,r=t.y,i=t.layers,n=t.viewports,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,o=a&&a.layer&&a.layer.id,s=o?i.find(function(t){return t.id===o}):null,u=n[0]&&n[0].unproject([e,r]),l={x:e,y:r,coordinate:u,lngLat:u,layer:s};return s?Object.assign({},a,l):Object.assign(l,{color:null,object:null,index:-1})}},{key:"updatePickingBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new Se(t)),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"pickClosestObject",value:function(t){var e=t.layers,r=t.viewports,i=t.x,n=t.y,a=t.radius,o=t.depth,s=void 0===o?1:o,u=t.mode,l=t.onViewportActive;this.updatePickingBuffer();for(var c,h=this.pixelRatio,p=Math.round(i*h),f=Math.round(this.gl.canvas.height-n*h),d=Math.round(a*h),v=this.pickingFBO,m=v.width,g=v.height,y=this.getPickingRect({deviceX:p,deviceY:f,deviceRadius:d,deviceWidth:m,deviceHeight:g}),_=[],b={},x=0;x<s;x++){var w=nl({pickedColors:y&&this.drawAndSamplePickingBuffer({layers:e,viewports:r,onViewportActive:l,deviceRect:y,redrawReason:u}),layers:e,deviceX:p,deviceY:f,deviceRadius:d,deviceRect:y});if(w.pickedColor&&x+1<s){var k=w.pickedColor[3]-1;b[k]||(b[k]=e[k].copyPickingColors()),e[k].clearPickingColor(w.pickedColor)}c=al({pickInfo:w,lastPickedInfo:this.lastPickedInfo,mode:u,layers:e,viewports:r,x:i,y:n,deviceX:p,deviceY:f,pixelRatio:h});var E=this.callLayerPickingCallbacks(c,u);if(E&&E.forEach(function(t){return _.push(t)}),!w.pickedColor)break}return Object.keys(b).forEach(function(t){return e[t].restorePickingColors(b[t])}),{result:_,emptyInfo:c&&c.get(null)}}},{key:"pickVisibleObjects",value:function(t){var e=t.layers,r=t.viewports,i=t.x,n=t.y,a=t.width,o=t.height,s=t.mode,u=t.onViewportActive;this.updatePickingBuffer();var l=this.pixelRatio,c=Math.round(i*l),h=Math.round(this.gl.canvas.height-n*l),p=Math.round((i+a)*l),f=Math.round(this.gl.canvas.height-(n+o)*l),d={x:c,y:f,width:p-c,height:h-f},v=function(t){var e=t.pickedColors,r=t.layers,i=new Map;if(e)for(var n=0;n<e.length;n+=4){var a=e[n+3]-1;if(a>=0){var o=e.slice(n,n+4),s=o.join(",");if(!i.has(s)){var u=r[a];u?i.set(s,{pickedColor:o,pickedLayer:u,pickedObjectIndex:u.decodePickingColor(o)}):E.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}({pickedColors:this.drawAndSamplePickingBuffer({layers:e,viewports:r,onViewportActive:u,deviceRect:d,redrawReason:s}),layers:e}),m=new Map;return v.forEach(function(t){var e={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:n,width:a,height:o,pixelRatio:l};e=ol({layer:t.pickedLayer,info:e,mode:s}),m.has(e.object)||m.set(e.object,e)}),Array.from(m.values())}},{key:"drawAndSamplePickingBuffer",value:function(t){var e=t.layers,r=t.viewports,i=t.onViewportActive,n=t.deviceRect,a=t.redrawReason;if(Wa(n),Wa(Number.isFinite(n.width)&&n.width>0,"`width` must be > 0"),Wa(Number.isFinite(n.height)&&n.height>0,"`height` must be > 0"),e.filter(function(t){return t.isPickable()}).length<1)return null;var o=this.pickingFBO;this.pickLayersPass.render({layers:e,viewports:r,onViewportActive:i,pickingFBO:o,deviceRect:n,redrawReason:a,effectProps:{lightSources:{}}});var s=n.x,u=n.y,l=n.width,c=n.height,h=new Uint8Array(l*c*4);return ge(o,{sourceX:s,sourceY:u,sourceWidth:l,sourceHeight:c,target:h}),h}},{key:"getPickingRect",value:function(t){var e=t.deviceX,r=t.deviceY,i=t.deviceRadius,n=t.deviceWidth,a=t.deviceHeight;if(!(e>=0&&r>=0&&e<n&&r<a))return null;var o=Math.max(0,e-i),s=Math.max(0,r-i);return{x:o,y:s,width:Math.min(n,e+i)-o+1,height:Math.min(a,r+i)-s+1}}},{key:"callLayerPickingCallbacks",value:function(t,e){var r=[],i=this.pickingEvent;return t.forEach(function(t){if(t.layer){var n=!1;switch(e){case"hover":n=t.layer.onHover(t,i);break;case"query":break;default:throw new Error("unknown pick type")}n||r.push(t)}}),r}}]),t}(),ul=1,ll=2,cl=4,hl={mousedown:ul,mousemove:ll,mouseup:cl};var pl,fl,dl=null;"undefined"!=typeof document&&(dl=r(41),pl=dl.PointerEventInput,fl=pl.prototype.handler,pl.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}(e,function(e){return e.pointerId===t.pointerId})||e.push(t)),fl.call(this,t)},dl.MouseInput.prototype.handler=function(t){var e=hl[t.type];e&ul&&t.button>=0&&(this.pressed=!0),e&ll&&0===t.which&&(e=cl),this.pressed&&(e&cl&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))});var vl=dl;var ml=vl?[[vl.Rotate,{enable:!1}],[vl.Pinch,{enable:!1}],[vl.Swipe,{enable:!1}],[vl.Pan,{threshold:0,enable:!1}],[vl.Press,{enable:!1}],[vl.Tap,{event:"doubletap",taps:2,enable:!1}],[vl.Tap,{event:"anytap",enable:!1}],[vl.Tap,{enable:!1}]]:null,gl={rotate:["pinch"],doubletap:["anytap"],anytap:["tap"]},yl={doubletap:["tap"]},_l={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},bl=["keydown","keyup"],xl=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],wl=["wheel","mousewheel","DOMMouseScroll"],kl={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},El={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Sl=r(16),Tl=-1!==Sl.b.indexOf("firefox"),Al=wl,Pl=function(){function t(e,r){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s.a)(this,t),this.element=e,this.callback=r,this.options=Object.assign({enable:!0},n),this.events=Al.concat(n.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,i.handleEvent,!!Sl.a&&{passive:!1})})}return Object(u.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;Sl.c.WheelEvent&&(Tl&&t.deltaMode===Sl.c.WheelEvent.DOM_DELTA_PIXEL&&(e/=Sl.c.devicePixelRatio),t.deltaMode===Sl.c.WheelEvent.DOM_DELTA_LINE&&(e*=40));var r={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,r)}}},{key:"_onWheel",value:function(t,e,r){this.callback({type:"wheel",center:r,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),Ol=xl,Il=function(){function t(e,r){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s.a)(this,t),this.element=e,this.callback=r,this.pressed=!1,this.options=Object.assign({enable:!0},n),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=Ol.concat(n.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(function(t){return e.addEventListener(t,i.handleEvent)})}return Object(u.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),Ml=bl,Cl=function(){function t(e,r){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s.a)(this,t),this.element=e,this.callback=r,this.options=Object.assign({enable:!0},n),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=Ml.concat(n.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=1,e.style.outline="none",this.events.forEach(function(t){return e.addEventListener(t,i.handleEvent)})}return Object(u.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach(function(e){return t.element.removeEventListener(e,t.handleEvent)})}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),Ll=function(){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s.a)(this,t),this.element=e,this.callback=r,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(u.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),jl=1,zl=2,Rl=4,Fl={pointerdown:jl,pointermove:zl,pointerup:Rl,mousedown:jl,mousemove:zl,mouseup:Rl},Dl=1,Bl=2,Nl=3,Ul=0,Vl=1,Gl=2,ql=1,Zl=2,Xl=4;var Wl=function(){function t(e){Object(s.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this)}return Object(u.a)(t,[{key:"isEmpty",value:function(){return 0===this.handlers.length}},{key:"add",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"root",i=this.handlers,n=this.handlersByElement;n.has(r)||n.set(r,[]);var a={type:t,handler:e,srcElement:r};i.push(a),n.get(r).push(a)}},{key:"remove",value:function(t,e){for(var r=this.handlers,i=this.handlersByElement,n=r.length-1;n>=0;n--){var a=r[n];if(a.type===t&&a.handler===e){r.splice(n,1);var o=i.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&i.delete(a.srcElement)}}}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),r=t.srcEvent.target;r&&r!==e.rootElement;){if(this._emit(e,r),e.handled)return;r=r.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var r=this.handlersByElement.get(e);if(r)for(var i=!1,n=function(){t.handled=!0},a=function(){t.handled=!0,i=!0},o=0;o<r.length;o++){var s=r[o],u=s.type;if((0,s.handler)(Object.assign({},t,{type:u,stopPropagation:n,stopImmediatePropagation:a})),i)break}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=Fl[t.srcEvent.type];if(!e)return null;var r=t.srcEvent,i=r.buttons,n=r.button,a=r.which,o=!1,s=!1,u=!1;return e===Rl||e===zl&&!Number.isFinite(i)?(o=a===Dl,s=a===Bl,u=a===Nl):e===zl?(o=Boolean(i&ql),s=Boolean(i&Xl),u=Boolean(i&Zl)):e===jl&&(o=n===Ul,s=n===Vl,u=n===Gl),{leftButton:o,middleButton:s,rightButton:u}}(t),function(t,e){var r=t.srcEvent;if(!t.center&&!Number.isFinite(r.clientX))return null;var i=t.center||{x:r.clientX,y:r.clientY},n=e.getBoundingClientRect(),a=n.width/e.offsetWidth,o=n.height/e.offsetHeight;return{center:i,offsetCenter:{x:(i.x-n.left-e.clientLeft)/a,y:(i.y-n.top-e.clientTop)/o}}}(t,e),{handled:!1,rootElement:e})}}]),t}(),Hl={events:null,recognizers:null,Manager:vl?vl.Manager:function(t){var e={},r=function(){return e};return e.get=function(){return null},e.set=r,e.on=r,e.off=r,e.destroy=r,e.emit=r,e},touchAction:"none"},Yl=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,t),this.options=Object.assign({},Hl,r),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var i=r.events;i&&this.on(i)}return Object(u.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var r=this.options,i=r.Manager;this.manager=new i(t,{touchAction:r.touchAction,recognizers:r.recognizers||ml}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(gl).forEach(function(t){var r=e.manager.get(t);r&&gl[t].forEach(function(t){r.recognizeWith(t)})}),this.wheelInput=new Pl(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Il(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Cl(t,this._onOtherEvent,{enable:!1}),this.contextmenuInput=new Ll(t,this._onOtherEvent,{enable:!1});var n=!0,a=!1,o=void 0;try{for(var s,u=this.events[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=C(s.value,2),c=l[0],h=l[1];h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(c,h.handleEvent))}}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,r){if("string"==typeof t)this._addEventHandler(t,e,r);else for(var i in r=e,t)this._addEventHandler(i,t[i],r)}},{key:"off",value:function(t,e){if("string"==typeof t)this._removeEventHandler(t,e);else for(var r in t)this._removeEventHandler(r,t[r])}},{key:"_toggleRecognizer",value:function(t,e){var r=this.manager;if(r){var i=r.get(t);if(i&&i.options.enable!==e){i.set({enable:e});var n=yl[t];n&&!this.options.recognizers&&n.forEach(function(n){var a=r.get(n);e?(a.requireFailure(t),i.dropRequireFailure(n)):a.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,r){var i=this.manager,n=this.events,a=El[t]||t,o=n.get(a);o||(o=new Wl(this),n.set(a,o),o.recognizerName=kl[a]||a,i&&i.on(a,o.handleEvent)),this._toggleRecognizer(o.recognizerName,!0),o.add(t,e,r)}},{key:"_removeEventHandler",value:function(t,e){var r=this.events,i=El[t]||t,n=r.get(i);if(n&&(n.remove(t,e),n.isEmpty())){var a=n.recognizerName,o=!1,s=!0,u=!1,l=void 0;try{for(var c,h=r.values()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var p=c.value;if(p.recognizerName===a&&!p.isEmpty()){o=!0;break}}}catch(t){u=!0,l=t}finally{try{s||null==h.return||h.return()}finally{if(u)throw l}}o||this._toggleRecognizer(a,!1)}}},{key:"_onBasicInput",value:function(t){var e=t.srcEvent,r=_l[e.type];r&&this.manager.emit(r,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}();function Kl(){}var Jl={id:"deckgl-overlay",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,_animate:!1,onWebGLInitialized:Kl,onResize:Kl,onViewStateChange:Kl,onBeforeRender:Kl,onAfterRender:Kl,onLoad:Kl,_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},Ql=function(){function t(e){Object(s.a)(this,t),e=Object.assign({},Jl,e),this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=e.initialViewState||null,this.interactiveState={isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerLeave=this._onPointerLeave.bind(this),this._pickAndCallback=this._pickAndCallback.bind(this),this._onRendererInitialized=this._onRendererInitialized.bind(this),this._onRenderFrame=this._onRenderFrame.bind(this),this._onViewStateChange=this._onViewStateChange.bind(this),this._onInteractiveStateChange=this._onInteractiveStateChange.bind(this),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new O({id:"deck.gl"}),this.setProps(e),this.animationLoop.start()}return Object(u.a)(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null),this.viewManager&&(this.viewManager.finalize(),this.viewManager=null),this.eventManager&&this.eventManager.destroy(),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&E.removed("onLayerHover","onHover")(),"onLayerClick"in t&&E.removed("onLayerClick","onClick")(),t=Object.assign({},this.props,t),this.props=t,this._setCanvasSize(t);var e=Object.assign({},t,{views:this._getViews(this.props),width:this.width,height:this.height}),r=this._getViewState(t);r&&(e.viewState=r),this.viewManager&&this.viewManager.setProps(e),this.layerManager&&this.layerManager.setProps(e),this.effectManager&&this.effectManager.setProps(e),this.animationLoop&&this.animationLoop.setProps(e),this.deckRenderer&&this.deckRenderer.setProps(e),this.deckPicker&&this.deckPicker.setProps(e),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var r=this.viewManager.needsRedraw(t),i=this.layerManager.needsRedraw(t),n=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e=e||r||i||n||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=t.x,r=t.y,i=t.radius,n=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a;this.stats.get("pickObject Time").timeStart();var s=this.layerManager.getLayers({layerIds:o}),u=this.layerManager.activateViewport,l=this.deckPicker.pickObject({x:e,y:r,radius:n,layers:s,viewports:this.getViewports({x:e,y:r}),activateViewport:u,mode:"query",depth:1}).result;return this.stats.get("pickObject Time").timeEnd(),l.length?l[0]:null}},{key:"pickMultipleObjects",value:function(t){var e=t.x,r=t.y,i=t.radius,n=void 0===i?0:i,a=t.layerIds,o=void 0===a?null:a,s=t.depth,u=void 0===s?10:s;this.stats.get("pickMultipleObjects Time").timeStart();var l=this.layerManager.getLayers({layerIds:o}),c=this.layerManager.activateViewport,h=this.deckPicker.pickObject({x:e,y:r,radius:n,layers:l,viewports:this.getViewports({x:e,y:r}),activateViewport:c,mode:"query",depth:u}).result;return this.stats.get("pickMultipleObjects Time").timeEnd(),h}},{key:"pickObjects",value:function(t){var e=t.x,r=t.y,i=t.width,n=void 0===i?1:i,a=t.height,o=void 0===a?1:a,s=t.layerIds,u=void 0===s?null:s;this.stats.get("pickObjects Time").timeStart();var l=this.layerManager.getLayers({layerIds:u}),c=this.layerManager.activateViewport,h=this.deckPicker.pickObjects({x:e,y:r,width:n,height:o,layers:l,viewports:this.getViewports({x:e,y:r,width:n,height:o}),activateViewport:c});return this.stats.get("pickObjects Time").timeEnd(),h}},{key:"_createCanvas",value:function(t){var e=t.canvas;("string"==typeof e&&Wa(e=document.getElementById(e)),e)||(e=document.createElement("canvas"),(t.parent||document.body).appendChild(e));var r=t.id,i=t.style;return e.id=r,Object.assign(e.style,i),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,r=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(r||0===r)&&(r=Number.isFinite(r)?"".concat(r,"px"):r,this.canvas.style.position="absolute",this.canvas.style.height=r)}}},{key:"_updateCanvasSize",value:function(){if(this._checkForCanvasSizeChange()){var t=this.width,e=this.height;this.viewManager.setProps({width:t,height:e}),this.props.onResize({width:this.width,height:this.height})}}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,r=t.clientHeight||t.height;return(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,r=t.width,i=t.height,n=t.gl,a=t.glOptions,o=t.debug,s=t.useDevicePixels,u=t.autoResizeDrawingBuffer;return new wi({width:r,height:i,useDevicePixels:s,autoResizeDrawingBuffer:u,gl:n,onCreateContext:function(t){return Pe(Object.assign({},a,t,{canvas:e.canvas,debug:o}))},onInitialize:this._onRendererInitialized,onRender:this._onRenderFrame,onBeforeRender:t.onBeforeRender,onAfterRender:t.onAfterRender})}},{key:"_getViewState",value:function(t){return t.viewState||this.viewState}},{key:"_getViews",value:function(t){var e=t.views||[new Yu({id:"default-view"})];return(e=Array.isArray(e)?e:[e]).length&&t.controller&&(e[0].props.controller=t.controller),e}},{key:"_requestPick",value:function(t){var e=t.event,r=t.callback,i=t.mode,n=this._pickRequest;if("pointerleave"===e.type)n.x=-1,n.y=-1,n.radius=0;else{var a=e.offsetCenter;if(!a)return;n.x=a.x,n.y=a.y,n.radius=this.props.pickingRadius}n.callback=r,n.event=e,n.mode=i}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.mode){var e=this.deckPicker.pickObject(Object.assign({layers:this.layerManager.getLayers(),viewports:this.getViewports(t),activateViewport:this.layerManager.activateViewport,depth:1},t)),r=e.result,i=e.emptyInfo;if(t.callback){var n=r.find(function(t){return t.index>=0})||i;t.callback(n,t.event)}t.mode=null}}},{key:"_updateCursor",value:function(){this.canvas&&(this.canvas.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_updateAnimationProps",value:function(t){this.layerManager.context.animationProps=t}},{key:"_setGLContext",value:function(t){if(!this.layerManager){for(var e in this.canvas||(this.canvas=t.canvas,Object(R.a)(t,{enable:!0,copyState:!0})),z(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t),this.eventManager=new Yl(t.canvas,{events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerLeave}}),qa)this.eventManager.on(e,this._onEvent);this.viewManager=new vu({eventManager:this.eventManager,onViewStateChange:this._onViewStateChange,onInteractiveStateChange:this._onInteractiveStateChange,views:this._getViews(this.props),viewState:this._getViewState(this.props),width:this.width,height:this.height}),Wa(this.viewManager);var r=this.viewManager.getViewports()[0];this.layerManager=new Hs(t,{deck:this,stats:this.stats,viewport:r}),this.effectManager=new Ku,this.deckRenderer=new rl(t),this.deckPicker=new sl(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var r=this.layerManager.context.gl;z(r,this.props.parameters),this.props.onBeforeRender({gl:r});var i=this.layerManager.getLayers(),n=this.layerManager.activateViewport;this.deckRenderer.renderLayers(Object.assign({layers:i,viewports:this.viewManager.getViewports(),activateViewport:n,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:r})}},{key:"_onRendererInitialized",value:function(t){var e=t.gl;this._setGLContext(e)}},{key:"_onRenderFrame",value:function(t){if(this.stats.get("frameRate").timeEnd(),this.stats.get("frameRate").timeStart(),t.tick%60==0){var e={};this.stats.forEach(function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),this.stats.reset(),E.table(3,e)(),this.props._onMetrics&&this.props._onMetrics(e)}this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(t),this._updateAnimationProps(t),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates(t)}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState[t.viewId]=e,this.viewManager.setProps({viewState:e}))}},{key:"_onInteractiveStateChange",value:function(t){var e=t.isDragging,r=void 0!==e&&e;r!==this.interactiveState.isDragging&&(this.interactiveState.isDragging=r)}},{key:"_onEvent",value:function(t){var e=qa[t.type],r=t.offsetCenter;if(e&&r){var i=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:i,viewports:this.getViewports(r)},this._lastPointerDownInfo),a=n.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],u=!1;o&&(u=o.call(a,n,t)),!u&&s&&s(n,t)}}},{key:"_onPointerDown",value:function(t){var e=t.offsetCenter;this._lastPointerDownInfo=this.pickObject({x:e.x,y:e.y})}},{key:"_onPointerMove",value:function(t){t.leftButton||t.rightButton||this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}},{key:"_onPointerLeave",value:function(t){this._requestPick({callback:this.props.onHover,event:t,mode:"hover"})}}]),t}();Ql.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(ho)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.bool,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,debug:t.bool,drawPickingColors:t.bool,_animate:t.bool}},Ql.defaultProps=Jl;function $l(t,e){return Number.isFinite(t)?t:e}var tc=function(t){function e(t){var r,i=t.width,n=t.height,a=t.position,o=t.bearing,u=t.pitch,l=t.longitude,c=t.latitude,h=t.zoom,p=(t.syncBearing,t.bounds,t.startPanEventPosition),f=t.startPanPosition,d=t.startRotateCenter,v=t.startRotateViewport,m=t.startZoomPos,g=t.startZoom;return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,{width:i,height:n,position:a,bearing:o,pitch:u,longitude:l,latitude:c,zoom:h})))._interactiveState={startPanEventPosition:p,startPanPosition:f,startRotateCenter:d,startRotateViewport:v,startZoomPos:m,startZoom:g},r}return Pt(e,Nu),Object(u.a)(e,[{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,r=this._viewportProps,i=r.translationX,n=r.translationY;return this._getUpdatedState({startPanPosition:[i,n],startPanEventPosition:e})}},{key:"pan",value:function(t){var e=t.pos,r=t.startPos,i=this._interactiveState.startPanEventPosition||r;if(!i)return this;var n=C(this._interactiveState.startPanPosition||[],2),a=n[0],o=n[1];a=$l(a,this._viewportProps.translationX),o=$l(o,this._viewportProps.translationY);var s=e[0]-i[0],u=e[1]-i[1];return this._getUpdatedState({translationX:a+s,translationY:o-u})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startPanPos:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotateCenter:this._viewportProps.position,startRotateViewport:this._viewportProps})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,r=t.deltaScaleY;if(!this._interactiveState.startRotateCenter)return this;var i=this._viewportProps,n=i.bearing,a=i.pitch;return this._getUpdatedState({bearing:n+10*e,pitch:a-10*r})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotateCenter:null,startRotateViewport:null})}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPos:e,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,r=t.startPos,i=t.scale,n=this._viewportProps,a=n.zoom,o=n.minZoom,s=n.maxZoom,u=n.width,l=n.height,c=(n.translationX,n.translationY,this._interactiveState.startZoomPos||r||e),h=Kr(a*i,o,s);e[0],c[0],e[1],c[1],c[0],c[1];return h/a<1?this.moveBackward():this.moveForward()}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPos:null,startZoom:null})}},{key:"moveLeft",value:function(){var t=this._viewportProps.bearing-2;return this._getUpdatedState({bearing:t})}},{key:"moveRight",value:function(){var t=this._viewportProps.bearing+2;return this._getUpdatedState({bearing:t})}},{key:"moveForward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),r=new pi(e).normalize().scale(1);return this._getUpdatedState({position:new pi(t).add(r)})}},{key:"moveBackward",value:function(){var t=this._viewportProps.position,e=this.getDirection(),r=new pi(e).normalize().scale(-1);return this._getUpdatedState({position:new pi(t).add(r)})}},{key:"moveUp",value:function(){var t=this._viewportProps.position;return this._getUpdatedState({position:new pi(t).add([0,0,1])})}},{key:"moveDown",value:function(){var t=this._viewportProps.position,e=t[2]>=1?[0,0,-1]:[0,0,0];return this._getUpdatedState({position:new pi(t).add(e)})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom+.2})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._viewportProps.zoom-.2})}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}}]),e}(),ec=function(t){function e(t){return Object(s.a)(this,e),St(this,Tt(e).call(this,tc,t))}return Pt(e,Ru),e}();(function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,du),Object(u.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,r=e.modelMatrix,i=void 0===r?null:r,n=e.bearing,a=e.up,o=void 0===a?[0,0,1]:a,s=function(t){var e=t.bearing,r=t.pitch;return new Du({bearing:e,pitch:r}).toVector3().normalize()}({bearing:n,pitch:89}),u=i?i.transformDirection(s):s,l=(new xa).lookAt({eye:[0,0,0],center:u,up:o});return new Zs(Object.assign({},t,{zoom:null,viewMatrix:l}))}},{key:"controller",get:function(){return this._getControllerProps({type:ec})}}]),e}()).displayName="FirstPersonView",(function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,du),Object(u.a)(e,[{key:"_getViewport",value:function(t){var e=t.viewState,r=e.bearing,i=e.pitch,n=e.position,a=e.up,o=50*e.zoom,s=function(t){var e=t.bearing,r=t.pitch;return new Du({bearing:e,pitch:r}).toVector3().normalize()}({bearing:r,pitch:i}).scale(-o).multiply(new pi(1,1,-1)),u=(new xa).multiplyRight((new xa).lookAt({eye:s,center:n,up:a}));return new Zs(Object.assign({},t,{id:this.id,zoom:null,viewMatrix:u}))}}]),e}()).displayName="ThirdPersonView";var rc={orbitAxis:"Z",rotationX:0,rotationOrbit:0,fovy:50,zoom:0,target:[0,0,0],minZoom:-1/0,maxZoom:1/0},ic={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new ku(["target","zoom","rotationX","rotationOrbit"]),transitionInterruption:Su},nc=function(t){return Math.pow(2,t)},ac=function(t){function e(t){var r,i=t.ViewportType,n=t.width,a=t.height,o=t.orbitAxis,u=void 0===o?rc.orbitAxis:o,l=t.rotationX,c=void 0===l?rc.rotationX:l,h=t.rotationOrbit,p=void 0===h?rc.rotationOrbit:h,f=t.target,d=void 0===f?rc.target:f,v=t.zoom,m=void 0===v?rc.zoom:v,g=t.fovy,y=void 0===g?rc.fovy:g,_=t.minZoom,b=void 0===_?rc.minZoom:_,x=t.maxZoom,w=void 0===x?rc.maxZoom:x,k=t.startPanPosition,E=t.startTarget,S=t.startRotationX,T=t.startRotationOrbit,A=t.startZoomPosition,P=t.startZoom;return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,{width:n,height:a,orbitAxis:u,rotationX:c,rotationOrbit:p,target:d,fovy:y,zoom:m,minZoom:b,maxZoom:w})))._interactiveState={startPanPosition:k,startTarget:E,startRotationX:S,startRotationOrbit:T,startZoomPosition:A,startZoom:P},r.ViewportType=i,r}return Pt(e,Nu),Object(u.a)(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getInteractiveState",value:function(){return this._interactiveState}},{key:"panStart",value:function(t){var e=t.pos,r=this._viewportProps.target;return this._getUpdatedState({startPanPosition:e,startTarget:r})}},{key:"pan",value:function(t){var e=t.pos,r=(t.startPos,this._interactiveState),i=r.startPanPosition,n=r.startTarget,a=new ua(e).subtract(i);return this._getUpdatedState({target:this._calculateNewTarget({startTarget:n,pixelOffset:a})})}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null,startTarget:null})}},{key:"rotateStart",value:function(t){t.pos;return this._getUpdatedState({startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}},{key:"rotate",value:function(t){var e=t.deltaScaleX,r=t.deltaScaleY,i=this._interactiveState,n=i.startRotationX,a=i.startRotationOrbit;if(!Number.isFinite(n)||!Number.isFinite(a))return this;var o=Kr(n+180*r,-89.999,89.999),s=(a+180*e)%360;return this._getUpdatedState({rotationX:o,rotationOrbit:s,isRotating:!0})}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(t){return Object.assign({},this._viewportProps)}},{key:"zoomStart",value:function(t){var e=t.pos;return this._getUpdatedState({startZoomPosition:e,startTarget:this._viewportProps.target,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,r=t.startPos,i=t.scale,n=this._viewportProps,a=n.zoom,o=n.width,s=n.height,u=n.target,l=this._interactiveState,c=l.startZoom,h=l.startZoomPosition,p=l.startTarget;Number.isFinite(c)||(c=a,p=u,h=r||e);var f=this._calculateNewZoom({scale:i,startZoom:c}),d=nc(c),v=nc(f),m=(o/2-h[0])*(v/d-1),g=(s/2-h[1])*(v/d-1);return this._getUpdatedState({zoom:f,target:this._calculateNewTarget({startTarget:p,zoom:f,pixelOffset:[m,g]})})}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startTarget:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:2})})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:.5})})}},{key:"moveLeft",value:function(){var t=[-50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveRight",value:function(){var t=[50,0];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveUp",value:function(){var t=[0,-50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"moveDown",value:function(){var t=[0,50];return this._getUpdatedState({target:this._calculateNewTarget({pixelOffset:t})})}},{key:"rotateLeft",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-15})}},{key:"rotateRight",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+15})}},{key:"rotateUp",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-10})}},{key:"rotateDown",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+10})}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,r=t.startZoom,i=this._viewportProps,n=i.maxZoom,a=i.minZoom;return Number.isFinite(r)||(r=this._viewportProps.zoom),Kr(r+Math.log2(e),a,n)}},{key:"_calculateNewTarget",value:function(t){var e=t.startTarget,r=t.zoom,i=t.pixelOffset,n=Object.assign({},this._viewportProps);Number.isFinite(r)&&(n.zoom=r),e&&(n.target=e);var a=new this.ViewportType(n),o=a.project(n.target);return a.unproject([o[0]-i[0],o[1]-i[1],o[2]])}},{key:"_getUpdatedState",value:function(t){return new e(Object.assign({},this._viewportProps,this._interactiveState,t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,r=t.minZoom,i=t.zoom;return t.zoom=i>e?e:i,t.zoom=i<r?r:i,t}}]),e}(),oc=function(t){function e(t){return Object(s.a)(this,e),St(this,Tt(e).call(this,ac,t))}return Pt(e,Ru),Object(u.a)(e,[{key:"_getTransitionProps",value:function(){return ic}}]),e}(),sc=Math.PI/180;function uc(t){var e=t.height,r=t.fovy,i=t.orbitAxis,n=t.rotationX,a=t.rotationOrbit,o=(t.zoom,.5/Math.tan(r*sc/2)),s=(new xa).lookAt({eye:[0,0,o]});s.rotateX(n*sc),"Z"===i?s.rotateZ(a*sc):s.rotateY(a*sc);var u=1/(e||1);return s.scale([u,u,u]),s}var lc=function(t){function e(t){Object(s.a)(this,e);var r=t.id,i=t.x,n=t.y,a=t.width,o=t.height,u=t.fovy,l=void 0===u?50:u,c=t.near,h=t.far,p=t.orbitAxis,f=void 0===p?"Z":p,d=t.target,v=void 0===d?[0,0,0]:d,m=t.rotationX,g=void 0===m?0:m,y=t.rotationOrbit,_=void 0===y?0:y,b=t.zoom,x=void 0===b?0:b;return St(this,Tt(e).call(this,{id:r,viewMatrix:uc({height:o,fovy:l,orbitAxis:f,rotationX:g,rotationOrbit:_,zoom:x}),fovy:l,near:c,far:h,x:i,y:n,position:v,width:a,height:o,zoom:x}))}return Pt(e,Zs),e}();(function(t){function e(t){return Object(s.a)(this,e),St(this,Tt(e).call(this,Object.assign({},t,{type:lc})))}return Pt(e,du),Object(u.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:oc,ViewportType:lc})}}]),e}()).displayName="OrbitView";var cc=Math.PI/180;(function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,du),Object(u.a)(e,[{key:"_getViewport",value:function(t){var e=t.x,r=t.y,i=t.width,n=t.height,a=t.viewState,o=a.eye,s=a.lookAt,u=void 0===s?[0,0,0]:s,l=a.up,c=void 0===l?[0,1,0]:l,h=t.fovy||a.fovy||75,p=t.near||a.near||1,f=t.far||a.far||100,d=Number.isFinite(a.aspect)?a.aspect:i/n,v=h*cc;return new Zs({id:this.id,x:e,y:r,width:i,height:n,viewMatrix:ga([],o,u,c),projectionMatrix:ma([],v,d,p,f)})}}]),e}()).displayName="PerspectiveView";var hc={transitionDuration:300,transitionEasing:function(t){return t},transitionInterpolator:new ku(["target","zoom"]),transitionInterruption:Su},pc=function(t){function e(t){var r;return Object(s.a)(this,e),(r=St(this,Tt(e).call(this,ac,t))).invertPan=!0,r}return Pt(e,Ru),Object(u.a)(e,[{key:"_onPanRotate",value:function(t){return!1}},{key:"_getTransitionProps",value:function(){return hc}}]),e}(),fc=(new xa).lookAt({eye:[0,0,1]});function dc(t){var e=t.width,r=t.height,i=t.near,n=t.far;return e=e||1,r=r||1,(new xa).ortho({left:-e/2,right:e/2,bottom:r/2,top:-r/2,near:i,far:n})}var vc=function(t){function e(t){var r=t.id,i=t.x,n=t.y,a=t.width,o=t.height,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?1e3:c,p=t.zoom,f=void 0===p?0:p,d=t.target,v=void 0===d?[0,0,0]:d;return Object(s.a)(this,e),St(void 0,new Zs({id:r,x:i,y:n,width:a,height:o,position:v,viewMatrix:fc,projectionMatrix:dc({width:a,height:o,near:l,far:h}),zoom:f}))}return Pt(e,Zs),e}();(function(t){function e(t){return Object(s.a)(this,e),St(this,Tt(e).call(this,Object.assign({},t,{type:vc})))}return Pt(e,du),Object(u.a)(e,[{key:"controller",get:function(){return this._getControllerProps({type:pc,ViewportType:vc})}}]),e}()).displayName="OrthographicView";var mc=.01,gc=["longitude","latitude","zoom"];var yc=["bearing","pitch"],_c=(function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}))}Pt(e,xu),Object(u.a)(e,[{key:"interpolateProps",value:function(t,e,r){for(var i=function(t,e,r){var i,n={},a=t.zoom,o=[t.longitude,t.latitude],s=To(a),u=e.zoom,l=[e.longitude,e.latitude],c=To(u-a),h=Po(o,s),p=Po(l,s),f=sa([],p,h),d=Math.max(t.width,t.height),v=d/c,m=aa(f);if(Math.abs(m)<mc){for(var g=0;g<gc.length;g++){var y=gc[g],_=t[y],b=e[y];n[y]=(i=r)*b+(1-i)*_}return n}var x=1.414*1.414,w=(v*v-d*d+x*x*m*m)/(2*d*x*m),k=(v*v-d*d-x*x*m*m)/(2*v*x*m),E=Math.log(Math.sqrt(w*w+1)-w),S=r*((Math.log(Math.sqrt(k*k+1)-k)-E)/1.414),T=Math.cosh(E)/Math.cosh(E+1.414*S),A=d*((Math.cosh(E)*Math.tanh(E+1.414*S)-Math.sinh(E))/x)/m,P=1/T,O=a+Ao(P),I=na([],f,A);ia(I,I,h),na(I,I,P);var M=Oo(I,To(O));return n.longitude=M[0],n.latitude=M[1],n.zoom=O,n}(t,e,r),n=0;n<yc.length;n++){var a=yc[n];i[a]=Jr(t[a]||0,e[a]||0,r)}return i}}])}(),function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).overAlloc,r=void 0===e?1:e;Object(s.a)(this,t),this.overAlloc=r}return Object(u.a)(t,[{key:"allocate",value:function(t,e,r){var i=r.size,n=r.type,a=r.copy,o=void 0!==a&&a,s=e*i;if(t&&s<=t.length)return t;var u=Math.max(Math.ceil(s*this.overAlloc),1),l=this._allocate(n,u);return t&&o&&l.set(t),this._release(t),l}},{key:"_allocate",value:function(){return new(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Float32Array)(arguments.length>1?arguments[1]:void 0)}},{key:"_release",value:function(t){}}]),t}()),bc=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,t);var r=e.attributes,i=void 0===r?{}:r;this.typedArrayManager=new _c,this.indexLayout=null,this.bufferLayout=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=i,this.updateGeometry(e),Object.seal(this)}Object(u.a)(t,[{key:"updateGeometry",value:function(t){var e=t.data,r=t.getGeometry,i=t.positionFormat,n=t.fp64;this.data=e,this.getGeometry=r,this.fp64=n,this.positionSize="XY"===i?2:3,this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){t.start,t.count,t.objects}},{key:"updateGeometryAttributes",value:function(t,e,r){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"_forEachGeometry",value:function(t){var e=this.data,r=this.getGeometry,i=Uo(e),n=i.iterable,a=i.objectInfo,o=!0,s=!1,u=void 0;try{for(var l,c=n[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;a.index++,t(r(h,a),a.index)}}catch(t){s=!0,u=t}finally{try{o||null==c.return||c.return()}finally{if(s)throw u}}}},{key:"_updateAttribute",value:function(t){var e=t.target,r=t.size,i=t.getValue,n=this.data,a=this.bufferLayout,o=0,s=Uo(n),u=s.iterable,l=s.objectInfo,c=!0,h=!1,p=void 0;try{for(var f,d=u[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=f.value;l.index++;var m=i(v,l),g=a[l.index];Ns({target:e,source:m,start:o,count:g}),o+=g*r}}catch(t){h=!0,p=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw p}}return e}},{key:"_rebuildGeometry",value:function(){var t=this;if(this.data&&this.getGeometry){var e=[],r=[],i=0;this._forEachGeometry(function(e,n){var a=t.getGeometrySize(e);i+=a,r[n]=a});var n=this.attributes,a=this._attributeDefs,o=this.typedArrayManager,s=this.fp64;for(var u in a){var l=a[u];l.fp64Only&&!s||(n[u]=o.allocate(n[u],i,l))}this.indexLayout=e,this.bufferLayout=r,this.instanceCount=i;var c={vertexStart:0,indexStart:0};this._forEachGeometry(function(i,n){var a=r[n];c.geometryIndex=n,c.geometrySize=a,t.updateGeometryAttributes(i,c),c.vertexStart+=a,c.indexStart+=e[n]||0}),this.vertexCount=c.indexStart}}}])}(),Pa.fp64LowPart),xc=new ea,wc=[255,0,255,255],kc={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},extruded:!0,fp64:!1,getPosition:{type:"accessor",value:function(t){return t.position}},getColor:{type:"accessor",value:wc},getElevation:{type:"accessor",value:1e3},material:xc},Ec=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Ds),Object(u.a)(e,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float coverage;\nuniform float elevationScale;\nvarying vec4 vColor;\n\nvoid main(void) {\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(instanceColors.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded) {\n    vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, instanceColors.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:wc}})}},{key:"updateState",value:function(t){var r=t.props,i=t.oldProps,n=t.changeFlags;if(Ve(Tt(e.prototype),"updateState",this).call(this,{props:r,oldProps:i,changeFlags:n}),r.fp64!==i.fp64||r.diskResolution!==i.diskResolution){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}r.vertices!==i.vertices&&this._updateVertices(r.vertices)}},{key:"getGeometry",value:function(t){return new Jn({radius:1,topCap:!1,bottomCap:!0,height:2,verticalAxis:"z",nradial:t,nvertical:1})}},{key:"_getModel",value:function(t){return new fn(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:this.getGeometry(this.props.diskResolution),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateVertices",value:function(t){if(t){var e=this.props.diskResolution;E.assert(t.length>=e);for(var r=this.state.model,i=this.getGeometry(this.props.diskResolution),n=i.attributes.POSITION,a=0,o=0;o<3;o++)for(var s=0;s<=e;s++){var u=t[s]||t[0];n.value[a++]=u[0],n.value[a++]=u[1],a++}r.setProps({geometry:i})}}},{key:"draw",value:function(t){var e=t.uniforms,r=this.props,i=r.elevationScale,n=r.extruded,a=r.offset,o=r.coverage,s=r.radius,u=r.angle;this.state.model.setUniforms(Object.assign({},e,{radius:s,angle:u/180*Math.PI,offset:a,extruded:n,coverage:o,elevationScale:i})).draw()}},{key:"calculateInstancePositions64xyLow",value:function(t){var e=this.use64bitPositions();if(t.constant=!e,e){var r=this.props,i=r.data,n=r.getPosition,a=t.value,o=0,s=Uo(i),u=s.iterable,l=s.objectInfo,c=!0,h=!1,p=void 0;try{for(var f,d=u[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=f.value;l.index++;var m=n(v,l);a[o++]=bc(m[0]),a[o++]=bc(m[1])}}catch(t){h=!0,p=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw p}}}else t.value=new Float32Array(2)}}]),e}();Ec.layerName="ColumnLayer",Ec.defaultProps=kc;var Sc=function(t){return t.length},Tc=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sc;Object(s.a)(this,t),this.sortedBins=this.getSortedBins(e,r),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(u.a)(t,[{key:"getSortedBins",value:function(t,e){return t.reduce(function(t,r,i){var n=e(r.points);return null!=n&&t.push({i:Number.isFinite(r.index)?r.index:i,value:n,counts:r.points.length}),t},[]).sort(function(t,e){return t.value-e.value})}},{key:"getValueRange",value:function(t){var e=C(t,2),r=e[0],i=e[1],n=this.sortedBins.length;if(!n)return[0,0];var a=Math.ceil(r/100*(n-1)),o=Math.floor(i/100*(n-1));return[this.sortedBins[a].value,this.sortedBins[o].value]}},{key:"getMaxCount",value:function(){var t=0;return this.sortedBins.forEach(function(e){return t=t>e.counts?t:e.counts}),t}},{key:"getBinMap",value:function(){return this.sortedBins.reduce(function(t,e){return Object.assign(t,Object(o.a)({},e.i,e))},{})}}]),t}();function Ac(t,e){return function(r){return function(t,e,r){var i=t[1]-t[0];if(i<=0)return E.warn("quantizeScale: invalid domain, returning range[0]")(),e[0];var n=i/e.length,a=Math.floor((r-t[0])/n);return e[Math.max(Math.min(a,e.length-1),0)]}(t,e,r)}}var Pc=Math.PI/3,Oc=[0,Pc,2*Pc,3*Pc,4*Pc,5*Pc];function Ic(t){return t[0]}function Mc(t){return t[1]}var Cc=function(){var t,e,r,i=0,n=0,a=1,o=1,s=Ic,u=Mc;function l(t){var i,n={},a=[],o=t.length;for(i=0;i<o;++i)if(!isNaN(c=+s.call(null,l=t[i],i,t))&&!isNaN(h=+u.call(null,l,i,t))){var l,c,h,p=Math.round(h/=r),f=Math.round(c=c/e-(1&p)/2),d=h-p;if(3*Math.abs(d)>1){var v=c-f,m=f+(c<f?-1:1)/2,g=p+(h<p?-1:1),y=c-m,_=h-g;v*v+d*d>y*y+_*_&&(f=m+(1&p?1:-1)/2,p=g)}var b=f+"-"+p,x=n[b];x?x.push(l):(a.push(x=n[b]=[l]),x.x=(f+(1&p)/2)*e,x.y=p*r)}return a}function c(t){var e=0,r=0;return Oc.map(function(i){var n=Math.sin(i)*t,a=-Math.cos(i)*t,o=n-e,s=a-r;return e=n,r=a,[o,s]})}return l.hexagon=function(e){return"m"+c(null==e?t:+e).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(n/r),l=Math.round(i/e),c=u*r;c<o+t;c+=r,++u)for(var h=l*e+(1&u)*e/2;h<a+e/2;h+=e)s.push([h,c]);return s},l.mesh=function(){var e=c(t).slice(0,4).join("l");return l.centers().map(function(t){return"M"+t+"m"+e}).join("")},l.x=function(t){return arguments.length?(s=t,l):s},l.y=function(t){return arguments.length?(u=t,l):u},l.radius=function(i){return arguments.length?(e=2*(t=+i)*Math.sin(Pc),r=1.5*t,l):t},l.size=function(t){return arguments.length?(i=n=0,a=+t[0],o=+t[1],l):[a-i,o-n]},l.extent=function(t){return arguments.length?(i=+t[0][0],n=+t[0][1],a=+t[1][0],o=+t[1][1],l):[[i,n],[a,o]]},l.radius(1)};function Lc(){}var jc={colorDomain:null,colorRange:[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],getColorValue:{type:"accessor",value:function(t){return t.length}},lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:Lc,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:function(t){return t.length}},elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:Lc,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(t,e){var r=t.data,i=t.radius,n=t.getPosition,a=function(t,e){var r=e.getDistanceScales().pixelsPerMeter;return t*r[0]}(i,e),o=[],s=Uo(r),u=s.iterable,l=s.objectInfo,c=!0,h=!1,p=void 0;try{for(var f,d=u[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=f.value;l.index++,o.push(Object.assign({screenCoord:e.projectFlat(n(v,l))},v))}}catch(t){h=!0,p=t}finally{try{c||null==d.return||d.return()}finally{if(h)throw p}}return{hexagons:Cc().radius(a).x(function(t){return t.screenCoord[0]}).y(function(t){return t.screenCoord[1]})(o).map(function(t,r){return{position:e.unprojectFlat([t.x,t.y]),points:t,index:r}})}},getPosition:{type:"accessor",value:function(t){return t.position}},fp64:!1,material:new ea},zc=function(t){function e(){return Object(s.a)(this,e),St(this,Tt(e).apply(this,arguments))}return Pt(e,Us),Object(u.a)(e,[{key:"initializeState",value:function(){this.state={hexagons:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:Lc,elevationScaleFunc:Lc,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(t){var e=this,r=t.oldProps,i=t.props,n=t.changeFlags,a=this.getDimensionChanges(r,i);n.dataChanged||this.needsReProjectPoints(r,i)?this.getHexagons():a&&a.forEach(function(t){return"function"==typeof t&&t.apply(e)})}},{key:"needsReProjectPoints",value:function(t,e){return t.radius!==e.radius||t.hexagonAggregator!==e.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getColor:[{id:"value",triggers:["getColorValue"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(t,e){var r=this.state.dimensionUpdaters,i=[];for(var n in r){var a=r[n].find(function(r){return r.triggers.some(function(r){return t[r]!==e[r]})});a&&i.push(a.updater)}return i.length?i:null}},{key:"getHexagons",value:function(){var t=this.props.hexagonAggregator,e=this.context.viewport,r=t(this.props,e),i=r.hexagons,n=r.hexagonVertices;this.updateRadiusAngle(n),this.setState({hexagons:i}),this.getSortedBins()}},{key:"getPickingInfo",value:function(t){var e=t.info,r=this.state,i=r.sortedColorBins,n=r.sortedElevationBins,a=null;if(e.picked&&e.index>-1){var o=this.state.hexagons[e.index],s=i.binMap[o.index]&&i.binMap[o.index].value,u=n.binMap[o.index]&&n.binMap[o.index].value;a=Object.assign({colorValue:s,elevationValue:u},o)}return Object.assign(e,{picked:Boolean(a),object:a})}},{key:"getUpdateTriggers",value:function(){var t=this,e=this.state.dimensionUpdaters,r={},i=function(i){r[i]={};var n=!0,a=!1,o=void 0;try{for(var s,u=e[i][Symbol.iterator]();!(n=(s=u.next()).done);n=!0){s.value.triggers.forEach(function(e){r[i][e]=t.props[e]})}}catch(t){a=!0,o=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}};for(var n in e)i(n);return r}},{key:"updateRadiusAngle",value:function(t){var e=this.props.radius,r=90;if(Array.isArray(t)){t.length<6&&E.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var i=t[0],n=t[3],a=this.context.viewport.getDistanceScales().pixelsPerMeter,o=this.projectFlat(i),s=this.projectFlat(n),u=o[0]-s[0],l=o[1]-s[1],c=Math.sqrt(u*u+l*l);r=Math.acos(u/c)*-Math.sign(l)/Math.PI*180+90,e=c/2/a[0]}this.setState({angle:r,radius:e})}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var t=this.props.getColorValue,e=new Tc(this.state.hexagons||[],t);this.setState({sortedColorBins:e}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var t=this.props.getElevationValue,e=new Tc(this.state.hexagons||[],t);this.setState({sortedElevationBins:e}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var t=this.props,e=t.lowerPercentile,r=t.upperPercentile,i=t.onSetColorDomain;e>r&&E.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([e,r]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var t=this.props,e=t.elevationLowerPercentile,r=t.elevationUpperPercentile,i=t.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([e,r]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var t=this.props.colorRange,e=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Ac(e,t)}},{key:"getElevationScale",value:function(){var t,e,r=this.props.elevationRange,i=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=(t=i,e=r,function(r){return(r-t[0])/(t[1]-t[0])*(e[1]-e[0])+e[0]})}},{key:"_onGetSublayerColor",value:function(t){var e=this.state,r=e.sortedColorBins,i=e.colorScaleFunc,n=e.colorValueDomain,a=r.binMap[t.index]&&r.binMap[t.index].value,o=this.props.colorDomain||n,s=a>=o[0]&&a<=o[o.length-1]?i(a):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(t){var e=this.state,r=e.sortedElevationBins,i=e.elevationScaleFunc,n=e.elevationValueDomain,a=r.binMap[t.index]&&r.binMap[t.index].value,o=this.props.elevationDomain||n;return a>=o[0]&&a<=o[o.length-1]?i(a):-1}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,r=t.extruded,i=t.coverage,n=t.material,a=t.fp64,o=t.transitions,s=this.state,u=s.angle,l=s.radius;return new(this.getSubLayerClass("hexagon-cell",Ec))({fp64:a,radius:l,diskResolution:6,elevationScale:e,angle:u,extruded:r,coverage:i,material:n,getColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getColor:o.getColorValue,getElevation:o.getElevationValue}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons})}}]),e}();zc.layerName="HexagonLayer",zc.defaultProps=jc;var Rc=r(31),Fc=r.n(Rc),Dc=r(29),Bc=r.n(Dc);r.d(e,"crimer",function(){return Vc});const Nc={latitude:37.79056523653,longitude:-122.44857881825685,zoom:8,bearing:0,pitch:30};Bc.a.accessToken="pk.eyJ1IjoibXBtY2tlbm5hOCIsImEiOiJfYWx3RlJZIn0.v-vrWv_t1ytntvWpeePhgQ";const Uc=new Bc.a.Map({container:"map",style:"mapbox://styles/mapbox/light-v9",interactive:!1,center:[Nc.longitude,Nc.latitude],zoom:Nc.zoom,bearing:Nc.bearing,pitch:Nc.pitch}),Vc=fetch("https://data.sfgov.org/resource/wg3w-h783.json?$limit=3000&$order=incident_datetime DESC").then(t=>t.json()).then(t=>{let e=Fc()(JSON.stringify(t)).geojson.features.map(t=>{let e=t.geometry.coordinates;return[parseFloat(e[1]),parseFloat(e[0])]});console.log(e);new Ql({canvas:"deck-canvas",width:"100%",height:"100%",initialViewState:Nc,controller:!0,onViewStateChange:({viewState:t})=>{Uc.jumpTo({center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch})},layers:[new zc({id:"heatmap",data:e,elevationScale:10,extruded:!0,radius:400,getPosition:t=>t,opacity:.4})]})});document.body.style.margin="0px"}]);